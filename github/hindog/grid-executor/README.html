<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h2><a id="user-content-grid-executor" class="anchor" href="https://github.com/hindog/grid-executor#grid-executor" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Grid Executor</h2> 
  <p>This project allows for remote-execution of JVM with the only remote dependency being password-less SSH. </p> 
  <h4><a id="user-content-features" class="anchor" href="https://github.com/hindog/grid-executor#features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h4> 
  <ul> 
   <li>Maintains a synchronized remote copy of application jars so when new application code is released, only changed jars are uploaded to remote instances on grid initialization.</li> 
   <li>Implements <code>ExecutorService</code> to support submitting <code>Runnable</code> and/or <code>Callable[T]</code> to the grid nodes.</li> 
   <li>Contains hooks for Scala <code>Future[T]</code> to allow for transparent grid execution by wrapping the <code>GridExecutor</code> in a Scala <code>ExecutionContext</code>.</li> 
   <li>By default, the library will bind remote STDOUT/STDERR to local STDOUT/STDERR and optionally STDIN can be bound as well.</li> 
   <li>Support for remote shells (ie: Spark-shell on a Hadoop gateway box)</li> 
  </ul> 
  <h4><a id="user-content-import" class="anchor" href="https://github.com/hindog/grid-executor#import" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Import</h4> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.hindog.grid.</span><span class="pl-v">_</span></pre>
  </div> 
  <h4><a id="user-content-ssh-key" class="anchor" href="https://github.com/hindog/grid-executor#ssh-key" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SSH Key</h4> 
  <p>Below is a set of commands that can be used to install password-less SSH (<code>ssh-copy-id</code> can also be used)</p> 
  <div class="highlight highlight-source-shell">
   <pre><span class="pl-c"><span class="pl-c">#</span> install pssh if not already installed</span>
brew install pssh

<span class="pl-c"><span class="pl-c">#</span> generate an SSH key if one isn't already present </span>
<span class="pl-k">if</span> [ <span class="pl-k">!</span> <span class="pl-k">-f</span> <span class="pl-k">~</span>/.ssh/id_rsa ]<span class="pl-k">;</span> <span class="pl-k">then</span> ssh-keygen -t rsa -b 2048 -N <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span> -f <span class="pl-k">~</span>/.ssh/id_rsa<span class="pl-k">;</span> <span class="pl-k">else</span> <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>Key already exists<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">fi</span>

<span class="pl-c"><span class="pl-c">#</span> Space-delimited list of hosts to install the key on</span>
<span class="pl-c"><span class="pl-c">#</span> ie: export REMOTE_HOSTS="server1.example.com server2.example.com"</span>
<span class="pl-k">export</span> REMOTE_HOSTS=<span class="pl-s"><span class="pl-pds">"</span>server1.example.com server2.example.com<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> create .ssh folder remotely if it doesn't already exist</span>
pssh -i -A -x -oStrictHostKeyChecking=no -H <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$REMOTE_HOSTS</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">'</span>if [ ! -d ~/.ssh ]; then mkdir ~/.ssh/; fi<span class="pl-pds">'</span></span>

<span class="pl-c"><span class="pl-c">#</span> cat your public key into each remote box's authorized_keys file</span>
cat <span class="pl-k">~</span>/.ssh/id_rsa.pub <span class="pl-k">|</span> pssh -i -A -I -x -oStrictHostKeyChecking=no -H <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$REMOTE_HOSTS</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">'</span>cat /dev/stdin &gt;&gt; .ssh/authorized_keys<span class="pl-pds">'</span></span>

<span class="pl-c"><span class="pl-c">#</span> change permissions for SSH files (it won't work without this!)</span>
pssh -i -A -x -oStrictHostKeyChecking=no -H <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$REMOTE_HOSTS</span><span class="pl-pds">"</span></span> chmod 700 .ssh
pssh -i -A -x -oStrictHostKeyChecking=no -H <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$REMOTE_HOSTS</span><span class="pl-pds">"</span></span> chmod 600 .ssh/authorized_keys</pre>
  </div> 
  <h4><a id="user-content-configuration" class="anchor" href="https://github.com/hindog/grid-executor#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h4> 
  <p>Configuration is provided though a properties file. Properties are scoped by <code>grid.</code>. </p> 
  <pre><code>
# Configures your remote username (if different from your local username)

grid.remote\:account.&lt;local username&gt;=&lt;remote username&gt;

# Adds JVM arg to ALL remote executions
grid.jvm\:xx\:permgen=-XX:MaxPermSize=768M

# Sets GridKit's "remote-runtime:jar-cache" property to determine where to store jars remotely (here we override the default [/tmp/nanocloud] to the user's [~/.jar-cache] on the remote box)
grid.remote-runtime\:jar-cache=.jar-cache

# Sets GridKit's "node:config-trace" property to dump ViEngine config on startup
grid.node\:config-trace=true

# Adds JVM args specific to remote executions on 'myGrid' nodes
grid.jvm\:xx\:mx.myGrid=-Xmx8g
grid.jvm\:exec-command.myGrid=/path/to/java

# User override to enable remote debug server that client can connect to
#grid.jvm\:xx\:debug.myGrid.ahiniker=-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5004

# User override to enable remote debug client that will connect to our IDE on startup (replace the IP with your laptop's IP)
#grid.jvm\:xx\:debug.myGrid.ahiniker=-agentlib:jdwp=transport=dt_socket,server=n,address=10.170.1.45:5004,suspend=y
</code></pre> 
  <h4><a id="user-content-examples" class="anchor" href="https://github.com/hindog/grid-executor#examples" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Examples</h4> 
  <p>All of the examples below assume the following imports/base trait to provide some default grid definitions. Also, it references a classpath resource of <code>grid.properties</code> that contains any configuration properties as outlined above.</p> 
  <p>NOTE: the grid definitions refer to <code>server1.example.com</code> and <code>server2.example.com</code>, these should be replaced with hostnames configured on your network. Password-less SSH needs to be configured for each host. </p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">com.hindog.grid.examples</span>

<span class="pl-k">import</span> <span class="pl-v">java.lang.management.</span><span class="pl-v">ManagementFactory</span>
<span class="pl-k">import</span> <span class="pl-v">java.util.concurrent.</span><span class="pl-v">Callable</span>

<span class="pl-k">import</span> <span class="pl-v">com.hindog.grid.GridConfigurable.</span><span class="pl-v">Hook</span>
<span class="pl-k">import</span> <span class="pl-v">com.hindog.grid.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">grizzled.slf4j.</span><span class="pl-v">Logging</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">_</span>

<span class="pl-k">trait</span> <span class="pl-en">GridExampleApp</span> <span class="pl-k">extends</span> <span class="pl-e">App</span> {

    <span class="pl-k">def</span> <span class="pl-en">message</span>(<span class="pl-v">msg</span>: <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Hello!<span class="pl-pds">"</span></span>) <span class="pl-k">=</span> s<span class="pl-s"><span class="pl-pds">"</span>$msg [thread: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">Thread</span>.currentThread().getId <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> within process: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">ManagementFactory</span>.getRuntimeMXBean().getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>]<span class="pl-pds">"</span></span>

    <span class="pl-k">val</span> <span class="pl-en">configOneRemote</span><span class="pl-k">:</span> <span class="pl-en">GridConfig</span> <span class="pl-k">=</span> <span class="pl-en">GridConfig</span>(
        <span class="pl-s"><span class="pl-pds">"</span>myGrid<span class="pl-pds">"</span></span>,
        <span class="pl-en">RemoteNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>server1.example.com<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server1<span class="pl-pds">"</span></span>) <span class="pl-c"><span class="pl-c">//</span> host + alias</span>
    ).withPropertyOverrides(<span class="pl-en">System</span>.getProperties).withPropertyOverrides(properties)

    <span class="pl-k">val</span> <span class="pl-en">configTwoRemote</span><span class="pl-k">:</span> <span class="pl-en">GridConfig</span> <span class="pl-k">=</span> <span class="pl-en">GridConfig</span>(
        <span class="pl-s"><span class="pl-pds">"</span>myGrid<span class="pl-pds">"</span></span>,
        <span class="pl-en">RemoteNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>server1.example.com<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server1<span class="pl-pds">"</span></span>), <span class="pl-c"><span class="pl-c">//</span> host + alias</span>
        <span class="pl-en">RemoteNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>server2.example.com<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server2<span class="pl-pds">"</span></span>) <span class="pl-c"><span class="pl-c">//</span> host + alias</span>
    ).withPropertyOverrides(<span class="pl-en">System</span>.getProperties).withPropertyOverrides(properties)
}
</pre>
  </div> 
  <h4><a id="user-content-scala-executioncontext--future-example" class="anchor" href="https://github.com/hindog/grid-executor#scala-executioncontext--future-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala ExecutionContext / Future Example</h4> 
  <p>Demonstrates how we can use GridExecutor with Scala's <code>Future[T]</code> natively without any GridExecutor specific code. Parallel collections are not supported.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">GridExecutorScalaFutureExample</span> <span class="pl-k">extends</span> <span class="pl-e">GridExampleApp</span> {

    <span class="pl-k">val</span> <span class="pl-en">remoteNodeConfig</span> <span class="pl-k">=</span> configOneRemote.nodes.head

    <span class="pl-k">val</span> <span class="pl-en">remoteNode1</span> <span class="pl-k">=</span> remoteNodeConfig.withName(remoteNodeConfig.name <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>-1<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">remoteNode2</span> <span class="pl-k">=</span> remoteNodeConfig.withName(remoteNodeConfig.name <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>-2<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">localNode1</span> <span class="pl-k">=</span>  <span class="pl-en">LocalNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>local-1<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">localNode2</span> <span class="pl-k">=</span>  <span class="pl-en">LocalNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>local-2<span class="pl-pds">"</span></span>)

    <span class="pl-c"><span class="pl-c">//</span> Set our config to use 2 remote and 2 local execution slots (4 total)</span>
    <span class="pl-k">val</span> <span class="pl-en">config2</span> <span class="pl-k">=</span> configOneRemote.withNodes(remoteNode1, remoteNode2, localNode1, localNode2)

    <span class="pl-c"><span class="pl-c">//</span> create an implicit ExecutionContext to execute against</span>
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">ec</span> <span class="pl-k">=</span> <span class="pl-en">ExecutionContext</span>.fromExecutorService(<span class="pl-en">GridExecutor</span>(config2))

    <span class="pl-c"><span class="pl-c">//</span> No references to GridExecutor are present in the following code</span>
    <span class="pl-c"><span class="pl-c">//</span> This will use scala's Future to run tasks in parallel using remote JVMs</span>
    <span class="pl-c"><span class="pl-c">//</span> We throw a Thread.sleep to simulate real work, total time should reflect parallel execution completed</span>
    <span class="pl-c"><span class="pl-c">//</span> the work in less time than sequential execution</span>
    <span class="pl-k">val</span> <span class="pl-en">start</span> <span class="pl-k">=</span> <span class="pl-en">System</span>.currentTimeMillis()

    <span class="pl-k">val</span> <span class="pl-en">futures</span> <span class="pl-k">=</span> (<span class="pl-c1">0</span> to <span class="pl-c1">20</span>).map(i <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span> {
        println(message(s<span class="pl-s"><span class="pl-pds">"</span>executing task $i<span class="pl-pds">"</span></span>))
        <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">1000</span>)
        s<span class="pl-s"><span class="pl-pds">"</span>result $i<span class="pl-pds">"</span></span>
    })

    <span class="pl-k">val</span> <span class="pl-en">results</span> <span class="pl-k">=</span> <span class="pl-en">Await</span>.result(<span class="pl-en">Future</span>.sequence(futures), <span class="pl-en">Duration</span>.<span class="pl-en">Inf</span>)
    println(s<span class="pl-s"><span class="pl-pds">"</span>results = $results<span class="pl-pds">"</span></span>)
    println(<span class="pl-s"><span class="pl-pds">"</span>total time: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> (<span class="pl-en">System</span>.currentTimeMillis() <span class="pl-k">-</span> start) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>ms<span class="pl-pds">"</span></span>)
    ec.shutdown()
}</pre>
  </div> 
  <h4><a id="user-content-single-use-example" class="anchor" href="https://github.com/hindog/grid-executor#single-use-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Single-use Example</h4> 
  <p>Demonstates how to initialize a grid whose life-cycle is scoped to a single task.</p> 
  <p>NOTE: the overhead in instantiating the cloud will be incurred on each invocation (as part of the future), but once the jars have sync'ed then subsequent invocations will have reduced overhead.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">GridExecutorSingleFutureExample</span> <span class="pl-k">extends</span> <span class="pl-e">GridExampleApp</span> {

    <span class="pl-k">import</span> <span class="pl-v">scala.collection.JavaConverters.</span><span class="pl-v">_</span>
    <span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>

    <span class="pl-k">val</span> <span class="pl-en">fut</span> <span class="pl-k">=</span> <span class="pl-en">GridExecutor</span>.future(configOneRemote) {
        println(message())
        <span class="pl-en">System</span>.getenv().asScala.toSeq.sortBy(_._1)
    }

    <span class="pl-en">Await</span>.result(fut, <span class="pl-en">Duration</span>.<span class="pl-en">Inf</span>).foreach(kv <span class="pl-k">=&gt;</span> println(kv._1 <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> kv._2))
}</pre>
  </div> 
  <h4><a id="user-content-multi-use-example" class="anchor" href="https://github.com/hindog/grid-executor#multi-use-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Multi-use Example</h4> 
  <p>Demonstates how to initialize a grid whose life-cycle is scoped to <code>thunk</code>. Can be used to submit multiple tasks in an ad-hoc fashion.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">GridExecutorScopedMultiUseExample</span> <span class="pl-k">extends</span> <span class="pl-e">GridExampleApp</span> {

    <span class="pl-c"><span class="pl-c">//</span> Submit 2 tasks and print their results</span>
    <span class="pl-en">GridExecutor</span>.withInstance(configTwoRemote) { executor <span class="pl-k">=&gt;</span>
        <span class="pl-k">val</span> <span class="pl-en">fut1</span> <span class="pl-k">=</span> executor.submit(<span class="pl-k">new</span> <span class="pl-en">Callable</span>[<span class="pl-k">String</span>] {
            <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">call</span>()<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> {
                println(<span class="pl-s"><span class="pl-pds">"</span>started task A<span class="pl-pds">"</span></span>)
                <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">5000</span>)
                message(<span class="pl-s"><span class="pl-pds">"</span>result A<span class="pl-pds">"</span></span>)
            }
        })

        <span class="pl-k">val</span> <span class="pl-en">fut2</span> <span class="pl-k">=</span> executor.submit(<span class="pl-k">new</span> <span class="pl-en">Callable</span>[<span class="pl-k">String</span>] {
            <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">call</span>()<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> {
                println(<span class="pl-s"><span class="pl-pds">"</span>started task B<span class="pl-pds">"</span></span>)
                <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">5000</span>)
                message(<span class="pl-s"><span class="pl-pds">"</span>result B<span class="pl-pds">"</span></span>)
            }
        })

        println(<span class="pl-s"><span class="pl-pds">"</span>Future 1 result: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> fut1.get())
        println(<span class="pl-s"><span class="pl-pds">"</span>Future 2 result: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> fut2.get())
    }

}</pre>
  </div> 
  <h4><a id="user-content-startupshutdown-hooks-example" class="anchor" href="https://github.com/hindog/grid-executor#startupshutdown-hooks-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Startup/Shutdown Hooks Example</h4> 
  <p>Startup/Shutdown hooks allow arbirary code to be registered for execution as part of each node's startup or shutdown sequence.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">GridExecutorScopedWithInitializationExample</span> <span class="pl-k">extends</span> <span class="pl-e">Logging</span> {
    <span class="pl-k">var</span> <span class="pl-en">globalValue</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>default value<span class="pl-pds">"</span></span>

    <span class="pl-k">def</span> <span class="pl-en">main</span>(<span class="pl-v">args</span>: <span class="pl-en">Array</span>[<span class="pl-k">String</span>]) <span class="pl-k">=</span> {

        <span class="pl-c"><span class="pl-c">//</span> Define an initialization process by using 'addStartupHook(new Hook("name") {...})'</span>

        <span class="pl-c"><span class="pl-c">//</span> below we will add a hook to set the 'globalValue' on the remote box on startup</span>
        <span class="pl-k">val</span> <span class="pl-en">baseConfig</span><span class="pl-k">:</span> <span class="pl-en">GridConfig</span> <span class="pl-k">=</span> <span class="pl-en">GridConfig</span>(
            <span class="pl-s"><span class="pl-pds">"</span>myGrid<span class="pl-pds">"</span></span>,
            <span class="pl-en">RemoteNodeConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>server1.example.com<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server1<span class="pl-pds">"</span></span>)
        ).withPropertyOverrides(<span class="pl-en">System</span>.getProperties)

        <span class="pl-k">val</span> <span class="pl-en">config</span> <span class="pl-k">=</span> baseConfig.addStartupHook(<span class="pl-k">new</span> <span class="pl-en">Hook</span>(<span class="pl-s"><span class="pl-pds">"</span>my init hook<span class="pl-pds">"</span></span>) {
            <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">run</span>()<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
                <span class="pl-c"><span class="pl-c">//</span> modify our global variable</span>
                println(<span class="pl-s"><span class="pl-pds">"</span>running initialization...<span class="pl-pds">"</span></span>)
                println(<span class="pl-en">GridExecutorScopedWithInitializationExample</span>.globalValue)
                <span class="pl-en">GridExecutorScopedWithInitializationExample</span>.globalValue <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>initialized value<span class="pl-pds">"</span></span>
            }
        }).addShutdownHook(<span class="pl-k">new</span> <span class="pl-en">Hook</span>(<span class="pl-s"><span class="pl-pds">"</span>my shutdown hook<span class="pl-pds">"</span></span>) {
            <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">run</span>()<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
                info(<span class="pl-s"><span class="pl-pds">"</span>running delay<span class="pl-pds">"</span></span>)
                <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">1000</span>)
            }
        })

        <span class="pl-k">val</span> <span class="pl-en">fut</span> <span class="pl-k">=</span> <span class="pl-en">GridExecutor</span>.future(config) {
            <span class="pl-c"><span class="pl-c">//</span> should return the value set via our initialization hook</span>
            <span class="pl-en">GridExecutorScopedWithInitializationExample</span>.globalValue
        }

        <span class="pl-c"><span class="pl-c">//</span> should reflect the init'ed value</span>
        println(<span class="pl-s"><span class="pl-pds">"</span>remote globalValue: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">Await</span>.result(fut, <span class="pl-en">Duration</span>.<span class="pl-en">Inf</span>))
        <span class="pl-c"><span class="pl-c">//</span> local value should be unchanged</span>
        println(<span class="pl-s"><span class="pl-pds">"</span>local globalValue: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> globalValue)
    }
}</pre>
  </div> 
  <h4><a id="user-content-local-fork-example" class="anchor" href="https://github.com/hindog/grid-executor#local-fork-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Local Fork Example</h4> 
  <p>Demonstrates how to configure a local node that can be used for running code in a forked JVM.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">GridExecutorLocalForkExample</span> <span class="pl-k">extends</span> <span class="pl-e">App</span> {
    <span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>

    println(<span class="pl-s"><span class="pl-pds">"</span>host jvm: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">ManagementFactory</span>.getRuntimeMXBean.getName)

    <span class="pl-k">val</span> <span class="pl-en">config1</span><span class="pl-k">:</span> <span class="pl-en">GridConfig</span> <span class="pl-k">=</span> <span class="pl-en">GridConfig</span>.localFork(<span class="pl-s"><span class="pl-pds">"</span>fork 1<span class="pl-pds">"</span></span>).withMaxHeap(<span class="pl-s"><span class="pl-pds">"</span>20m<span class="pl-pds">"</span></span>).withMinHeap(<span class="pl-s"><span class="pl-pds">"</span>20m<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">config2</span><span class="pl-k">:</span> <span class="pl-en">GridConfig</span> <span class="pl-k">=</span> <span class="pl-en">GridConfig</span>.localFork(<span class="pl-s"><span class="pl-pds">"</span>fork 2<span class="pl-pds">"</span></span>).withMaxHeap(<span class="pl-s"><span class="pl-pds">"</span>40m<span class="pl-pds">"</span></span>).withMinHeap(<span class="pl-s"><span class="pl-pds">"</span>40m<span class="pl-pds">"</span></span>)

    <span class="pl-k">val</span> <span class="pl-en">fut1</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> <span class="pl-en">GridExecutor</span>.future(config1) {
        println(<span class="pl-s"><span class="pl-pds">"</span>forked jvm 1: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">ManagementFactory</span>.getRuntimeMXBean.getName)
        println(<span class="pl-s"><span class="pl-pds">"</span>total memory 1: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">Runtime</span>.getRuntime.totalMemory())
        <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">5000</span>)
    }

    <span class="pl-k">val</span> <span class="pl-en">fut2</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> <span class="pl-en">GridExecutor</span>.future(config2) {
        println(<span class="pl-s"><span class="pl-pds">"</span>forked jvm 2: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">ManagementFactory</span>.getRuntimeMXBean.getName)
        println(<span class="pl-s"><span class="pl-pds">"</span>total memory 2: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-en">Runtime</span>.getRuntime.totalMemory())
        <span class="pl-en">Thread</span>.sleep(<span class="pl-c1">5000</span>)
    }

    <span class="pl-en">Await</span>.result(<span class="pl-en">Future</span>.sequence(<span class="pl-en">Seq</span>(fut1, fut2)), <span class="pl-c1">10</span> seconds)

}</pre>
  </div> 
 </article>
</div>