<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-reliable-http-client" class="anchor" href="https://github.com/arkadius/reliable-http-client#reliable-http-client" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>reliable-http-client</h1> 
  <p><a href="https://circleci.com/gh/arkadius/reliable-http-client/tree/master" target="_blank"><img src="https://camo.githubusercontent.com/bf71a6215ad60ecad040413651a88d5fcc4e41da/68747470733a2f2f636972636c6563692e636f6d2f67682f61726b61646975732f72656c6961626c652d687474702d636c69656e742f747265652f6d61737465722e7376673f7374796c653d736869656c6426636972636c652d746f6b656e3d31323837393332646164323936326439353464366561633238396433366362346635613035653262" alt="circle-ci" data-canonical-src="https://circleci.com/gh/arkadius/reliable-http-client/tree/master.svg?style=shield&amp;circle-token=1287932dad2962d954d6eac289d36cb4f5a05e2b" style="max-width:100%;"></a> <a href="https://sputnik.ci/app#/builds/arkadius/reliable-http-client" target="_blank"><img src="https://camo.githubusercontent.com/d75f42c227d28b007c5b44caab8a95b8cf0124a1/68747470733a2f2f737075746e696b2e63692f636f6e662f6261646765" alt="Sputnik" data-canonical-src="https://sputnik.ci/conf/badge" style="max-width:100%;"></a> <a href="https://www.codacy.com/app/arek-burdach/reliable-http-client" target="_blank"><img src="https://camo.githubusercontent.com/a648d5ae573ec41c2d3e08e63b316c99153e22a1/68747470733a2f2f6170692e636f646163792e636f6d2f70726f6a6563742f62616467652f67726164652f3436623838326630356338373436386138343962383830356662396165623638" alt="Codacy Badge" data-canonical-src="https://api.codacy.com/project/badge/grade/46b882f05c87468a849b8805fb9aeb68" style="max-width:100%;"></a> <a href="http://waffle.io/arkadius/reliable-http-client" target="_blank"><img src="https://camo.githubusercontent.com/87c1fbeebe23301843b908ae58ed69c0bacd66b7/68747470733a2f2f62616467652e776166666c652e696f2f61726b61646975732f72656c6961626c652d687474702d636c69656e742e7376673f6c6162656c3d7265616479267469746c653d5265616479" alt="Stories in Ready" data-canonical-src="https://badge.waffle.io/arkadius/reliable-http-client.svg?label=ready&amp;title=Ready" style="max-width:100%;"></a> <a href="https://gitter.im/arkadius/reliable-http-client?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/arkadius/reliable-http-client" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a></p> 
  <p><em>Reliable Http Client</em> is a set of tools making HTTP communication more reliable. It supports: <em>at least one delivery guaranty</em> and <em>retry strategies</em> including <em>durable exponential backoff</em> and <em>dead letter queue</em>.</p> 
  <p>It abstracting from publisher/subscriber transport. Currently there are implemented <a href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol" target="_blank">AMQP</a> transport and <a href="https://github.com/json4s/json4s" target="_blank">Json4s</a> serialization modules.</p> 
  <p>It can be used with any HTTP client. It includes wrapper for <em>Akka HTTP</em> in separate module, but You can use it with your own. In fact, it can be used with any request/response client, not necessarily HTTP.</p> 
  <p>There are 3 basic usage scenarios:</p> 
  <ul> 
   <li>in-only: when You are not interested in response, You only want to make sure that request was delivered</li> 
   <li>in-out: when You are interested in response but your response consumer is stateless</li> 
   <li>in-out with subscriptions for response: when You are interested in response and your response consumer is stateful</li> 
  </ul> 
  <p>For the third scenario there is also provided module with <em>persistent Akka FSM Actors</em> (using <em>akka-persistence</em>) for easy recovery of subscriptions for responses.</p> 
  <h2><a id="user-content-amqp-transport" class="anchor" href="https://github.com/arkadius/reliable-http-client#amqp-transport" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AMQP transport</h2> 
  <p>If You only want to use <em>Akka</em> wrapper for <em>amqp-client</em> with <em>Json4s</em> serialization</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.rhttpc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>rhttpc-amqp<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.8.0<span class="pl-pds">"</span></span>
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.rhttpc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>rhttpc-json4s<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.8.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Than:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.amqp.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.CommonFormats.</span><span class="pl-v">_</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>()
<span class="pl-k">import</span> <span class="pl-v">actorSystem.</span><span class="pl-v">dispatcher</span>

<span class="pl-en">AmqpConnectionFactory</span>.connect(actorSystem).map { connection <span class="pl-k">=&gt;</span>
  <span class="pl-k">val</span> <span class="pl-en">transport</span> <span class="pl-k">=</span> <span class="pl-en">AmqpTransport</span>(connection)
  
  <span class="pl-k">val</span> <span class="pl-en">publisher</span> <span class="pl-k">=</span> transport.publisher[<span class="pl-k">String</span>](<span class="pl-s"><span class="pl-pds">"</span>foo-queue<span class="pl-pds">"</span></span>)
  publisher.publish(<span class="pl-s"><span class="pl-pds">"</span>foo-message<span class="pl-pds">"</span></span>)
  
  <span class="pl-k">val</span> <span class="pl-en">subscriber</span> <span class="pl-k">=</span> transport.subscriber[<span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>bar-queue<span class="pl-pds">"</span></span>, actorSystem.actorOf(<span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">Actor</span> {
    <span class="pl-k">def</span> <span class="pl-en">receive</span><span class="pl-k">:</span> <span class="pl-en">Receive</span> <span class="pl-k">=</span> {
      <span class="pl-k">case</span> <span class="pl-v">i</span>: <span class="pl-k">Int</span> <span class="pl-k">=&gt;</span> println(s<span class="pl-s"><span class="pl-pds">"</span>got: $i<span class="pl-pds">"</span></span>)
    }
  })))
  subscriber.run()
}</pre>
  </div> 
  <h2><a id="user-content-client" class="anchor" href="https://github.com/arkadius/reliable-http-client#client" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Client</h2> 
  <p>For using of client with <em>AMQP</em> transport and <em>Json4s</em> serialization</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.rhttpc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>rhttpc-amqp<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.8.0<span class="pl-pds">"</span></span>
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.rhttpc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>rhttpc-json4s<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.8.0<span class="pl-pds">"</span></span>
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.rhttpc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>rhttpc-client<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.8.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-in-only-scenario" class="anchor" href="https://github.com/arkadius/reliable-http-client#in-only-scenario" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>In-only scenario</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.amqp.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.CommonFormats.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.client.</span><span class="pl-v">_</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>()
<span class="pl-k">import</span> <span class="pl-v">actorSystem.</span><span class="pl-v">dispatcher</span>
<span class="pl-en">AmqpConnectionFactory</span>.connect(actorSystem).map { <span class="pl-k">implicit</span> connection <span class="pl-k">=&gt;</span>
  <span class="pl-k">val</span> <span class="pl-en">client</span> <span class="pl-k">=</span> <span class="pl-en">ReliableClientFactory</span>().inOnly[<span class="pl-k">String</span>](ownClient.send)
  client.send(<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <h3><a id="user-content-in-out-with-stateless-consumer" class="anchor" href="https://github.com/arkadius/reliable-http-client#in-out-with-stateless-consumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>In-out with stateless consumer</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.amqp.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.transport.json4s.CommonFormats.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">rhttpc.client.</span><span class="pl-v">_</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>()
<span class="pl-k">import</span> <span class="pl-v">actorSystem.</span><span class="pl-v">dispatcher</span>
<span class="pl-en">AmqpConnectionFactory</span>.connect(actorSystem).map { <span class="pl-k">implicit</span> connection <span class="pl-k">=&gt;</span>
  <span class="pl-k">val</span> <span class="pl-en">client</span> <span class="pl-k">=</span> <span class="pl-en">ReliableClientFactory</span>().inOut[<span class="pl-k">String</span>, <span class="pl-k">String</span>](
    send <span class="pl-k">=</span> ownClient.send,
    handleResponse <span class="pl-k">=</span> consumer.consume
  )
  client.send(<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <h3><a id="user-content-in-out-with-stateful-consumer" class="anchor" href="https://github.com/arkadius/reliable-http-client#in-out-with-stateful-consumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>In-out with stateful consumer</h3> 
  <p>Consinder situation:</p> 
  <div class="highlight highlight-source-scala">
   <pre>system.actorOf(<span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">Actor</span> {
  <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-en">DoJob</span> <span class="pl-k">=&gt;</span>
      httpClient.send(request) pipeTo <span class="pl-c1">self</span>
    <span class="pl-k">case</span> <span class="pl-en">Response</span> <span class="pl-k">=&gt;</span>
      <span class="pl-c"><span class="pl-c">//</span> handle respone</span>
  }
}))</pre>
  </div> 
  <p>When given actor will be shutdowned e.g. because of a system failure, the response message will never been delivered.</p> 
  <p>Thanks to <em>rhttpc</em> the same execution cause that actor after restart will got the response message.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">rhttpc</span> <span class="pl-k">=</span> <span class="pl-en">ReliableHttpClientFactory</span>().inOutWithSubscriptions(amqpConnection)

system.actorOf(<span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">Actor</span> {
  <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-en">DoJob</span> <span class="pl-k">=&gt;</span>
      <span class="pl-k">val</span> <span class="pl-en">request</span> <span class="pl-k">=</span> <span class="pl-en">HttpRequest</span>().withUri(<span class="pl-s"><span class="pl-pds">"</span>http://ws-host:port<span class="pl-pds">"</span></span>).withMethod(<span class="pl-en">HttpMethods</span>.<span class="pl-en">POST</span>).withEntity(msg)
      rhttpc.send(request).toFuture pipeTo <span class="pl-c1">self</span>
    <span class="pl-k">case</span> <span class="pl-en">Response</span> <span class="pl-k">=&gt;</span>
      <span class="pl-c"><span class="pl-c">//</span> handle respone</span>
  }
}))</pre>
  </div> 
  <p>The example above cause that request/response will be send through <em>AMQP</em> durable queues. If http service idle for a while and during this we need to restart our app, response message will be delivered to response <em>AMQP</em> durable queue. But after restart our application won't know what to do with response - in which state was sending actor. So we need to also persist state of our actor including acknowledged published requests. It can be achived by <em>ReliableFSM</em> delivered by this project.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">rhttpc</span> <span class="pl-k">=</span> <span class="pl-en">ReliableHttpClientFactory</span>().inOutWithSubscriptions(amqpConnection)

system.actorOf(<span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">FooBarActor</span>(rhttpc)), <span class="pl-s"><span class="pl-pds">"</span>app-foobar<span class="pl-pds">"</span></span>)

<span class="pl-k">class</span> <span class="pl-en">FooBarActor</span>(<span class="pl-v">rhttpc</span>: <span class="pl-en">InOutReliableHttpClient</span>) <span class="pl-k">extends</span> <span class="pl-e">ReliableFSM</span>[<span class="pl-en">FooBarState</span>, <span class="pl-en">FooBarData</span>] {
  <span class="pl-k">import</span> <span class="pl-v">context.</span><span class="pl-v">dispatcher</span>
  
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">val</span> <span class="pl-en">id</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>foobar<span class="pl-pds">"</span></span>
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">val</span> <span class="pl-en">persistenceCategory</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>app<span class="pl-pds">"</span></span>
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">val</span> <span class="pl-en">subscriptionManager</span> <span class="pl-k">=</span> rhttpc.subscriptionManager

  startWith(<span class="pl-en">InitState</span>, <span class="pl-en">EmptyData</span>)

  when(<span class="pl-en">InitState</span>) {
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-en">SendMsg</span>(msg), _) <span class="pl-k">=&gt;</span>
      <span class="pl-k">val</span> <span class="pl-en">request</span> <span class="pl-k">=</span> <span class="pl-en">HttpRequest</span>().withUri(<span class="pl-s"><span class="pl-pds">"</span>http://ws-host:port<span class="pl-pds">"</span></span>).withMethod(<span class="pl-en">HttpMethods</span>.<span class="pl-en">POST</span>).withEntity(msg)
      rhttpc.send(request) pipeTo <span class="pl-c1">this</span>
      goto(<span class="pl-en">WaitingForResponseState</span>) replyingAfterSave()
  }
  
  when(<span class="pl-en">WaitingForResponseState</span>) {
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-v">httpResponse</span>: <span class="pl-en">HttpResponse</span>, _) <span class="pl-k">=&gt;</span>
      <span class="pl-c1">self</span> forward httpResponse.entity.<span class="pl-c1">asInstanceOf</span>[<span class="pl-en">HttpEntity</span>.<span class="pl-en">Strict</span>].data.utf8String
      stay()
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>, _) <span class="pl-k">=&gt;</span> goto(<span class="pl-en">FooState</span>) acknowledgingAfterSave()
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-s"><span class="pl-pds">"</span>bar<span class="pl-pds">"</span></span>, _) <span class="pl-k">=&gt;</span> goto(<span class="pl-en">BarState</span>) acknowledgingAfterSave()
  }

  when(<span class="pl-en">FooState</span>, stateTimeout <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes) {
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-en">StateTimeout</span>, _) <span class="pl-k">=&gt;</span> stop()
  }

  when(<span class="pl-en">BarState</span>, stateTimeout <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes) {
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-en">StateTimeout</span>, _) <span class="pl-k">=&gt;</span> stop()
  }

  whenUnhandled {
    <span class="pl-k">case</span> <span class="pl-en">Event</span>(<span class="pl-en">CurrentState</span>, _) <span class="pl-k">=&gt;</span>
      sender() <span class="pl-k">!</span> stateName
      stay()
  }
}</pre>
  </div> 
  <p>Slightly difference is that instead of <code>rhttpc.send(request).toFuture pipeTo self</code> we are doing <code>rhttpc.send(request) pipeTo this</code>. Also our actor extends <em>ReliableFSM</em> which handles messages from queues and persist actor's state. If our application was shutdowned in <em>WaitingForResponseState</em>, after restart actor will recover their state and handle response. Full example you can check out <a href="https://github.com/arkadius/reliable-http-client/blob/master/sample/sample-app/src/main/scala/rhttpc/sample/SampleApp.scala" target="_blank">here</a>. There are also <a href="https://github.com/arkadius/reliable-http-client/blob/master/sample/test/src/test/scala/rhttpc/test/DeliveryResponseAfterRestartWithDockerSpec.scala" target="_blank"><em>Docker</em> tests</a> that reproduce this situation. All you need to run them is installed <em>Docker</em>. If you have one, just run <code>sbt testProj/test 2&gt;&amp;1 | tee test.log</code></p> 
  <h2><a id="user-content-architecture" class="anchor" href="https://github.com/arkadius/reliable-http-client#architecture" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Architecture</h2> 
  <h3><a id="user-content-big-picture" class="anchor" href="https://github.com/arkadius/reliable-http-client#big-picture" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Big picture</h3> 
  <p><a href="https://raw.githubusercontent.com/arkadius/reliable-http-client/images/images/rhttpc-arch2.png" target="_blank"><img src="https://raw.githubusercontent.com/arkadius/reliable-http-client/images/images/rhttpc-arch2.png" alt="Bit picture" style="max-width:100%;"></a></p> 
  <p>Proxy can be also run as separate process.</p> 
  <h3><a id="user-content-request-response-sequence" class="anchor" href="https://github.com/arkadius/reliable-http-client#request-response-sequence" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request-response sequence</h3> 
  <p><a href="https://raw.githubusercontent.com/arkadius/reliable-http-client/images/images/rhttpc-request-response.png" target="_blank"><img src="https://raw.githubusercontent.com/arkadius/reliable-http-client/images/images/rhttpc-request-response.png" alt="Request-response" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-3rd-part-libraries" class="anchor" href="https://github.com/arkadius/reliable-http-client#3rd-part-libraries" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>3rd part libraries</h1> 
  <p><em>rhttpc</em> uses</p> 
  <ul> 
   <li><a href="https://github.com/rabbitmq/rabbitmq-java-client" target="_blank">rabbitmq-client</a> for communication through <em>AMQP</em></li> 
   <li><a href="https://github.com/json4s/json4s" target="_blank">json4s</a> for serialization</li> 
   <li><a href="https://github.com/akka/akka" target="_blank">akka-http</a> for HTTP communication</li> 
   <li><a href="https://github.com/akka/akka" target="_blank">akka-persistence</a> for storing snapshots of FSM states</li> 
  </ul> 
  <h1><a id="user-content-license" class="anchor" href="https://github.com/arkadius/reliable-http-client#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h1> 
  <p>The <em>reliable-http-client</em> is released under version 2.0 of the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License</a>.</p> 
 </article>
</div>