<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-welcome-to-rest-scalasprayakkaslickmysql-example" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#welcome-to-rest-scalasprayakkaslickmysql-example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Welcome to rest scala/spray/akka/slick/mysql example</h1> 
  <p>I have created this project during my research on scala/spray/akka/slick/mysql REST service.</p> 
  <p>It may be used to learn a bit on how to use those technologies to create REST service. It's just a prove of concept though and it's not production ready. It definitely can be used as a good start.</p> 
  <p>Additionally websocket (<a href="https://github.com/wandoulabs/spray-websocket" target="_blank"></a><a href="https://github.com/wandoulabs/spray-websocket" target="_blank">https://github.com/wandoulabs/spray-websocket</a>) was added to project. All events in the REST system like create/update/delete of resource are publishing information to all connected clients via websocket.</p> 
  <p>The database underneath is mysql, but it can be easily switch to any other which is supported by slick.</p> 
  <h3><a id="user-content-system-requirements" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#system-requirements" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>System requirements</h3> 
  <ul> 
   <li>Mysql server - up and running</li> 
   <li>Java with maven is installed</li> 
   <li>That's it</li> 
  </ul> 
  <h3><a id="user-content-configuration" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h3> 
  <ul> 
   <li>Set up user and database on mysql server</li> 
   <li>Edit db.conf in resources to configure db connection</li> 
  </ul> 
  <h3><a id="user-content-adding-new-rest-api" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#adding-new-rest-api" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Adding new REST API</h3> 
  <ul> 
   <li>take a look at com.vixxx123.scalasprayslickexample.example.api.person.PersonApi as example</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">CompanyApi</span>(<span class="pl-k">val</span> <span class="pl-en">actorContext</span><span class="pl-k">:</span> <span class="pl-en">ActorContext</span>, <span class="pl-v">companyDao</span>: <span class="pl-en">CompanyDao</span>, <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">authorization</span><span class="pl-k">:</span> <span class="pl-en">Authorization</span>)
  <span class="pl-k">extends</span> <span class="pl-e">BaseResourceApi</span> <span class="pl-k">with</span> <span class="pl-e">Logging</span> {


<span class="pl-c">  /**</span>
<span class="pl-c">   * Handler val names must be unique in the system - all</span>
<span class="pl-c">   */</span>

  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">companyCreateHandler</span> <span class="pl-k">=</span> actorContext.actorOf(<span class="pl-en">RoundRobinPool</span>(<span class="pl-c1">2</span>).props(<span class="pl-en">CreateActor</span>.props(companyDao)), <span class="pl-en">CreateActor</span>.<span class="pl-en">Name</span>)
  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">companyPutHandler</span> <span class="pl-k">=</span> actorContext.actorOf(<span class="pl-en">RoundRobinPool</span>(<span class="pl-c1">5</span>).props(<span class="pl-en">UpdateActor</span>.props(companyDao)), <span class="pl-en">UpdateActor</span>.<span class="pl-en">Name</span>)
  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">companyGetHandler</span> <span class="pl-k">=</span> actorContext.actorOf(<span class="pl-en">RoundRobinPool</span>(<span class="pl-c1">20</span>).props(<span class="pl-en">GetActor</span>.props(companyDao)), <span class="pl-en">GetActor</span>.<span class="pl-en">Name</span>)
  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">companyDeleteHandler</span> <span class="pl-k">=</span> actorContext.actorOf(<span class="pl-en">RoundRobinPool</span>(<span class="pl-c1">2</span>).props(<span class="pl-en">DeleteActor</span>.props(companyDao)), <span class="pl-en">DeleteActor</span>.<span class="pl-en">Name</span>)

  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">logTag</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> getClass.getName

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">init</span>() <span class="pl-k">=</span> {
    companyDao.initTable()
    <span class="pl-v">super</span>.init()
  }

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">authorisedResource</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">route</span>(<span class="pl-k">implicit</span> <span class="pl-v">userAuth</span>: <span class="pl-en">RestApiUser</span>) <span class="pl-k">=</span> {
    pathPrefix(<span class="pl-en">ResourceName</span>) {
      pathEnd {
        get {
          ctx <span class="pl-k">=&gt;</span> companyGetHandler <span class="pl-k">!</span> <span class="pl-en">GetMessage</span>(ctx, <span class="pl-c1">None</span>)
        } <span class="pl-k">~</span>
          post {
            entity(as[<span class="pl-en">Company</span>]) {
              company <span class="pl-k">=&gt;</span>
                ctx <span class="pl-k">=&gt;</span> companyCreateHandler <span class="pl-k">!</span> <span class="pl-en">CreateMessage</span>(ctx, company)
            }
          }
      } <span class="pl-k">~</span>
      pathPrefix(<span class="pl-en">IntNumber</span>) {
        entityId <span class="pl-k">=&gt;</span> {
          pathEnd {
            get {
              ctx <span class="pl-k">=&gt;</span> companyGetHandler <span class="pl-k">!</span> <span class="pl-en">GetMessage</span>(ctx, <span class="pl-en">Some</span>(entityId))
            } <span class="pl-k">~</span> put {
              entity(as[<span class="pl-en">Company</span>]) { entity <span class="pl-k">=&gt;</span>
                ctx <span class="pl-k">=&gt;</span> companyPutHandler <span class="pl-k">!</span> <span class="pl-en">PutMessage</span>(ctx, entity.copy(id <span class="pl-k">=</span> <span class="pl-en">Some</span>(entityId)))
              }
            } <span class="pl-k">~</span> delete {
              ctx <span class="pl-k">=&gt;</span> companyDeleteHandler <span class="pl-k">!</span> <span class="pl-en">DeleteMessage</span>(ctx, entityId)
            } <span class="pl-k">~</span> patch {
              entity(as[<span class="pl-en">List</span>[<span class="pl-en">JsonNotation</span>]]) { patch <span class="pl-k">=&gt;</span>
                ctx <span class="pl-k">=&gt;</span> companyPutHandler <span class="pl-k">!</span> <span class="pl-en">PatchMessage</span>(ctx, patch, entityId)
              }
            }
          }
        }
      }
    }
  }

}

<span class="pl-k">class</span> <span class="pl-en">CompanyApiBuilder</span> <span class="pl-k">extends</span> <span class="pl-e">Api</span>{
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">create</span>(<span class="pl-v">actorContext</span>: <span class="pl-en">ActorContext</span>, <span class="pl-v">authorization</span>: <span class="pl-en">Authorization</span>)<span class="pl-k">:</span> <span class="pl-en">BaseResourceApi</span> <span class="pl-k">=</span> {
    <span class="pl-k">new</span> <span class="pl-en">CompanyApi</span>(actorContext, <span class="pl-k">new</span> <span class="pl-en">CompanyDao,</span> authorization)
  }
}
</pre>
  </div> 
  <ul> 
   <li>create new routing class - which inherits from BaseResourceApi 
    <ul> 
     <li>method init should be used to initialize resource. It is run once on server start up. I use it to create db tables if they don't exists yet</li> 
     <li>method route - should define REST route for new API</li> 
     <li>method authorisedResource - states if authorization should be turn on/off for this resource </li> 
    </ul></li> 
   <li>create new object/class which inherits from 
    <ul> 
     <li>create method should return new routing class (created in previous step)</li> 
    </ul></li> 
   <li>in RestExampleApp object add your Api class to list.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">RestExampleApp</span> <span class="pl-k">extends</span> <span class="pl-e">App</span> {
  <span class="pl-k">new</span> <span class="pl-en">Rest</span>(<span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>on-spray-can<span class="pl-pds">"</span></span>), <span class="pl-en">List</span>(<span class="pl-en">PersonApi</span>, <span class="pl-en">CompanyApi</span>), <span class="pl-en">List</span>(<span class="pl-k">new</span> <span class="pl-en">ConsoleLogger))</span>
}</pre>
  </div> 
  <ul> 
   <li>that's it - you are good to go</li> 
  </ul> 
  <p>PersonApi class is just an example you don't have to implement handling incoming request same way, but I think it's quite good design. It give a possibility to configure number of workers per request type etc. Of course it is possible to handle request inline and no additional actors are needed. </p> 
  <h3><a id="user-content-features" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h3> 
  <ul> 
   <li>Each type of resource and method can have different numbers of actors - easy to optimise performance</li> 
   <li>Fully based on Akka</li> 
   <li>Uses Slick for persistence - easy to switch between databases (at least it should be easy :) )</li> 
   <li>Push messaging via websocket to all open connections or to specific user</li> 
   <li>Authorization with simplest(client_credentials) OAuth 2 implementation</li> 
  </ul> 
  <h3><a id="user-content-how-to-run" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#how-to-run" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to run</h3> 
  <ul> 
   <li>mvn clean install</li> 
   <li>mvn scala:run -DmainClass=com.vixxx123.scalasprayslickexample.RestExampleApp</li> 
  </ul> 
  <h3><a id="user-content-to-do-" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#to-do-" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>to do ###</h3> 
  <ul> 
   <li>configuration of logging levels</li> 
  </ul> 
  <h3><a id="user-content-have-fun" class="anchor" href="https://github.com/vixxx123/scalasprayslickexample#have-fun" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Have fun</h3> 
 </article>
</div>