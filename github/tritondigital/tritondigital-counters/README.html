<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text"> 
  <p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank">DocToc</a></em></p> 
  <ul> 
   <li><a href="https://github.com/tritondigital/tritondigital-counters#triton-digital-counters" target="_blank">Triton Digital Counters</a> 
    <ul> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#features" target="_blank">Features</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#concepts" target="_blank">Concepts</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#behaviour" target="_blank">Behaviour</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#getting-started" target="_blank">Getting started</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#configuration" target="_blank">Configuration</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#publishing-to-datadog" target="_blank">Publishing to Datadog</a> 
      <ul> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#datadog-configuration" target="_blank">Datadog configuration</a></li> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#datadog-on-docker" target="_blank">Datadog on Docker</a></li> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#limiting-the-number-of-metrics-sent-to-datadog" target="_blank">Limiting the number of metrics sent to Datadog</a></li> 
      </ul></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#publishing-to-logback" target="_blank">Publishing to Logback</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#publishing-new-metrics" target="_blank">Publishing new metrics</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#built-in-metrics" target="_blank">Built-in metrics</a> 
      <ul> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#jmx-basic-metrics" target="_blank">JMX basic metrics</a></li> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#monitoring-logback" target="_blank">Monitoring Logback</a></li> 
       <li><a href="https://github.com/tritondigital/tritondigital-counters#monitoring-akka-actors" target="_blank">Monitoring Akka actors</a></li> 
      </ul></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#appending-global-tags-to-all-metrics" target="_blank">Appending global tags to all metrics</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#providing-custom-gauges-at-publication-time" target="_blank">Providing custom gauges at publication time</a></li> 
     <li><a href="https://github.com/tritondigital/tritondigital-counters#publishing-codahale-metrics" target="_blank">Publishing Codahale Metrics</a></li> 
    </ul></li> 
  </ul> 
  <h1><a id="user-content-build-information-and-status" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#build-information-and-status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Build Information and status</h1> 
  <p><a href="https://travis-ci.org/tritondigital/tritondigital-counters" target="_blank"><img src="https://camo.githubusercontent.com/cdf6f0bd0486c995b8a14f368f1b3298a4c4b60b/68747470733a2f2f7472617669732d63692e6f72672f747269746f6e6469676974616c2f747269746f6e6469676974616c2d636f756e746572732e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/tritondigital/tritondigital-counters.png?branch=master" style="max-width:100%;"></a> <a href="https://coveralls.io/r/tritondigital/tritondigital-counters?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/45a64a1e0ad9cc3b48d024a04b873a131aa22dc0/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f747269746f6e6469676974616c2f747269746f6e6469676974616c2d636f756e746572732f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/tritondigital/tritondigital-counters/badge.svg?branch=master" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-triton-digital-counters" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#triton-digital-counters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Triton Digital Counters</h1> 
  <p>tritondigital-counters allows applications to publish metrics in monitoring systems as easy as logging, from Scala, Java, or any JVM language, with minimal overhead.</p> 
  <p>Currently, the library supports the following integrations:</p> 
  <ul> 
   <li>Datadog</li> 
   <li>Logback</li> 
   <li>Docker</li> 
   <li>Akka</li> 
   <li>Codahale metrics</li> 
  </ul> 
  <p>tritondigital-counters act in a similar spirit to the Codahale metrics, but is adding the publication to a timeseries database, and contextual tags that makes systems like OpenTSDB and Datadog so powerfull for monitoring applications.</p> 
  <h2><a id="user-content-features" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h2> 
  <p>tritondigital-counters supports publication to the following back-ends:</p> 
  <ul> 
   <li>Datadog</li> 
   <li>Logback logs</li> 
  </ul> 
  <p>tritondigital-counters can monitor the following part of your application out of the box:</p> 
  <ul> 
   <li>application lifecycle (start / stop)</li> 
   <li>Logback ERROR and WARNING log entries</li> 
   <li>Akka actors</li> 
   <li>Codahale metrics</li> 
  </ul> 
  <p>But the most important feature is it allows you to publish your own metrics easily.</p> 
  <h2><a id="user-content-concepts" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#concepts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Concepts</h2> 
  <p>Most of the concepts are identical to Codahale metrics one. Please refer to the <a href="https://dropwizard.github.io/metrics/3.1.0/manual/core/" target="_blank">Codahale metrics documentation</a> for what constitute a gauge, a counter, a marker, an histogram, and a timer.</p> 
  <p>tritondigital-counters adds the notion of tags, inherited from the OpenTSDB or Datadog tags. A tag is a bit of metadata associated with a metrics that allows for fine grained queries when retrieving timeseries. Example of tags are:</p> 
  <ul> 
   <li>application name</li> 
   <li>host name</li> 
   <li>response status code</li> 
   <li>etc...</li> 
  </ul> 
  <h2><a id="user-content-behaviour" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#behaviour" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Behaviour</h2> 
  <p>During normal conditions, tritondigital-counters will publish a snapshot of the metrics every publication interval (15 seconds by default).</p> 
  <p>The internal aggregation of metrics is based on Codahale Metrics, so it is fast. Although the metrics are published every few seconds, your application can update them thousends of time per seconds.</p> 
  <p>tritondigital-counters tries to be a good citizen. It is publishing metrics that have stable values less often (10 mins instead of the regular publication interval). This makes monitoring a lot of stable metrics not an issue.</p> 
  <p>When the remote timeseries database is not responding, it will drop the current metrics publication round, and tries to reconnect after the next publication interval.</p> 
  <p>If for whatever reason, publication takes longer than the interval between publication, some publication rounds will be skipped. This is making tritondigital-counters to peaks where a lot of metrics need to be published.</p> 
  <p>Publication time is jittered, so as to avoid resonance phenomena that could harm the target timeseries database.</p> 
  <h2><a id="user-content-getting-started" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#getting-started" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Getting started</h2> 
  <p>Start by adding the dependency to your project:</p> 
  <p><em>For Maven:</em></p> 
  <div class="highlight highlight-text-xml">
   <pre>    &lt;<span class="pl-ent">dependency</span>&gt;
        &lt;<span class="pl-ent">groupId</span>&gt;com.tritondigital&lt;/<span class="pl-ent">groupId</span>&gt;
        &lt;<span class="pl-ent">artifactId</span>&gt;tritondigital-counters_2.10&lt;/<span class="pl-ent">artifactId</span>&gt;
        &lt;<span class="pl-ent">version</span>&gt;1.0.2&lt;/<span class="pl-ent">version</span>&gt;
    &lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p><em>For SBT:</em></p> 
  <div class="highlight highlight-source-scala">
   <pre>    libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.tritondigital<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>tritondigital-counters<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.2<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>You can then start the monitoring process. tritondigital-counters is using akka-io for fast, efficient, and non blocking IO, so you will need to pass it an actor system:</p> 
  <p><em>In Java:</em></p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">ActorSystem</span> actorSystem <span class="pl-k">=</span> <span class="pl-smi">ActorSystem</span><span class="pl-k">.</span>create();
    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .publishToDatadog()
        .build();</pre>
  </div> 
  <p><em>In Scala:</em></p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>()
    <span class="pl-k">val</span> <span class="pl-en">metrics</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">MetricsBuilder</span>(actorSystem)
        .publishToDatadog
        .build</pre>
  </div> 
  <h2><a id="user-content-configuration" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h2> 
  <p>tritondigital-counters is using the <a href="https://github.com/typesafehub/config" target="_blank">typesafe config</a>. You can look at the documentation and default config values in src/main/resources/reference.conf.</p> 
  <h2><a id="user-content-publishing-to-datadog" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#publishing-to-datadog" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publishing to Datadog</h2> 
  <p>For activating the publication to datadog:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .publishToDatadog()
        .build();</pre>
  </div> 
  <h3><a id="user-content-datadog-configuration" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#datadog-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Datadog configuration</h3> 
  <p>You will need datadog agent to run locally on the host. If running elsewhere, you can adjust the following configuration settings:</p> 
  <ul> 
   <li><code>tritondigital_counters.datadog.host</code>: the datadog agent host name or ip (default: localhost)</li> 
   <li><code>tritondigital_counters.datadog.port</code>: the datadog agent host name or ip (default: 8125)</li> 
  </ul> 
  <h3><a id="user-content-datadog-on-docker" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#datadog-on-docker" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Datadog on Docker</h3> 
  <p>If you are running your application and the Datadog agent in Docker containers, you simply need to link the agent using the "datadog" alias:</p> 
  <div class="highlight highlight-source-shell">
   <pre>    docker run -dt --link my-datadog-container-name:datadog my-app</pre>
  </div> 
  <h3><a id="user-content-limiting-the-number-of-metrics-sent-to-datadog" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#limiting-the-number-of-metrics-sent-to-datadog" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Limiting the number of metrics sent to Datadog</h3> 
  <p>Datadog encourages you to think hard which metrics you send to their system. You can adjust which metrics you send to them by implementing a filter:</p> 
  <p><em>In Java:</em></p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-k">import</span> <span class="pl-smi">com.tritondigital.counters.MetricFilter</span>

    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyDGFilter</span> <span class="pl-k">extends</span> <span class="pl-e">MetricFilter</span> {
      <span class="pl-k">public</span> <span class="pl-k">Iterable</span>[<span class="pl-smi">Metric</span>] <span class="pl-en">filter</span>(<span class="pl-v">metrics</span>: <span class="pl-k">Iterable</span>[<span class="pl-smi">Metric</span>]) {
        <span class="pl-c">// Do your filtering here</span>
      }
    }

    <span class="pl-c1">...</span>

    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .publishToDatadog()
        .withDatadogFilter(<span class="pl-k">new</span> <span class="pl-smi">MyDGFilter</span>())
        .build();</pre>
  </div> 
  <p><em>In Scala:</em></p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">import</span> <span class="pl-v">com.tritondigital.counters.</span><span class="pl-v">MetricFilter</span>

    <span class="pl-k">class</span> <span class="pl-en">MyDGFilter</span> <span class="pl-k">extends</span> <span class="pl-e">ScalaMetricFilter</span> {
      <span class="pl-k">def</span> <span class="pl-en">filter</span>(<span class="pl-v">metrics</span>: <span class="pl-en">Iterable</span>[<span class="pl-en">Metric</span>]) <span class="pl-k">=</span> {
        <span class="pl-c">// Do your filtering here</span>
      }
    }

    ...

    <span class="pl-k">val</span> <span class="pl-en">metrics</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">MetricsBuilder</span>(actorSystem)
        .publishToDatadog()
        .withDatadogFilter(<span class="pl-k">new</span> <span class="pl-en">MyDGFilter</span>())
        .build()</pre>
  </div> 
  <p>If all you need to do is have a white list of metrics to send, a filter is readily useable:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .publishToDatadog()
        .withDatadogFilter(<span class="pl-k">new</span> <span class="pl-smi">MetricPrefixFilter</span>(<span class="pl-k">new</span> <span class="pl-smi">String</span>[]{ <span class="pl-s"><span class="pl-pds">"</span>log.<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>my-app.<span class="pl-pds">"</span></span> }))
        .build();</pre>
  </div> 
  <h2><a id="user-content-publishing-to-logback" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#publishing-to-logback" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publishing to Logback</h2> 
  <p>For debugging or in the tests, it can be usefull to publish the metrics value in your application log:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .publishToLogback()
        .build();</pre>
  </div> 
  <h2><a id="user-content-publishing-new-metrics" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#publishing-new-metrics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publishing new metrics</h2> 
  <p>You can now publish various kind of metrics:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-c">// Counters</span>
    metrics<span class="pl-k">.</span>incrementCounter(<span class="pl-s"><span class="pl-pds">"</span>some.metric.without.tags<span class="pl-pds">"</span></span>);

    <span class="pl-c">// Meters</span>
    metrics<span class="pl-k">.</span>markMeter(<span class="pl-s"><span class="pl-pds">"</span>some.meter<span class="pl-pds">"</span></span>);

    <span class="pl-c">// Histograms</span>
    metrics<span class="pl-k">.</span>updateHistogram(<span class="pl-s"><span class="pl-pds">"</span>some.histogram<span class="pl-pds">"</span></span>, <span class="pl-c1">88</span>);

    <span class="pl-c">// Timers</span>
    metrics<span class="pl-k">.</span>updateTimer(<span class="pl-s"><span class="pl-pds">"</span>some.timer<span class="pl-pds">"</span></span>, <span class="pl-c1">67</span>, <span class="pl-smi">TimeUnit</span><span class="pl-c1"><span class="pl-k">.</span>MILLIS</span>);

    <span class="pl-c">// Gauges</span>
    metrics<span class="pl-k">.</span>setGaugeValue(<span class="pl-s"><span class="pl-pds">"</span>some.gauge<span class="pl-pds">"</span></span>, <span class="pl-c1">1.45</span>);

    <span class="pl-c">// All methods support contextual tags</span>
    metrics<span class="pl-k">.</span>incrementCounter(<span class="pl-s"><span class="pl-pds">"</span>some.metric.with.tags<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">Tag</span>(<span class="pl-s"><span class="pl-pds">"</span>custom-tag-1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>), <span class="pl-k">new</span> <span class="pl-smi">Tag</span>(<span class="pl-s"><span class="pl-pds">"</span>custom-tag-2<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>));
    metrics<span class="pl-k">.</span>incrementCounter(<span class="pl-s"><span class="pl-pds">"</span>some.metric.with.tags<span class="pl-pds">"</span></span>, <span class="pl-c1">10</span>, <span class="pl-k">new</span> <span class="pl-smi">Tag</span>(<span class="pl-s"><span class="pl-pds">"</span>custom-tag-1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>), <span class="pl-k">new</span> <span class="pl-smi">Tag</span>(<span class="pl-s"><span class="pl-pds">"</span>custom-tag-2<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>));</pre>
  </div> 
  <p>That being said, timeseries databases only support gauges. So tritondigital-counters is creating gauges out of those high level metrics. Here are the gauges actually published by tritondigital-counters:</p> 
  <p><code>Gauges</code></p> 
  <p>The gauges are published as is.</p> 
  <p><code>Counters</code></p> 
  <p>The counters are published as is.</p> 
  <p><code>Meters</code></p> 
  <p>The following gauges are published for meters:</p> 
  <ul> 
   <li>Suffix: <code>.count</code></li> 
   <li><p>The total number of time the meter has been marked (= how many data points)</p></li> 
   <li><p>Suffix: <code>.m1</code></p></li> 
   <li>The 1 minute moving average</li> 
  </ul> 
  <p><code>Histograms</code></p> 
  <p>The following gauges are published for histograms:</p> 
  <ul> 
   <li>Suffix: <code>.count</code></li> 
   <li><p>The total number of time the histogram has been updated (= how many data points)</p></li> 
   <li><p>Suffix: <code>.median</code></p></li> 
   <li><p>The median value (.50th quantile)</p></li> 
   <li><p>Suffix: <code>.p75</code></p></li> 
   <li><p>.75th quantile</p></li> 
   <li><p>Suffix: <code>.p99</code></p></li> 
   <li>.99th quantile</li> 
  </ul> 
  <p><code>Timers</code></p> 
  <p>A timer is an histogram and a meter, and thus the gauges for both meters and histograms are published. The values' unit are milliseconds.</p> 
  <h2><a id="user-content-built-in-metrics" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#built-in-metrics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Built-in metrics</h2> 
  <p>Out of the box, some metrics are published.</p> 
  <h3><a id="user-content-jmx-basic-metrics" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#jmx-basic-metrics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>JMX basic metrics</h3> 
  <ul> 
   <li><code>java.heap.usage</code>: heap used in MB, as given by the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/MemoryMXBean.html" target="_blank"><code>java.lang.management.MemoryMXBean</code></a></li> 
   <li><code>java.cpu.load</code>: system load, as given by the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/OperatingSystemMXBean.html" target="_blank"><code>java.lang.management.OperatingSystemMXBean</code></a></li> 
  </ul> 
  <h3><a id="user-content-monitoring-logback" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#monitoring-logback" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Monitoring Logback</h3> 
  <p>If you want tritondigital-counters to monitor your logs, you can activate it by:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .monitorLogback()
        .build();</pre>
  </div> 
  <p>This will yield the following metrics:</p> 
  <ul> 
   <li><code>log.error.count</code> and <code>log.error.m1</code>: errors logged in Logback. 2 tags are given: <code>exception</code> which is the exception class anem that have been logged (if any) and <code>inner</code> which is the inner exception class name of that exception (if any).</li> 
   <li><code>log.warn.count</code> and <code>log.warn.m1</code>: warnings logged in Logback. 2 tags are given: <code>exception</code> which is the exception class anem that have been logged (if any) and <code>inner</code> which is the inner exception class name of that exception (if any).</li> 
  </ul> 
  <h3><a id="user-content-monitoring-akka-actors" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#monitoring-akka-actors" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Monitoring Akka actors</h3> 
  <p>You can monitor your Akka actors. For that, a utility wrapping the receive method is provided.</p> 
  <p><em>In Java:</em></p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-k">import</span> <span class="pl-smi">com.tritondigital.counters.Metrics</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.tritondigital.counters.akka.ActorWithMetrics</span>;

    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyActor</span> <span class="pl-k">extends</span> <span class="pl-e">ActorWithMetrics</span> {
        <span class="pl-k">public</span> <span class="pl-en">MyActor</span>(<span class="pl-smi">Metrics</span> <span class="pl-v">metrics</span>) {
            <span class="pl-v">super</span>(metrics);
        }
        <span class="pl-k">@Override</span>
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">wrappedOnReceive</span>(<span class="pl-smi">Object</span> <span class="pl-v">message</span>) <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
            <span class="pl-c">// Your logic that you used to place in onReceive()</span>
        }
    }</pre>
  </div> 
  <p><em>In Scala:</em></p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">import</span> <span class="pl-v">com.tritondigital.counters.</span><span class="pl-v">Metrics</span>
    <span class="pl-k">import</span> <span class="pl-v">com.tritondigital.counters.akka.</span><span class="pl-v">ActorMetrics</span>

    <span class="pl-k">class</span> <span class="pl-en">MyActor</span>(<span class="pl-k">val</span> <span class="pl-en">metrics</span><span class="pl-k">:</span> <span class="pl-en">Metrics</span>) <span class="pl-k">extends</span> <span class="pl-e">Actor</span> <span class="pl-k">with</span> <span class="pl-e">ActorMetrics</span> {
      <span class="pl-k">def</span> <span class="pl-en">wrappedReceive</span> <span class="pl-k">=</span> {
        <span class="pl-k">case</span> message <span class="pl-k">=&gt;</span>
          <span class="pl-c">// Your logic that you used to place in receive {}</span>
      }
    }</pre>
  </div> 
  <p>This will yield the following metrics:</p> 
  <ul> 
   <li><code>akka.actor.message</code> (timer with .count, .m1, .median, .p75, and .p99): number of message processed, and time to process them. 2 tags: <code>path</code>, for the actor path, and <code>mclass</code> for the message class name.</li> 
  </ul> 
  <h2><a id="user-content-appending-global-tags-to-all-metrics" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#appending-global-tags-to-all-metrics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Appending global tags to all metrics</h2> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .addGlobalTag(<span class="pl-s"><span class="pl-pds">"</span>my-app-tag-name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>my-app-tag-value<span class="pl-pds">"</span></span>)
        .build();</pre>
  </div> 
  <h2><a id="user-content-providing-custom-gauges-at-publication-time" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#providing-custom-gauges-at-publication-time" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Providing custom gauges at publication time</h2> 
  <p>Sometimes, you have access to gauges at all time, and all you need is to "plug" those values at publication time. You can achieve that by implimenting a custom metrics provider:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-k">import</span> <span class="pl-smi">com.tritondigital.counters.MetricsProvider</span>
    <span class="pl-k">import</span> <span class="pl-smi">scala.concurrent.Future</span>

    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyCustomProvider</span> <span class="pl-k">implements</span> <span class="pl-e">MetricsProvider</span> {
      <span class="pl-k">public</span> <span class="pl-k">Future&lt;<span class="pl-k">Metric</span>[]&gt;</span> <span class="pl-en">provide</span>() {
        <span class="pl-c">// Return your metrics here</span>
      }
    }

    <span class="pl-c1">...</span>

    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .addProvider(<span class="pl-k">new</span> <span class="pl-smi">MyCustomProvider</span>())
        .build();</pre>
  </div> 
  <h2><a id="user-content-publishing-codahale-metrics" class="anchor" href="https://github.com/tritondigital/tritondigital-counters#publishing-codahale-metrics" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publishing Codahale Metrics</h2> 
  <p>A provider exists for Codahale Metrics registry. You don't need a registry yourself (this is redundant with the com.tritondigital.counters.Metrics), but if an other library is providing one, you can make tritondigital-counters publish this library's metrics:</p> 
  <div class="highlight highlight-source-java">
   <pre>    <span class="pl-smi">MetricRegistry</span> registry <span class="pl-k">=</span> <span class="pl-c1">...</span>; <span class="pl-c">// Get the Codahale's registry</span>
    <span class="pl-smi">Metrics</span> metrics <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MetricsBuilder</span>(actorSystem)
        .addProvider(<span class="pl-k">new</span> <span class="pl-smi">CodahaleMetricsProvider</span>(actorSystem, registry))
        .build();</pre>
  </div> 
  <p>The rules for converting gauges, counters, meters, histograms, and timers to gauges for publication also apply for Codahale Metrics.</p> 
 </article>
</div>