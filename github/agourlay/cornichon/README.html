<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-cornichon----" class="anchor" href="https://github.com/agourlay/cornichon#cornichon----" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>cornichon <a href="https://travis-ci.org/agourlay/cornichon" target="_blank"><img src="https://camo.githubusercontent.com/3545a834d73ad7cb1d54b8aa07816b6e7c0a0af0/68747470733a2f2f7472617669732d63692e6f72672f61676f75726c61792f636f726e6963686f6e2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/agourlay/cornichon.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/com.github.agourlay/cornichon_2.11" target="_blank"><img src="https://camo.githubusercontent.com/9f27b1cdb0f7767f700746d8b138698b9dda8532/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f636f6d2e6769746875622e61676f75726c61792f636f726e6963686f6e5f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/com.github.agourlay/cornichon_2.11/badge.svg" style="max-width:100%;"></a> <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank"><img src="https://camo.githubusercontent.com/3f21d5eba19dbec0c6fc855b442b90d44b8e50f6/687474703a2f2f696d672e736869656c64732e696f2f3a6c6963656e73652d417061636865253230322d627269676874677265656e2e737667" alt="License" data-canonical-src="http://img.shields.io/:license-Apache%202-brightgreen.svg" style="max-width:100%;"></a> <a href="https://gitter.im/agourlay/cornichon?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/agourlay/cornichon" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a></h1> 
  <p>An extensible Scala DSL for testing JSON HTTP APIs.</p> 
  <h2><a id="user-content-table-of-contents" class="anchor" href="https://github.com/agourlay/cornichon#table-of-contents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Table of contents</h2> 
  <ol> 
   <li><a href="https://github.com/agourlay/cornichon#quick-start" target="_blank">Quick start</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#structure" target="_blank">Structure</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#dsl" target="_blank">DSL</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#built-in-steps" target="_blank">Built-in steps</a> 
    <ol> 
     <li><a href="https://github.com/agourlay/cornichon#http-effects" target="_blank">HTTP effects</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#http-assertions" target="_blank">HTTP assertions</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#http-streams" target="_blank">HTTP streams</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#graphql-support" target="_blank">GraphQL support</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#session-steps" target="_blank">Session steps</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#wrapper-steps" target="_blank">Wrapper steps</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#debug-steps" target="_blank">Debug steps</a></li> 
    </ol></li> 
   <li><a href="https://github.com/agourlay/cornichon#dsl-composition" target="_blank">DSL composition</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#placeholders" target="_blank">Placeholders</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#custom-steps" target="_blank">Custom steps</a> 
    <ol> 
     <li><a href="https://github.com/agourlay/cornichon#effectStep" target="_blank">EffectStep</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#effectStep-using-the-http-service" target="_blank">EffectStep using the HTTP service</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#assertstep" target="_blank">AssertStep</a></li> 
    </ol></li> 
   <li><a href="https://github.com/agourlay/cornichon#feature-options" target="_blank">Feature options</a> 
    <ol> 
     <li><a href="https://github.com/agourlay/cornichon#before-and-after-hooks" target="_blank">Before and after hooks</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#base-url" target="_blank">Base URL</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#request-timeout" target="_blank">Request timeout</a></li> 
     <li><a href="https://github.com/agourlay/cornichon#register-custom-extractors" target="_blank">Register custom extractors</a></li> 
    </ol></li> 
   <li><a href="https://github.com/agourlay/cornichon#execution-model" target="_blank">Execution model</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#ignoring-features-or-scenarios" target="_blank">Ignoring features or scenarios</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#custom-http-body-type" target="_blank">Custom HTTP body type</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#scalatest-integration" target="_blank">ScalaTest integration</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#ssl-configuration" target="_blank">SSL configuration</a></li> 
   <li><a href="https://github.com/agourlay/cornichon#license" target="_blank">License</a></li> 
  </ol> 
  <h2><a id="user-content-quick-start" class="anchor" href="https://github.com/agourlay/cornichon#quick-start" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Quick start</h2> 
  <p>Add the library dependency</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.github.agourlay<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>cornichon<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.10.3<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Cornichon is currently integrated with <a href="http://www.scalatest.org/" target="_blank">ScalaTest</a>, place your <code>Feature</code> files inside <code>src/test/scala</code> and run them using <code>sbt test</code>.</p> 
  <p>A <code>Feature</code> is a class extending <code>CornichonFeature</code> and implementing the required <code>feature</code> function.</p> 
  <p>How does it look like? </p> 
  <p>Find below an example of testing the Open Movie Database API.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.github.agourlay.cornichon.</span><span class="pl-v">CornichonFeature</span>

<span class="pl-k">class</span> <span class="pl-en">ReadmeExample</span> <span class="pl-k">extends</span> <span class="pl-e">CornichonFeature</span> {

  <span class="pl-k">def</span> <span class="pl-en">feature</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>OpenMovieDatabase API<span class="pl-pds">"</span></span>){

    <span class="pl-en">Scenario</span>(<span class="pl-s"><span class="pl-pds">"</span>list GOT season 1 episodes<span class="pl-pds">"</span></span>){

      <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://www.omdbapi.com<span class="pl-pds">"</span></span>).withParams(
        <span class="pl-s"><span class="pl-pds">"</span>t<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Game of Thrones<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>Season<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>
      )

      <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)

      <span class="pl-en">And</span> assert body.ignoring(<span class="pl-s"><span class="pl-pds">"</span>Episodes<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Response<span class="pl-pds">"</span></span>).is(
        <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">        {</span>
<span class="pl-s">          "Title": "Game of Thrones",</span>
<span class="pl-s">          "Season": "1"</span>
<span class="pl-s">        }</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>)

      <span class="pl-en">And</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>Episodes<span class="pl-pds">"</span></span>).is(
        <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">        |                Title                    |   Released   | Episode | imdbRating |   imdbID    |</span>
<span class="pl-s">        | "Winter Is Coming"                      | "2011-04-17" |   "1"   |    "8.1"   | "tt1480055" |</span>
<span class="pl-s">        | "The Kingsroad"                         | "2011-04-24" |   "2"   |    "7.8"   | "tt1668746" |</span>
<span class="pl-s">        | "Lord Snow"                             | "2011-05-01" |   "3"   |    "7.6"   | "tt1829962" |</span>
<span class="pl-s">        | "Cripples, Bastards, and Broken Things" | "2011-05-08" |   "4"   |    "7.7"   | "tt1829963" |</span>
<span class="pl-s">        | "The Wolf and the Lion"                 | "2011-05-15" |   "5"   |    "8.0"   | "tt1829964" |</span>
<span class="pl-s">        | "A Golden Crown"                        | "2011-05-22" |   "6"   |    "8.1"   | "tt1837862" |</span>
<span class="pl-s">        | "You Win or You Die"                    | "2011-05-29" |   "7"   |    "8.1"   | "tt1837863" |</span>
<span class="pl-s">        | "The Pointy End"                        | "2011-06-05" |   "8"   |    "7.9"   | "tt1837864" |</span>
<span class="pl-s">        | "Baelor"                                | "2011-06-12" |   "9"   |    "8.6"   | "tt1851398" |</span>
<span class="pl-s">        | "Fire and Blood"                        | "2011-06-19" |  "10"   |    "8.4"   | "tt1851397" |</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>)

      <span class="pl-en">And</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>Episodes<span class="pl-pds">"</span></span>).asArray.hasSize(<span class="pl-c1">10</span>)

      <span class="pl-en">And</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>Episodes[0]<span class="pl-pds">"</span></span>).is(
        <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">        {</span>
<span class="pl-s">          "Title": "Winter Is Coming",</span>
<span class="pl-s">          "Released": "2011-04-17",</span>
<span class="pl-s">          "Episode": "1",</span>
<span class="pl-s">          "imdbRating": "8.1",</span>
<span class="pl-s">          "imdbID": "tt1480055"</span>
<span class="pl-s">        }</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>)

      <span class="pl-en">And</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>Episodes[0].Released<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>2011-04-17<span class="pl-pds">"</span></span>)

      <span class="pl-en">And</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>Episodes<span class="pl-pds">"</span></span>).asArray.contains(
        <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">        {</span>
<span class="pl-s">          "Title": "Winter Is Coming",</span>
<span class="pl-s">          "Released": "2011-04-17",</span>
<span class="pl-s">          "Episode": "1",</span>
<span class="pl-s">          "imdbRating": "8.1",</span>
<span class="pl-s">          "imdbID": "tt1480055"</span>
<span class="pl-s">        }</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>)
    }
  }
}</pre>
  </div> 
  <p>For more examples see the following files which are part of the test pipeline:</p> 
  <ul> 
   <li><p><a href="https://github.com/agourlay/cornichon/blob/master/src/test/scala/com/github/agourlay/cornichon/examples/superHeroes/SuperHeroesScenario.scala" target="_blank">Embedded Superheroes API</a>.</p></li> 
   <li><p><a href="https://github.com/agourlay/cornichon/blob/master/src/it/scala/com.github.agourlay.cornichon.examples/OpenMovieDatabase.scala" target="_blank">OpenMovieDatabase API</a>.</p></li> 
   <li><p><a href="https://github.com/agourlay/cornichon/blob/master/src/it/scala/com.github.agourlay.cornichon.examples/DeckOfCard.scala" target="_blank">DeckOfCard API</a>.</p></li> 
   <li><p><a href="https://github.com/agourlay/cornichon/blob/master/src/it/scala/com.github.agourlay.cornichon.examples/StarWars.scala" target="_blank">Star Wars API</a>.</p></li> 
   <li><p><a href="https://github.com/agourlay/cornichon/blob/master/src/test/scala/com/github/agourlay/cornichon/examples/math/MathScenario.scala" target="_blank">Math Operations</a>.</p></li> 
  </ul> 
  <h2><a id="user-content-structure" class="anchor" href="https://github.com/agourlay/cornichon#structure" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Structure</h2> 
  <p>A Cornichon test is the definition of a so-called <code>feature</code>. </p> 
  <p>A <code>feature</code> can have several <code>scenarios</code> which in turn can have several <code>steps</code>.</p> 
  <p>The example below contains one <code>feature</code> with one <code>scenario</code> with two <code>steps</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">CornichonExamplesSpec</span> <span class="pl-k">extends</span> <span class="pl-e">CornichonFeature</span> {

  <span class="pl-k">def</span> <span class="pl-en">feature</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>Checking google<span class="pl-pds">"</span></span>){

    <span class="pl-en">Scenario</span>(<span class="pl-s"><span class="pl-pds">"</span>Google is up and running<span class="pl-pds">"</span></span>){

      <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://google.com<span class="pl-pds">"</span></span>)

      <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">302</span>)
    }
  }
}</pre>
  </div> 
  <p>The failure modes are the following:</p> 
  <ul> 
   <li><p>A <code>feature</code> fails if one or more <code>scenarios</code> fail.</p></li> 
   <li><p>A <code>scenario</code> fails if at least one <code>step</code> fails.</p></li> 
   <li><p>A <code>scenario</code> will stop at the first failed step encountered and ignore the remaining <code>steps</code>.</p></li> 
  </ul> 
  <h2><a id="user-content-dsl" class="anchor" href="https://github.com/agourlay/cornichon#dsl" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>DSL</h2> 
  <p>The content of a <code>feature</code> is described using a domain-specific language (DSL) providing a clear structure for statement definitions.</p> 
  <p>The structure of a step statement is the following:</p> 
  <p>1 - starts with either <code>Given</code> - <code>When</code> - <code>And</code> - <code>Then</code></p> 
  <p>The prefixes do not change the behavior of the steps but are present to improve the readability.</p> 
  <p>2 - followed by any single word (could be several words wrapped in back-ticks)</p> 
  <p>This structure was chosen to increase the freedom of customization while still benefiting from Scala's infix notation.</p> 
  <p>3 - ending with a <code>step</code> definition</p> 
  <p>The usage pattern is often to first run a <code>step</code> with a side effect then assert an expected state in a second <code>step</code>.</p> 
  <p>For example :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Given</span> <span class="pl-en">I</span> step_definition

<span class="pl-en">When</span> a step_definition

<span class="pl-en">And</span> \`another really important\` step_definition

<span class="pl-en">Then</span> assert step_definition
</pre>
  </div> 
  <p><code>step_definition</code> stands here for any object of type <code>Step</code>, those can be manually defined or simply built-in in Cornichon.</p> 
  <h2><a id="user-content-built-in-steps" class="anchor" href="https://github.com/agourlay/cornichon#built-in-steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Built-in steps</h2> 
  <p>Cornichon has a set of built-in steps for various HTTP calls and assertions on the response.</p> 
  <h3><a id="user-content-http-effects" class="anchor" href="https://github.com/agourlay/cornichon#http-effects" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>HTTP effects</h3> 
  <ul> 
   <li>GET, DELETE, HEAD, OPTIONS, POST, PUT and PATCH use the same request builder for request's body, URL parameters and headers.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>head(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/daredevil<span class="pl-pds">"</span></span>)

get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/daredevil<span class="pl-pds">"</span></span>).withParams(
  <span class="pl-s"><span class="pl-pds">"</span>firstParam<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>value1<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>secondParam<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>value2<span class="pl-pds">"</span></span>)

delete(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/daredevil<span class="pl-pds">"</span></span>).withHeaders((<span class="pl-s"><span class="pl-pds">"</span>Authorization<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==<span class="pl-pds">"</span></span>))

post(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>).withBody(<span class="pl-s"><span class="pl-pds">"</span>JSON description of Batman goes here<span class="pl-pds">"</span></span>)

put(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>).withBody(<span class="pl-s"><span class="pl-pds">"</span>JSON description of Batman goes here<span class="pl-pds">"</span></span>).withParams(
  <span class="pl-s"><span class="pl-pds">"</span>firstParam<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>value1<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>secondParam<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>value2<span class="pl-pds">"</span></span>)

patch(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>).withBody(<span class="pl-s"><span class="pl-pds">"</span>JSON description of Batman goes here<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>There is a built-in support for HTTP body defined as String, if you wish to use other types please check out the section <a href="https://github.com/agourlay/cornichon#custom-http-body-type" target="_blank">Custom HTTP body type</a>.</p> 
  <h3><a id="user-content-http-assertions" class="anchor" href="https://github.com/agourlay/cornichon#http-assertions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>HTTP assertions</h3> 
  <ul> 
   <li>assert response status</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>status.is(<span class="pl-c1">200</span>)
</pre>
  </div> 
  <ul> 
   <li>assert response headers</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>headers.name(<span class="pl-s"><span class="pl-pds">"</span>cache-control<span class="pl-pds">"</span></span>).isPresent

headers.contain(<span class="pl-s"><span class="pl-pds">"</span>cache-control<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>no-cache<span class="pl-pds">"</span></span>)

headers.name(<span class="pl-s"><span class="pl-pds">"</span>cache_control<span class="pl-pds">"</span></span>).isAbsent

save_header_value(<span class="pl-s"><span class="pl-pds">"</span>cache_control<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>my-cache-control-value<span class="pl-pds">"</span></span>)
</pre>
  </div> 
  <ul> 
   <li>assert response body comes with different flavors (ignoring, whitelisting)</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>body.is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "Batman",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "city": "Gotham city",</span>
<span class="pl-s">    "hasSuperpowers": false,</span>
<span class="pl-s">    "publisher":{</span>
<span class="pl-s">      "name":"DC",</span>
<span class="pl-s">      "foundationYear":1934,</span>
<span class="pl-s">      "location":"Burbank, California"</span>
<span class="pl-s">    }</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)

body.ignoring(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>hasSuperpowers<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>publisher.foundationYear<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>publisher.location<span class="pl-pds">"</span></span>).is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "Batman",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "publisher":{</span>
<span class="pl-s">      "name":"DC"</span>
<span class="pl-s">    }</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)

body.whitelisting.is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "Batman",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "publisher":{</span>
<span class="pl-s">      "name":"DC"</span>
<span class="pl-s">    }</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)</pre>
  </div> 
  <p>Ignored keys and extractors are JsonPaths following the format "a.b.c[int].d"</p> 
  <p>JsonPath can also be used to only assert part of the response</p> 
  <div class="highlight highlight-source-scala">
   <pre>body.path(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>Gotham city<span class="pl-pds">"</span></span>)

body.path(<span class="pl-s"><span class="pl-pds">"</span>hasSuperpowers<span class="pl-pds">"</span></span>).is(<span class="pl-c1">false</span>)

body.path(<span class="pl-s"><span class="pl-pds">"</span>publisher.name<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>DC<span class="pl-pds">"</span></span>)

body.path(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>).containsString(<span class="pl-s"><span class="pl-pds">"</span>Gotham<span class="pl-pds">"</span></span>)

body.path(<span class="pl-s"><span class="pl-pds">"</span>publisher.foundationYear<span class="pl-pds">"</span></span>).is(<span class="pl-c1">1934</span>)

body.path(<span class="pl-s"><span class="pl-pds">"</span>publisher.foundationYear<span class="pl-pds">"</span></span>).isPresent

body.path(<span class="pl-s"><span class="pl-pds">"</span>publisher.foundationMonth<span class="pl-pds">"</span></span>).isAbsent
</pre>
  </div> 
  <p>If one key of the path contains a "." it has to be wrapped with "`" to notify the parser.</p> 
  <div class="highlight highlight-source-scala">
   <pre>body.path(<span class="pl-s"><span class="pl-pds">"</span>`message.en`<span class="pl-pds">"</span></span>).isPresent

body.path(<span class="pl-s"><span class="pl-pds">"</span>`message.fr`<span class="pl-pds">"</span></span>).isAbsent
</pre>
  </div> 
  <p>If the endpoint returns a collection assert response body has several options (ordered, ignoring and using data table)</p> 
  <div class="highlight highlight-source-scala">
   <pre>body.asArray.inOrder.ignoringEach(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>hasSuperpowers<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>publisher<span class="pl-pds">"</span></span>).is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  [{</span>
<span class="pl-s">    "name": "Batman",</span>
<span class="pl-s">    "realName": "Bruce Wayne"</span>
<span class="pl-s">  },</span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "Superman",</span>
<span class="pl-s">    "realName": "Clark Kent"</span>
<span class="pl-s">  }]</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)

body.asArray.inOrder.ignoringEach(<span class="pl-s"><span class="pl-pds">"</span>publisher<span class="pl-pds">"</span></span>).is(
 <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  |    name     |    realName    |     city      |  hasSuperpowers |</span>
<span class="pl-s">  | "Batman"    | "Bruce Wayne"  | "Gotham city" |      false      |</span>
<span class="pl-s">  | "Superman"  | "Clark Kent"   | "Metropolis"  |      true       |</span>
<span class="pl-s"> <span class="pl-pds">"""</span></span>)  

body.asArray.hasSize(<span class="pl-c1">2</span>)

body.asArray.isNotEmpty

body.asArray.contains(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "Batman",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "city": "Gotham city",</span>
<span class="pl-s">    "hasSuperpowers": false,</span>
<span class="pl-s">    "publisher":{</span>
<span class="pl-s">      "name":"DC",</span>
<span class="pl-s">      "foundationYear":1934,</span>
<span class="pl-s">      "location":"Burbank, California"</span>
<span class="pl-s">    }</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)
</pre>
  </div> 
  <h3><a id="user-content-http-streams" class="anchor" href="https://github.com/agourlay/cornichon#http-streams" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>HTTP streams</h3> 
  <ul> 
   <li>Server-Sent-Event.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">When</span> <span class="pl-en">I</span> open_sse(s<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/stream<span class="pl-pds">"</span></span>, takeWithin <span class="pl-k">=</span> <span class="pl-c1">1.</span>seconds).withParams(<span class="pl-s"><span class="pl-pds">"</span>justName<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>)

<span class="pl-en">Then</span> assert body.asArray.hasSize(<span class="pl-c1">2</span>)

<span class="pl-en">Then</span> assert body.is(<span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  |   eventType      |    data     |</span>
<span class="pl-s">  | "superhero name" |  "Batman"   |</span>
<span class="pl-s">  | "superhero name" | "Superman"  |</span>
<span class="pl-s"><span class="pl-pds">"""</span></span>)</pre>
  </div> 
  <p>SSE streams are aggregated over a period of time in an array, therefore the previous array predicates can be re-used.</p> 
  <h3><a id="user-content-graphql-support" class="anchor" href="https://github.com/agourlay/cornichon#graphql-support" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>GraphQL support</h3> 
  <p>Cornichon offers an integration with the library <a href="https://github.com/sangria-graphql/sangria" target="_blank">Sangria</a> to propose convenient features to test GraphQL API.</p> 
  <ul> 
   <li>GraphQL query</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">sangria.macros.</span><span class="pl-v">_</span>

 <span class="pl-en">When</span> <span class="pl-en">I</span> query_gql(<span class="pl-s"><span class="pl-pds">"</span>/&lt;project-key&gt;/graphql<span class="pl-pds">"</span></span>).withQuery(
    graphql<span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">      query MyQuery {</span>
<span class="pl-s">        superheroes {</span>
<span class="pl-s">          results {</span>
<span class="pl-s">            name</span>
<span class="pl-s">            realName</span>
<span class="pl-s">            publisher {</span>
<span class="pl-s">              name</span>
<span class="pl-s">            }</span>
<span class="pl-s">          }</span>
<span class="pl-s">        }</span>
<span class="pl-s">      }</span>
<span class="pl-s">    <span class="pl-pds">"""</span></span>
    )
</pre>
  </div> 
  <p><code>query_gql</code> can also be used for mutation query.</p> 
  <ul> 
   <li>GraphQL JSON</li> 
  </ul> 
  <p>all built-in steps accepting String input/output can also accept an alternative lightweight JSON format using the <code>gql</code> StringContext.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.github.agourlay.cornichon.json.CornichonJson.</span><span class="pl-v">_</span>

<span class="pl-en">And</span> assert body.ignoring(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>publisher<span class="pl-pds">"</span></span>).is(
  gql<span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    name: "Batman",</span>
<span class="pl-s">    realName: "Bruce Wayne",</span>
<span class="pl-s">    hasSuperpowers: false</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>)</pre>
  </div> 
  <h3><a id="user-content-session-steps" class="anchor" href="https://github.com/agourlay/cornichon#session-steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Session steps</h3> 
  <ul> 
   <li>setting a value in <code>session</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>save(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>Batman<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <ul> 
   <li>saving value to `<code>session</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>save_body_path(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>batman-city<span class="pl-pds">"</span></span>)
</pre>
  </div> 
  <ul> 
   <li>asserting value in <code>session</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>session_value(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>Batman<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <ul> 
   <li>asserting JSON value in <code>session</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>session_value(<span class="pl-s"><span class="pl-pds">"</span>my-json-response<span class="pl-pds">"</span></span>).asJson.path(<span class="pl-s"><span class="pl-pds">"</span>a.b.c<span class="pl-pds">"</span></span>).ignoring(<span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>).is(...)</pre>
  </div> 
  <ul> 
   <li>asserting existence of value in <code>session</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>  session_value(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span>).isPresent
  session_value(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span>).isAbsent</pre>
  </div> 
  <h3><a id="user-content-wrapper-steps" class="anchor" href="https://github.com/agourlay/cornichon#wrapper-steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Wrapper steps</h3> 
  <p>Wrapper steps allow to control the execution of a series of steps to build more powerful tests.</p> 
  <ul> 
   <li>repeating a series of <code>steps</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Repeat</span>(<span class="pl-c1">3</span>) {
  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}</pre>
  </div> 
  <ul> 
   <li>repeating a series of <code>steps</code> during a period of time</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">RepeatDuring</span>(<span class="pl-c1">300.</span>millis) {
  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}</pre>
  </div> 
  <ul> 
   <li>repeat a series of <code>steps</code> for each input element</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">RepeatWith</span>(<span class="pl-s"><span class="pl-pds">"</span>Superman<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>GreenLantern<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Spiderman<span class="pl-pds">"</span></span>)(<span class="pl-s"><span class="pl-pds">"</span>superhero-name<span class="pl-pds">"</span></span>) {

  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>/superheroes/&lt;superhero-name&gt;<span class="pl-pds">"</span></span>).withParams(<span class="pl-s"><span class="pl-pds">"</span>sessionId<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;session-id&gt;<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)

  <span class="pl-en">Then</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>hasSuperpowers<span class="pl-pds">"</span></span>).is(<span class="pl-c1">true</span>)
}
</pre>
  </div> 
  <ul> 
   <li>retry a series of <code>steps</code> until it succeeds or reaches the limit</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">RetryMax</span>(<span class="pl-c1">3</span>) {
  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}</pre>
  </div> 
  <ul> 
   <li>repeating a series of <code>steps</code> until it succeeds over a period of time at a specified interval (handy for eventually consistent endpoints)</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Eventually</span>(maxDuration <span class="pl-k">=</span> <span class="pl-c1">15.</span>seconds, interval <span class="pl-k">=</span> <span class="pl-c1">200.</span>milliseconds) {

    <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/random<span class="pl-pds">"</span></span>)

    <span class="pl-en">Then</span> assert body.ignoring(<span class="pl-s"><span class="pl-pds">"</span>hasSuperpowers<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>publisher<span class="pl-pds">"</span></span>).is(
      <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">      {</span>
<span class="pl-s">        "name": "Batman",</span>
<span class="pl-s">        "realName": "Bruce Wayne",</span>
<span class="pl-s">        "city": "Gotham city"</span>
<span class="pl-s">      }</span>
<span class="pl-s">      <span class="pl-pds">"""</span></span>
    )
  }</pre>
  </div> 
  <ul> 
   <li>execute a series of steps 'n' times concurrently and wait 'maxTime' for completion.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Concurrently</span>(factor <span class="pl-k">=</span> <span class="pl-c1">3</span>, maxTime <span class="pl-k">=</span> <span class="pl-c1">10</span> seconds) {

  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}
</pre>
  </div> 
  <ul> 
   <li>execute a series of steps and fails if the execution does not complete within 'maxDuration'.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Within</span>(maxDuration <span class="pl-k">=</span> <span class="pl-c1">10</span> seconds) {

  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}
</pre>
  </div> 
  <ul> 
   <li>repeat a series of steps with different inputs specified via a datatable</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">WithDataInputs</span>(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">    | a | b  | c  |</span>
<span class="pl-s">    | 1 | 3  | 4  |</span>
<span class="pl-s">    | 7 | 4  | 11 |</span>
<span class="pl-s">    | 1 | -1 | 0  |</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>
) {
  <span class="pl-en">Then</span> assert a_plus_b_equals_c
}

<span class="pl-k">def</span> <span class="pl-en">a_plus_b_equals_c</span> <span class="pl-k">=</span>
  <span class="pl-en">AssertStep</span>(<span class="pl-s"><span class="pl-pds">"</span>sum of 'a' + 'b' = 'c'<span class="pl-pds">"</span></span>, s <span class="pl-k">⇒</span> <span class="pl-en">GenericEqualityAssertion</span>(s.get(<span class="pl-s"><span class="pl-pds">"</span>a<span class="pl-pds">"</span></span>).toInt <span class="pl-k">+</span> s.get(<span class="pl-s"><span class="pl-pds">"</span>b<span class="pl-pds">"</span></span>).toInt, s.get(<span class="pl-s"><span class="pl-pds">"</span>c<span class="pl-pds">"</span></span>).toInt))</pre>
  </div> 
  <ul> 
   <li>WithHeaders automatically sets headers for several steps useful for authenticated scenario.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">WithHeaders</span>((<span class="pl-s"><span class="pl-pds">"</span>Authorization<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==<span class="pl-pds">"</span></span>)){
  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/secured<span class="pl-pds">"</span></span>)
  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}
</pre>
  </div> 
  <ul> 
   <li>WithBasicAuth automatically sets basic auth headers for several steps.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">WithBasicAuth</span>(<span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>root<span class="pl-pds">"</span></span>){
  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/secured<span class="pl-pds">"</span></span>)
  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}
</pre>
  </div> 
  <ul> 
   <li>HttpListenTo creates an HTTP server that will be running during the length of the enclosed steps.</li> 
  </ul> 
  <p>By default this server responds with 201 to any POST request and 200 for all the rest.</p> 
  <p>Additionally it provides three administrations features:</p> 
  <ul> 
   <li>fetching recorded received requests</li> 
   <li>resetting recorded received requests</li> 
   <li>toggling on/off the error mode to return HTTP 500 to incoming requests</li> 
  </ul> 
  <p>The server records all requests received as a JSON array of HTTP request for later assertions.</p> 
  <p>There are two ways to perform assertions on the server statistics, either by querying the session at the end of the block or by contacting directly the server while it runs.</p> 
  <p>Refer to those <a href="https://github.com/agourlay/cornichon/blob/master/src/test/scala/com/github/agourlay/cornichon/examples/MockServerExample.scala" target="_blank">examples</a> for more information.</p> 
  <p>This feature is experimental and subject to changes.</p> 
  <ul> 
   <li>Log duration</li> 
  </ul> 
  <p>By default all <code>Step</code> execution time can be found in the logs, but sometimes one needs to time a series of steps.</p> 
  <p>This is where <code>LogDuration</code> comes in handy, it requires a label that will be printed as well to identify results.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">LogDuration</span>(label <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>my experiment<span class="pl-pds">"</span></span>) {

  <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://superhero.io/batman<span class="pl-pds">"</span></span>)

  <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
}
</pre>
  </div> 
  <h3><a id="user-content-debug-steps" class="anchor" href="https://github.com/agourlay/cornichon#debug-steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Debug steps</h3> 
  <ul> 
   <li>showing session content for debugging purpose</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre> <span class="pl-en">And</span> <span class="pl-en">I</span> show_session

 <span class="pl-en">And</span> <span class="pl-en">I</span> show_last_response

 <span class="pl-en">And</span> <span class="pl-en">I</span> show_last_status

 <span class="pl-en">And</span> <span class="pl-en">I</span> show_last_body

 <span class="pl-en">And</span> <span class="pl-en">I</span> show_last_headers</pre>
  </div> 
  <p>Those descriptions might be already outdated, in case of doubt always refer to those <a href="https://github.com/agourlay/cornichon/blob/master/src/test/scala/com/github/agourlay/cornichon/examples/superHeroes/SuperHeroesScenario.scala" target="_blank">examples</a> as they are executed as part of Cornichon's test suite.</p> 
  <h2><a id="user-content-dsl-composition" class="anchor" href="https://github.com/agourlay/cornichon#dsl-composition" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>DSL composition</h2> 
  <p>Series of steps defined with Cornichon's DSL can be reused within different <code>Scenarios</code>.</p> 
  <p>Using the keyword <code>Attach</code> if the series starts with a <code>Step</code> and without if it starts with a wrapping bloc.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">CornichonExamplesSpec</span> <span class="pl-k">extends</span> <span class="pl-e">CornichonFeature</span> {

  <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">feature</span> <span class="pl-k">=</span>
    <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>Cornichon feature example<span class="pl-pds">"</span></span>) {

      <span class="pl-en">Scenario</span>(<span class="pl-s"><span class="pl-pds">"</span>demonstrate DSL composition<span class="pl-pds">"</span></span>) {

        <span class="pl-en">Then</span> assert superhero_exists(<span class="pl-s"><span class="pl-pds">"</span>batman<span class="pl-pds">"</span></span>)

        <span class="pl-en">Then</span> assert random_superheroes_until(<span class="pl-s"><span class="pl-pds">"</span>Batman<span class="pl-pds">"</span></span>)

      }
    }

  <span class="pl-k">def</span> <span class="pl-en">superhero_exists</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span>
    <span class="pl-en">Attach</span> {
      <span class="pl-en">When</span> <span class="pl-en">I</span> get(s<span class="pl-s"><span class="pl-pds">"</span>/superheroes/$name<span class="pl-pds">"</span></span>).withParams(<span class="pl-s"><span class="pl-pds">"</span>sessionId<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;session-id&gt;<span class="pl-pds">"</span></span>)
      <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">200</span>)
    }

  <span class="pl-k">def</span> <span class="pl-en">random_superheroes_until</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span>
    <span class="pl-en">Eventually</span>(maxDuration <span class="pl-k">=</span> <span class="pl-c1">3</span> seconds, interval <span class="pl-k">=</span> <span class="pl-c1">10</span> milliseconds) {
      <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>/superheroes/random<span class="pl-pds">"</span></span>).withParams(<span class="pl-s"><span class="pl-pds">"</span>sessionId<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;session-id&gt;<span class="pl-pds">"</span></span>)
      <span class="pl-en">Then</span> assert body.path(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>).is(name)
      <span class="pl-en">Then</span> <span class="pl-en">I</span> print_step(<span class="pl-s"><span class="pl-pds">"</span>bingo!<span class="pl-pds">"</span></span>)
    }  
</pre>
  </div> 
  <p>It is possible to give a title to an attached bloc using <code>AttachAs(title)</code>.</p> 
  <h2><a id="user-content-placeholders" class="anchor" href="https://github.com/agourlay/cornichon#placeholders" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Placeholders</h2> 
  <p>Most built-in steps can use placeholders in their arguments, those will be automatically resolved from the <code>session</code>:</p> 
  <ul> 
   <li>URL</li> 
   <li>Expected body</li> 
   <li>HTTP params (name and value)</li> 
   <li>HTTP headers (name and value)</li> 
   <li>JSON Path</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Given</span> <span class="pl-en">I</span> save(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-s"><span class="pl-pds">"</span>Batman<span class="pl-pds">"</span></span>)

<span class="pl-en">Then</span> assert session_value(<span class="pl-s"><span class="pl-pds">"</span>favorite-superhero<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>Batman<span class="pl-pds">"</span></span>)

<span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/superheroes/&lt;favorite-superhero&gt;<span class="pl-pds">"</span></span>)

<span class="pl-en">Then</span> assert body.is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "&lt;favorite-superhero&gt;",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "city": "Gotham city",</span>
<span class="pl-s">    "publisher": "DC"</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>
)

<span class="pl-en">And</span> <span class="pl-en">I</span> save_body_path(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>batman-city<span class="pl-pds">"</span></span>)

<span class="pl-en">Then</span> assert session_value(<span class="pl-s"><span class="pl-pds">"</span>batman-city<span class="pl-pds">"</span></span>).is(<span class="pl-s"><span class="pl-pds">"</span>Gotham city<span class="pl-pds">"</span></span>)

<span class="pl-en">Then</span> assert body.is(
  <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "name": "&lt;favorite-superhero&gt;",</span>
<span class="pl-s">    "realName": "Bruce Wayne",</span>
<span class="pl-s">    "city": "&lt;batman-city&gt;",</span>
<span class="pl-s">    "publisher": "DC"</span>
<span class="pl-s">  }</span>
<span class="pl-s">  <span class="pl-pds">"""</span></span>
)
</pre>
  </div> 
  <p>It is also possible to inject random values inside placeholders using:</p> 
  <ul> 
   <li><code>&lt;random-uuid&gt;</code> for a random UUID</li> 
   <li><code>&lt;random-positive-integer&gt;</code> for a random Integer between 0-10000</li> 
   <li><code>&lt;random-string&gt;</code> for a random String of length 5</li> 
   <li><code>&lt;random-alphanum-string&gt;</code> for a random alphanumeric String of length 5</li> 
   <li><code>&lt;random-boolean&gt;</code> for a random Boolean string</li> 
   <li><code>&lt;timestamp&gt;</code> for the current timestamp</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>post(<span class="pl-s"><span class="pl-pds">"</span>http://url.io/somethingWithAnId<span class="pl-pds">"</span></span>).withBody(
<span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">  {</span>
<span class="pl-s">    "id" : "&lt;random-uuid&gt;"</span>
<span class="pl-s">  }</span>
<span class="pl-s"><span class="pl-pds">"""</span></span>)</pre>
  </div> 
  <p>If you save several times a value under the same key, the <code>session</code> will behave like a Multimap by appending the values. </p> 
  <p>It becomes then possible to retrieve past values :</p> 
  <ul> 
   <li><code>&lt;name&gt;</code> always uses the latest value taken by the key.</li> 
   <li><code>&lt;name[0]&gt;</code> uses the first value taken by the key</li> 
   <li><code>&lt;name[1]&gt;</code> uses the second element taken by the key</li> 
  </ul> 
  <h2><a id="user-content-custom-steps" class="anchor" href="https://github.com/agourlay/cornichon#custom-steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom steps</h2> 
  <h3><a id="user-content-effectstep" class="anchor" href="https://github.com/agourlay/cornichon#effectstep" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>EffectStep</h3> 
  <p>An <code>EffectStep</code> can be understood as the following function <code>Session =&gt; Future[Session]</code>.</p> 
  <p>This means that an <code>EffectStep</code> runs a side effect and populates the <code>Session</code> with potential result values.</p> 
  <p>A <code>session</code> is a Map-like object used to propagate state throughout a <code>scenario</code>. It is used to resolve <a href="https://github.com/agourlay/cornichon#placeholders" target="_blank">placeholders</a> and save the result computations for later assertions.</p> 
  <p>Here is the most simple <code>EffectStep</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">When</span> <span class="pl-en">I</span> <span class="pl-en">EffectStep</span>(title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>do nothing<span class="pl-pds">"</span></span>, action <span class="pl-k">=</span> s <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>.successful(s))
</pre>
  </div> 
  <p>or using a factory helper when dealing with non Future based computation</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">When</span> <span class="pl-en">I</span> <span class="pl-en">EffectStep</span>.fromSync(title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>do nothing<span class="pl-pds">"</span></span>, action <span class="pl-k">=</span> s <span class="pl-k">=&gt;</span> s)
</pre>
  </div> 
  <p>Let's try so save a value into the <code>Session</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">When</span> <span class="pl-en">I</span> <span class="pl-en">EffectStep</span>.fromSync(title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>estimate PI<span class="pl-pds">"</span></span>, action <span class="pl-k">=</span> s <span class="pl-k">=&gt;</span> s.add(<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>, piComputation())
</pre>
  </div> 
  <p>The test engine is responsible for controling the execution of the side effect function and to report any error.</p> 
  <h3><a id="user-content-effectstep-using-the-http-service" class="anchor" href="https://github.com/agourlay/cornichon#effectstep-using-the-http-service" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>EffectStep using the HTTP service</h3> 
  <p>Sometimes you want to perform HTTP calls inside of of an <code>EffectStep</code>, this is where the <code>http</code> service comes in handy.</p> 
  <p>In order to illustrate its usage let's take the following example, you would like to write a custom step like:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">feature</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>Customer endpoint<span class="pl-pds">"</span></span>){

  <span class="pl-en">Scenario</span>(<span class="pl-s"><span class="pl-pds">"</span>create customer<span class="pl-pds">"</span></span>){

    <span class="pl-en">When</span> <span class="pl-en">I</span> create_customer

    <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">201</span>)

  }</pre>
  </div> 
  <p>Most of the time you will create your own trait containing your custom steps and declare a self-type on <code>CornichonFeature</code> to be able to access the <code>httpService</code>. </p> 
  <p>It exposes a method <code>requestEffect</code> turning an <code>HttpRequest</code> into an asynchronous effect.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">MySteps</span> {
  <span class="pl-v">this</span><span class="pl-k">:</span> <span class="pl-en">CornichonFeature</span> <span class="pl-k">⇒</span>

  <span class="pl-k">def</span> <span class="pl-en">create_customer</span> <span class="pl-k">=</span> <span class="pl-en">EffectStep</span>(
    title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>create new customer<span class="pl-pds">"</span></span>,
    effect <span class="pl-k">=</span> http.requestEffect(
      request <span class="pl-k">=</span> <span class="pl-en">HttpRequest</span>.post(<span class="pl-s"><span class="pl-pds">"</span>/customer<span class="pl-pds">"</span></span>).withPayload(<span class="pl-s"><span class="pl-pds">"</span>someJson<span class="pl-pds">"</span></span>),
      expectedStatus <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-c1">201</span>)
      extractor <span class="pl-k">=</span> <span class="pl-en">RootExtractor</span>(<span class="pl-s"><span class="pl-pds">"</span>customer<span class="pl-pds">"</span></span>)
    )
  )
}
</pre>
  </div> 
  <p>The built-in HTTP steps available on the DSL are actually built on top of the <code>httpService</code> which means that you benefit from all the existing infrastructure to:</p> 
  <ul> 
   <li>resolve placeholders in URL, query params, body and headers.</li> 
   <li>automatically populate the session with the results of the call such as response body, status and headers (it is also possible to pass a custom extractor).</li> 
   <li>handle common errors such as timeout and malformed requests.</li> 
  </ul> 
  <h3><a id="user-content-assertstep" class="anchor" href="https://github.com/agourlay/cornichon#assertstep" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AssertStep</h3> 
  <p>An <code>AssertStep</code> can be understood as the following function <code>Sesssion =&gt; Assertion</code>. Its goal is to describe an expectation.</p> 
  <p>The test engine is responsible to test the validity of the provided <code>Assertion</code> which can be one of the following:</p> 
  <ul> 
   <li><p>Equality assertions : test the equality of two objects using the cats <code>Equals</code> typeclass.</p> 
    <ul> 
     <li><p>GenericEqualityAssertion to leave all the details to Cornichon</p> 
      <div class="highlight highlight-source-scala">
       <pre><span class="pl-en">When</span> <span class="pl-en">I</span> <span class="pl-en">AssertStep</span>(<span class="pl-s"><span class="pl-pds">"</span>always true!<span class="pl-pds">"</span></span>, s <span class="pl-k">=&gt;</span> <span class="pl-en">GenericEqualityAssertion</span>(<span class="pl-c1">true</span>, <span class="pl-c1">true</span>))</pre>
      </div></li> 
     <li><p>CustomMessageEqualityAssertion to provide a custom error message</p> 
      <div class="highlight highlight-source-scala">
       <pre><span class="pl-en">CustomMessageAssertion</span>[<span class="pl-en">A</span>](<span class="pl-v">expected</span>: <span class="pl-en">A</span>, <span class="pl-v">result</span>: <span class="pl-en">A</span>, <span class="pl-v">customMessage</span>: <span class="pl-en">A</span> <span class="pl-k">⇒</span> <span class="pl-k">String</span>)</pre>
      </div></li> 
    </ul></li> 
   <li><p>Ordering assertions : compare two objects using the cats <code>Order</code> typeclass.</p> 
    <ul> 
     <li>GreaterThanAssertion</li> 
     <li>LessThanAssertion</li> 
     <li>BetweenAssertion</li> 
    </ul></li> 
   <li><p>Collection assertions : test the state of a collection of elements</p> 
    <ul> 
     <li>CollectionEmptyAssertion</li> 
     <li>CollectionNotEmptyAssertion</li> 
     <li>CollectionSizeAssertion</li> 
     <li>CollectionContainsAssertion</li> 
    </ul></li> 
   <li><p>String assertion : assert the content of a given String value</p> 
    <ul> 
     <li>StringContainsAssertion</li> 
     <li>RegexAssertion</li> 
    </ul></li> 
  </ul> 
  <p>Below is a longer example showing how to integration an assertion into scenario.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">When</span> <span class="pl-en">I</span> <span class="pl-en">EffectStep</span>(
  title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>estimate PI<span class="pl-pds">"</span></span>,
  action <span class="pl-k">=</span> s <span class="pl-k">=&gt;</span> s.add(<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>, piComputation())
)

<span class="pl-en">Then</span> assert <span class="pl-en">AssertStep</span>(
  title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>check estimate<span class="pl-pds">"</span></span>,
  action <span class="pl-k">=</span> s <span class="pl-k">=&gt;</span> <span class="pl-en">BetweenAssertion</span>(<span class="pl-c1">3.1</span>, s.get(<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>), <span class="pl-c1">3.2</span>)
)</pre>
  </div> 
  <p><code>Assertions</code> can also be composed using <code>and</code> and <code>or</code>, for instance <code>BetweenAssertion</code> is the result of <code>LessThanAssertion</code> and <code>GreaterThanAssertion</code>.</p> 
  <p>This is rather low level therefore you not should write your steps like that directly inside the DSL but hide them behind functions with appropriate names.</p> 
  <p>Fortunately a bunch of built-in steps and primitive building blocs are already available for you.</p> 
  <p>Note for advance users: it is also possible to write custom wrapper steps by implementing <code>WrapperStep</code>.</p> 
  <h2><a id="user-content-feature-options" class="anchor" href="https://github.com/agourlay/cornichon#feature-options" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Feature options</h2> 
  <p>To implement a <code>CornichonFeature</code> it is only required to implement the <code>feature</code> function. However a number of useful options are available using override.</p> 
  <h3><a id="user-content-before-and-after-hooks" class="anchor" href="https://github.com/agourlay/cornichon#before-and-after-hooks" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Before and after hooks</h3> 
  <p>Hooks are available to set up and tear down things as usual but this feature is not integrated into the DSL.</p> 
  <p>Four functions are available in <code>CornichonFeature</code> with self-explanatory names:</p> 
  <p>Taking <code>Unit</code> expression</p> 
  <div class="highlight highlight-source-scala">
   <pre>beforeFeature { <span class="pl-c">// do side effect here }</span>

afterFeature {  <span class="pl-c">// do side effect here }</span></pre>
  </div> 
  <p>Taking <code>Step*</code> expression.</p> 
  <div class="highlight highlight-source-scala">
   <pre>beforeEachScenario ( <span class="pl-c">// feed Step* )</span>

afterEachScenario ( <span class="pl-c">// feed Step* )</span></pre>
  </div> 
  <h3><a id="user-content-base-url" class="anchor" href="https://github.com/agourlay/cornichon#base-url" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Base URL</h3> 
  <p>Instead of repeating at each HTTP statement the full URL, it is possible to set a common URL for the entire <code>feature</code> by overriding:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">override</span> <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">baseUrl</span> <span class="pl-k">=</span> s<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080<span class="pl-pds">"</span></span>
</pre>
  </div> 
  <p>and then only provide the missing part in the HTTP step definition</p> 
  <div class="highlight highlight-source-scala">
   <pre> <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>/superheroes/Batman<span class="pl-pds">"</span></span>)

 <span class="pl-en">When</span> <span class="pl-en">I</span> delete(<span class="pl-s"><span class="pl-pds">"</span>/superheroes/GreenLantern<span class="pl-pds">"</span></span>)
</pre>
  </div> 
  <p>You can still override the base URL of a single step by providing the complete URL starting with the HTTP protocol.</p> 
  <h3><a id="user-content-request-timeout" class="anchor" href="https://github.com/agourlay/cornichon#request-timeout" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request timeout</h3> 
  <p>The default value for the HTTP request timeout is <code>2 seconds</code>. As always it can be overridden per scenario.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>

<span class="pl-k">override</span> <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">requestTimeout</span> <span class="pl-k">=</span> <span class="pl-c1">100</span> millis
</pre>
  </div> 
  <h3><a id="user-content-register-custom-extractors" class="anchor" href="https://github.com/agourlay/cornichon#register-custom-extractors" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Register custom extractors</h3> 
  <p>In some cases it makes sense to declare <code>extractors</code> to avoid code duplication when dealing with <code>session</code> values.</p> 
  <p>An extractor is responsible to describe using a JsonPath how to build a value from an existing value in <code>session</code>.</p> 
  <p>For instance if most of your JSON responses contain a field <code>id</code> and you want to use it as a placeholder without always having to manually extract and save the value into the <code>session</code> you can write :</p> 
  <div class="highlight highlight-source-scala">
   <pre>   <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">registerExtractors</span> <span class="pl-k">=</span> <span class="pl-en">Map</span>(
     <span class="pl-s"><span class="pl-pds">"</span>response-id<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-en">JsonMapper</span>(<span class="pl-en">HttpService</span>.<span class="pl-en">LastResponseBodyKey</span>, <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>)
   )</pre>
  </div> 
  <p>It is now possible to use <code>&lt;response-id&gt;</code> or <code>&lt;response-id[integer]&gt;</code> in the steps definitions.</p> 
  <p>It works for all keys in <code>Session</code>, let's say we also have objects registered under keys <code>customer</code> &amp; <code>product</code>: </p> 
  <div class="highlight highlight-source-scala">
   <pre>   <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">registerExtractors</span> <span class="pl-k">=</span> <span class="pl-en">Map</span>(
     <span class="pl-s"><span class="pl-pds">"</span>response-version<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-en">JsonMapper</span>(<span class="pl-en">HttpService</span>.<span class="pl-en">LastResponseBodyKey</span>, <span class="pl-s"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>),
     <span class="pl-s"><span class="pl-pds">"</span>customer-street<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-en">JsonMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>customer<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>address.street<span class="pl-pds">"</span></span>),
     <span class="pl-s"><span class="pl-pds">"</span>product-first-rating<span class="pl-pds">"</span></span> <span class="pl-k">→</span> <span class="pl-en">JsonMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>product<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>rating[0].score<span class="pl-pds">"</span></span>)
   )</pre>
  </div> 
  <h2><a id="user-content-execution-model" class="anchor" href="https://github.com/agourlay/cornichon#execution-model" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Execution model</h2> 
  <p>By default the <code>features</code> are executed sequentially and the <code>scenarios</code> within are executed in parallel.</p> 
  <p>This execution is configurable if you have specific constraints.</p> 
  <p>To run <code>scenarios</code> sequentially it is necessary to declare in your application.conf file</p> 
  <div class="highlight highlight-source-scala">
   <pre>cornichon {
  executeScenariosInParallel <span class="pl-k">=</span> <span class="pl-c1">false</span>
}</pre>
  </div> 
  <p>To run <code>features</code> in parallel it is necessary to manually set a flag in your SBT build file.</p> 
  <div class="highlight highlight-source-scala">
   <pre>parallelExecution in <span class="pl-en">Test</span> <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">true</span></pre>
  </div> 
  <p>or through the command line <code>sbt test parallelExecution in Test := true</code></p> 
  <h2><a id="user-content-ignoring-features-or-scenarios" class="anchor" href="https://github.com/agourlay/cornichon#ignoring-features-or-scenarios" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Ignoring features or scenarios</h2> 
  <p><code>Feature</code> or individual <code>scenario</code> can also be marked to be ignored.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">CornichonExamplesSpec</span> <span class="pl-k">extends</span> <span class="pl-e">CornichonFeature</span> {

  <span class="pl-c">// Ignore a complete feature</span>
  <span class="pl-k">def</span> <span class="pl-en">feature</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>Checking google<span class="pl-pds">"</span></span>, ignored <span class="pl-k">=</span> <span class="pl-c1">true</span>){

    <span class="pl-c">// Ignore a single scenario</span>
    <span class="pl-en">Scenario</span>(<span class="pl-s"><span class="pl-pds">"</span>Google is up and running<span class="pl-pds">"</span></span>, ignored <span class="pl-k">=</span> <span class="pl-c1">true</span>){

      <span class="pl-en">When</span> <span class="pl-en">I</span> get(<span class="pl-s"><span class="pl-pds">"</span>http://google.com<span class="pl-pds">"</span></span>)

      <span class="pl-en">Then</span> assert status.is(<span class="pl-c1">302</span>)
    }
  }
}</pre>
  </div> 
  <h2><a id="user-content-custom-http-body-type" class="anchor" href="https://github.com/agourlay/cornichon#custom-http-body-type" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom HTTP body type</h2> 
  <p>By default the HTTP DSL expects a String body but in some cases you might want to work at a higher level of abstraction.</p> 
  <p>In order to use a custom type as body, it is necessary to provide 3 typeclass instances:</p> 
  <ul> 
   <li><code>cats.Show</code> used to print the values</li> 
   <li><code>io.circe.Encoder</code> used to convert the values to JSON</li> 
   <li><code>com.github.agourlay.cornichon.resolver.Resolvable</code> used to provide a custom String representation in which placeholders can be resolved</li> 
  </ul> 
  <p>For instance if you wish to use the <code>JsObject</code> from <code>play-json</code> as HTTP request's body you can define the following instances in your code:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">lazy</span> <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">jsonResolvableForm</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resolvable</span>[<span class="pl-en">JsObject</span>] {
    <span class="pl-k">def</span> <span class="pl-en">toResolvableForm</span>(<span class="pl-v">s</span>: <span class="pl-en">JsObject</span>) <span class="pl-k">=</span> s.toString()
    <span class="pl-k">def</span> <span class="pl-en">fromResolvableForm</span>(<span class="pl-v">s</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">Json</span>.parse(s).as[<span class="pl-en">JsObject</span>]
  }

  <span class="pl-k">lazy</span> <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">showJson</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Show</span>[<span class="pl-en">JsObject</span>] {
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">show</span>(<span class="pl-v">f</span>: <span class="pl-en">JsObject</span>)<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> f.toString()
  }

  <span class="pl-k">lazy</span> <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">JsonEncoder</span><span class="pl-k">:</span><span class="pl-en">Encoder</span>[<span class="pl-en">JsObject</span>] <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Encoder</span>[<span class="pl-en">JsObject</span>] {
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">a</span>: <span class="pl-en">JsObject</span>)<span class="pl-k">:</span> <span class="pl-en">Json</span> <span class="pl-k">=</span> parse(a.toString()).getOrElse(cJson.<span class="pl-en">Null</span>)
  }
</pre>
  </div> 
  <h2><a id="user-content-scalatest-integration" class="anchor" href="https://github.com/agourlay/cornichon#scalatest-integration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ScalaTest integration</h2> 
  <p>As Cornichon uses Scalatest it is possible to use all the nice CLI from SBT + ScalaTest to trigger tests:</p> 
  <ul> 
   <li><code>~test</code> tilde to re-run a command on change.</li> 
   <li><code>testOnly *CornichonExamplesSpec</code> to run only the feature CornichonExamplesSpec.</li> 
   <li><code>testOnly *CornichonExamplesSpec -- -t "Cornichon feature example should CRUD Feature demo"</code> to run only the scenario <code>CRUD Feature demo</code> from the feature <code>Cornichon feature example</code>. </li> 
  </ul> 
  <p>The full name of a scenario is <code>feature-name should scenario-name</code>.</p> 
  <p>See <a href="http://www.scala-sbt.org/0.13/docs/Testing.html" target="_blank">SBT doc</a> and <a href="http://www.scalatest.org/user_guide/using_the_runner" target="_blank">ScalaTest doc</a> for more information.</p> 
  <p>The <code>steps</code> execution logs will only be shown if:</p> 
  <ul> 
   <li>the scenario fails</li> 
   <li>the scenario succeeded and contains at least one <code>DebugStep</code> such as <code>And I show_last_status</code></li> 
  </ul> 
  <h2><a id="user-content-ssl-configuration" class="anchor" href="https://github.com/agourlay/cornichon#ssl-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SSL configuration</h2> 
  <p>Testing environment often have broken certificates, it is possible to disable hostname verification by adding the following configuration to your reference.conf or application.conf in src/test/resources</p> 
  <pre><code>akka {
  ssl-config{
    loose {
      disableHostnameVerification = true
    }
  }
}
</code></pre> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/agourlay/cornichon#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p><strong>Cornichon</strong> is licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License, Version 2.0</a>.</p> 
 </article>
</div>