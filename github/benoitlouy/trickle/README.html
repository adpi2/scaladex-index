<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-trickle" class="anchor" href="https://github.com/benoitlouy/trickle#trickle" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Trickle</h1> 
  <p><a href="https://travis-ci.org/benoitlouy/trickle.svg?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/02167ebc22c88fc4d911da87d271e020f1d07ae2/68747470733a2f2f7472617669732d63692e6f72672f62656e6f69746c6f75792f747269636b6c652e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/benoitlouy/trickle.svg" style="max-width:100%;"></a> <a href="http://codecov.io/github/benoitlouy/trickle?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/d0549c2a9b12f02a2fc4c1d7ccc6e14d9ead376e/687474703a2f2f636f6465636f762e696f2f6769746875622f62656e6f69746c6f75792f747269636b6c652f636f7665726167652e7376673f6272616e63683d6d6173746572" alt="codecov.io" data-canonical-src="http://codecov.io/github/benoitlouy/trickle/coverage.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/com.github.benoitlouy/trickle-core_2.11" target="_blank"><img src="https://camo.githubusercontent.com/7d953bec41dc6a72ebb4303e9c7414ae3c393c79/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f636f6d2e6769746875622e62656e6f69746c6f75792f747269636b6c652d636f72655f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/com.github.benoitlouy/trickle-core_2.11/badge.svg" style="max-width:100%;"></a> <a href="https://gitter.im/benoitlouy/trickle" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Chat" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a></p> 
  <h2><a id="user-content-overview" class="anchor" href="https://github.com/benoitlouy/trickle#overview" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Overview</h2> 
  <p>Trickle is a Scala library for creating and executing workflows.</p> 
  <p>trickle-core depends on</p> 
  <ul> 
   <li>scalaz-core</li> 
   <li>scalaz-concurrent</li> 
   <li>shapeless</li> 
   <li>commons-pool2</li> 
  </ul> 
  <h2><a id="user-content-getting-started" class="anchor" href="https://github.com/benoitlouy/trickle#getting-started" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Getting started</h2> 
  <h3><a id="user-content-sbt" class="anchor" href="https://github.com/benoitlouy/trickle#sbt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SBT</h3> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.github.benoitlouy<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>trickle-core<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-imports" class="anchor" href="https://github.com/benoitlouy/trickle#imports" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Imports</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">trickle.syntax.executor.</span><span class="pl-v">_ </span><span class="pl-c">// operators to executed workflows</span>
<span class="pl-k">import</span> <span class="pl-v">trickle.syntax.step.</span><span class="pl-v">_ </span><span class="pl-c">// operators to create workflows</span></pre>
  </div> 
  <h3><a id="user-content-linear-workflow" class="anchor" href="https://github.com/benoitlouy/trickle#linear-workflow" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Linear workflow</h3> 
  <p>Let's look at how we can define a workflow and execute it.</p> 
  <p>In the example below we are going to create a workflow which takes a String as input, convert it to a Int and then increment it.</p> 
  <p>The input of the flow is a String.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">input</span> <span class="pl-k">=</span> source[<span class="pl-k">String</span>]</pre>
  </div> 
  <p>We convert the String to an Int. The input (and output) of a step is a <code>StepIO[X]</code> which is nothing more than a type alias for <code>Validation[NonEmptyList[Exception], Option[X]]</code>. This mean than the input of step can be:</p> 
  <ul> 
   <li>a failure in which case we will have a list of at least one exception</li> 
   <li>a success without a value: <code>None</code></li> 
   <li>a success with a value: <code>Some(e)</code></li> 
  </ul> 
  <p>For convenience, trickle provide the ioMap operator which unwrap the Validation and the Option</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">integer</span> <span class="pl-k">=</span> input <span class="pl-k">|</span><span class="pl-k">&gt;</span> { _.ioMap(_.toInt) }</pre>
  </div> 
  <p>Let's increment the Int.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">flow</span> <span class="pl-k">=</span> integer <span class="pl-k">|</span><span class="pl-k">&gt;</span> { _.ioMap(_ <span class="pl-k">+</span> <span class="pl-c1">1</span>) }</pre>
  </div> 
  <p>We then execute the flow defined above with input "41". Executing a flow returns the result of the flow execution and the final execution state which contain the result of all the steps the flow is made of.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> (result, state) <span class="pl-k">=</span> flow.execute(input <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>41<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>The result of the flow execution is <code>Success(Some(43))</code> which is of type <code>StepIO[Int]</code>.</p> 
  <p>You can retrieve the result of an intermediary step by looking it up in the state returned by the execution.</p> 
  <div class="highlight highlight-source-scala">
   <pre>state.get(integer)</pre>
  </div> 
  <p>The above statement returns <code>Some(StepResult(Success(Some(41)))</code></p> 
  <p>A same flow can be executed many times with a different input. You can even execute the same flow concurrently as the flow in itself doesn't keep any information about the execution.</p> 
  <p>In the execution below the input String cannot be converted to an Int and the flow will fail.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> (errorResult, errorState) <span class="pl-k">=</span> flow.execute(input <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>The integer step failed, the failure is propagated all the way to the result of the final step.</p> 
  <p>errorResult will have the value <code>Failure(NonEmptyList(java.lang.NumberFormatException))</code></p> 
  <h3><a id="user-content-parallel-worflow-and-concurrency" class="anchor" href="https://github.com/benoitlouy/trickle#parallel-worflow-and-concurrency" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Parallel worflow and concurrency</h3> 
  <p>Let's create 2 flows:</p> 
  <ul> 
   <li><code>branch1</code> which takes a <code>String</code> as input and append " rocks " to it.</li> 
   <li><code>branch2</code> which takes a <code>String</code> representing an integer, converts it to an actual `<code>Int</code> and then multiplies it by 2.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">inputString</span> <span class="pl-k">=</span> source[<span class="pl-k">String</span>]
<span class="pl-k">val</span> <span class="pl-en">inputIntAsString</span> <span class="pl-k">=</span> source[<span class="pl-k">String</span>]

<span class="pl-k">val</span> <span class="pl-en">branch1</span> <span class="pl-k">=</span> inputString <span class="pl-k">|</span><span class="pl-k">&gt;</span> { _.ioMap(_ <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> rocks <span class="pl-pds">"</span></span>) }
<span class="pl-k">val</span> <span class="pl-en">branch2</span> <span class="pl-k">=</span> inputIntAsString <span class="pl-k">|</span><span class="pl-k">&gt;</span> { _.ioMap(_.toInt) } <span class="pl-k">|</span><span class="pl-k">&gt;</span> { _.ioMap(_ <span class="pl-k">*</span> <span class="pl-c1">2</span>) }</pre>
  </div> 
  <p>What we want to achieve is combine the results of these two flows into one to obtain a string made of n times the result of <code>branch1</code>, where n is the result of <code>branch2</code>.</p> 
  <p>To do so, we put the two branches together into a tuple and pipe it into a function taking two <code>StepIO</code> as input. In this case a function taking a <code>StepIO[String]</code> and a <code>StepIO[Int]</code> as input.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">flow</span> <span class="pl-k">=</span> (branch1, branch2) <span class="pl-k">|</span><span class="pl-k">&gt;</span> { (s, i) <span class="pl-k">=&gt;</span> (s <span class="pl-k">|@|</span> i) { <span class="pl-k">case</span> (os, oi) <span class="pl-k">=&gt;</span> <span class="pl-en">Some</span>(os.get <span class="pl-k">*</span> oi.get) } }</pre>
  </div> 
  <p>Since <code>StepIO</code> is a <code>scalaz.Validation</code> we can use the <code>|@|</code> operator to check that <code>s</code> and <code>i</code> are both successes.</p> 
  <p>We can now execute the flow by doing the following:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> (result, state) <span class="pl-k">=</span> flow.execute(inputString <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>trickle<span class="pl-pds">"</span></span>, inputIntAsString <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>This will execute <code>branch1</code> then execute <code>branch2</code> and then combine the two.</p> 
  <p>We can also execute branches at the same time by executing the flow this way:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> (result, state) <span class="pl-k">=</span> flow.executeParallel(inputString <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>trickle<span class="pl-pds">"</span></span>, inputIntAsString <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>Trickle will automatically spawn threads to execute the branches concurrently. It will collect the results and call the function to combine them.</p> 
  <p>You can combine the results of up to 22 branches, in which case Trickle will execute the 22 branches in parallel.</p> 
  <p>The result of the above workflow executions is <code>Success(Some("trickle rocks trickle rocks trickle rocks trickle rocks "))</code></p> 
  <h3><a id="user-content-other-code-samples" class="anchor" href="https://github.com/benoitlouy/trickle#other-code-samples" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Other code samples</h3> 
  <p>You can have a look at the sources <a href="https://github.com/benoitlouy/trickle/tree/master/examples/src/main/scala/trickle" target="_blank">here</a> for other example of usage of the library. Including conditional branching and processing of traversable objects.</p> 
 </article>
</div>