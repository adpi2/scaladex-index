<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#play2-reactivemongo-mocks" aria-hidden="true" class="anchor" id="user-content-play2-reactivemongo-mocks" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>play2-reactivemongo-mocks</h1> 
  <p>Library to allow mocking of a Play-ReactiveMongo app's MongoDB back end.</p> 
  <p>The intention of this library is to facilitate the writing of tests which:</p> 
  <ul> 
   <li>Cover DAO- or Service-level logic around backend database calls</li> 
   <li>Allow a level of component testing beyond simple unit tests</li> 
   <li>Execute far faster than conventional "seeded database" tests</li> 
   <li>Eliminate the potential issues around inconsistent and/or shared database state</li> 
  </ul> 
  <h2><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#a-note-about-versioning" aria-hidden="true" class="anchor" id="user-content-a-note-about-versioning" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>A Note About Versioning</h2> 
  <p>Due to the nature of mocking method calls, it is essential that the version of this library matches <em>exactly</em> the version of [<a href="https://github.com/ReactiveMongo/Play-ReactiveMongo" target="_blank">https://github.com/ReactiveMongo/Play-ReactiveMongo</a>].</p> 
  <h3><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#installation" aria-hidden="true" class="anchor" id="user-content-installation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h3> 
  <p>Bring in the library by adding the following to your Play project's <code>build.sbt</code>.</p> 
  <ul> 
   <li>The release repository:</li> 
  </ul> 
  <pre><code>   resolvers ++= Seq(
     "Millhouse Bintray"  at "http://dl.bintray.com/themillhousegroup/maven"
   )
</code></pre> 
  <ul> 
   <li>The dependency itself:</li> 
  </ul> 
  <h5><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#play-24x" aria-hidden="true" class="anchor" id="user-content-play-24x" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Play 2.4.x:</h5> 
  <pre><code>   libraryDependencies ++= Seq(
     "com.themillhousegroup" %% "play2-reactivemongo-mocks" % "0.11.9_0.5.35"
   )

</code></pre> 
  <p>The above version (the <strong>0.5.x</strong> family) is for <strong>Play-ReactiveMongo 0.11.9</strong> and <strong>Play 2.4</strong>. As Play 2.4 is for Scala 2.11, this library is correspondingly now <strong>only for Scala 2.11</strong>.</p> 
  <h5><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#play-25x" aria-hidden="true" class="anchor" id="user-content-play-25x" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Play 2.5.x:</h5> 
  <pre><code>   libraryDependencies ++= Seq(
     "com.themillhousegroup" %% "play2-reactivemongo-mocks" % "0.11.11_0.7.42"
   )

</code></pre> 
  <p>The <strong>0.6.x</strong> family was required for Play 2.5.x support and moves the expected ReactiveMongo version to 0.11.11. The <strong>0.7.x</strong> family fixes deprecation warnings in the underlying ReactiveMongo library.</p> 
  <h3><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#older-versions" aria-hidden="true" class="anchor" id="user-content-older-versions" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Older Versions</h3> 
  <p>The <strong>0.4.x</strong> versions of this library incorrectly specified a very old version of the <a href="http://etorreborre.github.io/specs2/" target="_blank">Specs2</a> library; this was reported in <a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks/issues/2" target="_blank">Issue 2</a> and resulted in the <strong>0.5.x</strong> line. <em>All <strong>0.4.x</strong> versions should be considered deprecated</em>; upgrading to <strong>0.5.x</strong> is painless and it is completely backwards-compatible.</p> 
  <p>If you are using <strong>Play 2.3</strong>, you can still use the older published <strong>0.3.x</strong> versions of this library, which target <strong>Play-ReactiveMongo 0.10.5.0.akka23</strong>, in both Scala 2.10 and Scala 2.11 flavours. Substitute the following dependency:</p> 
  <pre><code>	"com.themillhousegroup" %% "play2-reactivemongo-mocks" % "0.10.5.0.akka23_0.3.11"
</code></pre> 
  <h2><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#usage" aria-hidden="true" class="anchor" id="user-content-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Two modes of usage exist - the first will be more familiar to those who have used mocking libraries such as <a href="https://code.google.com/p/mockito/" target="_blank">Mockito</a> before. The second is a "higher-level" abstraction over the Mongo datastore, where the entire store (or at least, the part(s) being tested) are represented as a Map of Maps. If you are executing complex multi-Collection join-like queries, it may end up being a more readable solution.</p> 
  <h4><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#traditional-mock-definitions" aria-hidden="true" class="anchor" id="user-content-traditional-mock-definitions" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Traditional Mock Definitions</h4> 
  <h5><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#the-code-to-be-tested" aria-hidden="true" class="anchor" id="user-content-the-code-to-be-tested" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>The code to be tested</h5> 
  <p>Let's say you have a simple <code>Controller</code> that uses ReactiveMongo just like in <a href="http://reactivemongo.org/releases/0.11/documentation/tutorial/play2.html" target="_blank">their sample tutorial</a>:</p> 
  <pre><code>class PersonController @Inject() (val reactiveMongoApi: ReactiveMongoApi) 
	extends Controller with MongoController with ReactiveMongoComponents {

	def collection: JSONCollection = db.collection[JSONCollection]("persons")

	def findByName(name: String) = Action.async {
    val cursor: Cursor[JsObject] = collection.
      find(Json.obj("name" -&gt; name)).
      sort(Json.obj("created" -&gt; -1)).
      cursor[JsObject]

    val futurePersonsList: Future[List[JsObject]] = cursor.collect[List]()

    val futurePersonsJsonArray: Future[JsArray] =
      futurePersonsList.map { persons =&gt; Json.arr(persons) }

    futurePersonsJsonArray.map { persons =&gt;
      Ok(persons)
    }
  }
}
</code></pre> 
  <p>Great. You can run this against a real Mongo instance and it works fine. Now let's add some test coverage.</p> 
  <h5><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#define-a-spec" aria-hidden="true" class="anchor" id="user-content-define-a-spec" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Define a Spec</h5> 
  <p>Firstly, just mix in <code>MongoMocks</code> into our standard Specs2 specification:</p> 
  <pre><code>import org.specs2.mutable.Specification
import com.themillhousegroup.reactivemongo.mocks.MongoMocks

class PersonControllerSpec extends Specification with MongoMocks {

}

</code></pre> 
  <h5><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#defining-global-behaviour" aria-hidden="true" class="anchor" id="user-content-defining-global-behaviour" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Defining global behaviour</h5> 
  <p>If you just want your mock persistence layer to always reply with meaningful results, use the <code>mockedCollection(name)</code> method together with one or more of the <code>givenMongo...</code> methods, like this:</p> 
  <pre><code>class PersonControllerSpec extends Specification with MongoMocks {
    val mockedPersons = mockedCollection("persons")(this.mockDB)
    val people = List(
      Json.obj("name" -&gt; "Alice", "created" -&gt; 123456789L),
      Json.obj("name" -&gt; "Bob", "created" -&gt; 333333389L)
    )
    givenMongoCollectionFindAnyReturns(mockedPersons, people)

		val testController = new PersonController
		
		"some test of person finding" in {
			
		} 
}
</code></pre> 
  <h4><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#the-map-abstraction" aria-hidden="true" class="anchor" id="user-content-the-map-abstraction" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>The <code>Map</code> Abstraction</h4> 
  <p>Mix in <code>MappedMongoMocking</code> and define <code>mockData</code> - a <code>Map[String, Set[JsObject]</code> i.e. mapping CollectionName to its contents. That's it! All of your Mongo <code>find()</code> operations will now work against this data.</p> 
  <h2><a href="https://github.com/themillhousegroup/play2-reactivemongo-mocks#credits" aria-hidden="true" class="anchor" id="user-content-credits" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h2> 
  <p>Standing on the shoulders of giants:</p> 
  <ul> 
   <li><a href="https://github.com/ReactiveMongo/Play-ReactiveMongo" target="_blank">Play-ReactiveMongo</a></li> 
   <li><a href="https://code.google.com/p/mockito/" target="_blank">Mockito</a></li> 
   <li><a href="http://etorreborre.github.io/specs2/" target="_blank">Specs2</a></li> 
  </ul> 
 </article>
</div>