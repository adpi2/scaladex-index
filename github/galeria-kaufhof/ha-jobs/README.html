<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-ha-jobs" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#ha-jobs" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>HA-Jobs</h1> 
  <p><a href="https://travis-ci.org/Galeria-Kaufhof/ha-jobs" target="_blank"><img src="https://camo.githubusercontent.com/06a35fa4e3b877af600c30144a48d3a631cb2960/68747470733a2f2f7472617669732d63692e6f72672f47616c657269612d4b617566686f662f68612d6a6f62732e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/Galeria-Kaufhof/ha-jobs.png?branch=master" style="max-width:100%;"></a></p> 
  <p>Support for distributed, highly available (batch) singleton jobs, with job scheduling, locking, supervision and job status persistence. Implemented with Scala, Akka and Cassandra.</p> 
  <h2><a id="user-content-new-in-171" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-171" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.7.1</h2> 
  <ul> 
   <li>added a trait StatusWriter to JobStatusRepository for easier mocking in tests.</li> 
  </ul> 
  <h2><a id="user-content-new-in-170" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-170" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.7.0</h2> 
  <ul> 
   <li>add new job status</li> 
   <li>add waiting time to dead job detection</li> 
   <li>add start time and duration to job status json output</li> 
  </ul> 
  <h2><a id="user-content-new-in-160" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-160" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.6.0</h2> 
  <ul> 
   <li>update play from 2.4 to 2.5.9</li> 
   <li>update akka to 2.4.12</li> 
  </ul> 
  <h2><a id="user-content-new-in-153" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-153" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.5.3</h2> 
  <ul> 
   <li>Improved documentation of JobManager.allJobsScheduled</li> 
   <li>Added hook in JobManager for checking preconditions before jobs are started</li> 
   <li>Added more information in log message for dead job detection</li> 
   <li>Increase version of cassandra driver from 3.0.0 to 3.0.2</li> 
   <li>Removed SBT plugin dependency-graph</li> 
  </ul> 
  <h2><a id="user-content-new-in-152" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-152" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.5.2</h2> 
  <ul> 
   <li>#25 job supervisor should retry failed jobs by given retrigger count</li> 
  </ul> 
  <h2><a id="user-content-new-in-151" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#new-in-151" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>New in 1.5.1</h2> 
  <ul> 
   <li>critical bugfix in JobSupervisor</li> 
  </ul> 
  <pre><code>GET    /jobs/:jobType    @de.kaufhof.hajobs.JobsController.list(jobType, limit: Int ?= 20)
</code></pre> 
  <h2><a id="user-content-contents" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#contents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contents</h2> 
  <ul> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#overview" target="_blank">Overview</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#features" target="_blank">Features</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#constraints" target="_blank">Constraints</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#implementationsolution-details" target="_blank">Implementation/Solution Details</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#alternative-solutions" target="_blank">Alternative Solutions</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#installation--setup" target="_blank">Installation / Setup</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#usage" target="_blank">Usage</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#example-1-a-job-with-cron-schedule-persistence-and-supervision" target="_blank">Example 1: A Job with Cron Schedule, Persistence and Supervision</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#example-2-an-actor-job-with-cron-schedule-etc" target="_blank">Example 2: An Actor Job with Cron Schedule etc.</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#example-3-an-actor-job-running-continuously" target="_blank">Example 3: An Actor Job running continuously</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#play-rest-api" target="_blank">Play! REST API</a></li> 
   <li><a href="https://github.com/galeria-kaufhof/ha-jobs#license" target="_blank">License</a></li> 
  </ul> 
  <h2><a id="user-content-overview" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#overview" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Overview</h2> 
  <h3><a id="user-content-features" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features:</h3> 
  <ul> 
   <li>Job Locking 
    <ul> 
     <li>Ensures, that a job is run by at most one instance</li> 
     <li>Locks are automatically released when an instance crashed</li> 
     <li>When a lock is lost / timed out (e.g. because the jvm is only/mainly doing GC), the job will be canceled so that another instance can step in</li> 
    </ul> </li> 
   <li>Job Supervision 
    <ul> 
     <li>When a crashed job is detected, the job will be resumed/retried (maybe by another instance) a configured number of times</li> 
    </ul> </li> 
   <li>Job Scheduling 
    <ul> 
     <li>Jobs can be scheduled, the <a href="http://quartz-scheduler.org/" target="_blank">Quartz</a> scheduler is used for this.</li> 
    </ul> </li> 
   <li>Job Status / Reporting 
    <ul> 
     <li>For each job the status and result is stored, jobs can also provide details to be stored</li> 
    </ul> </li> 
   <li>Job Management 
    <ul> 
     <li>There's a <a href="https://www.playframework.com/" target="_blank">Play! Framework</a> controller that provides a REST api for jobs, which allows to start a job, get a list of job executions, and details for a specific job execution.</li> 
    </ul> </li> 
  </ul> 
  <h3><a id="user-content-constraints" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#constraints" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Constraints:</h3> 
  <ul> 
   <li>There's no need for work distribution / if a single instance can execute a job.</li> 
  </ul> 
  <h3><a id="user-content-implementationsolution-details" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#implementationsolution-details" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Implementation/Solution Details:</h3> 
  <p>Currently for Job Locking Cassandra's lightweight transactions are used, locks are stored with a certain TTL (e.g. 30 seconds) in a dedicated table. As long as a job is running, an (Akka) actor keeps the lock for the job active. When the job completes, the actor is stopped and the lock is released/deleted. When the instance running the job crashes, the lock will be deleted due to the used TTL.</p> 
  <p>Job Supervision is done by a Job, that detects dead jobs and restarts them the configured number of times.</p> 
  <p>There's the <code>JobManager</code>, that allows to start or restart a job, and schedules jobs based on their scheduling pattern.</p> 
  <p>A job must extend <code>Job</code>, which has the following interface:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">abstract</span> <span class="pl-k">class</span> <span class="pl-en">Job</span>(<span class="pl-k">val</span> <span class="pl-en">jobType</span><span class="pl-k">:</span> <span class="pl-en">JobType</span>,
                   <span class="pl-k">val</span> <span class="pl-en">retriggerCount</span><span class="pl-k">:</span> <span class="pl-k">Int</span>,
                   <span class="pl-k">val</span> <span class="pl-en">cronExpression</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-k">String</span>] <span class="pl-k">=</span> <span class="pl-c1">None</span>,
                   <span class="pl-k">val</span> <span class="pl-en">lockTimeout</span><span class="pl-k">:</span> <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">60</span> seconds) {

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * Starts a new job and returns a [[<span class="pl-e">de.kaufhof.hajobs.JobExecution JobExecution</span>]].</span>
<span class="pl-c">   * The [[<span class="pl-e">de.kaufhof.hajobs.JobExecution#result JobExecution.result</span>]] future must be</span>
<span class="pl-c">   * completed when the job execution is finished.</span>
<span class="pl-c">   *</span>
<span class="pl-c">   * This method (`run`) should not "block", all the work must be performed</span>
<span class="pl-c">   * by the returned `JobExecution`.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">run</span>()(<span class="pl-k">implicit</span> <span class="pl-v">context</span>: <span class="pl-en">JobContext</span>)<span class="pl-k">:</span> <span class="pl-en">JobExecution</span>

}</pre>
  </div> 
  <p>The <code>JobType</code> identifies the job, it is defined with a name and a <code>LockType</code>. There's a distinction between <code>JobType</code> and <code>LockType</code> so that jobs with the same <code>LockType</code> cannot run simultaneously. A <code>LockType</code> is just defined by name.</p> 
  <p>If your job is implemented as an actor, you can just use the <code>ActorJob</code>, as shown by examples below.</p> 
  <h3><a id="user-content-alternative-solutions" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#alternative-solutions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Alternative Solutions</h3> 
  <ul> 
   <li>For job locking <a href="http://zookeeper.apache.org/doc/current/recipes.html#sc_recipes_Locks" target="_blank">Zookeeper could be used</a>.</li> 
   <li>For job locking and job supervision <a href="http://doc.akka.io/docs/akka/snapshot/contrib/cluster-singleton.html" target="_blank">Akka's Cluster Singleton</a> could be used. There's also a nice <a href="http://typesafe.com/activator/template/akka-distributed-workers" target="_blank">Activator template for distributed workers with Akka</a> that provides an example for the cluster singleton.</li> 
   <li><a href="https://github.com/airbnb/chronos" target="_blank">Chronos</a> Fault tolerant job scheduler for Mesos which handles dependencies and ISO8601 based schedules. <em>Batteries included</em></li> 
  </ul> 
  <h2><a id="user-content-installation--setup" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#installation--setup" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation / Setup</h2> 
  <p>You must add the ha-jobs to the dependencies of the build file, e.g. add to <code>build.sbt</code>:</p> 
  <pre><code>libraryDependencies += "de.kaufhof" %% "ha-jobs" % "1.7.1"
</code></pre> 
  <p>It is published to maven central for both scala 2.10 and 2.11.</p> 
  <p>You must create the tables <code>lock</code>, <code>job_status_data</code> and <code>job_status_meta</code> in the used Cassandra keyspace, according to the (<a href="https://github.com/comeara/pillar" target="_blank">Pillar</a>) migration scripts in <a href="https://github.com/Galeria-Kaufhof/ha-jobs/tree/master/ha-jobs-core/src/test/resources/migrations" target="_blank">ha-jobs-core/src/test/resources/migrations</a>.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>For a single Job you have to</p> 
  <ul> 
   <li>Define the <code>LockType</code> (with name)</li> 
   <li>Define the <code>JobType</code> (with name and <code>LockType</code>)</li> 
   <li>Implement your concrete job, which must extend <code>Job</code>.</li> 
   <li>If you're using an Akka Actor for your Job, you can just use the <code>ActorJob</code> as <code>Job</code> implementation and configure it with the <code>Props</code> creating your Actor (see also the example below).</li> 
  </ul> 
  <p>To complete the setup you also need</p> 
  <ul> 
   <li>the <code>JobSupervisor</code> job, which detects dead jobs and retriggers them on an alive instance</li> 
   <li>the <code>JobManager</code>, which schedules Jobs according to their cron patterns</li> 
  </ul> 
  <p>You also need to setup/configure 2 or 3 things more, which should be self-explanatory.</p> 
  <h3><a id="user-content-example-1-a-job-with-cron-schedule-persistence-and-supervision" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#example-1-a-job-with-cron-schedule-persistence-and-supervision" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example 1: A Job with Cron Schedule, Persistence and Supervision</h3> 
  <p>Here's a fully working example of a job (might e.g. import products) that is started every 10 minutes. The job stores its status when starting/finished, it might do so as well during the import so that its progress could be tracked. In this example the JobSupervisor is also configured, so that failed/dead jobs would be detected.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span><span class="pl-v">ActorSystem</span>
<span class="pl-k">import</span> <span class="pl-v">de.kaufhof.hajobs.JobState.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">de.kaufhof.hajobs.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">Json</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span>{<span class="pl-v">Promise</span>, <span class="pl-v">Future</span>}
<span class="pl-k">import</span> <span class="pl-v">scala.util.</span>{<span class="pl-v">Failure</span>, <span class="pl-v">Success</span>, <span class="pl-v">Try</span>}

<span class="pl-c"><span class="pl-c">//</span> == Product Import Job</span>
<span class="pl-k">val</span> <span class="pl-en">ProductImportLockType</span> <span class="pl-k">=</span> <span class="pl-en">LockType</span>(<span class="pl-s"><span class="pl-pds">"</span>ProductImportLock<span class="pl-pds">"</span></span>)
<span class="pl-k">val</span> <span class="pl-en">ProductImportJobType</span> <span class="pl-k">=</span> <span class="pl-en">JobType</span>(<span class="pl-s"><span class="pl-pds">"</span>ProductImport<span class="pl-pds">"</span></span>, <span class="pl-en">ProductImportLockType</span>)

<span class="pl-c"><span class="pl-c">/**</span></span>
<span class="pl-c"> * A job that normally would import products, but now only prints "importing" some times.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">class</span> <span class="pl-en">ProductImport</span>(<span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">jobStatusRepository</span><span class="pl-k">:</span> <span class="pl-en">JobStatusRepository</span>,
                    <span class="pl-v">cronExpression</span>: <span class="pl-en">Option</span>[<span class="pl-k">String</span>]) <span class="pl-k">extends</span> <span class="pl-e">Job</span>(
  <span class="pl-en">ProductImportJobType</span>, retriggerCount <span class="pl-k">=</span> <span class="pl-c1">3</span>, cronExpression <span class="pl-k">=</span> cronExpression) <span class="pl-k">with</span> <span class="pl-e">WriteStatus</span> {

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">run</span>()(<span class="pl-k">implicit</span> <span class="pl-v">context</span>: <span class="pl-en">JobContext</span>)<span class="pl-k">:</span> <span class="pl-en">JobExecution</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JobExecution</span>() {

    <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">promise</span> <span class="pl-k">=</span> <span class="pl-en">Promise</span>[<span class="pl-k">Unit</span>]()
    <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">result</span> <span class="pl-k">=</span> promise.future

    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">cancel</span>()<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
      <span class="pl-c"><span class="pl-c">//</span> We might update some flag that could be checked by `importProducts()`</span>
    }

    writeStatus(<span class="pl-en">Running</span>)

    <span class="pl-c"><span class="pl-c">//</span> onComplete: after updating our status we must complete the result. This will</span>
    <span class="pl-c"><span class="pl-c">//</span> release the lock and stop the lock keeper actor.</span>
    importProducts().onComplete(updateStatus.andThen(_ <span class="pl-k">=&gt;</span> promise.success(())))

    <span class="pl-c"><span class="pl-c">//</span> A not so long running operation, but still producing some side effect</span>
    <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">importProducts</span>()<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Int</span>] <span class="pl-k">=</span> {
      <span class="pl-en">Future</span>.successful {
        println(<span class="pl-s"><span class="pl-pds">"</span>Importing products ... done.<span class="pl-pds">"</span></span>)
        <span class="pl-c1">42</span> <span class="pl-c"><span class="pl-c">//</span> products imported</span>
      }
    }

    <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">updateStatus</span>(<span class="pl-k">implicit</span> <span class="pl-v">context</span>: <span class="pl-en">JobContext</span>)<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-k">Int</span>] <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>[<span class="pl-en">JobStatus</span>] <span class="pl-k">=</span> {
      <span class="pl-k">case</span> <span class="pl-en">Success</span>(count) <span class="pl-k">=&gt;</span>
        writeStatus(<span class="pl-en">Finished</span>, <span class="pl-en">Some</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> count)))
      <span class="pl-k">case</span> <span class="pl-en">Failure</span>(e) <span class="pl-k">=&gt;</span>
        writeStatus(<span class="pl-en">Failed</span>, <span class="pl-en">Some</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> e.getMessage)))
    }

  }

}

<span class="pl-c"><span class="pl-c">//</span> Setup repos needed for jobs + job manager</span>
<span class="pl-c"><span class="pl-c">//</span> session: the Cassandra Session (com.datastax.driver.core.Session)</span>
<span class="pl-k">val</span> <span class="pl-en">statusRepo</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JobStatusRepository</span>(session, jobTypes <span class="pl-k">=</span> <span class="pl-en">JobTypes</span>(<span class="pl-en">ProductImportJobType</span>))
<span class="pl-k">val</span> <span class="pl-en">lockRepo</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">LockRepository</span>(session, <span class="pl-en">LockTypes</span>(<span class="pl-en">ProductImportLockType</span>))

<span class="pl-c"><span class="pl-c">//</span> Setup jobs</span>
<span class="pl-k">val</span> <span class="pl-en">productImporter</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ProductImport</span>(statusRepo, <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>0 0 * * * ?<span class="pl-pds">"</span></span>))
<span class="pl-k">val</span> <span class="pl-en">jobSupervisor</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JobSupervisor</span>(manager, lockRepo, statusRepo, <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>0 * * * * ?<span class="pl-pds">"</span></span>))

<span class="pl-k">val</span> <span class="pl-en">system</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>example1<span class="pl-pds">"</span></span>)

<span class="pl-c"><span class="pl-c">//</span> Setup the JobManager</span>
<span class="pl-k">val</span> <span class="pl-en">manager</span><span class="pl-k">:</span> <span class="pl-en">JobManager</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JobManager</span>(<span class="pl-en">Seq</span>(productImporter, jobSupervisor), lockRepo, statusRepo, system)

<span class="pl-c"><span class="pl-c">//</span> You should `shutdown()` the manager when the application is stopped.</span></pre>
  </div> 
  <p>In the given example, once the <code>JobManager</code> is created, it will schedule the <code>productImporter</code> according to its <code>cronExpression</code>.</p> 
  <p>The <code>JobTypes</code> and <code>LockTypes</code> must provide all your custom <code>JobType</code>s and <code>LockType</code>s, they're needed by the repositories when loading db records, which is done when a job status is reported (e.g. via the Play! REST API).</p> 
  <h3><a id="user-content-example-2-an-actor-job-with-cron-schedule-etc" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#example-2-an-actor-job-with-cron-schedule-etc" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example 2: An Actor Job with Cron Schedule etc.</h3> 
  <p>If the previous Job would be implemented via an Actor this would be used together with the <code>ActorJob</code>. So the <code>ProductImport</code> class and its instance would be replaced by this</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">ProductImportActor</span>(<span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">jobStatusRepository</span><span class="pl-k">:</span> <span class="pl-en">JobStatusRepository</span>)
                        (<span class="pl-k">implicit</span> <span class="pl-v">jobContext</span>: <span class="pl-en">JobContext</span>) <span class="pl-k">extends</span> <span class="pl-e">Actor</span> <span class="pl-k">with</span> <span class="pl-e">WriteStatus</span> {

  writeStatus(<span class="pl-en">Running</span>)

  <span class="pl-c1">self</span> <span class="pl-k">!</span> <span class="pl-s"><span class="pl-pds">"</span>go<span class="pl-pds">"</span></span>

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">receive</span><span class="pl-k">:</span> <span class="pl-en">Receive</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>go<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span>
      println(<span class="pl-s"><span class="pl-pds">"</span>Importing products ... done.<span class="pl-pds">"</span></span>)
      writeStatus(<span class="pl-en">Finished</span>, <span class="pl-en">Some</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">42</span>)))
      <span class="pl-c"><span class="pl-c">//</span> no need to tell the context that we're finished, this will be done by ActorJob when we're stopped.</span>
      context.stop(<span class="pl-c1">self</span>)
    <span class="pl-k">case</span> <span class="pl-en">ActorJob</span>.<span class="pl-en">Cancel</span> <span class="pl-k">=&gt;</span>
      <span class="pl-c"><span class="pl-c">//</span> We should support ActorJob.Cancel and stop() processing.</span>
      writeStatus(<span class="pl-en">Canceled</span>)
      context.stop(<span class="pl-c1">self</span>)
  }

}

<span class="pl-k">object</span> <span class="pl-en">ProductImportActor</span> {
  <span class="pl-k">def</span> <span class="pl-en">props</span>(<span class="pl-v">statusRepo</span>: <span class="pl-en">JobStatusRepository</span>)(<span class="pl-v">jobContext</span>: <span class="pl-en">JobContext</span>) <span class="pl-k">=</span>
    <span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">ProductImportActor</span>(statusRepo)(jobContext))
}

<span class="pl-c"><span class="pl-c">//</span> the `ActorJob` creates a new actor from the given Props on each schedule</span>
<span class="pl-k">val</span> <span class="pl-en">productImporter</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ActorJob</span>(<span class="pl-en">ProductImportJobType</span>, <span class="pl-en">ProductImportActor</span>.props(statusRepo),
  system, cronExpression <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>0 0 * * * ?<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <h3><a id="user-content-example-3-an-actor-job-running-continuously" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#example-3-an-actor-job-running-continuously" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example 3: An Actor Job running continuously</h3> 
  <p>A use case for this might be an actor that regularly consumes a queue, with a high frequency. So the actor job should be started on system start, grab the lock, and run infinitely.</p> 
  <p>The relevant parts from the example above would be modified like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">QueueConsumerActor</span>(<span class="pl-v">interval</span>: <span class="pl-en">FiniteDuration</span>,
                         <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">jobStatusRepository</span><span class="pl-k">:</span> <span class="pl-en">JobStatusRepository</span>)
                        (<span class="pl-k">implicit</span> <span class="pl-v">jobContext</span>: <span class="pl-en">JobContext</span>) <span class="pl-k">extends</span> <span class="pl-e">Actor</span> <span class="pl-k">with</span> <span class="pl-e">WriteStatus</span> {

  writeStatus(<span class="pl-en">Running</span>)

  <span class="pl-c1">self</span> <span class="pl-k">!</span> <span class="pl-s"><span class="pl-pds">"</span>consume<span class="pl-pds">"</span></span>

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">receive</span><span class="pl-k">:</span> <span class="pl-en">Receive</span> <span class="pl-k">=</span> consuming(<span class="pl-c1">0</span>)

  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">consuming</span>(<span class="pl-v">consumed</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-en">Receive</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>consume<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span>
      println(s<span class="pl-s"><span class="pl-pds">"</span>Consuming, until now consumed $consumed items...<span class="pl-pds">"</span></span>)
      writeStatus(<span class="pl-en">Running</span>, <span class="pl-en">Some</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>consumed<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> consumed)))
      context.system.scheduler.scheduleOnce(interval, <span class="pl-c1">self</span>, <span class="pl-s"><span class="pl-pds">"</span>consume<span class="pl-pds">"</span></span>)
      context.become(consuming(consumed <span class="pl-k">+</span> <span class="pl-c1">42</span>))
    <span class="pl-k">case</span> <span class="pl-en">ActorJob</span>.<span class="pl-en">Cancel</span> <span class="pl-k">=&gt;</span>
      <span class="pl-c"><span class="pl-c">//</span> We should support ActorJob.Cancel and stop() processing.</span>
      writeStatus(<span class="pl-en">Canceled</span>)
      context.stop(<span class="pl-c1">self</span>)
  }

}

<span class="pl-k">object</span> <span class="pl-en">QueueConsumerActor</span> {
  <span class="pl-k">def</span> <span class="pl-en">props</span>(<span class="pl-v">interval</span>: <span class="pl-en">FiniteDuration</span>, <span class="pl-v">statusRepo</span>: <span class="pl-en">JobStatusRepository</span>)(<span class="pl-v">jobContext</span>: <span class="pl-en">JobContext</span>) <span class="pl-k">=</span>
    <span class="pl-en">Props</span>(<span class="pl-k">new</span> <span class="pl-en">QueueConsumerActor</span>(interval, statusRepo)(jobContext))
}

<span class="pl-c"><span class="pl-c">//</span> the ActorJob does not define a `cronExpression`</span>
<span class="pl-k">val</span> <span class="pl-en">queueConsumer</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ActorJob</span>(<span class="pl-en">ConsumerJobType</span>, <span class="pl-en">QueueConsumerActor</span>.props(<span class="pl-c1">2</span> seconds, statusRepo),
  system, cronExpression <span class="pl-k">=</span> <span class="pl-c1">None</span>)
<span class="pl-k">val</span> <span class="pl-en">manager</span><span class="pl-k">:</span> <span class="pl-en">JobManager</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JobManager</span>(<span class="pl-en">Seq</span>(queueConsumer, jobSupervisor), lockRepo, statusRepo, system)

<span class="pl-c"><span class="pl-c">//</span> manually trigger the job</span>
manager.triggerJob(<span class="pl-en">ConsumerJobType</span>) onComplete {
  <span class="pl-k">case</span> <span class="pl-en">Success</span>(<span class="pl-en">Started</span>(jobId, _)) <span class="pl-k">=&gt;</span> println(s<span class="pl-s"><span class="pl-pds">"</span>Started queue consumer job $jobId<span class="pl-pds">"</span></span>)
  <span class="pl-c"><span class="pl-c">//</span> The Success case can also carry LockedStatus or Error</span>
  <span class="pl-k">case</span> <span class="pl-en">Success</span>(els) <span class="pl-k">=&gt;</span> println(s<span class="pl-s"><span class="pl-pds">"</span>Could not start queue consumer: $els<span class="pl-pds">"</span></span>)
  <span class="pl-k">case</span> <span class="pl-en">Failure</span>(e) <span class="pl-k">=&gt;</span> println(s<span class="pl-s"><span class="pl-pds">"</span>An exception occurred when trying to start queue consumer: $e<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <h3><a id="user-content-play-rest-api" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#play-rest-api" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Play! REST API</h3> 
  <p>The module <code>ha-jobs-play</code> provides a Play! controller that allows to start jobs and retrieve the job status via HTTP.</p> 
  <p>To use this you must add the following to the build file:</p> 
  <pre><code>libraryDependencies += "de.kaufhof" %% "ha-jobs-play" % "1.7.1"
</code></pre> 
  <p>In your routes file you have to add these routes (of course you may choose different urls):</p> 
  <pre><code>POST   /jobs/:jobType           @de.kaufhof.hajobs.JobsController.run(jobType)
GET    /jobs/:jobType           @de.kaufhof.hajobs.JobsController.list(jobType, limit: Int ?= 20)
GET    /jobs/:jobType/latest    @de.kaufhof.hajobs.JobsController.latest(jobType)
GET    /jobs/:jobType/:jobId    @de.kaufhof.hajobs.JobsController.status(jobType, jobId)
</code></pre> 
  <p>Use your preferred dependency injection mechanism to provide the managed <code>JobsController</code> to your application. Either by adding a new module to your application.conf or to your <code>ApplicationLoader</code>s load function.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">jobManager</span> <span class="pl-k">=</span> ... <span class="pl-c"><span class="pl-c">//</span> the JobManager</span>
<span class="pl-k">val</span> <span class="pl-en">jobTypes</span> <span class="pl-k">=</span> ... <span class="pl-c"><span class="pl-c">//</span> e.g. JobTypes(ProductImportJobType) in the 1st example</span>
<span class="pl-k">new</span> <span class="pl-en">JobsController</span>(jobManager, jobTypes, de.kaufhof.hajobs.routes.<span class="pl-en">JobsController</span>)</pre>
  </div> 
  <p>The <code>de.kaufhof.hajobs.routes.JobsController</code> is the reverse router (<code>ReverseJobsController</code>) created by Play! on compilation.</p> 
  <p>Then you can manage your jobs via http, e.g. using the following for a job of <code>JobType("productimport")</code>:</p> 
  <div class="highlight highlight-source-shell">
   <pre><span class="pl-c"><span class="pl-c">#</span> get a list of all job executions</span>
curl http://localhost:9000/jobs/productimport
<span class="pl-c"><span class="pl-c">#</span> get redirected to the status of the latest job execution</span>
curl -L http://localhost:9000/jobs/productimport/latest
<span class="pl-c"><span class="pl-c">#</span> get job execution status/details</span>
curl http://localhost:9000/jobs/productimport/a13037f0-9076-11e4-a8d6-4ff0e8bdfb24
<span class="pl-c"><span class="pl-c">#</span> execute the job</span>
curl -X POST http://localhost:9000/jobs/productimport</pre>
  </div> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/galeria-kaufhof/ha-jobs#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>The license is Apache 2.0, see LICENSE.</p> 
 </article>
</div>