<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/overthink/circlet#circlet" aria-hidden="true" class="anchor" id="user-content-circlet" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Circlet</h1> 
  <p><a href="https://travis-ci.org/overthink/circlet" target="_blank"><img src="https://camo.githubusercontent.com/52cc966f8617428deb17a268ad836f0899acfadd/68747470733a2f2f7472617669732d63692e6f72672f6f7665727468696e6b2f636972636c65742e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/overthink/circlet.svg?branch=master" style="max-width:100%;"></a></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.markfeeney.circlet.Circlet.</span><span class="pl-v">handler</span>
<span class="pl-k">import</span> <span class="pl-v">com.markfeeney.circlet.</span>{<span class="pl-v">JettyAdapter</span>, <span class="pl-v">Response</span>}

<span class="pl-k">val</span> <span class="pl-en">app</span> <span class="pl-k">=</span> handler { req <span class="pl-k">=&gt;</span> <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>) }
<span class="pl-en">JettyAdapter</span>.run(app)</pre>
  </div> 
  <p>Circlet is a simple Scala web application library. Circlet allows you to write your application as a plain function of type <code>Request =&gt; Option[Response]</code> (also called a <code>Handler</code>).</p> 
  <p>Composable middleware functions of type <code>Handler =&gt; Handler</code> are used to add reusable functionality to handlers. Circlet includes some useful middleware like parameter parsing (including multipart, i.e. file upload), and cookie handling. For routing and higher-level functionality, see <a href="https://github.com/overthink/usher" target="_blank">Usher</a>.</p> 
  <p>Circlet attempts to abstract away the underlying web server, but it's somewhat theoretical, since only Jetty is currently supported.</p> 
  <p>Circlet also supports websockets, <a href="https://github.com/overthink/circlet#websockets" target="_blank">see below</a>.</p> 
  <p>Circlet aims to be in roughly the same space as other web server interfaces like <a href="https://wsgi.readthedocs.io/en/latest/" target="_blank">WSGI</a>, <a href="http://rack.github.io/" target="_blank">Rack</a>, <a href="https://github.com/yesodweb/wai" target="_blank">WAI</a>, and <a href="https://github.com/ring-clojure/ring" target="_blank">Ring</a>. In fact, Ring is the inspiration for Circlet, and large parts of Circlet are ported directly from it.</p> 
  <h2><a href="https://github.com/overthink/circlet#try-it" aria-hidden="true" class="anchor" id="user-content-try-it" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Try it</h2> 
  <p>Latest release:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.markfeeney<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>circlet_2.11<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.2.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>There is also an <a href="https://github.com/overthink/circlet-example" target="_blank">example circlet project</a> showing how to get a running Circlet app.</p> 
  <h2><a href="https://github.com/overthink/circlet#project-goals" aria-hidden="true" class="anchor" id="user-content-project-goals" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Project Goals</h2> 
  <p>In priority order:</p> 
  <ol> 
   <li>Small: few classes, few dependencies, no special tooling</li> 
   <li>Composable</li> 
   <li>Maintainable code</li> 
   <li>Type safe enough</li> 
   <li>Fast enough</li> 
  </ol> 
  <h2><a href="https://github.com/overthink/circlet#design" aria-hidden="true" class="anchor" id="user-content-design" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Design</h2> 
  <p>Handlers and middleware must be implemented in continuation-passing style (<a href="https://en.wikipedia.org/wiki/Continuation-passing_style" target="_blank">CPS</a>).</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">type</span> <span class="pl-en">Cont</span> <span class="pl-k">=</span> <span class="pl-en">Option</span>[<span class="pl-en">Response</span>] <span class="pl-k">=&gt;</span> <span class="pl-en">Sent</span>.type
<span class="pl-k">type</span> <span class="pl-en">Handler</span> <span class="pl-k">=</span> <span class="pl-en">Request</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Cont</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Sent</span>.type
<span class="pl-k">type</span> <span class="pl-en">Middleware</span> <span class="pl-k">=</span> <span class="pl-en">Handler</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Handler</span></pre>
  </div> 
  <p>i.e. you need to write this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> respond is the continuation fn</span>
<span class="pl-k">val</span> <span class="pl-en">cpsHelloWorld</span><span class="pl-k">:</span> <span class="pl-en">Handler</span> <span class="pl-k">=</span> request <span class="pl-k">=&gt;</span> respond <span class="pl-k">=&gt;</span> {
  <span class="pl-k">val</span> <span class="pl-en">resp</span> <span class="pl-k">=</span> <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hello world<span class="pl-pds">"</span></span>)
  respond(resp)
}</pre>
  </div> 
  <p>instead of something like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> doesn't compile</span>
<span class="pl-k">val</span> <span class="pl-en">helloWorld</span><span class="pl-k">:</span> <span class="pl-en">Handler</span> <span class="pl-k">=</span> request <span class="pl-k">=&gt;</span> {
  <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hello world<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <p>Worrying about the continuation can be a pain in the neck sometimes, so <a href="https://github.com/overthink/circlet/blob/master/src/main/scala/com/markfeeney/circlet/Circlet.scala#L23" target="_blank">helpers</a> are available for cases where you don't need the extra features CPS affords. e.g.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">helloWorld</span> <span class="pl-k">=</span> handler { req <span class="pl-k">=&gt;</span> <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hello world<span class="pl-pds">"</span></span>) }</pre>
  </div> 
  <p>I've gone the CPS route so handlers can allocate "request scoped" resources and properly clean them up when request processing is complete. As an example, Circlet's multipart parameter middleware uses this to <a href="https://github.com/overthink/circlet/blob/master/src/main/scala/com/markfeeney/circlet/middleware/MultipartParams.scala#L163-L167" target="_blank">clean up temp files</a> created when handling file uploads.</p> 
  <p>Here's another (contrived) example: streaming a response from the database.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">streamingHandler</span><span class="pl-k">:</span> <span class="pl-en">Handler</span> <span class="pl-k">=</span> req <span class="pl-k">=&gt;</span> respond <span class="pl-k">=&gt;</span> {
  <span class="pl-k">val</span> <span class="pl-en">conn</span> <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">//</span> get a db connection</span>
  <span class="pl-k">try</span> {
    <span class="pl-k">val</span> <span class="pl-en">resp</span> <span class="pl-k">=</span> <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-en">SeqBody</span>(makeLazySeq(req, conn)))
    respond(resp)
  } <span class="pl-k">finally</span> {
    conn.close() <span class="pl-c"><span class="pl-c">//</span> response has been sent, close connection</span>
  }
}</pre>
  </div> 
  <p>Circlet's CPS approach is borrowed from <a href="https://hackage.haskell.org/package/wai-3.2.1/docs/Network-Wai.html" target="_blank">WAI</a> (thanks <a href="https://github.com/stebulus" target="_blank">stebulus</a>).</p> 
  <h2><a href="https://github.com/overthink/circlet#websockets" aria-hidden="true" class="anchor" id="user-content-websockets" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a name="user-content-websockets" target="_blank" href=""></a>Websockets</h2> 
  <p>As of 0.2.0, Criclet supports websockets. These are somewhat bolted on, unfortunately: they're Jetty-specific and do not take part in middleware. Regular handlers still behave as normal, but a separate mapping of paths to websocket implementations is provided to the server at creation time. Here is a simple example that returns whatever it is sent, converted to uppercase.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.markfeeney.circlet.Circlet.</span><span class="pl-v">handler</span>
<span class="pl-k">import</span> <span class="pl-v">com.markfeeney.circlet.</span>{<span class="pl-v">JettyAdapter</span>, <span class="pl-v">JettyOptions</span>, <span class="pl-v">Response</span>}
<span class="pl-k">import</span> <span class="pl-v">com.markfeeney.circlet.</span><span class="pl-v">JettyWebSocket</span>

<span class="pl-k">val</span> <span class="pl-en">upper</span> <span class="pl-k">=</span> <span class="pl-en">JettyWebSocket</span>(
  onText <span class="pl-k">=</span> (session, msg) <span class="pl-k">=&gt;</span> session.getRemote.sendString(msg.toUpperCase)
)
<span class="pl-k">val</span> <span class="pl-en">opts</span> <span class="pl-k">=</span> <span class="pl-en">JettyOptions</span>(webSockets <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>/upper/<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> upper))
<span class="pl-k">val</span> <span class="pl-en">app</span> <span class="pl-k">=</span> handler { req <span class="pl-k">=&gt;</span> <span class="pl-en">Response</span>(body <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>websocket example, connect to ws://upper/<span class="pl-pds">"</span></span>) }
<span class="pl-en">JettyAdapter</span>.run(app, opts)</pre>
  </div> 
  <h2><a href="https://github.com/overthink/circlet#todo" aria-hidden="true" class="anchor" id="user-content-todo" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>TODO</h2> 
  <ul> 
   <li>Better understand websocket threading model</li> 
   <li>Async handlers? (not yet convinced that I care)</li> 
   <li>Make websockets use <a href="https://jcp.org/en/jsr/detail?id=356" target="_blank">JSR 356</a> rather than Jetty-specific classes</li> 
   <li>Support other web servers besides Jetty?</li> 
  </ul> 
  <h2><a href="https://github.com/overthink/circlet#known-issues" aria-hidden="true" class="anchor" id="user-content-known-issues" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Known issues</h2> 
  <ul> 
   <li>A CPS handler could call the continuation function multiple times. I'm not sure how to prevent this, (or if I should) so don't do it. Unless you need to.</li> 
  </ul> 
  <h2><a href="https://github.com/overthink/circlet#other-options" aria-hidden="true" class="anchor" id="user-content-other-options" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Other options</h2> 
  <p>There are a lot of Scala web libraries and frameworks out there. Here are some that I feel are close in spirit to circlet.</p> 
  <ul> 
   <li><a href="http://http4s.org/" target="_blank">http4s</a> - very similar to circlet, focus on async, heavy use of scalaz</li> 
   <li><a href="https://twitter.github.io/finagle/" target="_blank">finagle</a> - Twitter's big system for building high-concurrency servers</li> 
  </ul> 
  <h2><a href="https://github.com/overthink/circlet#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>Copyright © 2016 Mark Feeney</p> 
  <p>Released under the MIT license.</p> 
 </article>
</div>