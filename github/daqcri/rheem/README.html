<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p><strong>--- Please note that Rheem has moved to a new repository: <a href="https://github.com/rheem-ecosystem/rheem" target="_blank">https://github.com/rheem-ecosystem/rheem</a> ---</strong></p> 
  <h1><a href="https://github.com/daqcri/rheem#rheem" aria-hidden="true" class="anchor" id="user-content-rheem" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Rheem</h1> 
  <p><a href="https://jenkins.qcri.org/job/rheem-build/" target="_blank"><img src="https://camo.githubusercontent.com/03cd214beb6b6ab9c0e4f25c5f7ab2c2f1d49950/68747470733a2f2f6a656e6b696e732e716372692e6f72672f6275696c645374617475732f69636f6e3f6a6f623d726865656d2d6275696c64" alt="Build Status" data-canonical-src="https://jenkins.qcri.org/buildStatus/icon?job=rheem-build" style="max-width:100%;"></a> <a href="https://gitter.im/rheem-ecosystem/Lobby" target="_blank"><img src="https://camo.githubusercontent.com/4766c5083942250e504fda0eba07508fd3a311c8/68747470733a2f2f6261646765732e6769747465722e696d2f726865656d2d65636f73797374656d2f4c6f6262792e706e67" alt="Gitter chat" data-canonical-src="https://badges.gitter.im/rheem-ecosystem/Lobby.png" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/org.qcri.rheem/rheem" target="_blank"><img src="https://camo.githubusercontent.com/403457c84d1c5caaf4c1bde5fb62246c0cd30f1d/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f6f72672e716372692e726865656d2f726865656d2f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/org.qcri.rheem/rheem/badge.svg" style="max-width:100%;"></a></p> 
  <h4><a href="https://github.com/daqcri/rheem#turning-the-zoo-of-data-processing-systems-into-a-circus" aria-hidden="true" class="anchor" id="user-content-turning-the-zoo-of-data-processing-systems-into-a-circus" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Turning the Zoo of Data Processing Systems into a Circus</h4> 
  <p>Rheem is an efficient and scalable data processing framework developed by the <a href="http://da.qcri.org" target="_blank">data analytics</a> group at <a href="http://qcri.com/" target="_blank">Qatar Computing Research Institute</a> in collaboration with the <a href="https://www.hpi.de/naumann" target="_blank">information systems group</a> at the Hasso Plattner Institute. In contrast to classical data processing systems that provide one dedicated execution engine, Rheem rather is a <em>meta processing framework</em>: You can specify your data processing app via one of Rheem's API and then Rheem will pick an optimal configuration of classical processing frameworks, such as Java Streams or Apache Spark, to run your app on. Finally, Rheem will also perform the execution, thereby hiding the different specific platform APIs and coordinate inter-platform communication.</p> 
  <p>This approach aims at freeing data engineers and software developers from the burden of knowing the zoo of different data processing systems, their APIs, strengths and weakness; the intricacies of coordinating and integrating different processing platforms; and the inflexibility when tying to a fix set of processing platforms. As of now, Rheem has built in support for the following processing platforms:</p> 
  <ul> 
   <li>Java 8 Streams</li> 
   <li><a href="https://spark.apache.org/" target="_blank">Apache Spark</a></li> 
   <li><a href="https://github.com/GraphChi/graphchi-java" target="_blank">GraphChi</a></li> 
   <li><a href="http://www.postgresql.org" target="_blank">Postgres</a></li> 
   <li><a href="https://www.sqlite.org/" target="_blank">SQLite</a></li> 
  </ul> 
  <h2><a href="https://github.com/daqcri/rheem#how-to-use-rheem" aria-hidden="true" class="anchor" id="user-content-how-to-use-rheem" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to use Rheem</h2> 
  <p><strong>Requirements.</strong> Rheem is built with Java 8 and Scala 2.11. However, to execute Rheem it is sufficient to have Java 8 installed. If you want to build Rheem yourself, you will also need to have <a href="http://maven.apache.org" target="_blank">Apache Maven</a> installed. Please also consider that processing platforms employed by Rheem might have further requirements.</p> 
  <p><strong>Get Rheem.</strong> Rheem is available via Maven Central. To use it with Maven, for instance, include the following into you POM file:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt; 
  &lt;<span class="pl-ent">groupId</span>&gt;org.qcri.rheem&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;rheem-***&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;0.2.1&lt;/<span class="pl-ent">version</span>&gt; 
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>Note the <code>***</code>: Rheem ships with multiple modules that can be included in your app, depending on how you want to use it:</p> 
  <ul> 
   <li><code>rheem-core</code>: provides core data structures and the optimizer (required)</li> 
   <li><code>rheem-basic</code>: provides common operators and data types for your apps (recommended)</li> 
   <li><code>rheem-api</code>: provides an easy-to-use Scala and Java API to assemble Rheem plans (recommended)</li> 
   <li><code>rheem-java</code>, <code>rheem-spark</code>, <code>rheem-graphchi</code>, <code>rheem-sqlite3</code>, <code>rheem-postgres</code>: adapters for the various supported processing platforms</li> 
   <li><code>rheem-profiler</code>: provides functionality to learn operator and UDF cost functions from historical execution data</li> 
  </ul> 
  <p>For the sake of version flexibility, you still have to include your Hadoop (<code>hadoop-hdfs</code> and <code>hadoop-common</code>) and Spark (<code>spark-core</code> and <code>spark-graphx</code>) version of choice.</p> 
  <p>In addition, you can obtain the most recent snapshot version of Rheem via Sonatype's snapshot repository. Just included</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">repositories</span>&gt;
  &lt;<span class="pl-ent">repository</span>&gt;
    &lt;<span class="pl-ent">id</span>&gt;sonatype-snapshots&lt;/<span class="pl-ent">id</span>&gt;
    &lt;<span class="pl-ent">name</span>&gt;Sonatype Snapshot Repository&lt;/<span class="pl-ent">name</span>&gt;
    &lt;<span class="pl-ent">url</span>&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/<span class="pl-ent">url</span>&gt;
  &lt;/<span class="pl-ent">repository</span>&gt;
&lt;<span class="pl-ent">repositories</span>&gt;</pre>
  </div> 
  <p>If you need to rebuild Rheem, e.g., to use a different Scala version, you can simply do so via Maven:</p> 
  <ol> 
   <li>Adapt the version variables (e.g., <code>spark.version</code>) in the main <code>pom.xml</code> file.</li> 
   <li>Build Rheem with the adapted versions. 
    <div class="highlight highlight-source-shell">
     <pre>$ mvn clean install</pre>
    </div> Note the <code>standalone</code> profile to fix Hadoop and Spark versions, so that Rheem apps do not explicitly need to declare the corresponding dependencies. Also, note the <code>distro</code> profile, which assembles a binary Rheem distribution. To activate these profiles, you need to specify them when running maven, i.e., 
    <div class="highlight highlight-source-shell">
     <pre>mvn clean install -P<span class="pl-k">&lt;</span>profile name<span class="pl-k">&gt;</span></pre>
    </div> </li> 
  </ol> 
  <p><strong>Configure Rheem.</strong> In order for Rheem to work properly, it is necessary to tell Rheem about the capacities of your processing platforms and how to reach them. While there is a default configuration that allows to test Rheem right away, we recommend to create a properties file to adapt the configuration where necessary. To have Rheem use that configuration transparently, just run you app via</p> 
  <div class="highlight highlight-source-shell">
   <pre>$ java -Drheem.properties=url://to/my/rheem.properties ...</pre>
  </div> 
  <p>You can find the most relevant settings in the following:</p> 
  <ul> 
   <li>General settings 
    <ul> 
     <li><code>rheem.core.log.enabled (= true)</code>: whether to log execution statistics to allow learning better cardinality and cost estimators for the optimizer</li> 
     <li><code>rheem.core.log.executions (= ~/.rheem/executions.json)</code> where to log execution times of operator groups</li> 
     <li><code>rheem.core.log.cardinalities (= ~/.rheem/cardinalities.json)</code> where to log cardinality measurements</li> 
     <li><code>rheem.core.optimizer.instrumentation (= org.qcri.rheem.core.profiling.OutboundInstrumentationStrategy)</code>: where to measure cardinalities in Rheem plans; other options are <code>org.qcri.rheem.core.profiling.NoInstrumentationStrategy</code> and <code>org.qcri.rheem.core.profiling.FullInstrumentationStrategy</code></li> 
     <li><code>rheem.core.optimizer.reoptimize (= false)</code>: whether to progressively optimize Rheem plans</li> 
     <li><code>rheem.basic.tempdir (= file:///tmp)</code>: where to store temporary files, in particular for inter-platform communication</li> 
    </ul> </li> 
   <li>Java Streams 
    <ul> 
     <li><code>rheem.java.cpu.mhz (= 2700)</code>: clock frequency of processor the JVM runs on in MHz</li> 
     <li><code>rheem.java.hdfs.ms-per-mb (= 2.7)</code>: average throughput from HDFS to JVM in ms/MB</li> 
    </ul> </li> 
   <li>Apache Spark 
    <ul> 
     <li><code>spark.master (= local)</code>: Spark master 
      <ul> 
       <li>various other Spark settings are supported, e.g., <code>spark.executor.memory</code>, <code>spark.serializer</code>, ...</li> 
      </ul> </li> 
     <li><code>rheem.spark.cpu.mhz (= 2700)</code>: clock frequency of processor the Spark workers run on in MHz</li> 
     <li><code>rheem.spark.hdfs.ms-per-mb (= 2.7)</code>: average throughput from HDFS to the Spark workers in ms/MB</li> 
     <li><code>rheem.spark.network.ms-per-mb (= 8.6)</code>: average network throughput of the Spark workers in ms/MB</li> 
     <li><code>rheem.spark.init.ms (= 4500)</code>: time it takes Spark to initialize in ms</li> 
    </ul> </li> 
   <li>GraphChi 
    <ul> 
     <li><code>rheem.graphchi.cpu.mhz (= 2700)</code>: clock frequency of processor GraphChi runs on in MHz</li> 
     <li><code>rheem.graphchi.cpu.cores (= 2)</code>: number of cores GraphChi runs on</li> 
     <li><code>rheem.graphchi.hdfs.ms-per-mb (= 2.7)</code>: average throughput from HDFS to GraphChi in ms/MB</li> 
    </ul> </li> 
   <li>SQLite 
    <ul> 
     <li><code>rheem.sqlite3.jdbc.url</code>: JDBC URL to use SQLite</li> 
     <li><code>rheem.sqlite3.cpu.mhz (= 2700)</code>: clock frequency of processor SQLite runs on in MHz</li> 
     <li><code>rheem.sqlite3.cpu.cores (= 2)</code>: number of cores SQLite runs on</li> 
    </ul> </li> 
   <li>PostgreSQL 
    <ul> 
     <li><code>rheem.postgres.jdbc.url</code>: JDBC URL to use PostgreSQL</li> 
     <li><code>rheem.postgres.cpu.mhz (= 2700)</code>: clock frequency of processor PostgreSQL runs on in MHz</li> 
     <li><code>rheem.postgres.cpu.cores (= 2)</code>: number of cores PostgreSQL runs on</li> 
    </ul> </li> 
  </ul> 
  <p><strong>Code with Rheem.</strong> The recommended way to specify your apps with Rheem is via its Scala or Java API from the <code>rheem-api</code> module. You can find examples below.</p> 
  <p><strong>Learn cost functions.</strong> Rheem provides a utility to learn cost functions from historical execution data. Specifically, Rheem can learn configurations for load profile estimators (that estimate CPU load, disk load etc.) for both operators and UDFs, as long as the configuration provides a template for those estimators. As an example, the <code>JavaMapOperator</code> draws its load profile estimator configuration via the configuration key <code>rheem.java.map.load</code>. Now, it is possible to specify a load profile estimator template in the configuration under the key <code>&lt;original key&gt;.template</code>, e.g.:</p> 
  <div class="highlight highlight-text-xml">
   <pre>rheem.java.map.load.template = {\
  "in":1, "out":1,\
  "cpu":"?*in0"\
}</pre>
  </div> 
  <p>This template specifies a load profile estimator that expects (at least) one input cardinality and one output cardinality. Further, it models a CPU load that is proportional to the input cardinality. However, more complex functions are possible. In particular, you can use</p> 
  <ul> 
   <li>the variables <code>in0</code>, <code>in1</code>, ... and <code>out0</code>, <code>out1</code>, ... to incorporate the input and output cardinalities, respectively;</li> 
   <li>operator properties, such as <code>numIterations</code> for the <code>PageRankOperator</code> implementations;</li> 
   <li>the operators <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>^</code>, and parantheses;</li> 
   <li>the functions <code>min(x0, x1, ...))</code>, <code>max(x0, x1, ...)</code>, <code>abs(x)</code>, <code>log(x, base)</code>, <code>ln(x)</code>, <code>ld(x)</code>;</li> 
   <li>and the constants <code>e</code> and <code>pi</code>.</li> 
  </ul> 
  <p>While Rheem specifies templates for all execution operators, you will need to specify that your UDFs are modelled by some configuration-based cost function (see the k-means example below) and create the according initial specification and template yourself. Once, you gathered execution data, you can run</p> 
  <div class="highlight highlight-source-shell">
   <pre>java ... org.qcri.rheem.profiler.ga.GeneticOptimizerApp [configuration URL [execution log]]</pre>
  </div> 
  <p>This app will try to find appropriate values for the question marks (<code>?</code>) in the load profile estimator templates to fit the gathered execution data and ready-made configuration entries for the load profile estimators. You can then copy them into your configuration.</p> 
  <h2><a href="https://github.com/daqcri/rheem#examples" aria-hidden="true" class="anchor" id="user-content-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Examples</h2> 
  <p>For some executable examples, have a look at <a href="https://www.github.com/sekruse/rheem-examples" target="_blank">this repository</a>.</p> 
  <h3><a href="https://github.com/daqcri/rheem#wordcount" aria-hidden="true" class="anchor" id="user-content-wordcount" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>WordCount</h3> 
  <p>The "Hello World!" of data processing systems is the wordcount.</p> 
  <h4><a href="https://github.com/daqcri/rheem#java-api" aria-hidden="true" class="anchor" id="user-content-java-api" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Java API</h4> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.api.JavaPlanBuilder</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.basic.data.Tuple2</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.core.api.Configuration</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.core.api.RheemContext</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.core.optimizer.cardinality.DefaultCardinalityEstimator</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.java.Java</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.qcri.rheem.spark.Spark</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.Collection</span>;
<span class="pl-k">import</span> <span class="pl-smi">java.util.Arrays</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">WordcountJava</span> {

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>){

        <span class="pl-c"><span class="pl-c">//</span> Settings</span>
        <span class="pl-smi">String</span> inputUrl <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>file:/tmp.txt<span class="pl-pds">"</span></span>;

        <span class="pl-c"><span class="pl-c">//</span> Get a plan builder.</span>
        <span class="pl-smi">RheemContext</span> rheemContext <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">RheemContext</span>(<span class="pl-k">new</span> <span class="pl-smi">Configuration</span>())
                .withPlugin(<span class="pl-smi">Java</span><span class="pl-k">.</span>basicPlugin())
                .withPlugin(<span class="pl-smi">Spark</span><span class="pl-k">.</span>basicPlugin());
        <span class="pl-smi">JavaPlanBuilder</span> planBuilder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JavaPlanBuilder</span>(rheemContext)
                .withJobName(<span class="pl-smi">String</span><span class="pl-k">.</span>format(<span class="pl-s"><span class="pl-pds">"</span>WordCount (%s)<span class="pl-pds">"</span></span>, inputUrl))
                .withUdfJarOf(<span class="pl-smi">WordcountJava</span><span class="pl-k">.</span>class);

        <span class="pl-c"><span class="pl-c">//</span> Start building the RheemPlan.</span>
        <span class="pl-k">Collection&lt;<span class="pl-k">Tuple2&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Integer</span>&gt;</span>&gt;</span> wordcounts <span class="pl-k">=</span> planBuilder
                <span class="pl-c"><span class="pl-c">//</span> Read the text file.</span>
                .readTextFile(inputUrl)<span class="pl-k">.</span>withName(<span class="pl-s"><span class="pl-pds">"</span>Load file<span class="pl-pds">"</span></span>)

                <span class="pl-c"><span class="pl-c">//</span> Split each line by non-word characters.</span>
                .flatMap(line <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">Arrays</span><span class="pl-k">.</span>asList(line<span class="pl-k">.</span>split(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\\</span>W+<span class="pl-pds">"</span></span>)))
                .withSelectivity(<span class="pl-c1">10</span>, <span class="pl-c1">100</span>, <span class="pl-c1">0.9</span>)
                .withName(<span class="pl-s"><span class="pl-pds">"</span>Split words<span class="pl-pds">"</span></span>)

                <span class="pl-c"><span class="pl-c">//</span> Filter empty tokens.</span>
                .filter(token <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-k">!</span>token<span class="pl-k">.</span>isEmpty())
                .withSelectivity(<span class="pl-c1">0.99</span>, <span class="pl-c1">0.99</span>, <span class="pl-c1">0.99</span>)
                .withName(<span class="pl-s"><span class="pl-pds">"</span>Filter empty words<span class="pl-pds">"</span></span>)

                <span class="pl-c"><span class="pl-c">//</span> Attach counter to each word.</span>
                .map(word <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-k">new</span> <span class="pl-k">Tuple2&lt;&gt;</span>(word<span class="pl-k">.</span>toLowerCase(), <span class="pl-c1">1</span>))<span class="pl-k">.</span>withName(<span class="pl-s"><span class="pl-pds">"</span>To lower case, add counter<span class="pl-pds">"</span></span>)

                <span class="pl-c"><span class="pl-c">//</span> Sum up counters for every word.</span>
                .reduceByKey(
                        <span class="pl-smi">Tuple2</span><span class="pl-k">::</span>getField0,
                        (t1, t2) <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-k">new</span> <span class="pl-k">Tuple2&lt;&gt;</span>(t1<span class="pl-k">.</span>getField0(), t1<span class="pl-k">.</span>getField1() <span class="pl-k">+</span> t2<span class="pl-k">.</span>getField1())
                )
                .withCardinalityEstimator(<span class="pl-k">new</span> <span class="pl-smi">DefaultCardinalityEstimator</span>(<span class="pl-c1">0.9</span>, <span class="pl-c1">1</span>, <span class="pl-c1">false</span>, in <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">Math</span><span class="pl-k">.</span>round(<span class="pl-c1">0.01</span> <span class="pl-k">*</span> in[<span class="pl-c1">0</span>])))
                .withName(<span class="pl-s"><span class="pl-pds">"</span>Add counters<span class="pl-pds">"</span></span>)

                <span class="pl-c"><span class="pl-c">//</span> Execute the plan and collect the results.</span>
                .collect();

        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(wordcounts);
    }
}</pre>
  </div> 
  <h4><a href="https://github.com/daqcri/rheem#scala-api" aria-hidden="true" class="anchor" id="user-content-scala-api" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala API</h4> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.api.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.core.api.</span>{<span class="pl-v">Configuration</span>, <span class="pl-v">RheemContext</span>}
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.java.</span><span class="pl-v">Java</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.spark.</span><span class="pl-v">Spark</span>

<span class="pl-k">object</span> <span class="pl-en">WordcountScala</span> {
  <span class="pl-k">def</span> <span class="pl-en">main</span>(<span class="pl-v">args</span>: <span class="pl-en">Array</span>[<span class="pl-k">String</span>]) {

    <span class="pl-c"><span class="pl-c">//</span> Settings</span>
    <span class="pl-k">val</span> <span class="pl-en">inputUrl</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>file:/tmp.txt<span class="pl-pds">"</span></span>

    <span class="pl-c"><span class="pl-c">//</span> Get a plan builder.</span>
    <span class="pl-k">val</span> <span class="pl-en">rheemContext</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">RheemContext</span>(<span class="pl-k">new</span> <span class="pl-en">Configuration)</span>
      .withPlugin(<span class="pl-en">Java</span>.basicPlugin)
      .withPlugin(<span class="pl-en">Spark</span>.basicPlugin)
    <span class="pl-k">val</span> <span class="pl-en">planBuilder</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">PlanBuilder</span>(rheemContext)
      .withJobName(s<span class="pl-s"><span class="pl-pds">"</span>WordCount ($inputUrl)<span class="pl-pds">"</span></span>)
      .withUdfJarsOf(<span class="pl-c1">this</span>.getClass)

    <span class="pl-k">val</span> <span class="pl-en">wordcounts</span> <span class="pl-k">=</span> planBuilder
      <span class="pl-c"><span class="pl-c">//</span> Read the text file.</span>
      .readTextFile(inputUrl).withName(<span class="pl-s"><span class="pl-pds">"</span>Load file<span class="pl-pds">"</span></span>)

      <span class="pl-c"><span class="pl-c">//</span> Split each line by non-word characters.</span>
      .flatMap(_.split(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\\</span>W+<span class="pl-pds">"</span></span>), selectivity <span class="pl-k">=</span> <span class="pl-c1">10</span>).withName(<span class="pl-s"><span class="pl-pds">"</span>Split words<span class="pl-pds">"</span></span>)

      <span class="pl-c"><span class="pl-c">//</span> Filter empty tokens.</span>
      .filter(_.nonEmpty, selectivity <span class="pl-k">=</span> <span class="pl-c1">0.99</span>).withName(<span class="pl-s"><span class="pl-pds">"</span>Filter empty words<span class="pl-pds">"</span></span>)

      <span class="pl-c"><span class="pl-c">//</span> Attach counter to each word.</span>
      .map(word <span class="pl-k">=&gt;</span> (word.toLowerCase, <span class="pl-c1">1</span>)).withName(<span class="pl-s"><span class="pl-pds">"</span>To lower case, add counter<span class="pl-pds">"</span></span>)

      <span class="pl-c"><span class="pl-c">//</span> Sum up counters for every word.</span>
      .reduceByKey(_._1, (c1, c2) <span class="pl-k">=&gt;</span> (c1._1, c1._2 <span class="pl-k">+</span> c2._2)).withName(<span class="pl-s"><span class="pl-pds">"</span>Add counters<span class="pl-pds">"</span></span>)
      .withCardinalityEstimator((<span class="pl-v">in</span>: <span class="pl-k">Long</span>) <span class="pl-k">=&gt;</span> math.round(in <span class="pl-k">*</span> <span class="pl-c1">0.01</span>))

      <span class="pl-c"><span class="pl-c">//</span> Execute the plan and collect the results.</span>
      .collect()

    println(wordcounts)
  }
}</pre>
  </div> 
  <h3><a href="https://github.com/daqcri/rheem#k-means" aria-hidden="true" class="anchor" id="user-content-k-means" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>k-means</h3> 
  <p>Rheem is also capable of iterative processing, which is, e.g., very important for machine learning algorithms, such as k-means.</p> 
  <h4><a href="https://github.com/daqcri/rheem#scala-api-1" aria-hidden="true" class="anchor" id="user-content-scala-api-1" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala API</h4> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.api.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.core.api.</span>{<span class="pl-v">Configuration</span>, <span class="pl-v">RheemContext</span>}
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.core.function.FunctionDescriptor.</span><span class="pl-v">ExtendedSerializableFunction</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.core.function.</span><span class="pl-v">ExecutionContext</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.java.</span><span class="pl-v">Java</span>
<span class="pl-k">import</span> <span class="pl-v">org.qcri.rheem.spark.</span><span class="pl-v">Spark</span>
<span class="pl-k">import</span> <span class="pl-v">scala.util.</span><span class="pl-v">Random</span>
<span class="pl-k">import</span> <span class="pl-v">scala.collection.JavaConversions.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">kmeans</span> {
  <span class="pl-k">def</span> <span class="pl-en">main</span>(<span class="pl-v">args</span>: <span class="pl-en">Array</span>[<span class="pl-k">String</span>]) {

    <span class="pl-c"><span class="pl-c">//</span> Settings</span>
    <span class="pl-k">val</span> <span class="pl-en">inputUrl</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>file:/tmp_kmeans.txt<span class="pl-pds">"</span></span>
    <span class="pl-k">val</span> <span class="pl-en">k</span> <span class="pl-k">=</span> <span class="pl-c1">5</span>
    <span class="pl-k">val</span> <span class="pl-en">iterations</span> <span class="pl-k">=</span> <span class="pl-c1">100</span>

    <span class="pl-c"><span class="pl-c">//</span> Get a plan builder.</span>
    <span class="pl-k">val</span> <span class="pl-en">rheemContext</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">RheemContext</span>(<span class="pl-k">new</span> <span class="pl-en">Configuration)</span>
      .withPlugin(<span class="pl-en">Java</span>.basicPlugin)
      .withPlugin(<span class="pl-en">Spark</span>.basicPlugin)
    <span class="pl-k">val</span> <span class="pl-en">planBuilder</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">PlanBuilder</span>(rheemContext)
      .withJobName(s<span class="pl-s"><span class="pl-pds">"</span>k-means ($inputUrl, k=$k, $iterations iterations)<span class="pl-pds">"</span></span>)
      .withUdfJarsOf(<span class="pl-c1">this</span>.getClass)

    <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Point</span>(<span class="pl-v">x</span>: <span class="pl-k">Double</span>, <span class="pl-v">y</span>: <span class="pl-k">Double</span>)
    <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">TaggedPoint</span>(<span class="pl-v">x</span>: <span class="pl-k">Double</span>, <span class="pl-v">y</span>: <span class="pl-k">Double</span>, <span class="pl-v">cluster</span>: <span class="pl-k">Int</span>)
    <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">TaggedPointCounter</span>(<span class="pl-v">x</span>: <span class="pl-k">Double</span>, <span class="pl-v">y</span>: <span class="pl-k">Double</span>, <span class="pl-v">cluster</span>: <span class="pl-k">Int</span>, <span class="pl-v">count</span>: <span class="pl-k">Long</span>) {
      <span class="pl-k">def</span> <span class="pl-en">add_points</span>(<span class="pl-v">that</span>: <span class="pl-en">TaggedPointCounter</span>) <span class="pl-k">=</span> <span class="pl-en">TaggedPointCounter</span>(<span class="pl-c1">this</span>.x <span class="pl-k">+</span> that.x, <span class="pl-c1">this</span>.y <span class="pl-k">+</span> that.y, <span class="pl-c1">this</span>.cluster, <span class="pl-c1">this</span>.count <span class="pl-k">+</span> that.count)
      <span class="pl-k">def</span> <span class="pl-en">average</span> <span class="pl-k">=</span> <span class="pl-en">TaggedPointCounter</span>(x <span class="pl-k">/</span> count, y <span class="pl-k">/</span> count, cluster, <span class="pl-c1">0</span>)
    }

    <span class="pl-c"><span class="pl-c">//</span> Read and parse the input file(s).</span>
    <span class="pl-k">val</span> <span class="pl-en">points</span> <span class="pl-k">=</span> planBuilder
      .readTextFile(inputUrl).withName(<span class="pl-s"><span class="pl-pds">"</span>Read file<span class="pl-pds">"</span></span>)
      .map { line <span class="pl-k">=&gt;</span>
        <span class="pl-k">val</span> <span class="pl-en">fields</span> <span class="pl-k">=</span> line.split(<span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span>)
        <span class="pl-en">Point</span>(fields(<span class="pl-c1">0</span>).toDouble, fields(<span class="pl-c1">1</span>).toDouble)
      }.withName(<span class="pl-s"><span class="pl-pds">"</span>Create points<span class="pl-pds">"</span></span>)


    <span class="pl-c"><span class="pl-c">//</span> Create initial centroids.</span>
    <span class="pl-k">val</span> <span class="pl-en">random</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Random</span>
    <span class="pl-k">val</span> <span class="pl-en">initialCentroids</span> <span class="pl-k">=</span> planBuilder
      .loadCollection(<span class="pl-k">for</span> (i <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-c1">1</span> to k) <span class="pl-k">yield</span> <span class="pl-en">TaggedPointCounter</span>(random.nextGaussian(), random.nextGaussian(), i, <span class="pl-c1">0</span>)).withName(<span class="pl-s"><span class="pl-pds">"</span>Load random centroids<span class="pl-pds">"</span></span>)

    <span class="pl-c"><span class="pl-c">//</span> Declare UDF to select centroid for each data point.</span>
    <span class="pl-k">class</span> <span class="pl-en">SelectNearestCentroid</span> <span class="pl-k">extends</span> <span class="pl-e">ExtendedSerializableFunction</span>[<span class="pl-en">Point</span>, <span class="pl-en">TaggedPointCounter</span>] {

<span class="pl-c">      <span class="pl-c">/**</span> Keeps the broadcasted centroids. <span class="pl-c">*/</span></span>
      <span class="pl-k">var</span> <span class="pl-en">centroids</span><span class="pl-k">:</span> <span class="pl-en">Iterable</span>[<span class="pl-en">TaggedPointCounter</span>] <span class="pl-k">=</span> _

      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">open</span>(<span class="pl-v">executionCtx</span>: <span class="pl-en">ExecutionContext</span>) <span class="pl-k">=</span> {
        centroids <span class="pl-k">=</span> executionCtx.getBroadcast[<span class="pl-en">TaggedPointCounter</span>](<span class="pl-s"><span class="pl-pds">"</span>centroids<span class="pl-pds">"</span></span>)
      }

      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">point</span>: <span class="pl-en">Point</span>)<span class="pl-k">:</span> <span class="pl-en">TaggedPointCounter</span> <span class="pl-k">=</span> {
        <span class="pl-k">var</span> <span class="pl-en">minDistance</span> <span class="pl-k">=</span> <span class="pl-k">Double</span>.<span class="pl-en">PositiveInfinity</span>
        <span class="pl-k">var</span> <span class="pl-en">nearestCentroidId</span> <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>
        <span class="pl-k">for</span> (centroid <span class="pl-k">&lt;</span><span class="pl-k">-</span> centroids) {
          <span class="pl-k">val</span> <span class="pl-en">distance</span> <span class="pl-k">=</span> <span class="pl-en">Math</span>.pow(<span class="pl-en">Math</span>.pow(point.x <span class="pl-k">-</span> centroid.x, <span class="pl-c1">2</span>) <span class="pl-k">+</span> <span class="pl-en">Math</span>.pow(point.y <span class="pl-k">-</span> centroid.y, <span class="pl-c1">2</span>), <span class="pl-c1">0.5</span>)
          <span class="pl-k">if</span> (distance <span class="pl-k">&lt;</span> minDistance) {
            minDistance <span class="pl-k">=</span> distance
            nearestCentroidId <span class="pl-k">=</span> centroid.cluster
          }
        }
        <span class="pl-k">new</span> <span class="pl-en">TaggedPointCounter</span>(point.x, point.y, nearestCentroidId, <span class="pl-c1">1</span>)
      }
    }

    <span class="pl-c"><span class="pl-c">//</span> Do the k-means loop.</span>
    <span class="pl-k">val</span> <span class="pl-en">finalCentroids</span> <span class="pl-k">=</span> initialCentroids.repeat(iterations, { currentCentroids <span class="pl-k">=&gt;</span>
      points
        .mapJava(<span class="pl-k">new</span> <span class="pl-en">SelectNearestCentroid)</span>
        .withBroadcast(currentCentroids, <span class="pl-s"><span class="pl-pds">"</span>centroids<span class="pl-pds">"</span></span>).withName(<span class="pl-s"><span class="pl-pds">"</span>Find nearest centroid<span class="pl-pds">"</span></span>)
        .reduceByKey(_.cluster, _.add_points(_)).withName(<span class="pl-s"><span class="pl-pds">"</span>Add up points<span class="pl-pds">"</span></span>)
        .withCardinalityEstimator(k)
        .map(_.average).withName(<span class="pl-s"><span class="pl-pds">"</span>Average points<span class="pl-pds">"</span></span>)
    }).withName(<span class="pl-s"><span class="pl-pds">"</span>Loop<span class="pl-pds">"</span></span>)

      <span class="pl-c"><span class="pl-c">//</span> Collect the results.</span>
      .collect()

    println(finalCentroids)
  }
}</pre>
  </div> 
  <h2><a href="https://github.com/daqcri/rheem#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>Unless explicitly stated otherwise all files in this repository are licensed under the Apache Software License 2.0</p> 
  <p>Copyright 2016 Qatar Computing Research Institute</p> 
  <p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> 
  <pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre> 
  <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p> 
 </article>
</div>