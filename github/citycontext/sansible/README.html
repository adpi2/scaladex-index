<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-sansible" class="anchor" href="https://github.com/citycontext/sansible#sansible" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sansible</h1> 
  <p><a href="https://maven-badges.herokuapp.com/maven-central/com.citycontext/sansible_2.11" target="_blank"><img src="https://camo.githubusercontent.com/3ff7de89b9c0bce047d7706675bdd74665b9cfbd/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f636f6d2e63697479636f6e746578742f73616e7369626c655f322e31312f62616467652e706e673f7374796c653d706c6173746963" alt="Maven central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/com.citycontext/sansible_2.11/badge.png?style=plastic" style="max-width:100%;"></a> <a href="https://travis-ci.org/citycontext/sansible" target="_blank"><img src="https://camo.githubusercontent.com/08c9088d1209ffc1a8df2c55ee12cfc947442402/68747470733a2f2f7472617669732d63692e6f72672f63697479636f6e746578742f73616e7369626c652e706e67" alt="Build Status" data-canonical-src="https://travis-ci.org/citycontext/sansible.png" style="max-width:100%;"></a></p> 
  <p>A type-safe DSL to generate and run Ansible playbooks directly from within Scala.</p> 
  <h2><a id="user-content-motivation" class="anchor" href="https://github.com/citycontext/sansible#motivation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Motivation</h2> 
  <p>With its agentless architecture and its rich collection of built-in modules, Ansible provides a simple and effective solution for deploying software and provisioning infrastructure. However, as our Ansible code-base grew, we found that managing a large collection of playbooks in plain YAML was far from ideal. Instead, using Ansible as a DSL embedded in Scala has the following benefits:</p> 
  <ul> 
   <li>Increased safety and quicker developer feedback, especially with respect to variable scoping and allowed module parameters.</li> 
   <li>Full IDE Support, with auto-completion for module names and parameters.</li> 
   <li>Superior means of abstraction: no need to learn Ansible own control flow syntax, variable scoping rules, jinja2 templates, includes, etc.. Just use Scala!</li> 
  </ul> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/citycontext/sansible#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Add Sansible to your <code>build.sbt</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.citycontext<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>sansible<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version</pre>
  </div> 
  <p>Break your provisioning code into packages and modules, exactly as you do for your scala projects.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">example.tasks</span>

<span class="pl-k">import</span> <span class="pl-v">ansible.Modules.</span>{<span class="pl-v">Apt</span>, <span class="pl-v">User</span>}
<span class="pl-k">import</span> <span class="pl-v">ansible.</span><span class="pl-v">Task</span>
<span class="pl-k">import</span> <span class="pl-v">example.Conf.</span><span class="pl-v">appUsername</span>

<span class="pl-k">object</span> <span class="pl-en">Dependencies</span> {
   <span class="pl-k">val</span> <span class="pl-en">appUser</span> <span class="pl-k">=</span> <span class="pl-en">Task</span>(s<span class="pl-s"><span class="pl-pds">"</span>create user $appUsername<span class="pl-pds">"</span></span>,
    <span class="pl-en">User</span>(appUsername).withState(<span class="pl-en">User</span>.<span class="pl-en">State</span>.present)
  )

  <span class="pl-k">val</span> <span class="pl-en">installGit</span> <span class="pl-k">=</span> <span class="pl-en">Task</span>(<span class="pl-s"><span class="pl-pds">"</span>install git<span class="pl-pds">"</span></span>,
    <span class="pl-en">Apt</span>(name <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>git<span class="pl-pds">"</span></span>)).withState(<span class="pl-en">Apt</span>.<span class="pl-en">State</span>.latest)
  )

  <span class="pl-k">val</span> <span class="pl-en">all</span> <span class="pl-k">=</span> <span class="pl-en">List</span>(appUser, installGit)
}</pre>
  </div> 
  <p>Assuming we have defined an inventory and some tasks, we can now put them together in a playbook and run it with ansible (we are currently developing against v2.0.1.0).</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">ansible.Inventory.</span><span class="pl-v">HostPattern</span>
<span class="pl-k">import</span> <span class="pl-v">ansible.</span>{<span class="pl-v">Playbook</span>, <span class="pl-v">Runner</span>}
<span class="pl-k">import</span> <span class="pl-v">example.tasks.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">Example</span> <span class="pl-k">extends</span> <span class="pl-e">App</span> {
  <span class="pl-k">val</span> <span class="pl-en">playbook</span> <span class="pl-k">=</span> <span class="pl-en">Playbook</span>(
    hosts <span class="pl-k">=</span> <span class="pl-en">List</span>(<span class="pl-en">HostPattern</span>(<span class="pl-en">Inventory</span>.<span class="pl-en">Groups</span>.web.name)),
    tasks <span class="pl-k">=</span> <span class="pl-en">Dependencies</span>.all
  )
  <span class="pl-en">Runner</span>.runPlaybook(<span class="pl-en">Inventory</span>.default)(playbook)
}</pre>
  </div> 
  <p>For some fully working playbook examples, please refer to the <a href="http://github.com/citycontext/sansible-examples" target="_blank">sansible-examples</a> repo on Github.</p> 
  <h3><a id="user-content-generated-module-code" class="anchor" href="https://github.com/citycontext/sansible#generated-module-code" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Generated module code</h3> 
  <p>The library provides auto-generated case classes for each Ansible module defined in the <a href="https://github.com/ansible/ansible-modules-core" target="_blank">ansible-modules-core</a> repository. Additionally, we generate a sealed sum type for each enumerable module option. For instance, for the <a href="http://docs.ansible.com/ansible/service_module.html" target="_blank">service</a> module's <strong>state</strong> option, we generate the following Scala code</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Service</span> {
  <span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">State</span>

  <span class="pl-k">object</span> <span class="pl-en">State</span> {
    <span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">Started</span> <span class="pl-k">extends</span> <span class="pl-e">State</span>
    <span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">Stopped</span> <span class="pl-k">extends</span> <span class="pl-e">State</span>
    <span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">Restarted</span> <span class="pl-k">extends</span> <span class="pl-e">State</span>
    <span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">Reloaded</span> <span class="pl-k">extends</span> <span class="pl-e">State</span>

    <span class="pl-k">val</span> <span class="pl-en">started</span><span class="pl-k">:</span> <span class="pl-en">State</span> <span class="pl-k">=</span> <span class="pl-en">Started</span>
    <span class="pl-k">val</span> <span class="pl-en">stopped</span><span class="pl-k">:</span> <span class="pl-en">State</span> <span class="pl-k">=</span> <span class="pl-en">Stopped</span>
    <span class="pl-k">val</span> <span class="pl-en">restarted</span><span class="pl-k">:</span> <span class="pl-en">State</span> <span class="pl-k">=</span> <span class="pl-en">Stopped</span>
    <span class="pl-k">val</span> <span class="pl-en">reloaded</span><span class="pl-k">:</span> <span class="pl-en">State</span> <span class="pl-k">=</span> <span class="pl-en">Reloaded</span>
  }
}</pre>
  </div> 
  <p>A service task, can now be defined by calling Service's <code>apply</code> method with the desired arguments:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">esRestart</span> <span class="pl-k">=</span> <span class="pl-en">Task</span>(<span class="pl-s"><span class="pl-pds">"</span>restart elasticsearch<span class="pl-pds">"</span></span>, <span class="pl-en">Service</span>(<span class="pl-s"><span class="pl-pds">"</span>elasticsearch<span class="pl-pds">"</span></span>,
  state <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-en">Service</span>.<span class="pl-en">State</span>.restarted),
)</pre>
  </div> 
  <p>Notice that, unless a module argument is explicitly marked as required in the Ansible documentation, we have to represent it in Sansible as a Scala <code>Option</code>. In order to mitigate the additional boilerplate that this introduces, we provide an auto-generated setter method for each non-mandatory enumerable field. This allows to re-write the service module call above as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Service</span>(<span class="pl-s"><span class="pl-pds">"</span>elasticsearch<span class="pl-pds">"</span></span>).withState(<span class="pl-en">Service</span>.<span class="pl-en">State</span>.restarted)</pre>
  </div> 
  <h3><a id="user-content-common-options-dsl" class="anchor" href="https://github.com/citycontext/sansible#common-options-dsl" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Common options DSL</h3> 
  <p>A number of Ansible options are equally applicable to both tasks and playbooks. These includes, among others, things like tags, environment variables, serial execution, and privilege escalation. In order to use the DSL, you will need to import implicits from both <code>ansible.std._</code> and <code>ansible.dsl._</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">ansible.</span>{<span class="pl-v">Task</span>, <span class="pl-v">Playbook</span>}
<span class="pl-k">import</span> <span class="pl-v">ansible.Modules.</span><span class="pl-v">GetUrl</span>
<span class="pl-k">import</span> <span class="pl-v">ansible.std.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">ansible.dsl.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">downloadApp</span> <span class="pl-k">=</span> <span class="pl-en">Task</span>(<span class="pl-s"><span class="pl-pds">"</span>Download app jar<span class="pl-pds">"</span></span>, <span class="pl-en">GetUrl</span>(
  url <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>http://example.com/jars/app.jar<span class="pl-pds">"</span></span>,
  dest <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/home/appUser/app<span class="pl-pds">"</span></span>
)).becoming(<span class="pl-s"><span class="pl-pds">"</span>appUser<span class="pl-pds">"</span></span>).withTags(<span class="pl-s"><span class="pl-pds">"</span>tag1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>tag2<span class="pl-pds">"</span></span>)
</pre>
  </div> 
  <p>For an overview of the methods currently implemented, refer to the implicit class <code>ansible.dsl.CommonOptions.Syntax</code>, which will be in scope for both playbook and task objects.</p> 
  <h2><a id="user-content-development" class="anchor" href="https://github.com/citycontext/sansible#development" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Development</h2> 
  <p>Sansible relies on a Ruby script and a Scala macro to generate a collection of case classes and their respective serialisation logic from the Ansible core modules' sources. The process involves a fair amount of data massaging, such as cloning git repositories, parsing YAML module annotations, applying some overrides, etc. Ansible module annotations are in fact intended for documentation purposes and are not expressed in a proper schema definition language.</p> 
  <h2><a id="user-content-project-status" class="anchor" href="https://github.com/citycontext/sansible#project-status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Project status</h2> 
  <p>The library is currently in its early development stage. We do not encourage you using it in production just yet.</p> 
 </article>
</div>