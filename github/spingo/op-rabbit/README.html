<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-op-rabbit" class="anchor" href="https://github.com/spingo/op-rabbit#op-rabbit" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Op-Rabbit</h1> 
  <h5><a id="user-content-an-opinionated-rabbitmq-library-for-scala-and-akka" class="anchor" href="https://github.com/spingo/op-rabbit#an-opinionated-rabbitmq-library-for-scala-and-akka" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>An opinionated RabbitMQ library for Scala and Akka.</h5> 
  <h1><a id="user-content-documentation" class="anchor" href="https://github.com/spingo/op-rabbit#documentation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Documentation</h1> 
  <p>Browse the latest <a href="https://op-rabbit.github.io/docs/index.html" target="_blank">API Docs</a> online.</p> 
  <p>Issues go here; questions can be posed there as well. Please see the <a href="https://github.com/SpinGo/op-rabbit/wiki/Cookbook" target="_blank">Cookbook</a>, first.</p> 
  <ul> 
   <li><a href="https://github.com/SpinGo/op-rabbit/issues" target="_blank">https://github.com/SpinGo/op-rabbit/issues</a></li> 
  </ul> 
  <h1><a id="user-content-intro" class="anchor" href="https://github.com/spingo/op-rabbit#intro" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Intro</h1> 
  <p>Op-Rabbit is a high-level, type-safe, opinionated, composable, fault-tolerant library for interacting with RabbitMQ; the following is a high-level feature list:</p> 
  <ul> 
   <li>Recovery: 
    <ul> 
     <li>Consumers automatically reconnect and subscribe if the connection is lost</li> 
     <li>Messages published will wait for a connection to be available</li> 
    </ul> </li> 
   <li>Integration 
    <ul> 
     <li>Connection settings pulled from Typesafe config library</li> 
     <li>Asynchronous, concurrent consumption using Scala native Futures or the new Akka Streams project.</li> 
     <li>Common pattern for serialization allows easy integration with serialization libraries such play-json or json4s</li> 
     <li>Common pattern for exception handling to publish errors to Airbrake, Syslog, or all of the above</li> 
    </ul> </li> 
   <li>Modular 
    <ul> 
     <li>Composition favored over inheritance enabling flexible and high code reuse.</li> 
    </ul> </li> 
   <li>Modeled 
    <ul> 
     <li>Queue binding, exchange binding modeled with case classes</li> 
     <li>Queue, and Exchange arguments, such as <code>x-ttl</code>, are modeled</li> 
     <li>HeaderValues are modeled; if you try and provide RabbitMQ an invalid type for a header value, the compiler will let you know.</li> 
     <li>Publishing mechanisms also modeled</li> 
    </ul> </li> 
   <li>Reliability 
    <ul> 
     <li>Builds on the excellent <a href="https://github.com/thenewmotion/akka-rabbitmq" target="_blank">Akka RabbitMQ client</a> library for easy recovery.</li> 
     <li>Built-in consumer error recovery strategy in which messages are re-delivered to the message queue and retried (not implemented for akka-streams integration as retry mechanism affects message order)</li> 
     <li>With a single message, pause all consumers if service health check fails (IE: database unavailable); easily resume the same.</li> 
    </ul> </li> 
   <li>Graceful shutdown 
    <ul> 
     <li>Consumers and streams can immediately unsubscribe, but stay alive long enough to wait for any messages to finish being processed.</li> 
    </ul> </li> 
   <li>Program at multiple levels of abstraction 
    <ul> 
     <li>If op-rabbit doesn't do what you need it to, you can either extend op-rabbit or interact directly with <code>akka-rabbitmq</code> <a href="https://github.com/thenewmotion/akka-rabbitmq" target="_blank">Akka RabbitMQ client</a>.</li> 
    </ul> </li> 
   <li>Tested 
    <ul> 
     <li>Extensive integration tests</li> 
    </ul> </li> 
  </ul> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/spingo/op-rabbit#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>Add the SpinGo OSS repository and include the dependencies of your choosing:</p> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-s"><span class="pl-pds">"</span>SpinGo OSS<span class="pl-pds">"</span></span> at <span class="pl-s"><span class="pl-pds">"</span>http://spingo-oss.s3.amazonaws.com/repositories/releases<span class="pl-pds">"</span></span>
)

<span class="pl-k">val</span> <span class="pl-en">opRabbitVersion</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>1.6.0<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-s"><span class="pl-pds">"</span>com.spingo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>op-rabbit-core<span class="pl-pds">"</span></span>        <span class="pl-k">%</span> opRabbitVersion,
  <span class="pl-s"><span class="pl-pds">"</span>com.spingo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>op-rabbit-play-json<span class="pl-pds">"</span></span>   <span class="pl-k">%</span> opRabbitVersion,
  <span class="pl-s"><span class="pl-pds">"</span>com.spingo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>op-rabbit-json4s<span class="pl-pds">"</span></span>      <span class="pl-k">%</span> opRabbitVersion,
  <span class="pl-s"><span class="pl-pds">"</span>com.spingo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>op-rabbit-airbrake<span class="pl-pds">"</span></span>    <span class="pl-k">%</span> opRabbitVersion,
  <span class="pl-s"><span class="pl-pds">"</span>com.spingo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>op-rabbit-akka-stream<span class="pl-pds">"</span></span> <span class="pl-k">%</span> opRabbitVersion
)</pre>
  </div> 
  <h3><a id="user-content-scala-version-compatibility-matrix" class="anchor" href="https://github.com/spingo/op-rabbit#scala-version-compatibility-matrix" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala Version Compatibility Matrix:</h3> 
  <p>Only Scala 2.11.x is supported. If you require Scala 2.10.x, use <a href="https://github.com/SpinGo/op-rabbit/tree/v1.2.x" target="_blank">op-rabbit 1.2.x</a>.</p> 
  <table> 
   <thead> 
    <tr> 
     <th>module</th> 
     <th>dependsOn</th> 
     <th>version</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td>op-rabbit-core</td> 
     <td>akka</td> 
     <td>2.4.x</td> 
    </tr> 
    <tr> 
     <td></td> 
     <td>akka-rabbitmq</td> 
     <td>2.3</td> 
    </tr> 
    <tr> 
     <td></td> 
     <td>shapeless</td> 
     <td>2.3.x</td> 
    </tr> 
    <tr> 
     <td></td> 
     <td>type-safe config</td> 
     <td>&gt;= 1.3.0</td> 
    </tr> 
    <tr> 
     <td>op-rabbit-play-json</td> 
     <td>play-json</td> 
     <td>2.5.x</td> 
    </tr> 
    <tr> 
     <td>op-rabbit-json4s</td> 
     <td>json4s</td> 
     <td>3.4.x</td> 
    </tr> 
    <tr> 
     <td>op-rabbit-circe</td> 
     <td>circe</td> 
     <td>0.5.x</td> 
    </tr> 
    <tr> 
     <td>op-rabbit-airbrake</td> 
     <td>airbrake</td> 
     <td>2.2.x</td> 
    </tr> 
    <tr> 
     <td>op-rabbit-akka-stream</td> 
     <td>acked-stream</td> 
     <td>2.1.x</td> 
    </tr> 
    <tr> 
     <td></td> 
     <td>akka-stream</td> 
     <td>&gt;= 2.4.2</td> 
    </tr>
   </tbody>
  </table> 
  <h2><a id="user-content-a-high-level-overview-of-the-available-components" class="anchor" href="https://github.com/spingo/op-rabbit#a-high-level-overview-of-the-available-components" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>A high-level overview of the available components:</h2> 
  <ul> 
   <li><code>op-rabbit-core</code> <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html" target="_blank">API</a> 
    <ul> 
     <li>Implements basic patterns for serialization and message processing.</li> 
    </ul> </li> 
   <li><code>op-rabbit-play-json</code> <a href="https://op-rabbit.github.io/docs/index.html#com.spingo.op_rabbit.PlayJsonSupport$" target="_blank">API</a> 
    <ul> 
     <li>Easily use <a href="https://www.playframework.com/documentation/2.4.x/ScalaJson" target="_blank">Play Json</a> formats to publish or consume messages; automatically sets RabbitMQ message headers to indicate content type.</li> 
    </ul> </li> 
   <li><code>op-rabbit-json4s</code> <a href="https://op-rabbit.github.io/docs/index.html#com.spingo.op_rabbit.Json4sSupport$" target="_blank">API</a> 
    <ul> 
     <li>Easily use <a href="http://json4s.org" target="_blank">Json4s</a> to serialization messages; automatically sets RabbitMQ message headers to indicate content type.</li> 
    </ul> </li> 
   <li><code>op-rabbit-airbrake</code> <a href="https://op-rabbit.github.io/docs/index.html#com.spingo.op_rabbit.AirbrakeLogger" target="_blank">API</a> 
    <ul> 
     <li>Report consumer exceptions to airbrake, using the <a href="https://github.com/airbrake/airbrake-java" target="_blank">Airbrake</a> Java library.</li> 
    </ul> </li> 
   <li><code>op-rabbit-akka-stream</code> <a href="https://op-rabbit.github.io/docs/index.html#com.spingo.op_rabbit.stream.package" target="_blank">API</a> 
    <ul> 
     <li>Process or publish messages using akka-stream.</li> 
    </ul> </li> 
  </ul> 
  <h2><a id="user-content-upgrade-guide" class="anchor" href="https://github.com/spingo/op-rabbit#upgrade-guide" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Upgrade Guide</h2> 
  <p>Refer to <a href="https://github.com/SpinGo/op-rabbit/wiki/Upgrading" target="_blank">Upgrade Guide wiki page</a> for help upgrading.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/spingo/op-rabbit#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Set up RabbitMQ connection information in <code>application.conf</code>:</p> 
  <pre><code class="language-conf">op-rabbit {
  topic-exchange-name = "amq.topic"
  channel-dispatcher = "op-rabbit.default-channel-dispatcher"
  default-channel-dispatcher {
    # Dispatcher is the name of the event-based dispatcher
    type = Dispatcher

    # What kind of ExecutionService to use
    executor = "fork-join-executor"

    # Configuration for the fork join pool
    fork-join-executor {
      # Min number of threads to cap factor-based parallelism number to
      parallelism-min = 2

      # Parallelism (threads) ... ceil(available processors * factor)
      parallelism-factor = 2.0

      # Max number of threads to cap factor-based parallelism number to
      parallelism-max = 4
    }
    # Throughput defines the maximum number of messages to be
    # processed per actor before the thread jumps to the next actor.
    # Set to 1 for as fair as possible.
    throughput = 100
  }
  connection {
    virtual-host = "/"
    hosts = ["127.0.0.1"]
    username = "guest"
    password = "guest"
    port = 5672
    ssl = false
    connection-timeout = 3s
  }
}
</code></pre> 
  <p>Note that hosts is an array; Connection attempts will be made to hosts in that order, with a default timeout of <code>3s</code>. This way you can specify addresses of your rabbitMQ cluster, and if one of the instances goes down, your application will automatically reconnect to another member of the cluster.</p> 
  <p><code>topic-exchange-name</code> is the default topic exchange to use; this can be overriden by passing <code>exchange = "my-topic"</code> to <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.TopicBinding" target="_blank">TopicBinding</a> or <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.Message$" target="_blank">Message.topic</a>.</p> 
  <p>Boot up the RabbitMQ control actor:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.</span><span class="pl-v">RabbitControl</span>
<span class="pl-k">import</span> <span class="pl-v">akka.actor.</span>{<span class="pl-v">ActorSystem</span>, <span class="pl-v">Props</span>}

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>such-system<span class="pl-pds">"</span></span>)
<span class="pl-k">val</span> <span class="pl-en">rabbitControl</span> <span class="pl-k">=</span> actorSystem.actorOf(<span class="pl-en">Props</span>[<span class="pl-en">RabbitControl</span>])</pre>
  </div> 
  <h3><a id="user-content-set-up-a-consumer-topic-subscription" class="anchor" href="https://github.com/spingo/op-rabbit#set-up-a-consumer-topic-subscription" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Set up a consumer: (Topic subscription)</h3> 
  <p>(this example uses <code>op-rabbit-play-json</code>)</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.PlayJsonSupport.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">age</span>: <span class="pl-k">Int</span>)
<span class="pl-c"><span class="pl-c">//</span> setup play-json serializer</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">personFormat</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.format[<span class="pl-en">Person</span>]
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">recoveryStrategy</span> <span class="pl-k">=</span> <span class="pl-en">RecoveryStrategy</span>.none

<span class="pl-k">val</span> <span class="pl-en">subscriptionRef</span> <span class="pl-k">=</span> <span class="pl-en">Subscription</span>.run(rabbitControl) {
  <span class="pl-k">import</span> <span class="pl-v">Directives.</span><span class="pl-v">_</span>
  <span class="pl-c"><span class="pl-c">//</span> A qos of 3 will cause up to 3 concurrent messages to be processed at any given time.</span>
  channel(qos <span class="pl-k">=</span> <span class="pl-c1">3</span>) {
    consume(topic(queue(<span class="pl-s"><span class="pl-pds">"</span>such-message-queue<span class="pl-pds">"</span></span>), <span class="pl-en">List</span>(<span class="pl-s"><span class="pl-pds">"</span>some-topic.#<span class="pl-pds">"</span></span>))) {
      (body(as[<span class="pl-en">Person</span>]) &amp; routingKey) { (person, key) <span class="pl-k">=&gt;</span>
        <span class="pl-c"><span class="pl-c">/*</span> do work; this body is executed in a separate thread, as</span>
<span class="pl-c">           provided by the implicit execution context <span class="pl-c">*/</span></span>
        println(s<span class="pl-s"><span class="pl-pds">"""</span>A person named '${person.name}' with age</span>
<span class="pl-s">          ${person.age} was received over '${key}'.<span class="pl-pds">"""</span></span>)
        ack
      }
    }
  }
}</pre>
  </div> 
  <p>Now, test the consumer by sending a message:</p> 
  <pre><code>subscriptionRef.initialized.foreach { _ =&gt;
  rabbitControl ! Message.topic(
    Person("Your name here", 33), "some-topic.cool")
}
</code></pre> 
  <p>Stop the consumer:</p> 
  <pre><code>subscriptionRef.close()
</code></pre> 
  <p>Note, if your call generates an additional future, you can pass it to ack, and message will be acked based off the Future success, and nacked with Failure (such that the configured <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.RecoveryStrategy" target="_blank">RecoveryStrategy</a> if the Future fails:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-c"><span class="pl-c">//</span> ...</span>
      (body(as[<span class="pl-en">Person</span>]) &amp; routingKey) { (person, key) <span class="pl-k">=&gt;</span>
        <span class="pl-c"><span class="pl-c">/*</span> do work; this body is executed in a separate thread, as</span>
<span class="pl-c">           provided by the implicit execution context <span class="pl-c">*/</span></span>
        <span class="pl-k">val</span> <span class="pl-en">result</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> myApi.methodCall(person)
        ack(result)
      }
  <span class="pl-c"><span class="pl-c">//</span> ...</span>
</pre>
  </div> 
  <h4><a id="user-content-consuming-from-existing-queues" class="anchor" href="https://github.com/spingo/op-rabbit#consuming-from-existing-queues" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Consuming from existing queues</h4> 
  <p>If the queue already exists and doesn't match the expected configuration, topic subscription will fail. To bind to an externally configured queue use <code>Queue.passive</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  channel(qos <span class="pl-k">=</span> <span class="pl-c1">3</span>) {
    consume(<span class="pl-en">Queue</span>.passive(<span class="pl-s"><span class="pl-pds">"</span>very-exist-queue<span class="pl-pds">"</span></span>)) { ...</pre>
  </div> 
  <p>It is also possible to optionally create the queue if it doesn't exist, by providing a <code>QueueDefinition</code> instead of a <code>String</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  channel(qos <span class="pl-k">=</span> <span class="pl-c1">3</span>) {
    consume(<span class="pl-en">Queue</span>.passive(topic(queue(<span class="pl-s"><span class="pl-pds">"</span>wow-maybe-queue<span class="pl-pds">"</span></span>), <span class="pl-en">List</span>(<span class="pl-s"><span class="pl-pds">"</span>some-topic.#<span class="pl-pds">"</span></span>)))) { ...</pre>
  </div> 
  <h4><a id="user-content-accessing-additional-headers" class="anchor" href="https://github.com/spingo/op-rabbit#accessing-additional-headers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Accessing additional headers</h4> 
  <p>As seen in the example above, you can extract headers in addition to the message body, using op-rabbit's <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.Directives" target="_blank">Directives</a>. You can use multiple declaratives via multiple nested functions, as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.properties.</span><span class="pl-v">_</span>

<span class="pl-c"><span class="pl-c">//</span> Nested directives</span>
<span class="pl-c"><span class="pl-c">//</span> ...</span>
      body(as[<span class="pl-en">Person</span>]) { person <span class="pl-k">=&gt;</span>
        optionalProperty(<span class="pl-en">ReplyTo</span>) { replyTo <span class="pl-k">=&gt;</span>
          <span class="pl-c"><span class="pl-c">//</span> do work</span>
          ack
        }
      }
<span class="pl-c"><span class="pl-c">//</span> ...</span></pre>
  </div> 
  <p>Or, you can combine directives using <code>&amp;</code> to form a compound directive, as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> Compound directive</span>
<span class="pl-c"><span class="pl-c">//</span> ...</span>
      (body(as[<span class="pl-en">Person</span>]) &amp; optionalProperty(<span class="pl-en">ReplyTo</span>)) { (person, replyTo) <span class="pl-k">=&gt;</span>
        <span class="pl-c"><span class="pl-c">//</span> do work</span>
        ack
      }
<span class="pl-c"><span class="pl-c">//</span> ...</span></pre>
  </div> 
  <p>See the documentation on <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.Directives" target="_blank">Directives</a> for more details.</p> 
  <h4><a id="user-content-shutting-down-a-consumer" class="anchor" href="https://github.com/spingo/op-rabbit#shutting-down-a-consumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Shutting down a consumer</h4> 
  <p>The following methods are available on a <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.SubscriptionRef" target="_blank">SubscriptionRef</a> which will allow control over the subscription.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">/*</span> stop receiving new messages from RabbitMQ immediately; shut down</span>
<span class="pl-c">   consumer and channel as soon as pending messages are completed. A</span>
<span class="pl-c">   grace period of 30 seconds is given, after which the subscription</span>
<span class="pl-c">   forcefully shuts down. (Default of 5 minutes used if duration not</span>
<span class="pl-c">   provided) <span class="pl-c">*/</span></span>
subscription.close(<span class="pl-c1">30</span> seconds)

<span class="pl-c"><span class="pl-c">/*</span> Shut down the subscription immediately; don't wait for messages to</span>
<span class="pl-c">   finish processing. <span class="pl-c">*/</span></span>
subscription.abort()

<span class="pl-c"><span class="pl-c">/*</span> Future[Unit] which completes once the provided binding has been</span>
<span class="pl-c">   applied (IE: queue has been created and topic bindings</span>
<span class="pl-c">   configured). Useful if you need to assert you don't send a message</span>
<span class="pl-c">   before a message queue is created in which to place it. <span class="pl-c">*/</span></span>
subscription.initialized

<span class="pl-c"><span class="pl-c">//</span> Future[Unit] which completes when the subscription is closed.</span>
subscription.closed</pre>
  </div> 
  <h4><a id="user-content-recovery-strategy" class="anchor" href="https://github.com/spingo/op-rabbit#recovery-strategy" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Recovery strategy:</h4> 
  <p>A recovery strategy defines how a subscription should handle exceptions and <strong>must be provided</strong>. Should it redeliver them a limited number of times? Or, should it drop them? Several pre-defined recovery strategies with their corresponding documentation are defined in the <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/current/index.html#com.spingo.op_rabbit.RecoveryStrategy$" target="_blank">RecoveryStrategy</a> companion object.</p> 
  <pre><code>implicit val recoveryStrategy = RecoveryStrategy.nack()
</code></pre> 
  <h3><a id="user-content-publish-a-message" class="anchor" href="https://github.com/spingo/op-rabbit#publish-a-message" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publish a message:</h3> 
  <div class="highlight highlight-source-scala">
   <pre>rabbitControl <span class="pl-k">!</span> <span class="pl-en">Message</span>.topic(
  <span class="pl-en">Person</span>(name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Mike How<span class="pl-pds">"</span></span>, age <span class="pl-k">=</span> <span class="pl-c1">33</span>),
  routingKey <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>some-topic.very-interest<span class="pl-pds">"</span></span>)

rabbitControl <span class="pl-k">!</span> <span class="pl-en">Message</span>.queue(
  <span class="pl-en">Person</span>(name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Ivanah Tinkle<span class="pl-pds">"</span></span>, age <span class="pl-k">=</span> <span class="pl-c1">25</span>),
  queue <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>such-message-queue<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>By default:</p> 
  <ul> 
   <li> <p>Messages will be queued up until a connection is available</p> </li> 
   <li> <p>Messages are monitored via publisherConfirms; if a connection is lost before RabbitMQ confirms receipt of the message, then the message is published again. This means that the message may be delivered twice, the default opinion being that <code>at-least-once</code> is better than <code>at-most-once</code>. You can use <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/core/current/index.html#com.spingo.op_rabbit.UnconfirmedMessage" target="_blank">UnconfirmedMessage</a> if you'd like <code>at-most-once</code> delivery, instead.</p> </li> 
   <li> <p>If you would like to be notified of confirmation, use the <a href="http://doc.akka.io/docs/akka/2.3.12/scala/actors.html#Send_messages" target="_blank">ask</a> pattern:</p> 
    <div class="highlight highlight-source-scala">
     <pre><span class="pl-k">import</span> <span class="pl-v">akka.pattern.</span><span class="pl-v">ask</span>
<span class="pl-k">import</span> <span class="pl-v">akka.util.</span><span class="pl-v">Timeout</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">timeout</span> <span class="pl-k">=</span> <span class="pl-en">Timeout</span>(<span class="pl-c1">5</span> seconds)
<span class="pl-k">val</span> <span class="pl-en">received</span> <span class="pl-k">=</span> (
  rabbitControl <span class="pl-k">?</span> <span class="pl-en">Message</span>.queue(
    <span class="pl-en">Person</span>(name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Ivanah Tinkle<span class="pl-pds">"</span></span>, age <span class="pl-k">=</span> <span class="pl-c1">25</span>),
    queue <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>such-message-queue<span class="pl-pds">"</span></span>)
).mapTo[<span class="pl-en">ConfirmResponse</span>]</pre>
    </div> </li> 
  </ul> 
  <h3><a id="user-content-consuming-using-akka-streams" class="anchor" href="https://github.com/spingo/op-rabbit#consuming-using-akka-streams" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Consuming using Akka streams</h3> 
  <p>(this example uses <code>op-rabbit-play-json</code> and <code>op-rabbit-akka-streams</code>)</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">Directives.</span><span class="pl-v">_</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">recoveryStrategy</span> <span class="pl-k">=</span> <span class="pl-en">RecoveryStrategy</span>.drop()
<span class="pl-en">RabbitSource</span>(
  rabbitControl,
  channel(qos <span class="pl-k">=</span> <span class="pl-c1">3</span>),
  consume(queue(
    <span class="pl-s"><span class="pl-pds">"</span>such-queue<span class="pl-pds">"</span></span>,
    durable <span class="pl-k">=</span> <span class="pl-c1">true</span>,
    exclusive <span class="pl-k">=</span> <span class="pl-c1">false</span>,
    autoDelete <span class="pl-k">=</span> <span class="pl-c1">false</span>)),
  body(as[<span class="pl-en">Person</span>])). <span class="pl-c"><span class="pl-c">//</span> marshalling is automatically hooked up using implicits</span>
  runForeach { person <span class="pl-k">=&gt;</span>
    greet(person)
  } <span class="pl-c"><span class="pl-c">//</span> after each successful iteration the message is acknowledged.</span></pre>
  </div> 
  <p>Note: <code>RabbitSource</code> yields an <a href="https://github.com/timcharper/acked-stream/blob/master/src/main/scala/com/timcharper/acked/AckedSource.scala" target="_blank">AckedSource</a>, which can be combined with an <a href="https://github.com/timcharper/acked-stream/blob/master/src/main/scala/com/timcharper/acked/AckedSink.scala" target="_blank">AckedSink</a> (such as <a href="http://spingo-oss.s3.amazonaws.com/docs/op-rabbit/akka-stream/current/index.html#com.spingo.op_rabbit.stream.MessagePublisherSink$" target="_blank"><code>MessagePublisherSink</code></a>). You can convert an acked stream into a normal stream by calling <code>AckedStream.acked</code>; once messages flow passed the <code>acked</code> component, they are considered acknowledged, and acknowledgement tracking is no longer a concern (and thus, you are free to use the akka-stream library in it's entirety).</p> 
  <h3><a id="user-content-publishing-using-akka-streams" class="anchor" href="https://github.com/spingo/op-rabbit#publishing-using-akka-streams" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Publishing using Akka streams</h3> 
  <p>(this example uses <code>op-rabbit-play-json</code> and <code>op-rabbit-akka-streams</code>)</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.stream.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.PlayJsonSupport.</span><span class="pl-v">_</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">workFormat</span> <span class="pl-k">=</span> <span class="pl-en">Format</span>[<span class="pl-en">Work</span>] <span class="pl-c"><span class="pl-c">//</span> setup play-json serializer</span>

<span class="pl-c"><span class="pl-c">/*</span> Each element in source will be acknowledged after publish</span>
<span class="pl-c">   confirmation is received <span class="pl-c">*/</span></span>
<span class="pl-en">AckedSource</span>(<span class="pl-c1">1</span> to <span class="pl-c1">15</span>).
  map(<span class="pl-en">Message</span>.queue(_, queueName)).
  to(<span class="pl-en">MessagePublisherSink</span>(rabbitControl))
  .run</pre>
  </div> 
  <p>If you can see the pattern here, combining an akka-stream rabbitmq consumer and publisher allows for guaranteed at-least-once message delivery from head to tail; in other words, don't acknowledge the original message from the message queue until any and all side-effect events have been published to other queues and persisted.</p> 
  <h3><a id="user-content-error-notification" class="anchor" href="https://github.com/spingo/op-rabbit#error-notification" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Error notification</h3> 
  <p>It's important to know when your consumers fail. Out of the box, <code>op-rabbit</code> ships with support for logging to <code>slf4j</code> (and therefore syslog), and also <code>airbrake</code> via <code>op-rabbit-airbrake</code>. Without any additional signal provided by you, slf4j will be used, making error visibility a default.</p> 
  <p>You can report errors to multiple sources by combining error logging strategies; for example, if you'd like to report to both <code>slf4j</code> and to <code>airbrake</code>, import / set the following implicit RabbitErrorLogging in the scope where your consumer is instantiated:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.spingo.op_rabbit.</span>{<span class="pl-v">Slf4jLogger</span>, <span class="pl-v">AirbrakeLogger</span>}

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">rabbitErrorLogging</span> <span class="pl-k">=</span> <span class="pl-en">Slf4jLogger</span> <span class="pl-k">+</span> <span class="pl-en">AirbrakeLogger</span>.fromConfig</pre>
  </div> 
  <p>Implementing your own error reporting strategy is simple; here's the source code for the slf4jLogger:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Slf4jLogger</span> <span class="pl-k">extends</span> <span class="pl-e">RabbitErrorLogging</span> {
  <span class="pl-k">def</span> <span class="pl-en">apply</span>(
    <span class="pl-v">name</span>: <span class="pl-k">String</span>,
    <span class="pl-v">message</span>: <span class="pl-k">String</span>,
    <span class="pl-v">exception</span>: <span class="pl-en">Throwable</span>,
    <span class="pl-v">consumerTag</span>: <span class="pl-k">String</span>,
    <span class="pl-v">envelope</span>: <span class="pl-en">Envelope</span>,
    <span class="pl-v">properties</span>: <span class="pl-en">BasicProperties</span>,
    <span class="pl-v">body</span>: <span class="pl-en">Array</span>[<span class="pl-k">Byte</span>])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {

    <span class="pl-k">val</span> <span class="pl-en">logger</span> <span class="pl-k">=</span> <span class="pl-en">LoggerFactory</span>.getLogger(name)
    logger.error(s<span class="pl-s"><span class="pl-pds">"</span>${message}. Body=${bodyAsString(body, properties)}. Envelope=${envelope}<span class="pl-pds">"</span></span>, exception)
  }
}</pre>
  </div> 
  <h2><a id="user-content-notes" class="anchor" href="https://github.com/spingo/op-rabbit#notes" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Notes</h2> 
  <h3><a id="user-content-shapeless-dependency" class="anchor" href="https://github.com/spingo/op-rabbit#shapeless-dependency" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Shapeless dependency</h3> 
  <p>Note, Op-Rabbit depends on <a href="https://github.com/milessabin/shapeless" target="_blank">shapeless</a> <code>2.3.0</code>, and there is presently no published version of <code>spray-routing-shapeless2</code> which works with shapeless <code>2.3.0</code>. Consider migrating to <code>akka-http</code>, or if you must stay on spray, use <a href="https://github.com/SpinGo/op-rabbit/tree/v1.2.x" target="_blank">op-rabbit 1.2.x</a>, instead.</p> 
  <h2><a id="user-content-credits" class="anchor" href="https://github.com/spingo/op-rabbit#credits" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h2> 
  <p>Op-Rabbit was created by <a href="http://timcharper.com" target="_blank">Tim Harper</a></p> 
  <p>This library builds upon the excellent <a href="https://github.com/thenewmotion/akka-rabbitmq" target="_blank">Akka RabbitMQ client</a> by Yaroslav Klymko.</p> 
 </article>
</div>