<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/meituan/firefly#firefly" aria-hidden="true" class="anchor" id="user-content-firefly" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Firefly</h1> 
  <hr> 
  <p>Lightweight thrift client code generator and runtime library for Android and Java.</p> 
  <p>Code generated by firefly has much fewer methods(about 1%) and lines than standard thrift code, which helps applications avoid the notorious 64k limit on methods in Android applications.</p> 
  <p>For exmaple, evernote's <a href="https://github.com/evernote/evernote-thrift" target="_blank">public api</a> is provided with thrift. Methods count of standard thrift generated code:</p> 
  <pre><code>&lt;root&gt;: 20815
    com: 20815
        evernote: 20815
            edam: 20815
                error: 226
                limits: 2
                notestore: 15225
                type: 2776
                userstore: 2586
Overall method count: 20815
</code></pre> 
  <p>Methods count of Firefly generated code:</p> 
  <pre><code>&lt;root&gt;: 204
    com: 204
        evernote: 204
            edam: 204
                error: 10
                limits: 1
                notestore: 90
                type: 85
                userstore: 18
Overall method count: 204
</code></pre> 
  <p>Firefly has an acceptable performance. Local process takes several tens of milliseconds when cold booting a service, which thrift code takes several milliseconds. Hot call takes less than one millisecond almost as fast as thrift code. Anyway, the time taken by local process is ignorable, comparing to the time taken by network.</p> 
  <p>This project is inspired by Square's <a href="https://github.com/square/wire" target="_blank">wire</a> and <a href="https://github.com/square/retrofit" target="_blank">retrofit</a>, and I shamelessly copy a lot of code from Twitter's <a href="https://github.com/twitter/scrooge" target="_blank">scrooge</a> and Google's <a href="https://github.com/google/gson" target="_blank">gson</a>.</p> 
  <h2><a href="https://github.com/meituan/firefly#compiling-thrift-files" aria-hidden="true" class="anchor" id="user-content-compiling-thrift-files" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Compiling thrift files</h2> 
  <p>Preparation:</p> 
  <ul> 
   <li>clone this repository</li> 
   <li>install sbt</li> 
  </ul> 
  <p>To compile thrift files:</p> 
  <div class="highlight highlight-source-shell">
   <pre>$ <span class="pl-c1">cd</span> generator
$ sbt <span class="pl-s"><span class="pl-pds">'</span>run [--output &lt;output-dir&gt;] &lt;thrift-file1&gt; [&lt;thrift-file2&gt; ...]<span class="pl-pds">'</span></span></pre>
  </div> 
  <p>If you want to generate files with Rx smell or supports Android's <code>Parcelable</code>, just put <code>--rx</code> or <code>--android</code> in the last, like this:</p> 
  <div class="highlight highlight-source-shell">
   <pre>$ <span class="pl-c1">cd</span> generator
$ sbt <span class="pl-s"><span class="pl-pds">'</span>run [--output &lt;output-dir&gt;] &lt;thrift-file1&gt; [&lt;thrift-file2&gt; ...] --rx --android<span class="pl-pds">'</span></span></pre>
  </div> 
  <p>If you generate codes with <code>--android</code>, your project should dependents on <code>com.meituan.firefly:lib-android</code> instead of <code>com.meituan.firefly:library</code>.</p> 
  <h3><a href="https://github.com/meituan/firefly#gradle-plugin" aria-hidden="true" class="anchor" id="user-content-gradle-plugin" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Gradle plugin</h3> 
  <p>If you are using Gradle, you may use the Gradle Plugin:</p> 
  <div class="highlight highlight-source-groovy">
   <pre>buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath <span class="pl-s"><span class="pl-pds">'</span>com.meituan.firefly:gradle-plugin:0.2.4<span class="pl-pds">'</span></span>
	}
}
apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>com.meituan.firefly<span class="pl-pds">'</span></span></pre>
  </div> 
  <p>you can change the input diretory and output diretory, like this:</p> 
  <div class="highlight highlight-source-groovy">
   <pre>apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>com.meituan.firefly<span class="pl-pds">'</span></span>
apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>com.android.library<span class="pl-pds">'</span></span>
firefly {
    inputDir file(<span class="pl-s"><span class="pl-pds">'</span>${project.projectDir}/src/main/idl<span class="pl-pds">'</span></span>)
    outputDir file(<span class="pl-s"><span class="pl-pds">'</span>${project.buildDir}/generated/source/firefly<span class="pl-pds">'</span></span>)
}</pre>
  </div> 
  <ul> 
   <li>inputDir's default value is '${project.projectDir}/src/main/idl'</li> 
   <li>outputDir's default value is '${project.buildDir}/generated/source/firefly'</li> 
   <li>rxStyle's default value is false</li> 
   <li>android's default value is false</li> 
  </ul> 
  <p>Please notice that, the plugin must be declared before plugin <code>com.android.library</code>, <code>com.android.application</code> or <code>java</code>. Pay attention to the arguments <code>rxStyle</code> and <code>android</code>. If you change them, all the output file will be re-generated.</p> 
  <p>If you want to generate code with rx smell or support android's Parcelable:</p> 
  <div class="highlight highlight-source-groovy">
   <pre>apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>com.meituan.firefly<span class="pl-pds">'</span></span>
apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>java<span class="pl-pds">'</span></span>
firefly {
    rxStyle <span class="pl-c1">true</span>
    android <span class="pl-c1">true</span>
}</pre>
  </div> 
  <p>The generator assumes that thrift files included by the target thrift file are placed in the same dir of the target thrift file.</p> 
  <h2><a href="https://github.com/meituan/firefly#using-firefly-in-your-application" aria-hidden="true" class="anchor" id="user-content-using-firefly-in-your-application" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using Firefly in your application</h2> 
  <p>The <code>library</code> package contains runtime support libraries that must be included in applications that use Firefly-generated code.</p> 
  <p>Include via Maven:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.meituan.firefly&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;library&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;0.2.4&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>or Gradle:</p> 
  <div class="highlight highlight-source-groovy">
   <pre>compile <span class="pl-s"><span class="pl-pds">'</span>com.meituan.firefly:library:0.2.4<span class="pl-pds">'</span></span></pre>
  </div> 
  <p>or sbt:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.meituan.firefly<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>library<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.2.4<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Given the following thrift file for example:</p> 
  <pre><code>namespace java com.meituan.greeting
service GreetingService{
    string greet(string name);
}
</code></pre> 
  <p>It generates an interface named <code>GreetingService</code>.</p> 
  <p>Use of generated code:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">final</span> <span class="pl-smi">OkHttpClient</span> okhttpClient <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">OkHttpClient</span>();
 
<span class="pl-smi">GreetingService</span> greetingService <span class="pl-k">=</span> <span class="pl-smi">Thrift</span><span class="pl-k">.</span>instance<span class="pl-k">.</span>create(<span class="pl-smi">GreetingService</span><span class="pl-k">.</span>class, <span class="pl-k">new</span> <span class="pl-smi">SimpleProtocolFactory</span>(){
    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">TProtocol</span> <span class="pl-en">get</span>() {
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">TBinaryProtocol</span>(<span class="pl-k">new</span> <span class="pl-smi">OkhttpTransport</span>(<span class="pl-c1">YOUR_SERVICE_URL</span>, okhttpClient));
    }
};

<span class="pl-smi">String</span> greeting <span class="pl-k">=</span> greetingService<span class="pl-k">.</span>greet(<span class="pl-s"><span class="pl-pds">"</span>Han meimei<span class="pl-pds">"</span></span>);</pre>
  </div> 
  <p>Make sure that <code>ProtocolFactory.get()</code> return a new Protocol for each call, or return a same thread-safe Protocol for every call.</p> 
  <h2><a href="https://github.com/meituan/firefly#roadmap" aria-hidden="true" class="anchor" id="user-content-roadmap" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Roadmap</h2> 
  <ul class="contains-task-list"> 
   <li class="task-list-item"><input checked class="task-list-item-checkbox" disabled id="" type="checkbox"> RxJava support</li> 
   <li class="task-list-item"><input checked class="task-list-item-checkbox" disabled id="" type="checkbox"> Gradle Plugin generates codes automatically</li> 
   <li class="task-list-item"><input checked class="task-list-item-checkbox" disabled id="" type="checkbox"> Serializable support</li> 
   <li class="task-list-item"><input checked class="task-list-item-checkbox" disabled id="" type="checkbox"> Android Parcelable support</li> 
  </ul> 
  <h2><a href="https://github.com/meituan/firefly#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <pre><code>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre> 
 </article>
</div>