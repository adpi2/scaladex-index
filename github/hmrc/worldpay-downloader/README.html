<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-worldpay-downloader" class="anchor" href="https://github.com/hmrc/worldpay-downloader#worldpay-downloader" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Worldpay Downloader</h1> 
  <p><a href="https://travis-ci.org/hmrc/worldpay-downloader" target="_blank"><img src="https://camo.githubusercontent.com/cc58d9198558099e98235affbd2a82cb44bd5c10/68747470733a2f2f7472617669732d63692e6f72672f686d72632f776f726c647061792d646f776e6c6f616465722e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/hmrc/worldpay-downloader.svg" style="max-width:100%;"></a> <a href="https://bintray.com/hmrc/releases/worldpay-downloader/_latestVersion" target="_blank"> <img src="https://camo.githubusercontent.com/df9b8260fb9f29233229bb97505f29193f35e879/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f686d72632f72656c65617365732f776f726c647061792d646f776e6c6f616465722f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/hmrc/releases/worldpay-downloader/images/download.svg" style="max-width:100%;"> </a></p> 
  <p>Microservice responsible for the download of Worldpay EMIS report, and well as the streaming of the data to RCS (a HOD).</p> 
  <p>Please note that - for internal, HMRC use - we use app-config-base to mix in configuration.</p> 
  <h2><a id="user-content-compile-the-application" class="anchor" href="https://github.com/hmrc/worldpay-downloader#compile-the-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Compile the application</h2> 
  <p>To compile the application and run the tests execute</p> 
  <pre><code>sbt clean test it:test fun:test
</code></pre> 
  <p>or</p> 
  <pre><code>run-all-tests.sh
</code></pre> 
  <h2><a id="user-content-run-the-application" class="anchor" href="https://github.com/hmrc/worldpay-downloader#run-the-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Run the application</h2> 
  <p>To run the application execute</p> 
  <pre><code>sbt 'run 9051'
</code></pre> 
  <p>and then access the application at</p> 
  <pre><code>http://localhost:9051/ping/ping
</code></pre> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/hmrc/worldpay-downloader#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>This code is open source software licensed under the Apache 2.0 License.</p> 
  <hr> 
  <h2><a id="user-content-api" class="anchor" href="https://github.com/hmrc/worldpay-downloader#api" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>API</h2> 
  <h2><a id="user-content-download--process-emis-report" class="anchor" href="https://github.com/hmrc/worldpay-downloader#download--process-emis-report" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Download &amp; Process EMIS Report</h2> 
  <pre><code>POST        /download/:downloadDate
</code></pre> 
  <p>downloadDate: Format is yyyyMMdd (e.g. 20150401 for 1 April, 2015). chunkSize: (Optional, Integer). The size of the chunks that we send to RCS. force: (Optional, Boolean, false). Forcing means that we send the file to RCS, even if they've already received it. Use with caution.</p> 
  <h2><a id="user-content-get-next-scheduled-date" class="anchor" href="https://github.com/hmrc/worldpay-downloader#get-next-scheduled-date" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Get Next Scheduled Date</h2> 
  <pre><code>GET         /nextScheduledDate
</code></pre> 
  <p>Retrieves the next scheduled date and time for downloading &amp; processing. This is supposed to every day except for Bank Holidays; the date is of the format: dd/MM/yyyy HH:mm (e.g. 01/04/2015 18:42 for 1 April, 2015.</p> 
  <p>If there is a scheduled date, we return it as text, with a status code of 200; otherwise, we return 404.</p> 
  <h2><a id="user-content-get-current-lock-status" class="anchor" href="https://github.com/hmrc/worldpay-downloader#get-current-lock-status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Get Current Lock Status</h2> 
  <pre><code>GET         /lock 
</code></pre> 
  <p>We use the Lock Service, with a lock named 'worldpay-downloader', to ensure that only one instance is processing a file at a time. If this lock currently exists, we return 200; otherwise, we return 404.</p> 
  <h2><a id="user-content-delete-current-lock" class="anchor" href="https://github.com/hmrc/worldpay-downloader#delete-current-lock" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Delete Current Lock</h2> 
  <pre><code>DELETE         /lock 
</code></pre> 
  <p>Attempt to delete the lock named 'worldpay-downloader'. If successfully deleted - by the Lock Service - we'll receive a 200; otherwise, a 500 - even if the lock simply didn't exist.</p> 
  <h2><a id="user-content-find-out-if-a-file-has-been-already-processed" class="anchor" href="https://github.com/hmrc/worldpay-downloader#find-out-if-a-file-has-been-already-processed" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Find Out If A File Has Been Already Processed</h2> 
  <pre><code>GET         /processed/:downloadDate
</code></pre> 
  <p>This asks if RCS has received <em>any file</em> from us, on the stated date. Please note that this does not correspond to the dated Worldpay file; for example: say today is 2nd March, 2016, and we realised that we neglected to send them any files since 29th February, 2016. If we sent them this query:</p> 
  <pre><code>GET         /processed/2016-02-29
</code></pre> 
  <p>It would come back as 200, indicated they received some file from us on the 29th, which is as we'd expect.</p> 
  <p>When we queried:</p> 
  <pre><code>GET         /processed/2016-03-01
</code></pre> 
  <p>We would get back a 404, indicating that they received no file from us on the 1st.</p> 
  <p>Say we then push the file for the 1st (as detailed below), and then queried:</p> 
  <pre><code>GET         /processed/2016-03-01
</code></pre> 
  <p>It would still return a 404, as they hadn't received any files on the 1st. But if we sent:</p> 
  <pre><code>GET         /processed/2016-03-02
</code></pre> 
  <p>It would come back as 200, as we just send them <em>a file</em>.</p> 
  <p>So, given this, how do we send them the file that Worldpay has for the 2nd? We'd have to force it:</p> 
  <pre><code>POST        /download/2016-03-02?force=true
</code></pre> 
  <p>downloadDate: Format is yyyy-MM-dd (e.g. 2015-04-17 for 17 April, 2015).</p> 
  <h2><a id="user-content-request-that-a-file-be-processed" class="anchor" href="https://github.com/hmrc/worldpay-downloader#request-that-a-file-be-processed" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request That A File Be Processed</h2> 
  <pre><code>POST        /processed/:downloadDate
</code></pre> 
  <p>This is similar to the /download/:downloadDate endpoint above, with the important difference that this one ensures that the lock is available. Note that there is no 'force' option here, so we cannot process for a file that's already been processed.</p> 
  <p>If we cannot get the lock, the response will be 409; if the lock is granted, but that file has already been processed: 400; otherwise, if successful: 200.</p> 
  <p>downloadDate: Format is yyyy-MM-dd (e.g. 2015-04-17 for 17 April, 2015).</p> 
  <h2><a id="user-content-request-that-the-scheduler-be-re-booted" class="anchor" href="https://github.com/hmrc/worldpay-downloader#request-that-the-scheduler-be-re-booted" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request That The Scheduler Be Re-booted</h2> 
  <pre><code>POST        /scheduler
</code></pre> 
  <p>If we suspect that the Scheduler (Akka) is no longer running, we can 're-boot' it. But please note that if the Scheduler is actually still running, and we do this, the behaviour is unknown; so, use with caution.</p> 
 </article>
</div>