<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/hmrc/agent-epaye-registration#agent-epaye-registration" aria-hidden="true" class="anchor" id="user-content-agent-epaye-registration" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>agent-epaye-registration</h1> 
  <p><a href="https://travis-ci.org/hmrc/agent-epaye-registration" target="_blank"><img src="https://camo.githubusercontent.com/c11a24188654f63aedf7495a787285347c3ef11a/68747470733a2f2f7472617669732d63692e6f72672f686d72632f6167656e742d65706179652d726567697374726174696f6e2e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/hmrc/agent-epaye-registration.svg" style="max-width:100%;"></a> <a href="https://bintray.com/hmrc/releases/agent-epaye-registration/_latestVersion" target="_blank"> <img src="https://camo.githubusercontent.com/d1c656db659c7f2a837b57a17a17bcac0097a2cd/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f686d72632f72656c65617365732f6167656e742d65706179652d726567697374726174696f6e2f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/hmrc/releases/agent-epaye-registration/images/download.svg" style="max-width:100%;"> </a></p> 
  <p>This is a backend microservice for Agent EPAYE Registration, part of interim replacement of OPRA (On-Line Pre-Registration of Agents).</p> 
  <p>The OPRA system provides a way for PAYE agents (not otherwise known to PAYE systems and therefore without known facts) to obtain a reference number that can be used as a known fact to enable them to register and enrol as a PAYE agent.</p> 
  <h2><a href="https://github.com/hmrc/agent-epaye-registration#features" aria-hidden="true" class="anchor" id="user-content-features" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h2> 
  <ul> 
   <li>Agent who needs an Agent PAYE reference code is able to enter its details and can be issued a code</li> 
   <li>Team capturing OPRA data has a way for stored data to be extracted so that it is available to other services</li> 
  </ul> 
  <h2><a href="https://github.com/hmrc/agent-epaye-registration#running-the-tests" aria-hidden="true" class="anchor" id="user-content-running-the-tests" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Running the tests</h2> 
  <pre><code>sbt test it:test
</code></pre> 
  <h2><a href="https://github.com/hmrc/agent-epaye-registration#running-the-app-locally" aria-hidden="true" class="anchor" id="user-content-running-the-app-locally" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Running the app locally</h2> 
  <pre><code>sm --start AGENT_EPAYE_REG -f
sm --stop AGENT_EPAYE_REGISTRATION
./run-local
</code></pre> 
  <p>It should then be listening on port 9445</p> 
  <h2><a href="https://github.com/hmrc/agent-epaye-registration#api" aria-hidden="true" class="anchor" id="user-content-api" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>API</h2> 
  <p>We're still building this service so some/all of the API described here might not be implemented yet!</p> 
  <h3><a href="https://github.com/hmrc/agent-epaye-registration#register-for-an-agent-epaye-reference-code" aria-hidden="true" class="anchor" id="user-content-register-for-an-agent-epaye-reference-code" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Register for an Agent EPAYE reference code</h3> 
  <pre><code>POST /agent-epaye-registration/registrations
</code></pre> 
  <p>Request body:</p> 
  <pre><code>{
    "agentName": "&lt;Agent's name&gt;",
    "contactName": "&lt;Agent's contact name",
    "telephoneNumber": "&lt;Agent's telephone number&gt;",
    "faxNumber": "&lt;Agent's fax number&gt;",
    "emailAddress": "&lt;Agent's email address&gt;",
    "address": {
        "addressLine1": "&lt;Agent's address line 1&gt;",
        "addressLine2": "&lt;Agent's address line 2&gt;",
        "addressLine3": "&lt;Agent's address line 3&gt;",
        "addressLine4": "&lt;Agent's address line 4&gt;",
        "postCode": "&lt;Agent's postcode&gt;"
    }
}
</code></pre> 
  <p>Possible responses:</p> 
  <h4><a href="https://github.com/hmrc/agent-epaye-registration#ok" aria-hidden="true" class="anchor" id="user-content-ok" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>OK</h4> 
  <pre><code>{
    "payeAgentReference": "&lt;New Agent EPAYE reference code&gt;"
}
</code></pre> 
  <h4><a href="https://github.com/hmrc/agent-epaye-registration#bad-request" aria-hidden="true" class="anchor" id="user-content-bad-request" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Bad Request</h4> 
  <pre><code>{
    "errors": [
        {
            "code": "&lt;ERROR_CODE&gt;",
            "message": "&lt;Error message&gt;"
        }
    ]
}
</code></pre> 
  <p>This endpoint validates the json input and returns Bad Request with a collection of error codes and messages for invalid input. An example of error code is <code>MISSING_FIELD</code>.</p> 
  <h3><a href="https://github.com/hmrc/agent-epaye-registration#extract-registrations-between-a-date-range" aria-hidden="true" class="anchor" id="user-content-extract-registrations-between-a-date-range" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Extract registrations between a date range</h3> 
  <p>This endpoint is secured by the <a href="https://confluence.tools.tax.service.gov.uk/display/PE/STRIDE+%28Internal%29+Auth" target="_blank">STRIDE (internal) Auth</a> model. It requires requests to be from signed in users authorised with the "T2 Technical" auth group.</p> 
  <pre><code>GET /agent-epaye-registration/registrations?dateFrom=yyyy-MM-dd&amp;dateTo=yyyy-MM-dd
</code></pre> 
  <p>The <code>dateFrom</code> and <code>dateTo</code> parameters follow the ISO 8604 date format with a full date as four digit year, two digit month of year, and two digit day of month (yyyy-MM-dd), e.g. <code>2017-02-27</code>. The date range may span 1 or more days, up to a year, but the dates must be in the past - today's date is not allowed.</p> 
  <p>Possible responses:</p> 
  <h4><a href="https://github.com/hmrc/agent-epaye-registration#ok-1" aria-hidden="true" class="anchor" id="user-content-ok-1" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>OK</h4> 
  <p>If there's no registrations within the date range, then a HTTP 200 response is returned with a body like:</p> 
  <pre><code>{
    "registrations": [],
    "complete" : true
}
</code></pre> 
  <p>If there are registrations within the date range, a HTTP 200 response is given with a body like:</p> 
  <pre><code>{
    "registrations": [
        {
            "agentReference": "HX2000",
            "agentName": "Dave Agent",
            "contactName": "Charlie Contact",
            "telephoneNumber": "04372895",
            "faxNumber": "04372895",
            "emailAddress": "some@email.com",
            "addressLine1": "First line of address",
            "addressLine2": "Second line of address",
            "addressLine3": "Optional 3rd line of address",
            "addressLine4": "Optional 4th line of address",
            "postCode": "CC111CC",
            "createdDateTime": "2017-09-08T10:03:29.544Z"
        },
        {
            "agentReference": "HX2001",
            "agentName": "Some Agent",
            "contactName": "Some Contact",
            "addressLine1": "First line of address",
            "addressLine2": "Second line of address",
            "postCode": "DD111DD",
            "createdDateTime": "2017-09-09T01:01:01.000Z"
        }
    ],
    "complete" : true
}
</code></pre> 
  <p>The following JSON fields are optional and will be omitted if there is no value:</p> 
  <ul> 
   <li><code>telephoneNumber</code></li> 
   <li><code>faxNumber</code></li> 
   <li><code>emailAddress</code></li> 
   <li><code>addressLine3</code></li> 
   <li><code>addressLine4</code></li> 
  </ul> 
  <p>The <code>createdDateTime</code> field is a combined date and time in UTC in ISO 8601 format (format is yyyy-MM-ddTHH:mm:ss.SSSZZ).</p> 
  <p>As the response is streamed, the <code>complete</code> field acts as a sentinel value indicating that all registrations were returned in their entirety and without error. If present, it's value will always be true and all of the registrations within the date range will have been streamed. If an error during streaming prevents a complete response, the <code>complete</code> field will not be present.</p> 
  <h4><a href="https://github.com/hmrc/agent-epaye-registration#bad-request-date-parsing-failure" aria-hidden="true" class="anchor" id="user-content-bad-request-date-parsing-failure" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Bad Request (date parsing failure)</h4> 
  <p>If one of the date parameters can not be parsed, a Bad Request is returned with a JSON body like:</p> 
  <pre><code>{
    "statusCode": 400,
    "message": "'To' date must be in ISO format (yyyy-MM-dd)",
    "requested": "/agent-epaye-registration/registrations?dateFrom=2017-08-10&amp;dateTo=2017-09-1x"
}
</code></pre> 
  <h4><a href="https://github.com/hmrc/agent-epaye-registration#bad-request-date-validation-failure" aria-hidden="true" class="anchor" id="user-content-bad-request-date-validation-failure" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Bad Request (date validation failure)</h4> 
  <p>The endpoint validates the dates and returns a Bad Request with a collection of error codes and messages for invalid input. An example of an error code is <code>INVALID_DATE_RANGE</code>.</p> 
  <pre><code>{
    "errors": [
        {
            "code": "&lt;ERROR_CODE&gt;",
            "message": "&lt;Error message&gt;"
        }
    ]
}
</code></pre> 
  <h3><a href="https://github.com/hmrc/agent-epaye-registration#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h3> 
  <p>This code is open source software licensed under the Apache 2.0 License</p> 
 </article>
</div>