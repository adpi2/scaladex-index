<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-play-events" class="anchor" href="https://github.com/hmrc/play-events#play-events" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>play-events</h1> 
  <p><a href="https://travis-ci.org/hmrc/play-events" target="_blank"><img src="https://camo.githubusercontent.com/45b5fbf7f9322c0566875eb873f9d4fe6d73849c/68747470733a2f2f7472617669732d63692e6f72672f686d72632f706c61792d6576656e74732e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/hmrc/play-events.svg?branch=master" style="max-width:100%;"></a> <a href="https://bintray.com/hmrc/releases/play-events/_latestVersion" target="_blank"> <img src="https://camo.githubusercontent.com/34fae9bade26fdf6d692a7952b804ce9a44079fc/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f686d72632f72656c65617365732f706c61792d6576656e74732f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/hmrc/releases/play-events/images/download.svg" style="max-width:100%;"> </a></p> 
  <p>Play Events composes various logging and metric standards into traits which can be mixed in to create events for your play app.</p> 
  <p>Auditing, Metrics, Alerts or Logging data can be recorded. A default monitoring implementation for HTTP errors is also provided.</p> 
  <h2><a id="user-content-download-play-events" class="anchor" href="https://github.com/hmrc/play-events#download-play-events" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Download play-events</h2> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.bintrayRepo(<span class="pl-s"><span class="pl-pds">"</span>hmrc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>releases<span class="pl-pds">"</span></span>)

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>uk.gov.hmrc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play-events<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>x.x.x<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a id="user-content-creating-an-alert-event" class="anchor" href="https://github.com/hmrc/play-events#creating-an-alert-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Creating an Alert Event</h2> 
  <p>A basic Alert Event would look like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">uk.gov.hmrc.play.events.examples</span>

<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.AlertLevel.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">Alertable</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">AlertCode</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ExampleAlertEvent</span>(<span class="pl-v">source</span>: <span class="pl-k">String</span>,
                             <span class="pl-v">name</span>: <span class="pl-k">String</span>,
                             <span class="pl-v">level</span>: <span class="pl-en">AlertLevel</span>,
                             <span class="pl-v">alertCode</span>: <span class="pl-en">AlertCode</span>) <span class="pl-k">extends</span> <span class="pl-e">Alertable</span>

<span class="pl-k">object</span> <span class="pl-en">ExampleAlertEvent</span> {
  <span class="pl-k">def</span> <span class="pl-en">apply</span>() <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ExampleAlertEvent</span>(
    source <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>TestApp<span class="pl-pds">"</span></span>,
    name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>External API Alert<span class="pl-pds">"</span></span>,
    level <span class="pl-k">=</span> <span class="pl-en">CRITICAL</span>,
    alertCode <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>EG-A<span class="pl-pds">"</span></span>
  )
}</pre>
  </div> 
  <h2><a id="user-content-recording-an-alert-event" class="anchor" href="https://github.com/hmrc/play-events#recording-an-alert-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Recording an Alert Event</h2> 
  <p>The above event would be recorded in your app by mixing in the <code>DefaultEventRecorder</code> trait and calling:</p> 
  <div class="highlight highlight-source-scala">
   <pre>record(<span class="pl-en">ExampleAlertEvent</span>())</pre>
  </div> 
  <p>Alert Events are written out to the logs in the following standard format. Match on this format with your Paging or Alerts service.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Logger</span>.warn(s<span class="pl-s"><span class="pl-pds">"</span>alert:${alertable.level}:source:${alertable.source}<span class="pl-pds">"</span></span> <span class="pl-k">+</span> 
             <span class="pl-s"><span class="pl-pds">"</span>:code:${alertable.alertCode}:name:${alertable.name}<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>So the output of this alert will be similar to <code>2015-08-04 13:54:56,793 level=[WARN] logger=[application] message=[alert:CRITICAL:source:TestApp:code:EG-A:name:External Api Alert]</code></p> 
  <h2><a id="user-content-creating-an-audit-event" class="anchor" href="https://github.com/hmrc/play-events#creating-an-audit-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Creating an Audit Event</h2> 
  <p>Audit Events look the same as any other event except they have <code>privateData</code> in place of <code>data</code>. Use this paramater to store sensitive data which should be written out to a secure events log. </p> 
  <p>They also typically take in an <code>implicit HeaderCarrier</code> in order to log the user session.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">uk.gov.hmrc.play.events.examples</span>

<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.http.</span><span class="pl-v">HeaderCarrier</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">Auditable</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ExampleAuditEvent</span>(<span class="pl-v">source</span>: <span class="pl-k">String</span>,
                             <span class="pl-v">name</span>: <span class="pl-k">String</span>,
                             <span class="pl-v">tags</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>],
                             <span class="pl-v">privateData</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>]) <span class="pl-k">extends</span> <span class="pl-e">Auditable</span>

<span class="pl-k">object</span> <span class="pl-en">ExampleAuditEvent</span> {

  <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">testCount</span>: <span class="pl-k">Int</span>, <span class="pl-v">testName</span>: <span class="pl-k">String</span>)(<span class="pl-k">implicit</span> <span class="pl-v">hc</span>: <span class="pl-en">HeaderCarrier</span>) <span class="pl-k">=</span>
    <span class="pl-en">ExampleAuditEvent</span>(
      source <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>example-source<span class="pl-pds">"</span></span>,
      name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-conducted<span class="pl-pds">"</span></span>,
      tags <span class="pl-k">=</span> <span class="pl-en">Map</span>(hc.toAuditTags(<span class="pl-s"><span class="pl-pds">"</span>testConducted<span class="pl-pds">"</span></span>, 
                                <span class="pl-s"><span class="pl-pds">"</span>/your-web-app/example-path/<span class="pl-pds">"</span></span>).toSeq<span class="pl-k">:</span> _<span class="pl-k">*</span>),
      privateData <span class="pl-k">=</span> hc.toAuditDetails() <span class="pl-k">++</span> buildAuditData(testCount, testName)
    )

  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">buildAuditData</span>(<span class="pl-v">count</span>: <span class="pl-k">Int</span>, <span class="pl-v">name</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> {
      <span class="pl-en">Map</span>(
        <span class="pl-s"><span class="pl-pds">"</span>Test Name<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> name.toString,
        <span class="pl-s"><span class="pl-pds">"</span>Tests Run<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> count.toString
      )
  }
}</pre>
  </div> 
  <h2><a id="user-content-recording-an-audit-event" class="anchor" href="https://github.com/hmrc/play-events#recording-an-audit-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Recording an Audit Event</h2> 
  <p>Audit Events require a <code>AuditConnector</code> to be set up inside your application to register events with. This should be registered inside a <code>AuditEventHandler</code>. </p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.audit.http.connector.</span><span class="pl-v">AuditConnector</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.handlers.</span><span class="pl-v">AuditEventHandler</span>

<span class="pl-k">object</span> <span class="pl-en">DefaultAuditEventHandler</span> <span class="pl-k">extends</span> <span class="pl-e">AuditEventHandler</span> {
  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">auditConnector</span><span class="pl-k">:</span> <span class="pl-en">AuditConnector</span> <span class="pl-k">=</span> <span class="pl-en">AuditConnector</span>
}</pre>
  </div> 
  <p>You then add this Handler to your own <code>Recorder</code> which you then include in your app where ever you want to audit. Note that we include <code>super.eventHandlers</code> so that the Default Alert, Metric and Loggable Handlers are included.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">ExampleEventRecorder</span> <span class="pl-k">extends</span> <span class="pl-e">DefaultEventRecorder</span> {
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">eventHandlers</span><span class="pl-k">:</span> <span class="pl-en">Set</span>[<span class="pl-en">EventHandler</span>] <span class="pl-k">=</span> 
    <span class="pl-v">super</span>.eventHandlers <span class="pl-k">++</span> <span class="pl-en">Set</span>(<span class="pl-en">DefaultAuditEventHandler</span>)
}</pre>
  </div> 
  <p>And now you record the Audit Event as normal</p> 
  <div class="highlight highlight-source-scala">
   <pre>record(<span class="pl-en">ExampleAuditEvent</span>(<span class="pl-c1">5</span>, <span class="pl-s"><span class="pl-pds">"</span>Example<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <h2><a id="user-content-creating-a-metric-event" class="anchor" href="https://github.com/hmrc/play-events#creating-a-metric-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Creating a Metric Event</h2> 
  <p>A Metric Event currently writes out to the log in a standard format, which can be analysed in your Log Digestion app to create reports etc.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">uk.gov.hmrc.play.events.examples</span>

<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">Measurable</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ExampleMetricEvent</span>(<span class="pl-v">source</span>: <span class="pl-k">String</span>,
                              <span class="pl-v">name</span>: <span class="pl-k">String</span>,
                              <span class="pl-v">data</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>]) <span class="pl-k">extends</span> <span class="pl-e">Measurable</span>

<span class="pl-k">object</span> <span class="pl-en">ExampleMetricEvent</span> {
  <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">fileId</span>: <span class="pl-k">String</span>, <span class="pl-v">fileType</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-en">ExampleMetricEvent</span>(
      source <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>TestApp<span class="pl-pds">"</span></span>,
      name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>NumberOfCreatedFilings<span class="pl-pds">"</span></span>,
      data <span class="pl-k">=</span> <span class="pl-en">Map</span> (
      <span class="pl-s"><span class="pl-pds">"</span>File ID<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> fileId,
      <span class="pl-s"><span class="pl-pds">"</span>File Type<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> fileType
    ))
}</pre>
  </div> 
  <h2><a id="user-content-recording-a-metric-event" class="anchor" href="https://github.com/hmrc/play-events#recording-a-metric-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Recording a Metric Event</h2> 
  <p>The <code>DefaultEventRecorder</code> trait writes out Metric Events in this standard format.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Logger</span>.info(s<span class="pl-s"><span class="pl-pds">"</span>metric:source:${measurable.source}:name:${measurable.name}<span class="pl-pds">"</span></span> <span class="pl-k">+</span> 
                <span class="pl-s"><span class="pl-pds">"</span>:data:${measurable.data}<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>They can be recorded by:</p> 
  <div class="highlight highlight-source-scala">
   <pre>record(<span class="pl-en">ExampleMetricEvent</span>(<span class="pl-s"><span class="pl-pds">"</span>1234567<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>SHARED<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <p>The output of this metric will be similar to <code>2015-08-04 13:54:56,793 level=[INFO] logger=[application] message=[metric:source:TestApp:name:NumberOfCreatedFilings:data:Map(File ID -&gt; 1234567, File Type -&gt; SHARED]</code></p> 
  <h2><a id="user-content-combining-event-types-in-one-event" class="anchor" href="https://github.com/hmrc/play-events#combining-event-types-in-one-event" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Combining Event Types in One Event</h2> 
  <p>The event traits can be mixed in together to allow for an event to be recorded once but produce multiple types of events in your logs. </p> 
  <p>Note the separation between <code>privateData</code> and <code>data</code> for AuditEvents. This also uses the <code>Loggable</code> trait to add an additional message into the logs.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">uk.gov.hmrc.play.events.examples</span>

<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.http.</span><span class="pl-v">HeaderCarrier</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.AlertLevel.</span><span class="pl-v">AlertLevel</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">AlertCode</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ExampleCombinedEvent</span>(<span class="pl-v">source</span>: <span class="pl-k">String</span>,
                                <span class="pl-v">name</span>: <span class="pl-k">String</span>,
                                <span class="pl-v">tags</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>],
                                <span class="pl-v">privateData</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>],
                                <span class="pl-v">data</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>],
                                <span class="pl-v">level</span>: <span class="pl-en">AlertLevel</span>,
                                <span class="pl-v">alertCode</span>: <span class="pl-en">AlertCode</span>)
            <span class="pl-k">extends</span> <span class="pl-e">Auditable</span> <span class="pl-k">with</span> <span class="pl-e">Measurable</span> <span class="pl-k">with</span> <span class="pl-e">Loggable</span> <span class="pl-k">with</span> <span class="pl-e">Alertable</span> {

 <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">log</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Combined Event occurred<span class="pl-pds">"</span></span>

}

<span class="pl-k">object</span> <span class="pl-en">ExampleCombinedEvent</span> {

  <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">filingID</span>: <span class="pl-k">String</span>, <span class="pl-v">otherFilingInfo</span>: <span class="pl-k">String</span>, <span class="pl-v">userPassword</span>: <span class="pl-k">String</span>, <span class="pl-v">alertCode</span>: <span class="pl-en">AlertCode</span>)
           (<span class="pl-k">implicit</span> <span class="pl-v">hc</span>: <span class="pl-en">HeaderCarrier</span>) <span class="pl-k">=</span> 
  <span class="pl-k">new</span> <span class="pl-en">ExampleCombinedEvent</span>(
    source <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-app<span class="pl-pds">"</span></span>,
    name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>CombinedEvent<span class="pl-pds">"</span></span>,
    tags <span class="pl-k">=</span> <span class="pl-en">Map</span>(hc.toAuditTags(<span class="pl-s"><span class="pl-pds">"</span>testConducted<span class="pl-pds">"</span></span>, 
                              <span class="pl-s"><span class="pl-pds">"</span>/your-web-app/example-path/<span class="pl-pds">"</span></span>).toSeq<span class="pl-k">:</span> _<span class="pl-k">*</span>),
    privateData <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>Password<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> userPassword) <span class="pl-k">++</span> 
                  generateData(filingID, otherFilingInfo),
    data <span class="pl-k">=</span> hc.toAuditDetails() <span class="pl-k">++</span> generateData(filingID, otherFilingInfo),
    alertCode <span class="pl-k">=</span> alertCode,
    <span class="pl-en">AlertLevel</span>.<span class="pl-en">WARNING</span>
  )

  <span class="pl-k">def</span> <span class="pl-en">generateData</span>(<span class="pl-v">filingID</span>: <span class="pl-k">String</span>, <span class="pl-v">otherFilingInfo</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>] <span class="pl-k">=</span>
    <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>Filing ID<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> filingID, <span class="pl-s"><span class="pl-pds">"</span>Filing Info<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> otherFilingInfo)
}</pre>
  </div> 
  <p>This event can be recorded using the <code>ExampleEventRecorder</code> above.</p> 
  <h2><a id="user-content-default-monitoring-of-http-errors-and-error-counts" class="anchor" href="https://github.com/hmrc/play-events#default-monitoring-of-http-errors-and-error-counts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Default Monitoring of Http Errors and Error Counts</h2> 
  <p>The traits <code>HttpErrorMonitor</code> and <code>HttpErrorCountMonitor</code> provide a default monitoring solution for any app that uses the <strong>uk.gov.hmrc.http-verbs</strong> library. In any class that extends <code>HttpErrorMonitor</code> or <code>HttpErrorCountMonitor</code> you can wrap your code with <code>monitor</code> as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">getHttpData</span>()(<span class="pl-k">implicit</span> <span class="pl-v">hc</span>: <span class="pl-en">HeaderCarrier</span>) <span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">ExampleHttpResponse</span>] <span class="pl-k">=</span> {
  monitor() {
    http.<span class="pl-en">GET</span>[<span class="pl-en">ExampleHttpResponse</span>](exampleGetUrl)
  }
}</pre>
  </div> 
  <p>The default value for <code>AlertCode</code> is "Unknown".</p> 
  <p>Or you can provide an alert code:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">getHttpData</span>()(<span class="pl-k">implicit</span> <span class="pl-v">hc</span>: <span class="pl-en">HeaderCarrier</span>) <span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">ExampleHttpResponse</span>] <span class="pl-k">=</span> {
  monitor(<span class="pl-s"><span class="pl-pds">"</span>ALERT-CODE<span class="pl-pds">"</span></span>) {
    http.<span class="pl-en">GET</span>[<span class="pl-en">ExampleHttpResponse</span>](exampleGetUrl)
  }
}</pre>
  </div> 
  <p>This will catch any of <code>uk.gov.hmrc.play.http.{HttpException, Upstream4xxResponse, Upstream5xxResponse}</code>, log events if an exception occurs, and pass the exception along.</p> 
  <p>The traits <code>HttpErrorMonitor</code> and <code>HttpErrorCountMonitor</code> are stackable - the events logged as a result of wrapping your code in <code>monitor</code> depend upon whether you've mixed in the traits <code>HttpErrorMonitor</code> or <code>HttpErrorCountMonitor</code> or both, as follows:</p> 
  <ul> 
   <li><code>HttpErrorMonitor</code> logs both a Metric and Critical Alert event for each exception</li> 
   <li><code>HttpErrorCountMonitor</code> logs a Metric event for each exception</li> 
  </ul> 
  <h2><a id="user-content-default-monitoring-of-http-response-times" class="anchor" href="https://github.com/hmrc/play-events#default-monitoring-of-http-response-times" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Default Monitoring of Http Response Times</h2> 
  <p>In any class that extends the <code>Timer</code> trait you can wrap a Http call with <code>timer</code>. This can be combined with the Http error monitoring described in the previous section, as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">getHttpData</span>()(<span class="pl-k">implicit</span> <span class="pl-v">hc</span>: <span class="pl-en">HeaderCarrier</span>) <span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">ExampleHttpResponse</span>] <span class="pl-k">=</span> {
  monitor(<span class="pl-s"><span class="pl-pds">"</span>ALERT-CODE<span class="pl-pds">"</span></span>) {
    timer(<span class="pl-s"><span class="pl-pds">"</span>ALERT-CODE<span class="pl-pds">"</span></span>) {
      http.<span class="pl-en">GET</span>[<span class="pl-en">ExampleHttpResponse</span>](exampleGetUrl)
    }
  }
}</pre>
  </div> 
  <p>As for Http error monitoring, you can provide an <code>AlertCode</code>, as in the example above, or you can use the default value, which is "Unknown".</p> 
  <p>This will log a Metric event containing the time in nanoseconds taken to make the Http call.</p> 
  <h2><a id="user-content-custom-monitoring-of-http-errors-error-counts-and-response-times" class="anchor" href="https://github.com/hmrc/play-events#custom-monitoring-of-http-errors-error-counts-and-response-times" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom Monitoring of Http Errors, Error Counts and Response Times</h2> 
  <p>Examples are included of how to extend the <code>HttpErrorMonitor</code>, <code>HttpErrorCountMonitor</code> and <code>Timer</code> traits, which is useful for integrating with other Metrics and Alerts libraries.</p> 
  <p>Your classes can extend these custom monitoring traits and wrap your code with <code>monitor</code> or <code>timer</code> as appropriate.</p> 
  <p>The following shows how to create a custom <code>Timer</code> with a custom event and custom <code>DefaultEventRecorder</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.handlers.</span>{<span class="pl-v">DefaultAlertEventHandler</span>, <span class="pl-v">DefaultMetricsEventHandler</span>, <span class="pl-v">EventHandler</span>}
<span class="pl-k">import</span> <span class="pl-v">uk.gov.hmrc.play.events.monitoring.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">Duration</span>

<span class="pl-k">trait</span> <span class="pl-en">ExampleEventRecorder</span> <span class="pl-k">extends</span> <span class="pl-e">DefaultEventRecorder</span> {

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">eventHandlers</span><span class="pl-k">:</span> <span class="pl-en">Set</span>[<span class="pl-en">EventHandler</span>] <span class="pl-k">=</span> <span class="pl-en">Set</span>(<span class="pl-en">DefaultMetricsEventHandler</span>, <span class="pl-en">DefaultAlertEventHandler</span>)
}

<span class="pl-k">trait</span> <span class="pl-en">ExampleTimer</span> <span class="pl-k">extends</span> <span class="pl-e">Timer</span> <span class="pl-k">with</span> <span class="pl-e">ExampleEventRecorder</span> {

  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">source</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>TestApp<span class="pl-pds">"</span></span>

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">createTimerEvent</span>(<span class="pl-v">alertCode</span>: <span class="pl-en">AlertCode</span>, <span class="pl-v">duration</span>: <span class="pl-en">Duration</span>)<span class="pl-k">:</span> <span class="pl-en">Measurable</span> <span class="pl-k">=</span> <span class="pl-en">ExampleTimerEvent</span>(alertCode, duration)
}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ExampleTimerEvent</span>(<span class="pl-v">alertCode</span>: <span class="pl-k">String</span>, <span class="pl-v">duration</span>: <span class="pl-en">Duration</span>) <span class="pl-k">extends</span> <span class="pl-e">Measurable</span> {

  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">source</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>TestApp<span class="pl-pds">"</span></span>

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">data</span><span class="pl-k">:</span> <span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>] <span class="pl-k">=</span> <span class="pl-en">Map</span> (
    <span class="pl-s"><span class="pl-pds">"</span>Time<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> s<span class="pl-s"><span class="pl-pds">"</span>${duration.length}<span class="pl-pds">"</span></span>
  )

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">name</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> s<span class="pl-s"><span class="pl-pds">"</span>Timer-$alertCode<span class="pl-pds">"</span></span>
}</pre>
  </div> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/hmrc/play-events#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>This code is open source software licensed under the Apache 2.0 License.</p> 
 </article>
</div>