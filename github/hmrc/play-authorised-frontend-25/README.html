<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-play-authorised-frontend" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#play-authorised-frontend" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>play-authorised-frontend</h1> 
  <p><a href="https://travis-ci.org/hmrc/play-authorised-frontend" target="_blank"><img src="https://camo.githubusercontent.com/bcaed8bce7aff28da72625b84377ac5b625eda7b/68747470733a2f2f7472617669732d63692e6f72672f686d72632f706c61792d617574686f72697365642d66726f6e74656e642e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/hmrc/play-authorised-frontend.svg" style="max-width:100%;"></a> <a href="https://bintray.com/hmrc/releases/play-authorised-frontend/_latestVersion" target="_blank"> <img src="https://camo.githubusercontent.com/fa5e2013a6791e748dce71e04b28d2fb920fef64/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f686d72632f72656c65617365732f706c61792d617574686f72697365642d66726f6e74656e642f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/hmrc/releases/play-authorised-frontend/images/download.svg" style="max-width:100%;"> </a> <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_blank"><img src="https://camo.githubusercontent.com/d00d3a7dec5b7f60761b739a5e3b3447eaac743e/687474703a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4170616368652d627269676874677265656e2e737667" alt="Apache-2.0 license" data-canonical-src="http://img.shields.io/badge/license-Apache-brightgreen.svg" style="max-width:100%;"></a></p> 
  <p>This component can be used in Frontends to allow Authorised Delegation of users.</p> 
  <h2><a id="user-content-installing" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#installing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installing</h2> 
  <p>Include the following dependency in your SBT build</p> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.bintrayRepo(<span class="pl-s"><span class="pl-pds">"</span>hmrc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>releases<span class="pl-pds">"</span></span>)

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>uk.gov.hmrc<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play-authorised-frontend<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>[INSERT-VERSION]<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-actions" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#actions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Actions</h3> 
  <p>It provides two traits from which user-aware controllers can be extended:</p> 
  <ul> 
   <li>Actions - This provides methods: <code>AuthorisedFor</code> and <code>AuthenticatedBy</code> which allow different levels of authorisation, and provides the AuthContext object to your controller.</li> 
   <li>DelegationAwareActions - This is used identically to Actions, but works in situations where the code allows <em>delegated</em> access. These actions require an <code>AuthConnector</code> plus a <code>DelegationConnector</code> with associated configuration.</li> 
  </ul> 
  <h3><a id="user-content-connectors" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#connectors" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Connectors</h3> 
  <p>The following connectors should be provided:</p> 
  <ul> 
   <li>The standard <code>AuthorisedFor</code> and <code>AuthenticatedBy</code> Actions requires a single <code>AuthConnector</code> to be provided.</li> 
   <li>When using <code>DelegationAwareActions</code>, both an <code>AuthConnector</code> and <code>DelegationConnector</code> should be provided.</li> 
  </ul> 
  <p>It is vital to provide companion objects and all necessary configuration for the <code>AuthConnector</code> and <code>DelegationConnector</code>.</p> 
  <h3><a id="user-content-user-and-authcontext" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#user-and-authcontext" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>User and AuthContext</h3> 
  <p>The <code>AuthContext</code> class is the replacement of the <code>User</code> class. The <code>User</code> is a familiar remnant of previous incarnations of play-frontend and play-authorised-frontend.</p> 
  <p><code>AuthContext</code> provides three fields:</p> 
  <ul> 
   <li><em>user</em> - This represents the <em>logged in user</em>; the person at the keyboard currently using the application</li> 
   <li><em>principal</em> - This is the entity whose tax accounts are being used (person, organisation or holder of tax accounts).</li> 
   <li><p><em>attorney</em> - This is an optional entity acting <em>on behalf of</em> the principal.</p> <p>case class User(userId: String, userAuthority: Authority, nameFromGovernmentGateway: Option[String] decryptedToken: Option[String] actingAsAttorneyFor:Option[ActingAsAttorneyFor])</p></li> 
  </ul> 
  <p>To help migrating, the mapping from <code>User</code> to <code>AuthContext</code> fields are as follows:</p> 
  <p><code>User.userId</code> == <code>AuthContext.user.userId</code></p> 
  <p><code>User.userAuthority.uri</code> == <code>AuthContext.user.userId</code></p> 
  <p><code>User.userAuthority.accounts</code> == <code>AuthContext.principal.accounts</code></p> 
  <p><code>User.userAuthority.loggedInAt</code> == <code>AuthContext.user.loggedInAt</code></p> 
  <p><code>User.userAuthority.previouslyLoggedInAt</code> == <code>AuthContext.user.previouslyLoggedInAt</code></p> 
  <p><code>User.nameFromGovernmentGateway</code> == either <code>AuthContext.principal.name</code> or <code>AuthContext.attorney.name</code></p> 
  <p><code>User.decryptedToken</code> == <code>AuthContext.user.governmentGatewayToken</code></p> 
  <p><code>User.actingAsAttorneyFor</code> - this is deprecated and has been removed in favour of the principal/attorney fields.</p> 
  <h3><a id="user-content-service-origin-for-metrics-for-securing-our-services" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#service-origin-for-metrics-for-securing-our-services" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Service Origin for Metrics for Securing Our Services</h3> 
  <p>The <code>GovernmentGateway</code> trait allows to set a <code>origin</code> property which will be used by analytics tools to track the entire login journey.</p> 
  <p>By default this is the name of the application (<code>appName</code> from <code>application.conf</code>). You can set a value that is different from the application name globally in <code>application.conf</code> with the <code>sosOrigin</code> property.</p> 
  <p>If you need to dynamically set the value per request, you need to override the <code>origin</code> property in the <code>GovernmentGateway</code> trait. </p> 
  <h3><a id="user-content-controller" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#controller" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Controller</h3> 
  <p>If you have a service that initiates the delegation flow, where a logged in user starts acting on behalf of another user, then you need to provide a controller extending <code>uk.gov.hmrc.play.frontend.auth.Delegator</code>.</p> 
  <p>This provides two methods:</p> 
  <ul> 
   <li><code>startDelegationAndRedirect()</code>: This requires a <code>DelegationContext</code> object, containing the information you want to be made available in the target frontend. That is, the name of the principal, the name of the attorney, the account details which are to be made available in the target, and the link allowing the attorney to return to their home page (e.g. the agent dashboard). This method makes a service call to the Delegation microservice which stores the provided <code>DelegationContext</code>, it then adds a delegation flag to the session and redirects to the target frontend address (i.e. that of the attorney's client).</li> 
   <li><code>endDelegation()</code>: when the attorney wants to return to their origin, they click the callback link provided in the original <code>startDelegationAndRedirect()</code> call. This should hit an endpoint which calls <code>endDelegation()</code> on the <code>Delegator</code>. The <code>endDelegation()</code> method removes the current delegation context from the Delegation microservice, and removes the delegation flag from the session.</li> 
  </ul> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/hmrc/play-authorised-frontend-25#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>This code is open source software licensed under the Apache 2.0 License.</p> 
 </article>
</div>