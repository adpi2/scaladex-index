<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-reactivecouchbase-plugin-for-play-framework-23" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#reactivecouchbase-plugin-for-play-framework-23" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ReactiveCouchbase Plugin for Play framework 2.3</h1> 
  <p><a href="https://gitter.im/ReactiveCouchbase/ReactiveCouchbase-play?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Gitter" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a></p> 
  <h2><a id="user-content-contents" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#contents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contents</h2> 
  <ul> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#basic-usage" target="_blank">Basic Usage</a> 
    <ul> 
     <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#project-configuration" target="_blank">Project configuration</a></li> 
     <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#standard-usage-from-a-controller" target="_blank">Usage from a controller</a></li> 
     <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#standard-usage-from-a-model" target="_blank">Usage from a model</a></li> 
    </ul></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#" target="_blank">Capped bucket &amp; tailable queries</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#crud-application" target="_blank">How to build CRUD Application</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#reactivecouchbase-n1ql-search" target="_blank">ReactiveCouchbase N1QL support</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#use-couchbase-as-cache-implementation" target="_blank">Use Couchbase as Play Cache</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#synchonize-couchbase-design-documents" target="_blank">Synchronise Design Documents (evolutions)</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#automatically-insert-documents-at-startup" target="_blank">Insert data at startup (fixtures)</a></li> 
   <li><a href="https://github.com/reactivecouchbase/reactivecouchbase-play#reactivecouchbase-play-specific-configuration-cheatsheet" target="_blank">ReactiveCouchbase Play specific configuration cheatsheet</a></li> 
  </ul> 
  <h1><a id="user-content-current-version" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#current-version" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Current version</h1> 
  <ul> 
   <li>current dev version for Play framework 2.3 is 0.3 or 0.4-SNAPSHOT 
    <ul> 
     <li><a href="https://raw.github.com/ReactiveCouchbase/repository/master/releases" target="_blank">https://raw.github.com/ReactiveCouchbase/repository/master/releases</a></li> 
     <li><a href="https://raw.github.com/ReactiveCouchbase/repository/master/snapshots" target="_blank">https://raw.github.com/ReactiveCouchbase/repository/master/snapshots</a></li> 
    </ul></li> 
  </ul> 
  <h1><a id="user-content-starter-kits" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#starter-kits" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Starter Kits</h1> 
  <p>You can quickly bootstrap a project with the Java and Scala starter kits :</p> 
  <ul> 
   <li><a href="https://github.com/ReactiveCouchbase/play-crud-starter-kit" target="_blank">https://github.com/ReactiveCouchbase/play-crud-starter-kit</a></li> 
   <li><a href="https://github.com/ReactiveCouchbase/play-java-starter-kit" target="_blank">https://github.com/ReactiveCouchbase/play-java-starter-kit</a></li> 
   <li><a href="https://github.com/ReactiveCouchbase/play-scala-starter-kit" target="_blank">https://github.com/ReactiveCouchbase/play-scala-starter-kit</a></li> 
  </ul> 
  <p>The binaries are here :</p> 
  <ul> 
   <li><a href="https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-crud-starter-kit.zip" target="_blank">https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-crud-starter-kit.zip</a></li> 
   <li><a href="https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-java-starter-kit.zip" target="_blank">https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-java-starter-kit.zip</a></li> 
   <li><a href="https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-scala-starter-kit.zip" target="_blank">https://github.com/ReactiveCouchbase/repository/raw/master/starterkits/play-scala-starter-kit.zip</a></li> 
  </ul> 
  <p>Just download the zip file, unzip it, change the app name/version in the <code>build.sbt</code> file and you're ready to go.</p> 
  <h1><a id="user-content-basic-usage" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#basic-usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Basic Usage</h1> 
  <h2><a id="user-content-project-configuration" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#project-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Project configuration</h2> 
  <p>in your <code>build.sbt</code> file add dependencies and resolvers like :</p> 
  <div class="highlight highlight-source-scala">
   <pre>name <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>myproject<span class="pl-pds">"</span></span>

version <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>1.0-SNAPSHOT<span class="pl-pds">"</span></span>

<span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">root</span> <span class="pl-k">=</span> (project in file(<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)).enablePlugins(<span class="pl-en">PlayScala</span>)

scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>2.11.1<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  cache,
  ws,
  <span class="pl-s"><span class="pl-pds">"</span>org.reactivecouchbase<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>reactivecouchbase-play<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.3<span class="pl-pds">"</span></span>
)

resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>ReactiveCouchbase<span class="pl-pds">"</span></span> at <span class="pl-s"><span class="pl-pds">"</span>https://raw.github.com/ReactiveCouchbase/repository/master/releases<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>or if you use the good old <code>project\Build.scala</code> file :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">sbt.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">Keys.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.Play.autoImport.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">PlayKeys.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.</span><span class="pl-v">PlayScala</span>

<span class="pl-k">object</span> <span class="pl-en">ApplicationBuild</span> <span class="pl-k">extends</span> <span class="pl-e">Build</span> {

  <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">root</span> <span class="pl-k">=</span> <span class="pl-en">Project</span>(id <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>My Project<span class="pl-pds">"</span></span>, base <span class="pl-k">=</span> file(<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)).enablePlugins(<span class="pl-en">PlayScala</span>).settings(
    libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
      cache,
      ws,
      <span class="pl-s"><span class="pl-pds">"</span>org.reactivecouchbase<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>reactivecouchbase-play<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.3<span class="pl-pds">"</span></span>
    ),
    version <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>1.0-SNAPSHOT<span class="pl-pds">"</span></span>,
    scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>2.11.1<span class="pl-pds">"</span></span>,
    organization <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.foo.bar<span class="pl-pds">"</span></span>,
    incOptions <span class="pl-k">:</span><span class="pl-k">=</span> incOptions.value.withNameHashing(<span class="pl-c1">true</span>),
    resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>ReactiveCouchbase repository<span class="pl-pds">"</span></span> at <span class="pl-s"><span class="pl-pds">"</span>https://raw.github.com/ReactiveCouchbase/repository/master/releases<span class="pl-pds">"</span></span>
  )
}</pre>
  </div> 
  <p>then create a <code>conf/play.plugins</code> file and add :</p> 
  <p><code>400:org.reactivecouchbase.play.plugins.CouchbasePlugin</code></p> 
  <p>add in your <code>conf/application.conf</code> file :</p> 
  <pre><code>
couchbase {
  buckets = [{
    host="127.0.0.1"
    port="8091"
    base="pools"
    bucket="bucketname"
    user=""
    pass=""
    timeout="0"
  }]
}

</code></pre> 
  <h2><a id="user-content-standard-usage-from-a-controller" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#standard-usage-from-a-controller" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Standard usage from a controller</h2> 
  <p>You will then be able to use the couchbase API from your Play controllers. The following code is asynchronous and uses Play's <code>Action.async { ... }</code>API under the hood. As you will need an execution context for all those async calls, you can use <code>PlayCouchbase.couchbaseExecutor</code> based on your <code>application.conf</code> file. You can of course use Play default Execution Context (through <code>import play.api.libs.concurrent.Execution.Implicits._</code>) or your own.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.mvc.</span>{<span class="pl-v">Action</span>, <span class="pl-v">Controller</span>}
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.Play.</span><span class="pl-v">current</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">User</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">surname</span>: <span class="pl-k">String</span>, <span class="pl-v">email</span>: <span class="pl-k">String</span>)

<span class="pl-k">object</span> <span class="pl-en">UserController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">CouchbaseController</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">couchbaseExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">userReader</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.reads[<span class="pl-en">User</span>]

  <span class="pl-k">def</span> <span class="pl-en">getUser</span>(<span class="pl-v">key</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">CouchbaseAction</span> { bucket <span class="pl-k">=&gt;</span>
    bucket.get[<span class="pl-en">User</span>](key).map { maybeUser <span class="pl-k">=&gt;</span>
      maybeUser.map(user <span class="pl-k">=&gt;</span> <span class="pl-en">Ok</span>(views.html.user(user)).getOrElse(<span class="pl-en">BadRequest</span>(s<span class="pl-s"><span class="pl-pds">"</span>Unable to find user with key: $key<span class="pl-pds">"</span></span>))
    }
  }
}
</pre>
  </div> 
  <p>this code is a shortcut for </p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.mvc.</span>{<span class="pl-v">Action</span>, <span class="pl-v">Controller</span>}
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">Couchbase</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">CouchbaseBucket</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.Play.</span><span class="pl-v">current</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">User</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">surname</span>: <span class="pl-k">String</span>, <span class="pl-v">email</span>: <span class="pl-k">String</span>)

<span class="pl-k">object</span> <span class="pl-en">UserController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">couchbaseExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">userReader</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.reads[<span class="pl-en">User</span>]

  <span class="pl-k">def</span> <span class="pl-en">getUser</span>(<span class="pl-v">key</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
    <span class="pl-k">val</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.defaultBucket
    bucket.get[<span class="pl-en">User</span>](key).map { maybeUser <span class="pl-k">=&gt;</span>
      maybeUser.map(user <span class="pl-k">=&gt;</span> <span class="pl-en">Ok</span>(views.html.user(user)).getOrElse(<span class="pl-en">BadRequest</span>(s<span class="pl-s"><span class="pl-pds">"</span>Unable to find user with key: $key<span class="pl-pds">"</span></span>))
    }
  }
}
</pre>
  </div> 
  <p>You can also access Couchbase from your Java application :</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">controllers</span>;

<span class="pl-k">import</span> <span class="pl-smi">models.ShortURL</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.Couchbase</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.CouchbaseBucket</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.F</span>;
<span class="pl-k">import static</span> <span class="pl-smi">play.libs.F.*</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.mvc.Controller</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.mvc.Result</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">CouchbaseBucket</span> bucket <span class="pl-k">=</span> <span class="pl-smi">Couchbase</span><span class="pl-k">.</span>bucket(<span class="pl-s"><span class="pl-pds">"</span>bucket1<span class="pl-pds">"</span></span>);

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">Result</span>  <span class="pl-en">getUser</span>(<span class="pl-k">final</span> <span class="pl-smi">String</span> <span class="pl-v">key</span>) {
        <span class="pl-k">return</span> async(
            bucket<span class="pl-k">.</span>get(key, <span class="pl-smi">User</span><span class="pl-k">.</span>class)<span class="pl-k">.</span>map(<span class="pl-k">new</span> <span class="pl-k">Function&lt;<span class="pl-smi">User</span>, <span class="pl-smi">Result</span>&gt;</span>() {
                <span class="pl-k">@Override</span>
                <span class="pl-k">public</span> <span class="pl-smi">Result</span> <span class="pl-en">apply</span>(<span class="pl-smi">User</span> <span class="pl-v">user</span>) <span class="pl-k">throws</span> <span class="pl-smi">Throwable</span> {
                    <span class="pl-k">if</span> (user <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
                        <span class="pl-k">return</span> badRequest(<span class="pl-s"><span class="pl-pds">"</span>Unable to find user with key: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> key);
                    }
                    <span class="pl-k">return</span> ok(views<span class="pl-k">.</span>html<span class="pl-k">.</span>user<span class="pl-k">.</span>render(user));
                }
            })
        );
    }
}
</pre>
  </div> 
  <p>and with Java 8</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">controllers</span>;

<span class="pl-k">import</span> <span class="pl-smi">models.ShortURL</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.Couchbase</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.CouchbaseBucket</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.F</span>;
<span class="pl-k">import static</span> <span class="pl-smi">play.libs.F.*</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.mvc.Controller</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.mvc.Result</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">CouchbaseBucket</span> bucket <span class="pl-k">=</span> <span class="pl-smi">Couchbase</span><span class="pl-k">.</span>bucket(<span class="pl-s"><span class="pl-pds">"</span>bucket1<span class="pl-pds">"</span></span>);

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">Result</span>  <span class="pl-en">getUser</span>(<span class="pl-k">final</span> <span class="pl-smi">String</span> <span class="pl-v">key</span>) {
        <span class="pl-k">return</span> async(
            bucket<span class="pl-k">.</span>get(key, <span class="pl-smi">User</span><span class="pl-k">.</span>class)<span class="pl-k">.</span>map(user <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
                <span class="pl-k">if</span> (user <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
                    <span class="pl-k">return</span> badRequest(<span class="pl-s"><span class="pl-pds">"</span>Unable to find user with key: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> key);
                }
                <span class="pl-k">return</span> ok(views<span class="pl-k">.</span>html<span class="pl-k">.</span>user<span class="pl-k">.</span>render(user));
            })
        );
    }
}
</pre>
  </div> 
  <p>You can of course connect many buckets with :</p> 
  <pre><code>couchbase {

  ...

  buckets = [{
      host=["127.0.0.1", "192.168.0.42"]
      port="8091"
      base="pools"
      bucket="bucket1"
      user=""
      pass=""
      timeout="0"
  }, {
     host="127.0.0.1"
     port="8091"
     base="pools"
     bucket="bucket2"
     user=""
     pass=""
     timeout="0"
  }, {
     host="192.168.0.42"
     port="8091"
     base="pools"
     bucket="bucket3"
     user=""
     pass=""
     timeout="0"
  }]
}

</code></pre> 
  <p>then select one of them for each of your operation :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">UserController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">CouchbaseController</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">couchbaseExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">userReader</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.reads[<span class="pl-en">User</span>]
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">beerReader</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.reads[<span class="pl-en">Beer</span>]

  <span class="pl-k">def</span> <span class="pl-en">getUser</span>(<span class="pl-v">key</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">CouchbaseAction</span>(<span class="pl-s"><span class="pl-pds">"</span>bucket1<span class="pl-pds">"</span></span>) { bucket <span class="pl-k">=&gt;</span>
    bucket.get[<span class="pl-en">User</span>](key).map { maybeUser <span class="pl-k">=&gt;</span>
      maybeUser.map(user <span class="pl-k">=&gt;</span> <span class="pl-en">Ok</span>(views.html.user(user)).getOrElse(<span class="pl-en">BadRequest</span>(s<span class="pl-s"><span class="pl-pds">"</span>Unable to find user with key: $key<span class="pl-pds">"</span></span>))
    }
  }

  <span class="pl-k">def</span> <span class="pl-en">getBeer</span>(<span class="pl-v">key</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">CouchbaseAction</span>(<span class="pl-s"><span class="pl-pds">"</span>bucket2<span class="pl-pds">"</span></span>) { request <span class="pl-k">=&gt;</span> bucket <span class="pl-k">=&gt;</span>
    bucket.get[<span class="pl-en">Beer</span>](key).map { maybeBeer <span class="pl-k">=&gt;</span>
      maybeBeer.map(beer <span class="pl-k">=&gt;</span> <span class="pl-en">Ok</span>(views.html.beer(beer)).getOrElse(<span class="pl-en">BadRequest</span>(s<span class="pl-s"><span class="pl-pds">"</span>Unable to find beer with key: $key<span class="pl-pds">"</span></span>))
    }
  }
}
</pre>
  </div> 
  <h2><a id="user-content-standard-usage-from-a-model" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#standard-usage-from-a-model" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Standard usage from a model</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">Couchbase</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">CouchbaseBucket</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.client.</span><span class="pl-v">OpResult</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.Play.</span><span class="pl-v">current</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Beer</span>(<span class="pl-v">id</span>: <span class="pl-k">String</span>, <span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">brewery</span>: <span class="pl-k">String</span>) {
  <span class="pl-k">def</span> <span class="pl-en">save</span>()<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">OpResult</span>] <span class="pl-k">=</span> <span class="pl-en">Beer</span>.save(<span class="pl-v">this</span>)
  <span class="pl-k">def</span> <span class="pl-en">remove</span>()<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">OpResult</span>] <span class="pl-k">=</span> <span class="pl-en">Beer</span>.remove(<span class="pl-v">this</span>)
}

<span class="pl-k">object</span> <span class="pl-en">Beer</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">beerFmt</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.format[<span class="pl-en">Beer</span>]
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">ec</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor

  <span class="pl-k">def</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>)

  <span class="pl-k">def</span> <span class="pl-en">findById</span>(<span class="pl-v">id</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Option</span>[<span class="pl-en">Beer</span>]] <span class="pl-k">=</span> {
    bucket.get[<span class="pl-en">Beer</span>](id)
  }

  <span class="pl-k">def</span> <span class="pl-en">findAll</span>()<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">List</span>[<span class="pl-en">Beer</span>]] <span class="pl-k">=</span> {
    bucket.find[<span class="pl-en">Beer</span>](<span class="pl-s"><span class="pl-pds">"</span>beer<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_name<span class="pl-pds">"</span></span>)(<span class="pl-k">new</span> <span class="pl-en">Query</span>().setIncludeDocs(<span class="pl-c1">true</span>).setStale(<span class="pl-en">Stale</span>.<span class="pl-en">FALSE</span>))
  }

  <span class="pl-k">def</span> <span class="pl-en">findByName</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Option</span>[<span class="pl-en">Beer</span>]] <span class="pl-k">=</span> {
    <span class="pl-k">val</span> <span class="pl-en">query</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Query</span>().setIncludeDocs(<span class="pl-c1">true</span>).setLimit(<span class="pl-c1">1</span>)
          .setRangeStart(<span class="pl-en">ComplexKey</span>.of(name))
          .setRangeEnd(<span class="pl-en">ComplexKey</span>.of(s<span class="pl-s"><span class="pl-pds">"</span>$name<span class="pl-cce">\uefff</span><span class="pl-pds">"</span></span>).setStale(<span class="pl-en">Stale</span>.<span class="pl-en">FALSE</span>))
    bucket.find[<span class="pl-en">Beer</span>](<span class="pl-s"><span class="pl-pds">"</span>beer<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_name<span class="pl-pds">"</span></span>)(query).map(_.headOption)
  }

  <span class="pl-k">def</span> <span class="pl-en">save</span>(<span class="pl-v">beer</span>: <span class="pl-en">Beer</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">OpResult</span>] <span class="pl-k">=</span> {
    bucket.set[<span class="pl-en">Beer</span>](beer.id, beer)
  }

  <span class="pl-k">def</span> <span class="pl-en">remove</span>(<span class="pl-v">beer</span>: <span class="pl-en">Beer</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">OpResult</span>] <span class="pl-k">=</span> {
    bucket.delete(beer.id)
  }
}
</pre>
  </div> 
  <p>or from a java model</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">models</span>;

<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.ComplexKey</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.Query</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.Stale</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.client.OpResult</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.Couchbase</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.CouchbaseBucket</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.F</span>;
<span class="pl-k">import static</span> <span class="pl-smi">play.libs.F.*</span>;

<span class="pl-k">import</span> <span class="pl-smi">java.util.Collection</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ShortURL</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> id;
    <span class="pl-k">public</span> <span class="pl-smi">String</span> originalUrl;

    <span class="pl-k">public</span> <span class="pl-en">ShortURL</span>() {}

    <span class="pl-k">public</span> <span class="pl-en">ShortURL</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>, <span class="pl-smi">String</span> <span class="pl-v">originalUrl</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>id <span class="pl-k">=</span> id;
        <span class="pl-v">this</span><span class="pl-k">.</span>originalUrl <span class="pl-k">=</span> originalUrl;
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">CouchbaseBucket</span> bucket <span class="pl-k">=</span> <span class="pl-smi">Couchbase</span><span class="pl-k">.</span>bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>);

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">ShortURL</span>&gt;</span> <span class="pl-en">findById</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>get(id, <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-k">Collection&lt;<span class="pl-smi">ShortURL</span>&gt;</span>&gt;</span> <span class="pl-en">findAll</span>() {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>find(<span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>,
            <span class="pl-k">new</span> <span class="pl-smi">Query</span>()<span class="pl-k">.</span>setIncludeDocs(<span class="pl-c1">true</span>)<span class="pl-k">.</span>setStale(<span class="pl-smi">Stale</span><span class="pl-c1"><span class="pl-k">.</span>FALSE</span>), <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-k">Option&lt;<span class="pl-smi">ShortURL</span>&gt;</span>&gt;</span> <span class="pl-en">findByURL</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>) {
        <span class="pl-smi">Query</span> query <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Query</span>()
                .setLimit(<span class="pl-c1">1</span>)
                .setIncludeDocs(<span class="pl-c1">true</span>)
                .setStale(<span class="pl-smi">Stale</span><span class="pl-c1"><span class="pl-k">.</span>FALSE</span>)
                .setRangeStart(<span class="pl-smi">ComplexKey</span><span class="pl-k">.</span>of(url))
                .setRangeEnd(<span class="pl-smi">ComplexKey</span><span class="pl-k">.</span>of(url <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\u</span>efff<span class="pl-pds">"</span></span>));
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>find(<span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>, query, <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class)
                .map(<span class="pl-k">new</span> <span class="pl-k">Function&lt;<span class="pl-k">Collection&lt;<span class="pl-smi">ShortURL</span>&gt;</span>, <span class="pl-k">Option&lt;<span class="pl-smi">ShortURL</span>&gt;</span>&gt;</span>() {
            <span class="pl-k">@Override</span>
            <span class="pl-k">public</span> <span class="pl-k">Option&lt;<span class="pl-smi">ShortURL</span>&gt;</span> <span class="pl-en">apply</span>(<span class="pl-k">Collection&lt;<span class="pl-smi">ShortURL</span>&gt;</span> <span class="pl-v">shortURLs</span>) <span class="pl-k">throws</span> <span class="pl-smi">Throwable</span> {
                <span class="pl-k">if</span> (shortURLs<span class="pl-k">.</span>isEmpty()) {
                    <span class="pl-k">return</span> <span class="pl-smi">Option</span><span class="pl-k">.</span>None();
                }
                <span class="pl-k">return</span> <span class="pl-smi">Option</span><span class="pl-k">.</span>Some(shortURLs<span class="pl-k">.</span>iterator()<span class="pl-k">.</span>next());
            }
        });
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">OpResult</span>&gt;</span> <span class="pl-en">save</span>(<span class="pl-smi">ShortURL</span> <span class="pl-v">url</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>set(url<span class="pl-k">.</span>id, url);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">OpResult</span>&gt;</span> <span class="pl-en">remove</span>(<span class="pl-smi">ShortURL</span> <span class="pl-v">url</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>delete(url<span class="pl-k">.</span>id);
    }
}
</pre>
  </div> 
  <p>and with Java 8</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">models</span>;

<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.ComplexKey</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.Query</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.couchbase.client.protocol.views.Stale</span>;
<span class="pl-k">import</span> <span class="pl-smi">net.spy.memcached.ops.OperationStatus</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.Couchbase</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.reactivecouchbase.play.java.couchbase.CouchbaseBucket</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.libs.F</span>;
<span class="pl-k">import static</span> <span class="pl-smi">play.libs.F.*</span>;

<span class="pl-k">import</span> <span class="pl-smi">java.util.Collection</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ShortURL</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> id;
    <span class="pl-k">public</span> <span class="pl-smi">String</span> originalUrl;

    <span class="pl-k">public</span> <span class="pl-en">ShortURL</span>() {}

    <span class="pl-k">public</span> <span class="pl-en">ShortURL</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>, <span class="pl-smi">String</span> <span class="pl-v">originalUrl</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>id <span class="pl-k">=</span> id;
        <span class="pl-v">this</span><span class="pl-k">.</span>originalUrl <span class="pl-k">=</span> originalUrl;
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-smi">CouchbaseBucket</span> bucket <span class="pl-k">=</span> <span class="pl-smi">Couchbase</span><span class="pl-k">.</span>bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>);

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">ShortURL</span>&gt;</span> <span class="pl-en">findById</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>get(id, <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-k">Collection&lt;<span class="pl-smi">ShortURL</span>&gt;</span>&gt;</span> <span class="pl-en">findAll</span>() {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>find(<span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>,
            <span class="pl-k">new</span> <span class="pl-smi">Query</span>()<span class="pl-k">.</span>setIncludeDocs(<span class="pl-c1">true</span>)<span class="pl-k">.</span>setStale(<span class="pl-smi">Stale</span><span class="pl-c1"><span class="pl-k">.</span>FALSE</span>), <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-k">Option&lt;<span class="pl-smi">ShortURL</span>&gt;</span>&gt;</span> <span class="pl-en">findByURL</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>) {
        <span class="pl-smi">Query</span> query <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Query</span>()
                .setLimit(<span class="pl-c1">1</span>)
                .setIncludeDocs(<span class="pl-c1">true</span>)
                .setStale(<span class="pl-smi">Stale</span><span class="pl-c1"><span class="pl-k">.</span>FALSE</span>)
                .setRangeStart(<span class="pl-smi">ComplexKey</span><span class="pl-k">.</span>of(url))
                .setRangeEnd(<span class="pl-smi">ComplexKey</span><span class="pl-k">.</span>of(url <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\u</span>efff<span class="pl-pds">"</span></span>));
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>find(<span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>, query, <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class)
            .map(shortURLs <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
                <span class="pl-k">if</span> (shortURLs<span class="pl-k">.</span>isEmpty()) {
                    <span class="pl-k">return</span> <span class="pl-smi">Option</span><span class="pl-k">.</span>None();
                }
                <span class="pl-k">return</span> <span class="pl-smi">Option</span><span class="pl-k">.</span>Some(shortURLs<span class="pl-k">.</span>iterator()<span class="pl-k">.</span>next());
            });
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">OperationStatus</span>&gt;</span> <span class="pl-en">save</span>(<span class="pl-smi">ShortURL</span> <span class="pl-v">url</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>set(url<span class="pl-k">.</span>id, url);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">Promise&lt;<span class="pl-smi">OperationStatus</span>&gt;</span> <span class="pl-en">remove</span>(<span class="pl-smi">ShortURL</span> <span class="pl-v">url</span>) {
        <span class="pl-k">return</span> bucket<span class="pl-k">.</span>delete(url<span class="pl-k">.</span>id);
    }
}
</pre>
  </div> 
  <h1><a id="user-content-capped-buckets-and-tailable-queries" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#capped-buckets-and-tailable-queries" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Capped buckets and tailable queries</h1> 
  <p>Play2-couchbase provides a way to simulate capped buckets (<a href="http://docs.mongodb.org/manual/core/capped-collections/" target="_blank">http://docs.mongodb.org/manual/core/capped-collections/</a>). You can see a capped bucket as a circular buffer. Once the buffer is full, the oldest entry is removed from the bucket.</p> 
  <p>Here, the bucket isn't really capped at couchbase level. It is capped at play2-couchbase level. You can use a bucket as a capped bucket using :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.cappedBucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>, <span class="pl-c1">100</span>) <span class="pl-c">// here I use the default bucket as a capped bucket of size 100</span></pre>
  </div> 
  <p>of course, only data inserted with this <code>CappedBucket</code> object are considered for capped bucket features.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">john</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>fname<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Doe<span class="pl-pds">"</span></span>)

<span class="pl-k">for</span> (i <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-c1">0</span> to <span class="pl-c1">200</span>) {
    bucket.insert(<span class="pl-en">UUID</span>.randomUUID().toString, john)
}
<span class="pl-c">// still 100 people in the bucket (and possibly other data inserted with standard API)</span></pre>
  </div> 
  <p>When a json object is inserted, a timestamp is add to the object and this timestamp will be used to manage all the capped bucket features.</p> 
  <p>The nice part with capped buckets is the <code>tail</code> function. It's like using a <code>tail -f</code>command on the datas of the capped bucket</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">tailf</span> <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
    <span class="pl-k">val</span> <span class="pl-en">enumerator1</span> <span class="pl-k">=</span> bucket.tail[<span class="pl-en">JsValue</span>]()
    <span class="pl-k">val</span> <span class="pl-en">enumerator2</span> <span class="pl-k">=</span> bucket.tail[<span class="pl-en">JsValue</span>](<span class="pl-c1">1265457L</span>) <span class="pl-c">// start to read data from 1265457L timestamp</span>
    <span class="pl-k">val</span> <span class="pl-en">enumerator3</span> <span class="pl-k">=</span> bucket.tail[<span class="pl-en">JsValue</span>](<span class="pl-c1">1265457L</span>, <span class="pl-c1">200</span>, <span class="pl-en">TimeUnit</span>.<span class="pl-en">MILLISECONDS</span>) <span class="pl-c">// update every 200 milliseconds</span>
    enumerator1.map( <span class="pl-en">Ok</span>.chunked( _ ) )
}</pre>
  </div> 
  <h1><a id="user-content-crud-application" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#crud-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>CRUD Application</h1> 
  <p>If you want to quickly bootstrap a project with Play2 Couchbase, it's pretty easy, you can use the CRUD utilities.</p> 
  <p>To do so, first create a model :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ShortURL</span>(<span class="pl-v">id</span>: <span class="pl-k">String</span>, <span class="pl-v">originalUrl</span>: <span class="pl-k">String</span>)
</pre>
  </div> 
  <p>then declare an implicit Json Formatter that will be used for Json serialization/deserialization</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">Json</span>

<span class="pl-k">object</span> <span class="pl-en">ShortURL</span> {
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">fmt</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.format[<span class="pl-en">ShortURL</span>]
}
</pre>
  </div> 
  <p>Now you can do two things :</p> 
  <ul> 
   <li>create a CRUD source</li> 
   <li>create a CRUD controller</li> 
  </ul> 
  <p>let's try the CRUD controller</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.crud.</span><span class="pl-v">CouchbaseCrudSourceController</span>
<span class="pl-k">import</span> <span class="pl-v">models.</span><span class="pl-v">ShortURL</span>
<span class="pl-k">import</span> <span class="pl-v">models.ShortURLs.</span><span class="pl-v">fmt</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.Play.</span><span class="pl-v">current</span>

<span class="pl-k">object</span> <span class="pl-en">ShortURLController</span> <span class="pl-k">extends</span> <span class="pl-e">CouchbaseCrudSourceController</span>[<span class="pl-en">ShortURL</span>] {
  <span class="pl-k">def</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>)
}
</pre>
  </div> 
  <p>and add the following route to your <code>routes</code> file</p> 
  <pre><code>-&gt;      /urls                       controllers.ShortURLController
</code></pre> 
  <p>now you will be able to do :</p> 
  <pre><code>
GET     /urls/?doc=docName&amp;view=viewName                    # get all urls according to a view
POST    /urls/                                              # create a url
GET     /urls/{id}                                          # get a url
PUT     /urls/{id}                                          # update url
PUT     /urls/{id}/partial                                  # partially update url
DELETE  /urls/{id}                                          # delete url
POST    /urls/find/?doc=docName&amp;view=viewName&amp;q=query       # search urls
GET     /urls/stream/?doc=docName&amp;view=viewName&amp;q=query     # search urls as HTTP stream

POST    /urls/batch                                         # create multiple urls
PUT     /urls/batch                                         # update multiple urls
DELETE  /urls/batch                                         # delete multiple urls

</code></pre> 
  <p>it is also possible to define default design doc name, view and id key :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">ShortURLController</span> <span class="pl-k">extends</span> <span class="pl-e">CouchbaseCrudSourceController</span>[<span class="pl-en">ShortURL</span>] {
  <span class="pl-k">def</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>)
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">defaultViewName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">defaultDesignDocname</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">idKey</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>__myAwesomeIdKey<span class="pl-pds">"</span></span>
}
</pre>
  </div> 
  <p>you can also only define a CRUD source containing all needed methods with :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.crud.</span><span class="pl-v">CouchbaseCrudSource</span>
<span class="pl-k">import</span> <span class="pl-v">models.</span><span class="pl-v">ShortURL</span>
<span class="pl-k">import</span> <span class="pl-v">models.ShortURLs.</span><span class="pl-v">fmt</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.</span><span class="pl-v">Couchbase</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.Play.</span><span class="pl-v">current</span>

<span class="pl-k">object</span> <span class="pl-en">ShortURLSource</span> <span class="pl-k">extends</span> <span class="pl-e">CouchbaseCrudSource</span>[<span class="pl-en">ShortURL</span>]( <span class="pl-en">Couchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>) ) {}
</pre>
  </div> 
  <p>You can also access this feature from Java</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ShortURLController</span> <span class="pl-k">extends</span> <span class="pl-e">CrudSourceController&lt;<span class="pl-smi">ShortURL</span>&gt;</span> {

    <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-k">CrudSource&lt;<span class="pl-smi">ShortURL</span>&gt;</span> source <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">CrudSource&lt;<span class="pl-smi">ShortURL</span>&gt;</span>( <span class="pl-smi">Couchbase</span><span class="pl-k">.</span>bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>), <span class="pl-smi">ShortURL</span><span class="pl-k">.</span>class );
    <span class="pl-c">//private final CrudSource&lt;ShortURL&gt; source = new CrudSource&lt;ShortURL&gt;( Couchbase.bucket("default"), "__myAwesomeIdKey", ShortURL.class );</span>

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">CrudSource&lt;<span class="pl-smi">ShortURL</span>&gt;</span> <span class="pl-en">getSource</span>() {
        <span class="pl-k">return</span> source;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">defaultDesignDocname</span>() {
        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>shorturls<span class="pl-pds">"</span></span>;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">defaultViewName</span>() {
        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>by_url<span class="pl-pds">"</span></span>;
    }
}
</pre>
  </div> 
  <p>You will need a controller instanciator for that :</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">import</span> <span class="pl-smi">controllers.ShortURLController</span>;
<span class="pl-k">import</span> <span class="pl-smi">play.GlobalSettings</span>;

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Global</span> <span class="pl-k">extends</span> <span class="pl-e">GlobalSettings</span> {
    <span class="pl-c">// You can really do something more clever here ;-)</span>
    <span class="pl-k">public</span> <span class="pl-k">&lt;<span class="pl-smi">A</span>&gt;</span> <span class="pl-smi">A</span> <span class="pl-en">getControllerInstance</span>(<span class="pl-k">java.lang.Class&lt;<span class="pl-smi">A</span>&gt;</span> <span class="pl-v">aClass</span>) <span class="pl-k">throws</span> <span class="pl-smi">java.lang<span class="pl-k">.</span>Exception</span> {
        <span class="pl-k">if</span> (aClass<span class="pl-k">.</span>equals(<span class="pl-smi">ShortURLController</span><span class="pl-k">.</span>class)) {
            <span class="pl-k">return</span> (<span class="pl-smi">A</span>) <span class="pl-k">new</span> <span class="pl-smi">ShortURLController</span>();
        }
        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">"</span>Cannot instanciate <span class="pl-pds">"</span></span> <span class="pl-k">+</span> aClass<span class="pl-k">.</span>getName());
    }
}
</pre>
  </div> 
  <p>and also to define routes (yeah I know it's boring, but it's a work in progress right now)</p> 
  <pre><code>
GET     /urls/                      @controllers.ShortURLController.find()
POST    /urls/                      @controllers.ShortURLController.insert()
POST    /urls/find                  @controllers.ShortURLController.find()
POST    /urls/batch                 @controllers.ShortURLController.batchInsert()
PUT     /urls/batch                 @controllers.ShortURLController.batchUpdate()
DELETE  /urls/batch                 @controllers.ShortURLController.batchDelete()
PUT     /urls/:id/partial           @controllers.ShortURLController.updatePartial(id)
GET     /urls/:id                   @controllers.ShortURLController.get(id)
DELETE  /urls/:id                   @controllers.ShortURLController.delete(id)
PUT     /urls/:id                   @controllers.ShortURLController.update(id)

</code></pre> 
  <p>Note : <strong>You can also use the awesome play-autosource project (<a href="https://github.com/mandubian/play-autosource" target="_blank">https://github.com/mandubian/play-autosource</a>) that comes with Couchbase support</strong></p> 
  <h1><a id="user-content-reactivecouchbase-n1ql-search" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#reactivecouchbase-n1ql-search" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ReactiveCouchbase N1QL search</h1> 
  <p>N1QL is the Couchbase Query Language. The N1QL Developer Preview 2 (DP2) is a pre-beta release of the language and is available at</p> 
  <p><a href="http://www.couchbase.com/communities/n1ql" target="_blank">http://www.couchbase.com/communities/n1ql</a></p> 
  <p>The ReactiveCouchbase plugin offers a very experimental access to N1QL based on the N1QL DP1. As it is experimental, I can not ensure that this feature will not massively change and/or will be continued.</p> 
  <p>First setup your N1QL query server. Download it and expand it. Then connect it to your Couchbase server.</p> 
  <p>./cbq-engine -couchbase http://:8091/`</p> 
  <p>Now you have to configure N1QL in you <code>conf/application.conf</code> file add :</p> 
  <pre><code>
couchbase {
   n1ql {
     host="127.0.0.1"
     port=8093
   }
}

</code></pre> 
  <p>And now you can use it from your application</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.plugins.CouchbaseN1QLPlugin.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.iteratee.</span>{<span class="pl-v">Enumerator</span>, <span class="pl-v">Enumeratee</span>}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-v">fname</span>: <span class="pl-k">String</span>, <span class="pl-v">age</span>: <span class="pl-k">Int</span>)

<span class="pl-k">object</span> <span class="pl-en">N1QLQuerier</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">personFormat</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.format[<span class="pl-en">Person</span>]

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>)

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">couchbaseExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor

  <span class="pl-k">def</span> <span class="pl-en">find</span>(<span class="pl-v">age</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
    <span class="pl-en">N1QL</span>( s<span class="pl-s"><span class="pl-pds">"""</span> SELECT fname, age FROM tutorial WHERE age &gt; ${age} <span class="pl-pds">"""</span></span>, driver )
                                                   .toList[<span class="pl-en">Person</span>].map { persons <span class="pl-k">=&gt;</span>
      <span class="pl-en">Ok</span>(s<span class="pl-s"><span class="pl-pds">"</span>Persons older than ${age}<span class="pl-pds">"</span></span>, persons))
    }
  }
}
</pre>
  </div> 
  <p>or use it the Enumerator way</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.reactivecouchbase.play.plugins.CouchbaseN1QLPlugin.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.iteratee.</span>{<span class="pl-v">Enumerator</span>, <span class="pl-v">Enumeratee</span>}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(<span class="pl-v">fname</span>: <span class="pl-k">String</span>, <span class="pl-v">age</span>: <span class="pl-k">Int</span>)

<span class="pl-k">object</span> <span class="pl-en">N1QLQuerier</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">personFormat</span> <span class="pl-k">=</span> <span class="pl-en">Json</span>.format[<span class="pl-en">Person</span>]

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">bucket</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.bucket(<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>)

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">couchbaseExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">PlayCouchbase</span>.couchbaseExecutor

  <span class="pl-k">def</span> <span class="pl-en">find</span>(<span class="pl-v">age</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
    <span class="pl-en">N1QL</span>( s<span class="pl-s"><span class="pl-pds">"""</span> SELECT fname, age FROM tutorial WHERE age &gt; ${age} <span class="pl-pds">"""</span></span>, driver )
                                    .enumerate[<span class="pl-en">Person</span>].map { enumerator <span class="pl-k">=&gt;</span>
       <span class="pl-en">Ok</span>.chunked((enumerator &amp;<span class="pl-k">&gt;</span>
        <span class="pl-en">Enumeratee</span>.collect[<span class="pl-en">Person</span>] { <span class="pl-k">case</span> p<span class="pl-k">@</span><span class="pl-en">Person</span>(_, age) <span class="pl-k">if</span> age <span class="pl-k">&lt;</span> <span class="pl-c1">50</span> <span class="pl-k">=&gt;</span> p } <span class="pl-k">&gt;&lt;&gt;</span>
        <span class="pl-en">Enumeratee</span>.map[<span class="pl-en">Person</span>](personFormat.writes)) <span class="pl-k">&gt;&gt;&gt;</span>
        <span class="pl-en">Enumerator</span>.eof))
    }
  }
}
</pre>
  </div> 
  <h1><a id="user-content-use-couchbase-as-cache-implementation" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#use-couchbase-as-cache-implementation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Use Couchbase as Cache implementation</h1> 
  <p>in <code>conf/play.plugins</code> file and add : <code>500:org.reactivecouchbase.play.plugins.CouchbaseCachePlugin</code></p> 
  <p>then you need to add the following to your configuration</p> 
  <pre><code>couchbase {
  cache {
    bucket="name of the bucket to use"
    enabled=true
  }

  ...

}
</code></pre> 
  <p>you can also specify a common namespace for the cache keys with</p> 
  <pre><code>couchbase {
  cache {
    bucket="name of the bucket to use"
    enabled=true
    namespace="play-cache."
  }

  ...

}
</code></pre> 
  <p>then you can use your Play Cache the standard way</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Cache</span>.set(<span class="pl-s"><span class="pl-pds">"</span>item.key<span class="pl-pds">"</span></span>, connectedUser)
<span class="pl-k">val</span> <span class="pl-en">maybeUser</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">User</span>] <span class="pl-k">=</span> <span class="pl-en">Cache</span>.getAs[<span class="pl-en">User</span>](<span class="pl-s"><span class="pl-pds">"</span>item.key<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <h1><a id="user-content-synchonize-couchbase-design-documents" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#synchonize-couchbase-design-documents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Synchonize Couchbase design documents</h1> 
  <p>You can use CouchbaseEvolutionsPlugin to automaticaly create your design documents at application start from json files.</p> 
  <p>in <code>conf/play.plugins</code> file and add : <code>600:org.reactivecouchbase.play.plugins.CouchbaseEvolutionsPlugin</code></p> 
  <p>then configure the plugin</p> 
  <pre><code>couchbase {

  ...
  evolutions {
    #documents = ...    #optional, default conf/views
    #disabled = ...     #optional, default false
    #use.locks = ...    #optional, default true

    default { #default is the name of your bucket
        apply = true
        synchronise = true
    }
  }

}
</code></pre> 
  <p>The plugin will search your design documents in folders named as your buckets in the <code>couchbase.evolutions.documents</code> value</p> 
  <pre><code>conf
    views
        default
            tweets.json
            users.json
            ...
        ...
</code></pre> 
  <p>Your json might look like</p> 
  <div class="highlight highlight-source-json">
   <pre>{
    <span class="pl-s"><span class="pl-pds">"</span>views<span class="pl-pds">"</span></span>:{
       <span class="pl-s"><span class="pl-pds">"</span>withMedia<span class="pl-pds">"</span></span>: {
           <span class="pl-s"><span class="pl-pds">"</span>map<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>function (doc, meta) {<span class="pl-cce">\n</span> if(doc.entities.media)<span class="pl-cce">\n</span>  emit(dateToArray(doc.created_at))<span class="pl-cce">\n</span>}<span class="pl-pds">"</span></span>
       }
    }
}</pre>
  </div> 
  <p>The name of the design document will be the name of the json file. You can specify another one in the json</p> 
  <div class="highlight highlight-source-json">
   <pre>{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>my_doc<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>views<span class="pl-pds">"</span></span>:{
       <span class="pl-s"><span class="pl-pds">"</span>withMedia<span class="pl-pds">"</span></span>: {
           <span class="pl-s"><span class="pl-pds">"</span>map<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>function (doc, meta) {<span class="pl-cce">\n</span> if(doc.entities.media)<span class="pl-cce">\n</span>  emit(dateToArray(doc.created_at))<span class="pl-cce">\n</span>}<span class="pl-pds">"</span></span>
       }
    }
}</pre>
  </div> 
  <p><strong>Note : Design documents synchronisation is not yet available</strong></p> 
  <h1><a id="user-content-automatically-insert-documents-at-startup" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#automatically-insert-documents-at-startup" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Automatically insert documents at startup</h1> 
  <p>You can use CouchbaseFixturesPlugin to automaticaly insert data into buckets.</p> 
  <p>in <code>conf/play.plugins</code> file and add : <code>700:org.reactivecouchbase.play.plugins.CouchbaseFixturesPlugin</code></p> 
  <p>then configure the plugin</p> 
  <pre><code>couchbase {
  ...
  fixtures {
    #documents = ...    #optional, default conf/fixtures
    #disabled = ...     #optional, default false

    default { #default is the name of your bucket
      insert = true
      key = "_id" # the json member to extract key for insertion
    }
  }
}
</code></pre> 
  <p>The plugin will search data in folders named as your buckets in the <code>couchbase.fixtures.documents</code> value</p> 
  <pre><code>conf
    fixtures
        default
            users.json
</code></pre> 
  <p>Your json <strong>MUST BE</strong> an <strong>ARRAY</strong> structure containing your JSON documents (even if there is only one doc inside) and might look like :</p> 
  <div class="highlight highlight-source-json">
   <pre>[
    {
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>John Doe<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>john.doe@gmail.com<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>
    },
    {
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Jane Doe<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>jane.doe@gmail.com<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>
    }
]</pre>
  </div> 
  <p><strong>Note : Your documents will be overwritten at each startup. Removed json files won't be removed from your buckets.</strong></p> 
  <h1><a id="user-content-reactivecouchbase-play-specific-configuration-cheatsheet" class="anchor" href="https://github.com/reactivecouchbase/reactivecouchbase-play#reactivecouchbase-play-specific-configuration-cheatsheet" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ReactiveCouchbase Play specific configuration cheatsheet</h1> 
  <p>Here is the complete plugin configuration with default values</p> 
  <pre><code>
couchbase {
   useplayec=true                    # the plugin can use play.api.libs.concurrent.Execution.Implicits.defaultContext as execution context, optional
   cache {                           # cache related configuration, optional
     namespace=""                    # key prefix if couchbase used as cache with the cache plugin, optional
     enabled=false                   # enable cache with couchbase, optional
   }
   fixtures {                        # fixtures related configuration, optional
     disabled=false                  # disable fixtures, optional
     documents="conf/fixtures"       # path for fixtures files, optional
     $bucketName {
       insert=true                   # insert fixtures, optional
       key="_id"                     # key name for each fixture object, optional
     }
   }
   evolutions {                      # evolutions related configuration, optional
     disabled=false                  # disable evolutions, optional
     documents="conf/views"          # path for evolution files, optional
     use.locks=true                  # use locks for evolutions, optional
     $bucketName {
       apply=true                    # apply evolution on start
       synchronize=true              # synchronize with existing
     }
   }
}

</code></pre> 
 </article>
</div>