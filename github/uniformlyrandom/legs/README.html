<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-legsio" class="anchor" href="https://github.com/uniformlyrandom/legs#legsio" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Legs.io</h1> 
  <p>Scraping and job orchestration library.</p> 
  <p><a href="https://travis-ci.org/uniformlyrandom/legs" target="_blank"><img src="https://camo.githubusercontent.com/faf54208b1ead8628540ac199132586a34e4f412/68747470733a2f2f7472617669732d63692e6f72672f756e69666f726d6c7972616e646f6d2f6c6567732e706e67" alt="Build Status" data-canonical-src="https://travis-ci.org/uniformlyrandom/legs.png" style="max-width:100%;"></a></p> 
  <h3><a id="user-content-project-goal" class="anchor" href="https://github.com/uniformlyrandom/legs#project-goal" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Project goal</h3> 
  <p>Eliminate the cruft, boilerplate and minimize time needed to write a scraper. Ideally only the business logic (moving parts) need to be written, all supporting machinery needs to be already in place and provide simple intuitive APIs</p> 
  <h3><a id="user-content-installation" class="anchor" href="https://github.com/uniformlyrandom/legs#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h3> 
  <p>Java 8 "Nashorn" is used as the map-reduce engine, you will need to have Java 8 installed to use <code>Legs</code>.</p> 
  <p><code>Legs.io</code> is published to Sonatype, so first make sure <code>SBT</code> is checking Sonatype for jars</p> 
  <pre><code>resolvers += Resolver.sonatypeRepo("releases")
</code></pre> 
  <p>Adding the dependecy to <code>build.sbt</code></p> 
  <pre><code>libraryDependencies += "io.legs" %% "legs" % "0.8.4+"
</code></pre> 
  <p>Currently I publish the project against Scala <code>2.11</code>, if <code>2.10.*</code> is required, please let me know</p> 
  <h3><a id="user-content-changelog" class="anchor" href="https://github.com/uniformlyrandom/legs#changelog" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Changelog</h3> 
  <ul> 
   <li><code>0.8.1</code> add randomized user agent to PhantomJS</li> 
   <li><code>0.8.2</code> improve logging + docs</li> 
   <li><code>0.8.3.*</code> refactoring internals, adding <code>AS_JSON</code>, some work around queues</li> 
   <li><code>0.8.4.*</code> experimental <code>transform</code> feature for every step of the chain</li> 
  </ul> 
  <h3><a id="user-content-library-contents" class="anchor" href="https://github.com/uniformlyrandom/legs#library-contents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Library contents</h3> 
  <p>The library was originally built for scraping &amp; crawling and requires additional functionality other then simply downloading pages. Some additional machinery is provided to support an easy and effective tool </p> 
  <ul> 
   <li>scraping (HTML,XML)</li> 
   <li>tracking visited pages</li> 
   <li>"live client" (selenium)</li> 
   <li>string operations (regex etc)</li> 
   <li>queue management / jobs</li> 
   <li>iterating collections </li> 
   <li>persistence to file / remote </li> 
   <li>map reduce operations (JavaScript)</li> 
  </ul> 
  <p><em>For queues to work, Redis needs to be installed and configured</em></p> 
  <h3><a id="user-content-job-instructions" class="anchor" href="https://github.com/uniformlyrandom/legs#job-instructions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Job instructions</h3> 
  <p>The language to connect the different parts requires that:</p> 
  <ul> 
   <li>minimal language friction</li> 
   <li>portable and sharable</li> 
   <li>future compatible</li> 
   <li>allow enough flexibility but still very simple and basic</li> 
  </ul> 
  <p>I ended up using JSON as the storage medium, which seemed to fit the requirements nicely.</p> 
  <p>Job instructions are sequential and will only continue to the next block when the current finishes, it needs to have an <code>action</code> member with full path to specific function (if its one of the library provided functions, you can call the specific function name directly without specifying its path), parameter keys are then separated by slashes which will be looked up first in the <code>values</code> member and then in the current state</p> 
  <div class="highlight highlight-source-json">
   <pre>[
    {
        <span class="pl-s"><span class="pl-pds">"</span>action<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>FETCH/url<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span> : {
            <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>https://news.google.com/<span class="pl-pds">"</span></span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>yields<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>s_google_news<span class="pl-pds">"</span></span>
    },{
        <span class="pl-s"><span class="pl-pds">"</span>action<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>ECHO/s_google_news<span class="pl-pds">"</span></span>
    }
]</pre>
  </div> 
  <ul> 
   <li>it will resolve <code>FETCH</code> to <code>io.legs.specialized.Scraper.FETCH</code></li> 
   <li>the engine will try to resolve the <code>url</code> parameter from the <code>values</code> first and then from the current "state" (inherited from its preceding sibling)</li> 
   <li>finally it will evaluate and if successful will assign a state value with the name <code>s_google_news</code> (the <code>s_</code> is just convention to denote a string value)</li> 
   <li>the next instructions block will call the <code>io.legs.specialized.Tools.ECHO</code> with parameter by that name</li> 
   <li>you should be able to see the source HTML in your console now</li> 
  </ul> 
  <p>Several build in functions are available (see the <code>Library functions</code> section below)</p> 
  <h1><a id="user-content-library-functions" class="anchor" href="https://github.com/uniformlyrandom/legs#library-functions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Library functions</h1> 
  <p>To generate a fresh <code>FUNCTIONS.md</code> execute <code>sbt gendocs</code></p> 
  <p>Latest automatically generated are <a href="https://github.com/uniformlyrandom/legs/blob/master/FUNCTIONS.md" target="_blank">here</a></p> 
 </article>
</div>