<div class="announce instapaper_body md" data-path="readme.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-akka-kafka" class="anchor" href="https://github.com/sclasen/akka-kafka#akka-kafka" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>akka-kafka</h1> 
  <p><a href="https://travis-ci.org/sclasen/akka-kafka" target="_blank"><img src="https://camo.githubusercontent.com/6ff11ac74193bfda826e8165e5ee60fb2d0d0c9a/68747470733a2f2f7472617669732d63692e6f72672f73636c6173656e2f616b6b612d6b61666b612e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/sclasen/akka-kafka.svg?branch=master" style="max-width:100%;"></a></p> 
  <p>Actor based kafka consumer built on top of the high level kafka consumer.</p> 
  <p>The <code>0.0.X</code> versions of akka-kafka were built with kafka <code>0.8.1.1</code>. Starting with <code>0.1.0</code> akka-kafka is built against the scala 2.11 version of kafka <code>0.8.2.0</code></p> 
  <h2><a id="user-content-akkaconsumer" class="anchor" href="https://github.com/sclasen/akka-kafka#akkaconsumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AkkaConsumer</h2> 
  <p>Manages backpressure so the consumer doesn't overwhelm other parts of the system. The consumer allows asynchronous/concurrent processing of a configurable, bounded number of in-flight messages.</p> 
  <p>You can configure the connector to commit offsets at a configurable interval, after a configured number of messages are processed, or simply commit the offsets programatically. It waits until all in flight messages are processed at commit time, so you know that everything that's committed has been processed.</p> 
  <h2><a id="user-content-akkabatchconsumer" class="anchor" href="https://github.com/sclasen/akka-kafka#akkabatchconsumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AkkaBatchConsumer</h2> 
  <p>Configured and used very similarly to the <code>AkkaConsumer</code> but it accumulates a batch of messages, with a configured maximum size and timeout, and sends the batch to your <code>ActorRef</code>, you reply with <code>BatchConnectorFSM.BatchProcessed</code> and the batch consumer will commit the batch and accumulate a new one.</p> 
  <h1><a id="user-content-use" class="anchor" href="https://github.com/sclasen/akka-kafka#use" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>use</h1> 
  <p>Add the dependencies to your project. akka-kafka by default excludes kafka's logging dependencies, in favor of slf4j, but does so without forcing you to do the same, so you need to add a dependency that brings in log4j or slf4j's log4j.</p> 
  <p>If you dont want to use slf4j, you can substitute log4j.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">/*</span> build.sbt <span class="pl-c">*/</span></span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.sclasen<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-kafka<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.0<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>compile<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.typesafe.akka<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-slf4j<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>2.3.9<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>compile<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.slf4j<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>log4j-over-slf4j<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.7.10<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>compile<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a id="user-content-akkaconsumer-1" class="anchor" href="https://github.com/sclasen/akka-kafka#akkaconsumer-1" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AkkaConsumer</h2> 
  <p>To use this consumer you must provide it with an actorRef that will receive messages from kafka, and will reply to the sender with <code>StreamFSM.Processed</code> after a message has been successfully processed. If you do not reply in this way to every single message received, the connector will not be able to drain all in-flight messages at commit time, and will hang.</p> 
  <p>Note that the sender in this case is not the <code>ConnectorFSM</code> actor, but one of the <code>StreamFSM</code> actors that are the connector's children. You need to reply to the <code>sender()</code>, a <code>StreamFSM</code> rather than the connector itself so each stream can track the number of outstanding messages correctly.</p> 
  <p>Here is an example of such an actor that just prints the messages.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">Printer</span> <span class="pl-k">extends</span> <span class="pl-e">Actor</span>{

  <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> x<span class="pl-k">:</span><span class="pl-en">Any</span> <span class="pl-k">=&gt;</span>
      println(x)
      sender <span class="pl-k">!</span> <span class="pl-en">StreamFSM</span>.<span class="pl-en">Processed</span>
  }

}</pre>
  </div> 
  <p>The consumer is configured with an instance of <code>AkkaConsumerProps</code>, which looks like this.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">AkkaConsumerProps</span>[<span class="pl-en">Key</span>,<span class="pl-en">Msg</span>](system<span class="pl-k">:</span><span class="pl-en">ActorSystem</span>,
                                      actorRefFactory<span class="pl-k">:</span><span class="pl-en">ActorRefFactory</span>,
                                      connectorActorName<span class="pl-k">:</span><span class="pl-en">Option</span>[<span class="pl-k">String</span>],
                                      zkConnect<span class="pl-k">:</span><span class="pl-k">String</span>,
                                      topicFilterOrTopic<span class="pl-k">:</span><span class="pl-en">Either</span>[<span class="pl-en">TopicFilter</span>, <span class="pl-k">String</span>],
                                      group<span class="pl-k">:</span><span class="pl-k">String</span>,
                                      streams<span class="pl-k">:</span><span class="pl-k">Int</span>,
                                      keyDecoder<span class="pl-k">:</span><span class="pl-en">Decoder</span>[<span class="pl-en">Key</span>],
                                      msgDecoder<span class="pl-k">:</span><span class="pl-en">Decoder</span>[<span class="pl-en">Msg</span>],
                                      <span class="pl-v">msgHandler</span>: (<span class="pl-en">MessageAndMetadata</span>[<span class="pl-en">Key</span>,<span class="pl-en">Msg</span>]) <span class="pl-k">=&gt;</span> <span class="pl-en">Any</span>,
                                      <span class="pl-v">receiver</span>: <span class="pl-en">ActorRef</span>,
                                      maxInFlightPerStream<span class="pl-k">:</span><span class="pl-k">Int</span> <span class="pl-k">=</span> <span class="pl-c1">64</span>,
                                      startTimeout<span class="pl-k">:</span><span class="pl-en">Timeout</span> <span class="pl-k">=</span> <span class="pl-en">Timeout</span>(<span class="pl-c1">5</span> seconds),
                                      commitConfig<span class="pl-k">:</span><span class="pl-en">CommitConfig</span> <span class="pl-k">=</span> <span class="pl-en">CommitConfig</span>())

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">CommitConfig</span>(commitInterval<span class="pl-k">:</span><span class="pl-en">Option</span>[<span class="pl-en">FiniteDuration</span>] <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-c1">10</span> seconds),
                        commitAfterMsgCount<span class="pl-k">:</span><span class="pl-en">Option</span>[<span class="pl-k">Int</span>] <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-c1">10000</span>),
                        commitTimeout<span class="pl-k">:</span><span class="pl-en">Timeout</span> <span class="pl-k">=</span> <span class="pl-en">Timeout</span>(<span class="pl-c1">5</span> seconds))</pre>
  </div> 
  <p>there are 4 helper methods on the <code>AkkaConsumerProps object</code> that ease the construction of <code>AkkaConsumerProps</code>.</p> 
  <p>Use <code>AkkaConsumerProps.forSystem(system = ...)</code> when you only need a single connector in your application. The connector will be created as a top level actor.</p> 
  <p>Use <code>AkkaConsumerProps.forContext(context = ...)</code> when you want to have multiple connectors in your application, or you want the connector to be a child of one of your actors.</p> 
  <p>Use <code>AkkaConsumerProps.forSystemWithFilter(system = ...)</code> for using a TopicFilter, when you only need a single connector in your application. The connector will be created as a top level actor.</p> 
  <p>Use <code>AkkaConsumerProps.forContextWithFilter(context = ...)</code> for using a TopicFilter, when you want to have multiple connectors in your application, or you want the connector to be a child of one of your actors.</p> 
  <p>So a full example of getting a consumer up and running looks like this.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span>{<span class="pl-v">Props</span>, <span class="pl-v">ActorSystem</span>, <span class="pl-v">Actor</span>}
<span class="pl-k">import</span> <span class="pl-v">com.sclasen.akka.kafka.</span>{<span class="pl-v">AkkaConsumer</span>, <span class="pl-v">AkkaConsumerProps</span>, <span class="pl-v">StreamFSM</span>}
<span class="pl-k">import</span> <span class="pl-v">kafka.serializer.</span><span class="pl-v">DefaultDecoder</span>

<span class="pl-k">object</span> <span class="pl-en">Example</span> {
  <span class="pl-k">class</span> <span class="pl-en">Printer</span> <span class="pl-k">extends</span> <span class="pl-e">Actor</span>{
    <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
      <span class="pl-k">case</span> x<span class="pl-k">:</span><span class="pl-en">Any</span> <span class="pl-k">=&gt;</span>
        println(x)
        sender <span class="pl-k">!</span> <span class="pl-en">StreamFSM</span>.<span class="pl-en">Processed</span>
    }
  }

  <span class="pl-k">val</span> <span class="pl-en">system</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>)
  <span class="pl-k">val</span> <span class="pl-en">printer</span> <span class="pl-k">=</span> system.actorOf(<span class="pl-en">Props</span>[<span class="pl-en">Printer</span>])


  <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">  the consumer will have 4 streams and max 64 messages per stream in flight, for a total of 256</span>
<span class="pl-c">  concurrently processed messages.</span>
<span class="pl-c">  <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">consumerProps</span> <span class="pl-k">=</span> <span class="pl-en">AkkaConsumerProps</span>.forSystem(
    system <span class="pl-k">=</span> system,
    zkConnect <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>localhost:2181<span class="pl-pds">"</span></span>,
    topic <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-kafka-topic<span class="pl-pds">"</span></span>,
    group <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-consumer-group<span class="pl-pds">"</span></span>,
    streams <span class="pl-k">=</span> <span class="pl-c1">4</span>, <span class="pl-c"><span class="pl-c">//</span>one per partition</span>
    keyDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    msgDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    receiver <span class="pl-k">=</span> printer
  )

  <span class="pl-k">val</span> <span class="pl-en">consumer</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AkkaConsumer</span>(consumerProps)

  consumer.start()  <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is started</span>

  consumer.commit() <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when all in-flight messages are processed and offsets are committed.</span>

  consumer.stop()   <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is stopped.</span>

}</pre>
  </div> 
  <h1><a id="user-content-configure" class="anchor" href="https://github.com/sclasen/akka-kafka#configure" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>configure</h1> 
  <p>The <code>reference.conf</code> file is used to provide defaults for the properties used to configure the underlying kafka consumer.</p> 
  <p>To override any of these properties, use the standard akka <code>application.conf</code> mechanism.</p> 
  <p>Note that the property values must be strings, as that is how kafka expects them.</p> 
  <p>Do NOT set the <code>consumer.timeout.ms</code> to <code>-1</code>. This will break everything. Don't set <code>auto.commit.enable</code> either.</p> 
  <pre><code>kafka.consumer {
    zookeeper.connection.timeout.ms = "10000"
    auto.commit.enable = "false"
    zookeeper.session.timeout.ms = "1000"
    zookeeper.sync.time.ms =  "1000"
    consumer.timeout.ms =  "400"
}
</code></pre> 
  <h2><a id="user-content-akkabatchconsumer-1" class="anchor" href="https://github.com/sclasen/akka-kafka#akkabatchconsumer-1" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AkkaBatchConsumer</h2> 
  <p>To use this consumer you must provide it with an actorRef that will receive a Batch of messages from kafka, and will reply to the sender with <code>BatchConnectorFSM.BatchProcessed</code> after a batch has been successfully processed. If you do not reply in this way to every single batch received, the connector will not be able to commit the batch, and will hang.</p> 
  <p><code>AkkaBatchConsumerProps</code> has similar convenience methods to <code>AkkaConsumerProps</code></p> 
  <p>So a full example of getting a batch consumer up and running looks like this.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span>{<span class="pl-v">Props</span>, <span class="pl-v">ActorSystem</span>, <span class="pl-v">Actor</span>}
<span class="pl-k">import</span> <span class="pl-v">com.sclasen.akka.kafka.</span>{<span class="pl-v">AkkaBatchConsumer</span>, <span class="pl-v">AkkaBatchConsumerProps</span>, <span class="pl-v">BatchConnectorFSM</span>}
<span class="pl-k">import</span> <span class="pl-v">kafka.serializer.</span><span class="pl-v">DefaultDecoder</span>

<span class="pl-c"><span class="pl-c">//</span>object BatchExample {</span>
  <span class="pl-k">class</span> <span class="pl-en">BatchPrinter</span> <span class="pl-k">extends</span> <span class="pl-e">Actor</span>{
    <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
      <span class="pl-k">case</span> <span class="pl-en">MyBatch</span>(xs) <span class="pl-k">=&gt;</span>
        xs.foreach(println)
        sender <span class="pl-k">!</span> <span class="pl-en">BatchConnectorFSM</span>.<span class="pl-en">BatchProcessed</span>
    }
  }

  <span class="pl-k">type</span> <span class="pl-en">B</span> <span class="pl-k">=</span> <span class="pl-en">Array</span>[<span class="pl-k">Byte</span>]

  <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">MyBatch</span>(<span class="pl-v">msgs</span>: <span class="pl-en">IndexedSeq</span>[<span class="pl-k">String</span>])

  <span class="pl-c"><span class="pl-c">/*</span>provide a function that makes your batch object from an IndexedSeq of messages, if desired.<span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">makeBatch</span>(<span class="pl-v">msgs</span>: <span class="pl-en">IndexedSeq</span>[<span class="pl-k">String</span>])<span class="pl-k">:</span><span class="pl-en">MyBatch</span> <span class="pl-k">=</span> <span class="pl-en">MyBatch</span>(msgs)

  <span class="pl-c"><span class="pl-c">/*</span>provide a function that transforms the kafka message payload, if desired.<span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">messageHandler</span>(<span class="pl-v">msg</span>: <span class="pl-en">Array</span>[<span class="pl-k">Byte</span>])<span class="pl-k">:</span><span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">String</span>(msg)

  <span class="pl-k">val</span> <span class="pl-en">system</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>batchTest<span class="pl-pds">"</span></span>)
  <span class="pl-k">val</span> <span class="pl-en">printer</span> <span class="pl-k">=</span> system.actorOf(<span class="pl-en">Props</span>[<span class="pl-en">BatchPrinter</span>])


  <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">  the consumer will have 4 streams and accumulate a batch of up to 1000 messages before sending the batch.</span>
<span class="pl-c">  if no message is received for 1 second, the partial batch is sent instead.</span>
<span class="pl-c">  <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">consumerProps</span> <span class="pl-k">=</span> <span class="pl-en">AkkaBatchConsumerProps</span>.forSystem[<span class="pl-en">B</span>,<span class="pl-en">B</span>,<span class="pl-k">String</span>,<span class="pl-en">MyBatch</span>](
    system <span class="pl-k">=</span> system,
    zkConnect <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>localhost:2181<span class="pl-pds">"</span></span>,
    topic <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-kafka-topic<span class="pl-pds">"</span></span>,
    group <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-consumer-group<span class="pl-pds">"</span></span>,
    streams <span class="pl-k">=</span> <span class="pl-c1">4</span>, <span class="pl-c"><span class="pl-c">//</span>one per partition</span>
    keyDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    msgDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    msgHandler <span class="pl-k">=</span> messageHandler(_),
    batchHandler <span class="pl-k">=</span> makeBatch(_),
    receiver <span class="pl-k">=</span> printer
  )

  <span class="pl-k">val</span> <span class="pl-en">consumer</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AkkaBatchConsumer</span>(consumerProps)

  consumer.start()  <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is started</span>

  consumer.stop()   <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is stopped.</span>

}</pre>
  </div> 
  <h2><a id="user-content-akkadirectconsumer" class="anchor" href="https://github.com/sclasen/akka-kafka#akkadirectconsumer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AkkaDirectConsumer</h2> 
  <p>This consumer is based on <a href="https://cwiki.apache.org/confluence/display/KAFKA/Consumer+Group+Example" target="_blank">Kafka High Level Consumer</a>. This consumer creates <code>N</code> threads per topic where <code>N</code> = <code>streams</code>. Each thread will block on the iterator until a message becomes available. Messages are then forwarded to your receiving actor in the same manor.</p> 
  <p>This actor overrides settings for both:</p> 
  <pre><code>consumer.timeout.ms = "-1"
auto.commit.enable = "true"
</code></pre> 
  <p>This will not affect the configured values for other actors [AkkaBatchConsumer, AkkaConsumer] and thus you can use both styles of actors in the same project to fit your needs.</p> 
  <p>This consumer is suitable for low volume messages that require minimal latency (eg: Instant Messaging applications)</p> 
  <p>Some notes on blocking:</p> 
  <ul> 
   <li><a href="http://doc.akka.io/docs/akka/2.2.3/general/actor-systems.html#Blocking_Needs_Careful_Management" target="_blank">Blocking Needs Careful Management</a></li> 
  </ul> 
  <p><code>AkkaDirectConsumerProps</code> has similar convenience methods to <code>AkkaConsumerProps</code></p> 
  <p>So a full example of getting a high level consumer up and running looks like this.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.actor.</span>{<span class="pl-v">Props</span>, <span class="pl-v">ActorSystem</span>, <span class="pl-v">Actor</span>}
<span class="pl-k">import</span> <span class="pl-v">com.sclasen.akka.kafka.</span>{<span class="pl-v">AkkaDirectConsumer</span>, <span class="pl-v">AkkaDirectConsumerProps</span>}
<span class="pl-k">import</span> <span class="pl-v">kafka.serializer.</span><span class="pl-v">DefaultDecoder</span>

<span class="pl-k">object</span> <span class="pl-en">Example</span> {
  <span class="pl-k">class</span> <span class="pl-en">Printer</span> <span class="pl-k">extends</span> <span class="pl-e">Actor</span>{
    <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
      <span class="pl-k">case</span> x<span class="pl-k">:</span><span class="pl-en">Any</span> <span class="pl-k">=&gt;</span>
        println(x)
        sender <span class="pl-k">!</span> <span class="pl-en">StreamFSM</span>.<span class="pl-en">Processed</span>
    }
  }

  <span class="pl-k">val</span> <span class="pl-en">system</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>)
  <span class="pl-k">val</span> <span class="pl-en">printer</span> <span class="pl-k">=</span> system.actorOf(<span class="pl-en">Props</span>[<span class="pl-en">Printer</span>])

  <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">  the consumer will have 4 streams (threads that block per topic)</span>
<span class="pl-c">  <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">consumerProps</span> <span class="pl-k">=</span> <span class="pl-en">AkkaDirectConsumerProps</span>.forSystem(
    system <span class="pl-k">=</span> system,
    zkConnect <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>localhost:2181<span class="pl-pds">"</span></span>,
    topic <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-kafka-topic<span class="pl-pds">"</span></span>,
    group <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>your-consumer-group<span class="pl-pds">"</span></span>,
    streams <span class="pl-k">=</span> <span class="pl-c1">4</span>, <span class="pl-c"><span class="pl-c">//</span>one per partition</span>
    keyDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    msgDecoder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DefaultDecoder</span>(),
    receiver <span class="pl-k">=</span> printer
  )

  <span class="pl-k">val</span> <span class="pl-en">consumer</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AkkaConsumer</span>(consumerProps)

  consumer.start()  <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is started</span>

  consumer.stop()   <span class="pl-c"><span class="pl-c">//</span>returns a Future[Unit] that completes when the connector is stopped.</span>

}</pre>
  </div> 
  <h1><a id="user-content-develop" class="anchor" href="https://github.com/sclasen/akka-kafka#develop" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>develop</h1> 
  <p>Assumes you have forego installed. if not, <code>go get github.com/ddollar/forego</code></p> 
  <pre><code>./bin/setup         #installs kafka to ./kafka-install
cp .env.sample .env #used by forego to set your env vars
forego start        #starts zookeeper and kafka
</code></pre> 
  <p>In another shell</p> 
  <pre><code>forego run sbt
</code></pre> 
 </article>
</div>