<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-templatescala-" class="anchor" href="https://github.com/thoughtworksinc/template.scala#templatescala-" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>template.scala <a href="http://thoughtworks.com/" target="_blank"><img align="right" src="https://camo.githubusercontent.com/4e8bb83ad97ee6b683cb5529d8c5489e4927855a/68747470733a2f2f7777772e74686f75676874776f726b732e636f6d2f696d67732f74772d6c6f676f2e706e67" title="ThoughtWorks" height="15" data-canonical-src="https://www.thoughtworks.com/imgs/tw-logo.png" style="max-width:100%;"></a></h1> 
  <p><a href="https://gitter.im/ThoughtWorksInc/template.scala?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/9d6512ab12c5ac18774fa6f1d6f32290474bfbb9/68747470733a2f2f6261646765732e6769747465722e696d2f54686f75676874576f726b73496e632f74656d706c6174652e7363616c612e737667" alt="Join the chat at https://gitter.im/ThoughtWorksInc/template.scala" data-canonical-src="https://badges.gitter.im/ThoughtWorksInc/template.scala.svg" style="max-width:100%;"></a> <a href="https://travis-ci.org/ThoughtWorksInc/template.scala" target="_blank"><img src="https://camo.githubusercontent.com/0b921b7c77041374df6148cab6b975bf452a661e/68747470733a2f2f7472617669732d63692e6f72672f54686f75676874576f726b73496e632f74656d706c6174652e7363616c612e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/ThoughtWorksInc/template.scala.svg?branch=master" style="max-width:100%;"></a> <a href="https://index.scala-lang.org/thoughtworksinc/template.scala/template" target="_blank"><img src="https://camo.githubusercontent.com/960576ec4d8932b698b4d0897642f530d3c9497c/68747470733a2f2f696e6465782e7363616c612d6c616e672e6f72672f74686f75676874776f726b73696e632f74656d706c6174652e7363616c612f74656d706c6174652f6c61746573742e737667" alt="Latest version" data-canonical-src="https://index.scala-lang.org/thoughtworksinc/template.scala/template/latest.svg" style="max-width:100%;"></a></p> 
  <p><strong>template.scala</strong> is a library for creating inline functions, similar to C++ templates.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/thoughtworksinc/template.scala#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <div class="highlight highlight-source-scala">
   <pre>scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>2.12.1<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span> or "2.11.8"</span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.thoughtworks.template<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>template<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>latest.release<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-en">Provided</span>

addCompilerPlugin(<span class="pl-s"><span class="pl-pds">"</span>org.scalameta<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>paradise<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>3.0.0-M7<span class="pl-pds">"</span></span> cross <span class="pl-en">CrossVersion</span>.full)</pre>
  </div> 
  <p>A template function is created with a <code>@template</code> annotation.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">@</span>template
<span class="pl-k">def</span> <span class="pl-en">max</span>(<span class="pl-v">x</span>: <span class="pl-en">Any</span>, <span class="pl-v">y</span>: <span class="pl-en">Any</span>) <span class="pl-k">=</span> {
  <span class="pl-k">if</span> (x <span class="pl-k">&gt;</span> y) x <span class="pl-k">else</span> y
}</pre>
  </div> 
  <p>Unlike normal functions, a template function will not be type-checked until using it. Thus it does not raise a type error on <code>x &gt; y</code> because the real types of <code>x</code> and <code>y</code> have not been determined.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">i</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span> max(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
<span class="pl-k">val</span> <span class="pl-en">d</span><span class="pl-k">:</span> <span class="pl-k">Double</span> <span class="pl-k">=</span> max(<span class="pl-c1">8.0</span>, <span class="pl-c1">0.5</span>)</pre>
  </div> 
  <p>The <code>max</code> function will be type-checkd and inlined whenever being invoked.</p> 
  <p>If the type of <code>x</code> does not support <code>&gt;</code> method, it does not compile:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">s</span><span class="pl-k">:</span> <span class="pl-k">Symbol</span> <span class="pl-k">=</span> max(<span class="pl-en">'foo</span>, <span class="pl-en">'bar</span>)</pre>
  </div> 
  <pre><code>&lt;macro&gt;:1: value &gt; is not a member of Symbol
def max(x: Any, y: Any) = if (x &gt; y) x else y
                                ^
</code></pre> 
  <h2><a id="user-content-side-effects" class="anchor" href="https://github.com/thoughtworksinc/template.scala#side-effects" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Side effects</h2> 
  <p>By default, the side effects in arguments of <code>@template</code> functions will be evaluated before the execution of the function body. For example:</p> 
  <div class="highlight highlight-source-scala">
   <pre>max({
  println(<span class="pl-s"><span class="pl-pds">"</span>x = 1<span class="pl-pds">"</span></span>)
  <span class="pl-c1">1</span>
}, {
  println(<span class="pl-s"><span class="pl-pds">"</span>y = 2<span class="pl-pds">"</span></span>)
  <span class="pl-c1">2</span>
})</pre>
  </div> 
  <p>The output is</p> 
  <div class="highlight highlight-source-scala">
   <pre>x <span class="pl-k">=</span> <span class="pl-c1">1</span>
y <span class="pl-k">=</span> <span class="pl-c1">2</span></pre>
  </div> 
  <p>However, you can use call-by-name parameter to force the side effects re-evaluate whenever the argument is referenced. For example:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">@</span>template
<span class="pl-k">def</span> <span class="pl-en">callByNameMax</span>(<span class="pl-v">x</span>: <span class="pl-k">=&gt;</span> <span class="pl-en">Any</span>, <span class="pl-v">y</span>: <span class="pl-k">=&gt;</span> <span class="pl-en">Any</span>) <span class="pl-k">=</span> {
  <span class="pl-k">if</span> (x <span class="pl-k">&gt;</span> y) x <span class="pl-k">else</span> y
}

callByNameMax({
  println(<span class="pl-s"><span class="pl-pds">"</span>x = 1<span class="pl-pds">"</span></span>)
  <span class="pl-c1">1</span>
}, {
  println(<span class="pl-s"><span class="pl-pds">"</span>y = 2<span class="pl-pds">"</span></span>)
  <span class="pl-c1">2</span>
})</pre>
  </div> 
  <p>The output is</p> 
  <div class="highlight highlight-source-scala">
   <pre>x <span class="pl-k">=</span> <span class="pl-c1">1</span>
y <span class="pl-k">=</span> <span class="pl-c1">2</span>
y <span class="pl-k">=</span> <span class="pl-c1">2</span></pre>
  </div> 
  <h2><a id="user-content-recursive-template-functions" class="anchor" href="https://github.com/thoughtworksinc/template.scala#recursive-template-functions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Recursive template functions</h2> 
  <p>Template functions can be recursive, as long as the number of calls are finite and can be determined at compile-time.</p> 
  <p>The following code creates a heterogeneous list.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">HList</span> {

  <span class="pl-k">final</span> <span class="pl-k">def</span> <span class="pl-en">::</span>(<span class="pl-v">head</span>: <span class="pl-en">Any</span>)<span class="pl-k">:</span> head.<span class="pl-k">type</span> <span class="pl-en">::</span> <span class="pl-c1">this</span>.type <span class="pl-k">=</span> {
    new (head.<span class="pl-k">type</span> <span class="pl-en">::</span> <span class="pl-c1">this</span>.type)(head, <span class="pl-c1">this</span>)
  }

}

<span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">HNil</span> <span class="pl-k">extends</span> <span class="pl-e">HList</span>

<span class="pl-k">final</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">::</span>[<span class="pl-en">Head</span>, <span class="pl-en">Tail</span> <span class="pl-k">&lt;</span><span class="pl-k">:</span> <span class="pl-en">HList</span>](<span class="pl-v">head</span>: <span class="pl-en">Head</span>, <span class="pl-v">tail</span>: <span class="pl-en">Tail</span>) <span class="pl-k">extends</span> <span class="pl-e">HList</span> {
  <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">i</span>: <span class="pl-c1">0</span>)<span class="pl-k">:</span> head.type <span class="pl-k">=</span> {
    head
  }

  <span class="pl-k">@</span>template
  <span class="pl-k">def</span> <span class="pl-en">apply</span>(<span class="pl-v">i</span>: <span class="pl-k">Int</span> <span class="pl-k">with</span> <span class="pl-e">Singleton):</span> <span class="pl-en">Any</span> <span class="pl-k">=</span> {
    tail(i <span class="pl-k">-</span> <span class="pl-c1">1</span>)
  }

}</pre>
  </div> 
  <p>Then you can index elements in the HList via template function <code>apply</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">hlist</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span> <span class="pl-k">::</span> <span class="pl-c1">1</span> <span class="pl-k">::</span> <span class="pl-c1">false</span> <span class="pl-k">::</span> <span class="pl-en">HNil</span>

<span class="pl-k">val</span> <span class="pl-en">s</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> hlist(<span class="pl-c1">0</span>)
<span class="pl-k">val</span> <span class="pl-en">i</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span> hlist(<span class="pl-c1">1</span>)
<span class="pl-k">val</span> <span class="pl-en">b</span><span class="pl-k">:</span> <span class="pl-k">Boolean</span> <span class="pl-k">=</span> hlist(<span class="pl-c1">2</span>)

hlist(<span class="pl-c1">3</span>) <span class="pl-c"><span class="pl-c">//</span> Compile error</span></pre>
  </div> 
  <p>Note that the above <code>HList</code> code need <a href="http://typelevel.org/scala/" target="_blank">TypeLevel Scala</a> and <a href="http://docs.scala-lang.org/sips/pending/42.type.html" target="_blank"><code>-Yliteral-types</code></a> flag.</p> 
  <h2><a id="user-content-limitations" class="anchor" href="https://github.com/thoughtworksinc/template.scala#limitations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Limitations</h2> 
  <ul> 
   <li><code>@template</code> functions always inline, never sharing similar implementations like C++ templates.</li> 
   <li><code>@template</code> functions do not support type parameters. You can create type aliases instead. See <a href="https://github.com/ThoughtWorksInc/template.scala/blob/53121bc7dd42de0b933a1b2ef6ac882b4d06c12d/src/test/scala/com/thoughtworks/templateSpec.scala#L120" target="_blank">the test case</a> for example.</li> 
   <li>Recursive <code>@template</code> functions must be resolved at compile-time.</li> 
  </ul> 
 </article>
</div>