<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-featurebee-for-scala" class="anchor" href="https://github.com/autoscout24/featurebee-scala#featurebee-for-scala" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>FeatureBee For Scala</h1> 
  <p>FeatureBee client for Scala applications</p> 
  <h2><a id="user-content-status" class="anchor" href="https://github.com/autoscout24/featurebee-scala#status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Status</h2> 
  <p><a href="https://travis-ci.org/AutoScout24/featurebee-scala" target="_blank"><img src="https://camo.githubusercontent.com/cddf7fe0529d34d2b478c04b2c5e9aaf79c09204/68747470733a2f2f7472617669732d63692e6f72672f4175746f53636f757432342f666561747572656265652d7363616c612e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/AutoScout24/featurebee-scala.svg" style="max-width:100%;"></a> <a href="https://coveralls.io/r/AutoScout24/featurebee-scala" target="_blank"><img src="https://camo.githubusercontent.com/b7a0c9a4e93203eee95ad0a8b8528d6a09f96ffc/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f4175746f53636f757432342f666561747572656265652d7363616c612f62616467652e737667" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/AutoScout24/featurebee-scala/badge.svg" style="max-width:100%;"></a> <a href="https://bintray.com/tatsu-kondor/maven/featurebee/_latestVersion" target="_blank"><img src="https://camo.githubusercontent.com/1798a896dd94e9bbb6bf72c99597832b9296d93c/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f74617473752d6b6f6e646f722f6d6176656e2f666561747572656265652f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/tatsu-kondor/maven/featurebee/images/download.svg" style="max-width:100%;"> </a></p> 
  <h2><a id="user-content-setup" class="anchor" href="https://github.com/autoscout24/featurebee-scala#setup" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Setup</h2> 
  <p>Add to your <code>build.sbt</code> following resolver with dependency:</p> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.bintrayRepo(<span class="pl-s"><span class="pl-pds">"</span>tatsu-kondor<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>maven<span class="pl-pds">"</span></span>)

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.autoscout24<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>featurebee<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>(see version number above)<span class="pl-pds">"</span></span>,
                       <span class="pl-s"><span class="pl-pds">"</span>com.autoscout24<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>featurebee-s3-registry<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>(see version number above)<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span> if you want the S3 and the reloading feature registry</span></pre>
  </div> 
  <p>Now you can use FeatureBee library.</p> 
  <h2><a id="user-content-how-to-use" class="anchor" href="https://github.com/autoscout24/featurebee-scala#how-to-use" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How To Use</h2> 
  <p>Write a Features trait to access all your features in one place, e.g.:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">Features</span> {
  <span class="pl-k">def</span> <span class="pl-en">languageDropdown</span><span class="pl-k">:</span> <span class="pl-en">Feature</span>
  <span class="pl-k">def</span> <span class="pl-en">survey</span><span class="pl-k">:</span> <span class="pl-en">Feature</span>
}

<span class="pl-k">object</span> <span class="pl-en">Features</span> <span class="pl-k">extends</span> <span class="pl-e">Features</span> {
  <span class="pl-k">private</span> <span class="pl-k">implicit</span> <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">featureRegistry</span> <span class="pl-k">=</span> <span class="pl-en">StaticJsonFeatureRegistry</span>(<span class="pl-s"><span class="pl-pds">"</span>featureBee.json<span class="pl-pds">"</span></span>)
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">languageDropdown</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>language-dropdown<span class="pl-pds">"</span></span>).getOrElse(<span class="pl-en">AlwaysOffFeature</span>)
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">survey</span> <span class="pl-k">=</span> <span class="pl-en">Feature</span>(<span class="pl-s"><span class="pl-pds">"</span>survey<span class="pl-pds">"</span></span>).getOrElse(<span class="pl-en">AlwaysOffFeature</span>)
}</pre>
  </div> 
  <p>Hint: If you want a dynamic S3 based json file registry, see farther below.</p> 
  <p>Add file <code>featureBee.json</code> at your <code>resources</code> or <code>conf</code> folder with <code>JSON</code> that explains behaviour of your feature flags, for example:</p> 
  <div class="highlight highlight-source-json">
   <pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>survey<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Enables survey<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>tags<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>our-team<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>awesome-feature<span class="pl-pds">"</span></span>],
    <span class="pl-s"><span class="pl-pds">"</span>activation<span class="pl-pds">"</span></span>: [{ <span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>}]
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>language-dropdown<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Shows language dropdown<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>tags<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>our-team<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>awesome-feature<span class="pl-pds">"</span></span>],
    <span class="pl-s"><span class="pl-pds">"</span>activation<span class="pl-pds">"</span></span>: [{ <span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>}]
  }
]</pre>
  </div> 
  <p>For deatil information regarding format of <code>JSON</code> see <a href="https://github.com/autoscout24/featurebee-scala#contract" target="_blank">Contract</a> paragraph.</p> 
  <p>Write a support object which defines how the request from the client is used to extract relevant feature toggle info, like e.g. the language or the browser. For Play apps you may use the already defined <code>PlayClientInfoSupport</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">ControllerClientInfoSupport</span> {
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">requestToClientInfo</span>(<span class="pl-k">implicit</span> <span class="pl-v">requestHeader</span>: <span class="pl-en">RequestHeader</span>)<span class="pl-k">:</span> <span class="pl-en">ClientInfo</span> <span class="pl-k">=</span> {
    <span class="pl-k">import</span> <span class="pl-v">PlayClientInfoSupport.</span><span class="pl-v">_</span>
    <span class="pl-en">ClientInfoImpl</span>(userAgent, localeFromCookieValue(<span class="pl-s"><span class="pl-pds">"</span>culture<span class="pl-pds">"</span></span>), uuidFromCookieValue(<span class="pl-s"><span class="pl-pds">"</span>as24Visitor<span class="pl-pds">"</span></span>), forcedFeatureToggle)
  }
}  </pre>
  </div> 
  <p>Currently only a static json file inside your deployment is supported, see Contract section below. See the usage of <code>StaticJsonFeatureRegistry</code> above for infos how you specify the location of the feature config file.</p> 
  <h2><a id="user-content-forced-feature-toggling-godmode" class="anchor" href="https://github.com/autoscout24/featurebee-scala#forced-feature-toggling-godmode" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Forced Feature Toggling (GodMode)</h2> 
  <p>If you use the <code>PlayClientInfoSupport</code>, you may force feature activation regardless of the conditions you specify in your <code>JSON</code> feature config by setting a query param, a request Header, or a cookie. This order of mentioning the variants is also the order of precedence, so query param has precedence over cookie. All the keys are case insensitive.</p> 
  <p><em>IMPORTANT</em>: Please be aware that GodMode will work even if that Feature is not defined in the Registry or the Registry fails to load. This means that <code>AlwaysOnFeature</code>/<code>AlwaysOffFeature</code> objects will be overridden by the GodMode.</p> 
  <h3><a id="user-content-query-param" class="anchor" href="https://github.com/autoscout24/featurebee-scala#query-param" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Query Param</h3> 
  <p>Use query param <code>featurebee</code> to specify forced / god mode activation of features:</p> 
  <pre><code>http://yourUrl?featurebee=feature1%3Dtrue%7Cfeature2%3Dfalse 
</code></pre> 
  <p>Which decodes to:</p> 
  <pre><code>http://yourUrl?featurebee=feature1=true|feature2=false)
</code></pre> 
  <p><code>=</code> is used to assign the <code>true</code> / <code>false</code> value to a feature with the given name and <code>|</code> is used to separate the different features from each other. So we need URL encoding here, so the above forced feature string would decode to:</p> 
  <pre><code>feature1=true|feature2=false
</code></pre> 
  <h3><a id="user-content-request-header" class="anchor" href="https://github.com/autoscout24/featurebee-scala#request-header" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request Header</h3> 
  <p>Use header name <code>featurebee</code> or <code>X-Featurebee</code> (case insensitiv) to specify the forced / god mode feature activation. </p> 
  <p>Example request header value:</p> 
  <pre><code>feature1=true|feature2=false
</code></pre> 
  <h3><a id="user-content-cookie" class="anchor" href="https://github.com/autoscout24/featurebee-scala#cookie" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Cookie</h3> 
  <p>Use a cookie with name <code>featurebee</code> to specify the forced/god mode feature activation.</p> 
  <p>Example cookie value:</p> 
  <pre><code>feature1=true|feature2=false
</code></pre> 
  <h2><a id="user-content-contract" class="anchor" href="https://github.com/autoscout24/featurebee-scala#contract" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contract</h2> 
  <p>The FeatureBee Server returns a list of all defined features.</p> 
  <div class="highlight highlight-source-json">
   <pre>[{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Name of the Feature<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Some additional description<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>tags<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>Team Name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Or Service name<span class="pl-pds">"</span></span>],
  <span class="pl-s"><span class="pl-pds">"</span>activation<span class="pl-pds">"</span></span>: [{<span class="pl-s"><span class="pl-pds">"</span>culture<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>de-DE<span class="pl-pds">"</span></span>]}]
}]</pre>
  </div> 
  <p>Conditions is an array of type and values. Supported types are <code>default</code>, <code>culture</code>, <code>userAgentFragments</code> and <code>trafficDistribution</code>. </p> 
  <p>Each condition can have its own format how the values should look like. Each condition could have multiple values. All conditions have to be fulfilled (logical AND). </p> 
  <h3><a id="user-content-format-of-conditions" class="anchor" href="https://github.com/autoscout24/featurebee-scala#format-of-conditions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Format of conditions</h3> 
  <ul> 
   <li><code>default</code>: JSON Boolean (<code>true</code> or <code>false</code>) or JSON String (<code>"on"</code> or <code>"off"</code>) This defines a default ON or OFF activation of the feature for all clients. This state/activation may be overwritten by using god mode/forced feature toggling <em>IMPORTANT</em>: Please be aware that god mode only works if the feature is defined in the registry, i.e. the json in classpath or S3 contains the given feature. If the feature is NOT present, and you define your features like above <code>override def languageDropdown = Feature("language-dropdown").getOrElse(AlwaysOffFeature)</code> then the state defined by getOrElse(STATE) wins and forcing the feature to a specific state will not work. So this is a big difference between defining the default state of the feature in code with getOrElse and the default condition in the JSON! 
    <ul> 
     <li>Examples: 
      <ul> 
       <li><code>{ "default": true }</code> or <code>{ "default": false }</code> </li> 
       <li><code>{ "default": "on" }</code> or <code>{ "default": "off" }</code></li> 
      </ul></li> 
    </ul></li> 
   <li><code>culture</code>: JSON Array of Strings in the form <code>"lang-COUNTRY"</code> or <code>"lang"</code> (only lower case) or <code>"COUNTRY"</code> (only upper case) 
    <ul> 
     <li>Examples: 
      <ul> 
       <li><code>{ "culture": ["de-AT"] }</code> </li> 
       <li><code>{ "culture": ["AT"] }</code> </li> 
       <li><code>{ "culture": ["de"] }</code> </li> 
       <li><code>{ "culture": ["de-DE", "de-AT] }</code> </li> 
      </ul></li> 
    </ul></li> 
   <li><code>userAgentFragments</code>: JSON Array of Strings that must be contained in the user agent 
    <ul> 
     <li>Example: <code>{"userAgentFragments": ["Firefox"]}</code></li> 
    </ul></li> 
   <li><code>trafficDistribution</code>: JSON Array or a single JSON String in the from <code>"FROM-TO"</code> where <code>TO</code> &gt; <code>FROM</code> and <code>1 &lt;= FROM,TO &lt;= 100</code>. Be aware that in the standard impl of PlayClientInfoSupport this is derived by looking at a cookie value which is expected to be a UUID. If this cookie is not present, a random UUID is generated which means that the feature using trafficDistribution will not be stable for this client! 
    <ul> 
     <li>Examples: 
      <ul> 
       <li><code>{ "trafficDistribution": "1-100" }</code> </li> 
       <li><code>{ "trafficDistribution": "51-100" }</code> </li> 
       <li><code>{ "trafficDistribution": "1-20" }</code> </li> 
       <li><code>{ "trafficDistribution": ["1-20", "80-85"] }</code></li> 
      </ul></li> 
    </ul></li> 
  </ul> 
  <p>The <code>JSON</code> has to fulfill the following requirements:</p> 
  <ul> 
   <li>Name must be set and unique</li> 
   <li>activation must contain at least one condition</li> 
   <li>description is mandatory</li> 
   <li>tags are optional</li> 
  </ul> 
  <h2><a id="user-content-reloadable-feature-registry-based-on-files-in-s3" class="anchor" href="https://github.com/autoscout24/featurebee-scala#reloadable-feature-registry-based-on-files-in-s3" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Reloadable Feature Registry based on files in S3</h2> 
  <p>Featurebee supports dynamic, periodic re-loading of the feature registry from a S3 bucket possibly containing several feature json files in the format as described above. For that to work you it's best to move the creation of the FeatureRegistry to the play guice context. </p> 
  <p>S3 loading is supplied by S3JsonFeatureRegistry and the reloading feature is implemented by ReloadingFeatureRegistry.</p> 
  <h3><a id="user-content-reloadingfeatureregistry" class="anchor" href="https://github.com/autoscout24/featurebee-scala#reloadingfeatureregistry" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ReloadingFeatureRegistry</h3> 
  <p>ReloadingFeatureRegistry inspects the last modification date of the inital and the re-creator function, adds the activationDelay duration to it and activates the registry on the resulting point in time. With that approach it should be possible to achieve that all instances of a service activate a new feature registry at the same time and by that minimizing the problems experienced by end users. Would the instances switch the registry at different points in time some problems in their experience could arise.</p> 
  <p>See below for an example to enable periodic reloading of feature json files from S3.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">java.time.</span><span class="pl-v">LocalDateTime</span>
<span class="pl-k">import</span> <span class="pl-v">java.util.concurrent.</span><span class="pl-v">Executors</span>
<span class="pl-k">import</span> <span class="pl-v">akka.actor.</span><span class="pl-v">ActorSystem</span>
<span class="pl-k">import</span> <span class="pl-v">com.amazonaws.services.s3.</span><span class="pl-v">AmazonS3Client</span>
<span class="pl-k">import</span> <span class="pl-v">com.autoscout24.classifiedlist.TypedEvents.</span>{<span class="pl-v">FeatureRegistryLoadedFromS3WithIgnoredErrors</span>, <span class="pl-v">FeatureRegistryLoadingFromS3Failed</span>, <span class="pl-v">FeatureRegistrySuccessfullyLoadedFromS3</span>}
<span class="pl-k">import</span> <span class="pl-v">com.autoscout24.eventpublisher24.events.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.google.inject.</span>{<span class="pl-v">AbstractModule</span>, <span class="pl-v">Provides</span>, <span class="pl-v">Singleton</span>}
<span class="pl-k">import</span> <span class="pl-v">featurebee.api.</span><span class="pl-v">FeatureRegistry</span>
<span class="pl-k">import</span> <span class="pl-v">featurebee.registry.</span><span class="pl-v">DefaultFeatureValueFeatureRegistry</span>
<span class="pl-k">import</span> <span class="pl-v">featurebee.registry.s3.S3JsonFeatureRegistry.</span><span class="pl-v">S3File</span>
<span class="pl-k">import</span> <span class="pl-v">featurebee.registry.s3.</span>{<span class="pl-v">ReloadingFeatureRegistry</span>, <span class="pl-v">S3JsonFeatureRegistry</span>}
<span class="pl-k">import</span> <span class="pl-v">org.scalactic.</span>{<span class="pl-v">Bad</span>, <span class="pl-v">Good</span>}
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">ExecutionContext</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">scala.language.</span><span class="pl-v">postfixOps</span>

<span class="pl-k">class</span> <span class="pl-en">FeatureRegistryModule</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractModule</span> {

  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">bucketName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>as24prod-features-eu-west-1<span class="pl-pds">"</span></span>

  <span class="pl-k">def</span> <span class="pl-en">configure</span>() <span class="pl-k">=</span> {}

  <span class="pl-k">@</span><span class="pl-en">Provides</span>
  <span class="pl-k">@</span><span class="pl-en">Singleton</span>
  <span class="pl-k">def</span> <span class="pl-en">s3Client</span>(<span class="pl-v">configuration</span>: <span class="pl-en">Configuration</span>)<span class="pl-k">:</span> <span class="pl-en">AmazonS3Client</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AmazonS3Client</span>()

  <span class="pl-k">@</span><span class="pl-en">Provides</span>
  <span class="pl-k">@</span><span class="pl-en">Singleton</span>
  <span class="pl-k">def</span> <span class="pl-en">featureRegistry</span>(<span class="pl-v">amazonS3Client</span>: <span class="pl-en">AmazonS3Client</span>, <span class="pl-v">actorSystem</span>: <span class="pl-en">ActorSystem</span>, <span class="pl-v">eventPublisher</span>: <span class="pl-en">TypedEventPublisher</span>)<span class="pl-k">:</span> <span class="pl-en">FeatureRegistry</span> <span class="pl-k">=</span> {

    <span class="pl-k">val</span> <span class="pl-en">initialRegistry</span> <span class="pl-k">=</span> s3FeatureRegistry(amazonS3Client, eventPublisher) <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>((registry, lastModified)) <span class="pl-k">=&gt;</span> (registry, lastModified)
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span> (<span class="pl-en">DefaultFeatureValueFeatureRegistry</span>, <span class="pl-en">LocalDateTime</span>.<span class="pl-en">MIN</span>)
    }

    <span class="pl-k">new</span> <span class="pl-en">ReloadingFeatureRegistry</span>(initialRegistry, () <span class="pl-k">=&gt;</span> s3FeatureRegistry(amazonS3Client, eventPublisher),
      actorSystem.scheduler, reloadAfter <span class="pl-k">=</span> <span class="pl-c1">2</span> minutes, activationDelay <span class="pl-k">=</span> <span class="pl-c1">2</span> min <span class="pl-c1">10</span> seconds, singleThreadExecContext
    )
  }

  <span class="pl-c"><span class="pl-c">//</span> S3 Feature registry returns a merge of all feature json files and the latest modification date of all of them</span>
  <span class="pl-c"><span class="pl-c">//</span> in case of failures it returns None</span>
  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">s3FeatureRegistry</span><span class="pl-k">:</span> (<span class="pl-en">AmazonS3Client</span>, <span class="pl-en">TypedEventPublisher</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">Option</span>[(<span class="pl-en">FeatureRegistry</span>, <span class="pl-en">LocalDateTime</span>)] <span class="pl-k">=</span> {
    (amazonS3Client, eventPublisher) <span class="pl-k">=&gt;</span>
      <span class="pl-en">S3JsonFeatureRegistry</span>(
        <span class="pl-en">Seq</span>(
          <span class="pl-en">S3File</span>(bucketName, <span class="pl-s"><span class="pl-pds">"</span>classified-list-featurebee.json<span class="pl-pds">"</span></span>, ignoreOnFailures <span class="pl-k">=</span> <span class="pl-c1">false</span>),
          <span class="pl-en">S3File</span>(bucketName, <span class="pl-s"><span class="pl-pds">"</span>classified-list-gecloud-featurebee.json<span class="pl-pds">"</span></span>, ignoreOnFailures <span class="pl-k">=</span> <span class="pl-c1">true</span>)
        )
      )(amazonS3Client) <span class="pl-k">match</span> {
        <span class="pl-k">case</span> <span class="pl-en">Good</span>(featureRegistryBuilt) <span class="pl-k">=&gt;</span>
          <span class="pl-k">val</span> <span class="pl-en">errorString</span> <span class="pl-k">=</span> featureRegistryBuilt.failedIgnoredFiles.map(_.toString)
          <span class="pl-k">if</span> (errorString.nonEmpty) eventPublisher.publish(<span class="pl-en">FeatureRegistryLoadedFromS3WithIgnoredErrors</span>(errorString))
          <span class="pl-k">else</span> eventPublisher.publish(<span class="pl-en">FeatureRegistrySuccessfullyLoadedFromS3</span>())
          <span class="pl-en">Some</span>((featureRegistryBuilt.featureRegistry, featureRegistryBuilt.lastModified))

        <span class="pl-k">case</span> <span class="pl-en">Bad</span>(errors) <span class="pl-k">=&gt;</span>
          eventPublisher.publish(<span class="pl-en">FeatureRegistryLoadingFromS3Failed</span>(errors.mkString(<span class="pl-s"><span class="pl-pds">"</span>The following errors occured loading the features from S3<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>;<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)))
          <span class="pl-c1">None</span>
      }
  }

  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">singleThreadExecContext</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ExecutionContext</span> {
    <span class="pl-k">val</span> <span class="pl-en">threadPool</span> <span class="pl-k">=</span> <span class="pl-en">Executors</span>.newFixedThreadPool(<span class="pl-c1">1</span>)
    <span class="pl-k">def</span> <span class="pl-en">execute</span>(<span class="pl-v">runnable</span>: <span class="pl-en">Runnable</span>) { threadPool.submit(runnable) }
    <span class="pl-k">def</span> <span class="pl-en">reportFailure</span>(<span class="pl-v">t</span>: <span class="pl-en">Throwable</span>) {}
  }
}</pre>
  </div> 
  <p>Please note that you are able to define files that don't break the reloading in case of errors (ignoreOnFailures). With that you are able to separate features for downstream fragments (see below) and you're own features in two files with possibly different access policies and/or failure handling (ignore or not, as in above example)</p> 
  <h2><a id="user-content-fragment-services--features" class="anchor" href="https://github.com/autoscout24/featurebee-scala#fragment-services--features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Fragment Services &amp; Features</h2> 
  <p>When working with Fragments you may need to pass the feature toggles through to Fragment Service.</p> 
  <p>To do this you can define the services your feature is required in. From there you can call the Feature Registry and get the Feature String for a particular service.</p> 
  <p>e.g:</p> 
  <div class="highlight highlight-source-json">
   <pre>[{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>name-of-the-feature<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Some additional description<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>tags<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>Team Name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Or Service name<span class="pl-pds">"</span></span>],
  <span class="pl-s"><span class="pl-pds">"</span>activation<span class="pl-pds">"</span></span>: [{<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>}],
  <span class="pl-s"><span class="pl-pds">"</span>services<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>content-service<span class="pl-pds">"</span></span>]
},
{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>name-of-another-feature<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Some other description<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>tags<span class="pl-pds">"</span></span>: [<span class="pl-s"><span class="pl-pds">"</span>Team Name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Or Service name<span class="pl-pds">"</span></span>],
  <span class="pl-s"><span class="pl-pds">"</span>activation<span class="pl-pds">"</span></span>: [{<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>}],
  <span class="pl-s"><span class="pl-pds">"</span>services<span class="pl-pds">"</span></span>: []
}]</pre>
  </div> 
  <p>Where you are including your fragment you can now do:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">featureString</span> <span class="pl-k">=</span> featureRegistry.featureStringForService(<span class="pl-s"><span class="pl-pds">"</span>content-service<span class="pl-pds">"</span></span>)
<span class="pl-k">@</span><span class="pl-en">Html</span>(s<span class="pl-s"><span class="pl-pds">"""</span>&lt;!--#include virtual="/fragment/contentservice/header.html?featurebee=${featureString}" --&gt;<span class="pl-pds">"""</span></span>)</pre>
  </div> 
  <p>This will only pass across the appropriate features to the fragment service. e.g:</p> 
  <p><code>/fragment/contentservice/header.html?featurebee=name-of-the-feature=true</code></p> 
  <h2><a id="user-content-copyright" class="anchor" href="https://github.com/autoscout24/featurebee-scala#copyright" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Copyright</h2> 
  <p>Copyright (C) 2016 AutoScout24 GmbH.</p> 
  <p>Distributed under the MIT License.</p> 
 </article>
</div>