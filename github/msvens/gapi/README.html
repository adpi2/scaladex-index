<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-gapi" class="anchor" href="https://github.com/msvens/gapi#gapi" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>GAPI</h1> 
  <p><a href="https://travis-ci.org/msvens/gapi" target="_blank"><img src="https://camo.githubusercontent.com/7dc3fba72a096f9caa0b426d75bc79649071d580/68747470733a2f2f7472617669732d63692e6f72672f6d7376656e732f676170692e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/msvens/gapi.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/org.mellowtech/gapi_2.12" target="_blank"><img src="https://camo.githubusercontent.com/2222d1ad03d1e0050b322d82c55b53280d256362/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f6f72672e6d656c6c6f77746563682f676170695f322e31322e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/org.mellowtech/gapi_2.12.svg" style="max-width:100%;"></a></p> 
  <h2><a id="user-content-overview" class="anchor" href="https://github.com/msvens/gapi#overview" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Overview</h2> 
  <p>Scala wrapper for Google APIs - specifically drive. Focus is on making it simple to do common tasks such as listing files, creating folders, etc while still offering full access to the underlying Google APIs.</p> 
  <p>GAPI also simplifies the auth process for installed applications and akka-http based servers</p> 
  <h3><a id="user-content-installation" class="anchor" href="https://github.com/msvens/gapi#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h3> 
  <p>TBW</p> 
  <h3><a id="user-content-configuration" class="anchor" href="https://github.com/msvens/gapi#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h3> 
  <p>TBW</p> 
  <h3><a id="user-content-authenticate-from-a-server" class="anchor" href="https://github.com/msvens/gapi#authenticate-from-a-server" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Authenticate from a server</h3> 
  <p>Check out the full source code in <a href="https://github.com/msvens/gapi/blob/master/serverexample/src/main/scala/org/mellowtech/gapi/example/server/ServerApp.scala" target="_blank">ServerApp.scala</a></p> 
  <p>The following description assumes familiarity with <a href="http://doc.akka.io/docs/akka-http/current/scala/http/index.html" target="_blank">akka-http</a></p> 
  <p>First we create a an object that will serve as our example akka server.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">ServerApp</span> {

  <span class="pl-k">import</span> <span class="pl-v">Directives.</span><span class="pl-v">_</span>
  <span class="pl-k">import</span> <span class="pl-v">org.mellowtech.gapi.GApiImplicits.</span><span class="pl-v">_</span>

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">actorSystem</span> <span class="pl-k">=</span> <span class="pl-en">ActorSystem</span>()
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">executor</span><span class="pl-k">:</span> <span class="pl-en">ExecutionContext</span> <span class="pl-k">=</span> actorSystem.dispatcher
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">log</span><span class="pl-k">:</span> <span class="pl-en">LoggingAdapter</span> <span class="pl-k">=</span> <span class="pl-en">Logging</span>(actorSystem, getClass)
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">materializer</span><span class="pl-k">:</span> <span class="pl-en">ActorMaterializer</span> <span class="pl-k">=</span> <span class="pl-en">ActorMaterializer</span>()
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">conf</span><span class="pl-k">:</span> <span class="pl-en">GApiConfig</span> <span class="pl-k">=</span> <span class="pl-en">GApiConfig</span>()
}</pre>
  </div> 
  <p>Next we instantiate our database service. This is needed to store tokens. GApi uses slick so you need to provide a slick configuration (see above).</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">dbService</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DbService</span>
<span class="pl-k">val</span> <span class="pl-en">tokenDAO</span><span class="pl-k">:</span> <span class="pl-en">TokenService</span> <span class="pl-k">=</span> <span class="pl-en">TokenDAO</span>(dbService)</pre>
  </div> 
  <p>Next we setup our router for google as well as the callback to store the token in our Db.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">ServerCallback</span>(<span class="pl-k">val</span> <span class="pl-en">tokenService</span><span class="pl-k">:</span> <span class="pl-en">TokenService</span>) <span class="pl-k">extends</span> <span class="pl-e">DefaultAuthenticated</span> <span class="pl-k">with</span> <span class="pl-e">CredentialListener</span> {
  <span class="pl-k">val</span> <span class="pl-en">hasDrive</span><span class="pl-k">:</span> <span class="pl-en">AtomicBoolean</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AtomicBoolean</span>(<span class="pl-c1">false</span>)
  <span class="pl-k">var</span> <span class="pl-en">gdrive</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">DriveService</span>] <span class="pl-k">=</span> <span class="pl-c1">None</span>
}

<span class="pl-k">val</span> <span class="pl-en">serverCallback</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ServerCallback</span>(tokenDAO)
<span class="pl-k">val</span> <span class="pl-en">gAuth</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GoogleRouter</span>(serverCallback)</pre>
  </div> 
  <p>Although not strictly needed it can be a good idea to setup your own exception handler for your akka routes in case you want to handle any GAPI Exception separately. This can be done like so</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">gApiExceptionHandler</span> <span class="pl-k">=</span> <span class="pl-en">ExceptionHandler</span> {
    <span class="pl-k">case</span> <span class="pl-v">x</span>: <span class="pl-en">GApiException</span> <span class="pl-k">=&gt;</span>
      extractUri { uri <span class="pl-k">=&gt;</span>
        log.error(s<span class="pl-s"><span class="pl-pds">"</span>Request to $uri could not be handled normally<span class="pl-pds">"</span></span>)
        complete(<span class="pl-en">HttpResponse</span>(<span class="pl-en">StatusCodes</span>.<span class="pl-en">InternalServerError</span>, entity <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> x.jsonError.getOrElse(<span class="pl-s"><span class="pl-pds">"</span>no json error<span class="pl-pds">"</span></span>)))
      }
    <span class="pl-k">case</span> z <span class="pl-k">=&gt;</span>
      log.error(z, <span class="pl-s"><span class="pl-pds">"</span>exception<span class="pl-pds">"</span></span>)
      complete(<span class="pl-en">StatusCodes</span>.<span class="pl-en">InternalServerError</span>)
  }</pre>
  </div> 
  <p>Next we need to setup an initialise the specific google service we want to use (in this case drive).</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">def</span> <span class="pl-en">drive</span><span class="pl-k">:</span> <span class="pl-en">DriveService</span> <span class="pl-k">=</span> serverCallback.gdrive.get

  <span class="pl-k">def</span> <span class="pl-en">initGoogleServices</span><span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    <span class="pl-c"><span class="pl-c">//</span>First try to create a drive-service if we already have credentials</span>
    <span class="pl-k">val</span> <span class="pl-en">f</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Option</span>[<span class="pl-en">Credential</span>]] <span class="pl-k">=</span> <span class="pl-k">for</span> {
      opt <span class="pl-k">&lt;</span><span class="pl-k">-</span> tokenDAO.getDefault
    } <span class="pl-k">yield</span> opt <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>(t) <span class="pl-k">=&gt;</span> <span class="pl-en">Some</span>(<span class="pl-en">GoogleHelper</span>.credential(t, <span class="pl-en">Some</span>(jsonFactory), <span class="pl-en">Some</span>(httpTransport), <span class="pl-en">Some</span>(serverCallback)))
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">None</span>
    }
    <span class="pl-k">val</span> <span class="pl-en">cred</span> <span class="pl-k">=</span> <span class="pl-en">Await</span>.result(f, <span class="pl-c1">1</span> seconds)
    cred <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>(c) <span class="pl-k">=&gt;</span> {
        serverCallback.gdrive <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-en">DriveService</span>(c))
        serverCallback.hasDrive.set(<span class="pl-c1">true</span>)
      }
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span> serverCallback.gdrive <span class="pl-k">=</span> <span class="pl-c1">None</span>
    }
  }</pre>
  </div> 
  <p>The final thing is to create a main method and bind our routes to our akka http server</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">def</span> <span class="pl-en">main</span>(<span class="pl-v">args</span>: <span class="pl-en">Array</span>[<span class="pl-k">String</span>])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    initGoogleServices
    <span class="pl-en">Http</span>().bindAndHandle(authRoute <span class="pl-k">~</span> gAuth.route <span class="pl-k">~</span> defRoute, conf.httpHost.get, conf.httpPort.get)
  }</pre>
  </div> 
  <p>For the actual routes please check the example source code <a href="https://github.com/msvens/gapi/blob/master/serverexample/src/main/scala/org/mellowtech/gapi/example/server/ServerApp.scala" target="_blank">ServerApp.scala</a></p> 
  <h3><a id="user-content-authenticate-from-an-installed-application" class="anchor" href="https://github.com/msvens/gapi#authenticate-from-an-installed-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Authenticate from an installed application</h3> 
  <p>Authentication from an installed application is simpler since we can rely on the APIs provided by google.</p> 
  <p>You can use the helper <a href="https://github.com/msvens/gapi/blob/master/common/src/main/scala/org/mellowtech/gapi/Installed.scala" target="_blank">Installed.scala</a> to get away with almost all boiler plate. To create an application that lists your google drive root you can do this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">LocalApp</span> <span class="pl-k">extends</span> <span class="pl-e">App</span>{

    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">conf</span><span class="pl-k">:</span> <span class="pl-en">GApiConfig</span> <span class="pl-k">=</span> <span class="pl-en">GApiConfig</span>()
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">ec</span> <span class="pl-k">=</span> <span class="pl-en">ExecutionContext</span>.global

    <span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
    <span class="pl-k">import</span> <span class="pl-v">scala.collection.JavaConverters.</span><span class="pl-v">_</span>

    <span class="pl-k">val</span> <span class="pl-en">ds</span> <span class="pl-k">=</span> <span class="pl-en">DriveService</span>(<span class="pl-en">Installed</span>.credential(conf))

    <span class="pl-k">val</span> <span class="pl-en">rootFolder</span> <span class="pl-k">=</span> <span class="pl-k">for</span>{
      f <span class="pl-k">&lt;</span><span class="pl-k">-</span> ds.root
      fl <span class="pl-k">&lt;</span><span class="pl-k">-</span> ds.list(f)
    } <span class="pl-k">yield</span> fl

  <span class="pl-en">Await</span>.ready(rootFolder, <span class="pl-c1">10</span> seconds).value.get <span class="pl-k">match</span> {
    <span class="pl-k">case</span> <span class="pl-en">Success</span>(fl) <span class="pl-k">=&gt;</span> {
      <span class="pl-k">val</span> <span class="pl-en">nl</span> <span class="pl-k">=</span> fl.getFiles.asScala.map(_.getName)
      println(nl.mkString(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>))
    }
    <span class="pl-k">case</span> <span class="pl-en">Failure</span>(e) <span class="pl-k">=&gt;</span> e <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-v">x</span>: <span class="pl-en">GApiException</span> <span class="pl-k">=&gt;</span> println(x.jsonError)
    }
  }
}</pre>
  </div> 
  <h3><a id="user-content-use-google-drive-api" class="anchor" href="https://github.com/msvens/gapi#use-google-drive-api" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Use Google Drive API</h3> 
  <h2><a id="user-content-todo" class="anchor" href="https://github.com/msvens/gapi#todo" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>TODO</h2> 
  <h2><a id="user-content-version-history" class="anchor" href="https://github.com/msvens/gapi#version-history" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Version History</h2> 
 </article>
</div>