<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-sbt-dynver--" class="anchor" href="https://github.com/dwijnand/sbt-dynver#sbt-dynver--" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a href="https://github.com/dwijnand/sbt-dynver" target="_blank">sbt-dynver</a> <a href="https://travis-ci.org/dwijnand/sbt-dynver" target="_blank"><img src="https://camo.githubusercontent.com/52355a8be6971e538a865c1a9124ddcd8361571d/68747470733a2f2f7472617669732d63692e6f72672f6477696a6e616e642f7362742d64796e7665722e7376673f6272616e63683d6d6173746572" alt="travis-badge" data-canonical-src="https://travis-ci.org/dwijnand/sbt-dynver.svg?branch=master" style="max-width:100%;"></a> <a href="https://gitter.im/dwijnand/sbt-dynver" target="_blank"><img src="https://camo.githubusercontent.com/07cf416bdbf0ffd98c6611bcb4973c54d5c8f390/68747470733a2f2f6261646765732e6769747465722e696d2f6477696a6e616e642f7362742d64796e7665722e737667" alt="gitter-badge" data-canonical-src="https://badges.gitter.im/dwijnand/sbt-dynver.svg" style="max-width:100%;"></a></h1> 
  <p><code>sbt-dynver</code> is an <a href="http://www.scala-sbt.org/" target="_blank">sbt</a> plugin to dynamically set your version from git.</p> 
  <p>Inspired by:</p> 
  <ul> 
   <li>The way that Mercurial <a href="https://selenic.com/hg/file/3.9.1/setup.py#l179" target="_blank">versions itself</a></li> 
   <li>The <a href="https://github.com/sbt/sbt-git/blob/v0.8.5/src/main/scala/com/typesafe/sbt/SbtGit.scala#L266-L270" target="_blank">GitVersioning</a> AutoPlugin in <a href="https://github.com/sbt/sbt-git" target="_blank">sbt-git</a>.</li> 
  </ul> 
  <h2><a id="user-content-setup" class="anchor" href="https://github.com/dwijnand/sbt-dynver#setup" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Setup</h2> 
  <p>Add this to your sbt build plugins, in either <code>project/plugins.sbt</code> or <code>project/dynver.sbt</code>:</p> 
  <pre><code>addSbtPlugin("com.dwijnand" % "sbt-dynver" % "2.0.0")
</code></pre> 
  <p>Then make sure to <strong>NOT set the version setting</strong>, otherwise you will override <code>sbt-dynver</code>.</p> 
  <p>In CI, you may need to run <code>git fetch --tags</code> if the repo is cloned with <code>--no-tags</code>.</p> 
  <p>Other than that, as <code>sbt-dynver</code> is an AutoPlugin that is all that is required.</p> 
  <h2><a id="user-content-detail" class="anchor" href="https://github.com/dwijnand/sbt-dynver#detail" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Detail</h2> 
  <p><code>version in ThisBuild</code>, <code>isSnapshot in ThisBuild</code> and <code>isVersionStable in ThisBuild</code> will be automatically set to:</p> 
  <pre><code>| Case                                                                 | version                        | isSnapshot | isVersionStable |
| -------------------------------------------------------------------- | ------------------------------ | ---------- | --------------- |
| when on tag v1.0.0, w/o local changes                                | 1.0.0                          | false      | true            |
| when on tag v1.0.0 with local changes                                | 1.0.0+20140707-1030            | true       | false           |
| when on tag v1.0.0 +3 commits, on commit 1234abcd, w/o local changes | 1.0.0+3-1234abcd               | true       | true            |
| when on tag v1.0.0 +3 commits, on commit 1234abcd with local changes | 1.0.0+3-1234abcd+20140707-1030 | true       | false           |
| when there are no tags, on commit 1234abcd, w/o local changes        | 1234abcd                       | true       | true            |
| when there are no tags, on commit 1234abcd with local changes        | 1234abcd+20140707-1030         | true       | false           |
| when there are no commits, or the project isn't a git repo           | HEAD+20140707-1030             | true       | false           |
</code></pre> 
  <h2><a id="user-content-tag-requirements" class="anchor" href="https://github.com/dwijnand/sbt-dynver#tag-requirements" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tag Requirements</h2> 
  <p>In order to be recognized by sbt-dynver, tags must begin with the lowercase letter 'v' followed by a digit.</p> 
  <p>If you're not seeing what you expect, then start with this:</p> 
  <pre><code>git tag -a v0.0.1 -m "Initial version tag for sbt-dynver"
</code></pre> 
  <h2><a id="user-content-tasks" class="anchor" href="https://github.com/dwijnand/sbt-dynver#tasks" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tasks</h2> 
  <ul> 
   <li><code>dynver</code>: Returns the dynamic version of your project, inferred from the git metadata</li> 
   <li><code>dynverCurrentDate</code>: Returns the captured current date. Used for (a) the dirty suffix of <code>dynverGitDescribeOutput</code> and (b) the fallback version (e.g if not a git repo).</li> 
   <li><code>dynverGitDescribeOutput</code>: Returns the captured <code>git describe</code> out, in a structured form. Useful to define a <a href="https://github.com/dwijnand/sbt-dynver#custom-version-string" target="_blank">custom version string</a>.</li> 
   <li><code>dynverCheckVersion</code>: Checks if version and dynver match</li> 
   <li><code>dynverAssertVersion</code>: Asserts if version and dynver match</li> 
  </ul> 
  <h2><a id="user-content-custom-version-string" class="anchor" href="https://github.com/dwijnand/sbt-dynver#custom-version-string" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom version string</h2> 
  <p>Sometimes you want to customise the version string. It might be for personal preference, or for compatibility with another tool or spec.</p> 
  <p>As an example, Docker rejects tags which include <code>+</code>'s (<a href="https://github.com/dwijnand/sbt-dynver/issues/5" target="_blank">#5</a>).</p> 
  <p>A simply way to solve this is to simply post-process the value of <code>version in ThisBuild</code> (and optionally <code>dynver in ThisBuild</code>), for example by replacing '+' with '-':</p> 
  <div class="highlight highlight-source-scala">
   <pre>version in <span class="pl-en">ThisBuild</span> <span class="pl-k">~</span><span class="pl-k">=</span> (_.replace(<span class="pl-c1">'+'</span>, <span class="pl-c1">'-'</span>))
 dynver in <span class="pl-en">ThisBuild</span> <span class="pl-k">~</span><span class="pl-k">=</span> (_.replace(<span class="pl-c1">'+'</span>, <span class="pl-c1">'-'</span>))</pre>
  </div> 
  <p>If instead you want to completely customise the string format you can use <code>dynverGitDescribeOutput</code>, <code>dynverCurrentDate</code> and <code>sbtdynver.DynVer</code>, like so:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">versionFmt</span>(<span class="pl-v">out</span>: sbtdynver.<span class="pl-en">GitDescribeOutput</span>)<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span>
  out.ref.dropV.value <span class="pl-k">+</span> out.commitSuffix.mkString(<span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>) <span class="pl-k">+</span> out.dirtySuffix.dropPlus.mkString(<span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)

<span class="pl-k">def</span> <span class="pl-en">fallbackVersion</span>(<span class="pl-v">d</span>: java.util.<span class="pl-en">Date</span>)<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> s<span class="pl-s"><span class="pl-pds">"</span>HEAD-${sbtdynver.DynVer timestamp d}<span class="pl-pds">"</span></span>

inThisBuild(<span class="pl-en">List</span>(
  version <span class="pl-k">:</span><span class="pl-k">=</span> dynverGitDescribeOutput.value.mkVersion(versionFmt, fallbackVersion(dynverCurrentDate.value)),
   dynver <span class="pl-k">:</span><span class="pl-k">=</span> {
     <span class="pl-k">val</span> <span class="pl-en">d</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">java.util.Date</span>
     sbtdynver.<span class="pl-en">DynVer</span>.getGitDescribeOutput(d).mkVersion(versionFmt, fallbackVersion(d))
   }
))</pre>
  </div> 
  <p>Essentially this:</p> 
  <ol> 
   <li>defines how to transform the structured output of <code>git describe</code>'s into a string, with <code>versionFmt</code></li> 
   <li>defines the fallback version string, with <code>fallbackVersion</code>, and</li> 
   <li>wires everything back together</li> 
  </ol> 
  <h2><a id="user-content-dependencies" class="anchor" href="https://github.com/dwijnand/sbt-dynver#dependencies" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependencies</h2> 
  <ul> 
   <li><code>git</code>, on the <code>PATH</code></li> 
  </ul> 
  <h2><a id="user-content-licence" class="anchor" href="https://github.com/dwijnand/sbt-dynver#licence" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Licence</h2> 
  <p>Copyright 2016-2017 Dale Wijnand</p> 
  <p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> 
  <p><a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">http://www.apache.org/licenses/LICENSE-2.0</a></p> 
  <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p> 
 </article>
</div>