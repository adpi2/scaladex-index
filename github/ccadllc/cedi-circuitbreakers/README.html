<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/ccadllc/cedi-circuitbreakers#cedi-circuitbreakers" aria-hidden="true" class="anchor" id="user-content-cedi-circuitbreakers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Cedi Circuitbreakers</h1> 
  <p>Quick links:</p> 
  <ul> 
   <li><a href="https://github.com/ccadllc/cedi-circuitbreakers#about" target="_blank">About the library</a></li> 
   <li><a href="https://github.com/ccadllc/cedi-circuitbreakers#usage" target="_blank">Examples of use</a></li> 
   <li><a href="https://github.com/ccadllc/cedi-circuitbreakers#config" target="_blank">Configuration</a></li> 
   <li><a href="https://github.com/ccadllc/cedi-circuitbreakers#getit" target="_blank">How to get latest version</a></li> 
   <li><a href="https://oss.sonatype.org/service/local/repositories/releases/archive/com/ccadllc/cedi/circuitbreaker_2.12/1.0.0/circuitbreaker_2.12-1.0.0-javadoc.jar/!/com/ccadllc/cedi/circuitbreaker/index.html" target="_blank">API Docs</a></li> 
  </ul> 
  <h3><a href="https://github.com/ccadllc/cedi-circuitbreakers#about-the-library" aria-hidden="true" class="anchor" id="user-content-about-the-library" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-about" target="_blank" href=""></a>About the library</h3> 
  <p>The term <code>Circuit breaker</code> in software engineering applies to a programming pattern meant to provide a similar service for software components that its namesake provides for electrical grids: ensuring that a failure or overload does not cascade to bring down the whole system. Advanced circuit breakers such as the ones provided by this library also enable the means for throttling (degrading or limiting) the component usage when a service cannot keep up with inbound requests. Finally, this library additionally provides the means by which clients - for example, a monitoring task - can subscribe to 1.) events related to the circuit breaker activity (e.g., alert users when a circuit breaker has opened, closed, or is throttling requests due to excessive inbound traffic); and/or 2.) a stream of statistics related to the circuitbreaker emitted on a periodic basis.</p> 
  <h3><a href="https://github.com/ccadllc/cedi-circuitbreakers#examples-of-use" aria-hidden="true" class="anchor" id="user-content-examples-of-use" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-usage" target="_blank" href=""></a>Examples of use</h3> 
  <h4><a href="https://github.com/ccadllc/cedi-circuitbreakers#-circuitbreaker-protection" aria-hidden="true" class="anchor" id="user-content--circuitbreaker-protection" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-protectusage" target="_blank" href=""></a> Circuitbreaker Protection</h4> 
  <p>Here is a simple example of the use of a circuit breaker to protect against cascading failures. Aside from its configuration - described later in this README - the syntax and semantics in the use of the flow control circuit breaker is identical.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">cats.effect.</span><span class="pl-v">IO</span>
<span class="pl-k">import</span> <span class="pl-v">fs2.</span>{ <span class="pl-v">Scheduler</span>, <span class="pl-v">Stream</span> }

<span class="pl-k">import</span> <span class="pl-v">java.io.</span><span class="pl-v">IOException</span>
<span class="pl-k">import</span> <span class="pl-v">java.util.</span><span class="pl-v">UUID</span>
<span class="pl-k">import</span> <span class="pl-v">java.util.concurrent.</span><span class="pl-v">TimeoutException</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">com.ccadllc.cedi.circuitbreaker.</span><span class="pl-v">_</span>

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * The circuit breaker registry settings are fairly simple and only consist</span>
<span class="pl-c"> * of how often it should evaluate any of the circuit breakers and remove those</span>
<span class="pl-c"> * that have had no activity for a given time period.  If the checkInterval</span>
<span class="pl-c"> * property evaluates to 0 (0.seconds for example), no circuit breaker garbage</span>
<span class="pl-c"> * collection will occur.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">val</span> <span class="pl-en">circuitBreakerRegistrySettings</span><span class="pl-k">:</span> <span class="pl-en">RegistrySettings</span> <span class="pl-k">=</span> <span class="pl-en">RegistrySettings</span>(
  garbageCollection <span class="pl-k">=</span> <span class="pl-en">RegistrySettings</span>.<span class="pl-en">GarbageCollection</span>(checkInterval <span class="pl-k">=</span> <span class="pl-c1">1.</span>hour, inactivityCutoff <span class="pl-k">=</span> <span class="pl-c1">24.</span>hours)
)

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * This constitutes the configuration of the circuitbreaker we shall create as part of this example.</span>
<span class="pl-c"> * It consists of the constraints that define sliding sample window of statistics to gather,</span>
<span class="pl-c"> * the percentage failures over that sample window time-frame which will trigger the circuitbreaker</span>
<span class="pl-c"> * to open and to fail fast subsequent requests, the interval at which a request should be let</span>
<span class="pl-c"> * through to test when the circuitbreaker has opened, and the number of consecutive test requests</span>
<span class="pl-c"> * which must succeed to close it.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">val</span> <span class="pl-en">databaseCircuitBreakerSettings</span><span class="pl-k">:</span> <span class="pl-en">FailureSettings</span> <span class="pl-k">=</span> <span class="pl-en">FailureSettings</span>(
  sampleWindow <span class="pl-k">=</span> <span class="pl-en">SampleWindow</span>(duration <span class="pl-k">=</span> <span class="pl-c1">2.</span>minutes),
  degradationThreshold <span class="pl-k">=</span> <span class="pl-en">Percentage</span>(percent <span class="pl-k">=</span> <span class="pl-c1">40.0</span>),
  test <span class="pl-k">=</span> <span class="pl-en">FailureSettings</span>.<span class="pl-en">Test</span>(interval <span class="pl-k">=</span> <span class="pl-c1">5.</span>seconds, minimumSuccesses <span class="pl-k">=</span> <span class="pl-c1">5</span>)
)

<span class="pl-c"><span class="pl-c">/*</span> The very simple data type which will represent the database object we are querying for this example. <span class="pl-c">*/</span></span>
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">QuarterlyProductSales</span>(<span class="pl-v">productId</span>: <span class="pl-en">UUID</span>, <span class="pl-v">productName</span>: <span class="pl-k">String</span>, <span class="pl-v">totalSales</span>: <span class="pl-k">Long</span>)

<span class="pl-c"><span class="pl-c">/*</span> A simple stub to represent a query to a remote dynamodb persistent database <span class="pl-c">*/</span></span>
<span class="pl-k">def</span> <span class="pl-en">retrieveQuarterlyProductSales</span><span class="pl-k">:</span> <span class="pl-en">IO</span>[<span class="pl-en">Vector</span>[<span class="pl-en">QuarterlyProductSales</span>]] <span class="pl-k">=</span>
  <span class="pl-en">IO</span>(<span class="pl-en">Vector</span>(<span class="pl-en">QuarterlyProductSales</span>(<span class="pl-en">UUID</span>.randomUUID, <span class="pl-s"><span class="pl-pds">"</span>widgets<span class="pl-pds">"</span></span>, <span class="pl-c1">565000L</span>)))

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * A service to abstract interactions with a remote database.  For our example purposes, it only has one</span>
<span class="pl-c"> * entry point, to query for `QuarterlyProductSales` objects.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">class</span> <span class="pl-en">DatabaseService</span>(<span class="pl-v">cbRegistry</span>: <span class="pl-en">CircuitBreakerRegistry</span>[<span class="pl-en">IO</span>], <span class="pl-v">circuitBreakerSettings</span>: <span class="pl-en">FailureSettings</span>) {
  <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">   * The dynamodb client circuit breaker is identified in the registry via the</span>
<span class="pl-c">   * `CircuitBreaker.Identifier`</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">final</span> <span class="pl-k">val</span> <span class="pl-en">DynamoDbCircuitBreakerId</span><span class="pl-k">:</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span> <span class="pl-k">=</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span>(<span class="pl-s"><span class="pl-pds">"</span>dynamodb-client<span class="pl-pds">"</span></span>)
  <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">   * The dynamodb client circuit breaker will evaluate task failures using</span>
<span class="pl-c">   * this to determine if the failure should be considered in determining</span>
<span class="pl-c">   * whether a circuit breaker be opened. For example, application level failures</span>
<span class="pl-c">   * typically should not be considered, since that category of failure generally</span>
<span class="pl-c">   * does not indicate systemic problems of the kind a circuit breaker was designed</span>
<span class="pl-c">   * to protect against.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">final</span> <span class="pl-k">val</span> <span class="pl-en">DynamoDbCircuitBreakerEvaluator</span><span class="pl-k">:</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">FailureEvaluator</span> <span class="pl-k">=</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">FailureEvaluator</span> {
    <span class="pl-k">case</span> <span class="pl-v">_</span>: <span class="pl-en">IOException</span> <span class="pl-k">|</span> <span class="pl-v">_</span>: <span class="pl-en">TimeoutException</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">true</span>
    <span class="pl-k">case</span> _ <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>
  }

  <span class="pl-k">def</span> <span class="pl-en">getAllQuarterlyProductSales</span><span class="pl-k">:</span> <span class="pl-en">IO</span>[<span class="pl-en">Vector</span>[<span class="pl-en">QuarterlyProductSales</span>]] <span class="pl-k">=</span> <span class="pl-k">for</span> {
    <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">     * The registry will look up the circuit breaker by identifier,</span>
<span class="pl-c">     * creating it if it does not yet exist.</span>
<span class="pl-c">     <span class="pl-c">*/</span></span>
    cb <span class="pl-k">&lt;</span><span class="pl-k">-</span> cbRegistry.forFailure(<span class="pl-en">DynamoDbCircuitBreakerId</span>, circuitBreakerSettings, <span class="pl-en">DynamoDbCircuitBreakerEvaluator</span>)
    <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">     * The protect function of the circuit breaker will apply its current statistics</span>
<span class="pl-c">     * both before and after the task execution.  If the circuit breaker is open and</span>
<span class="pl-c">     * a test is not yet ready to be run, the task itself will not be executed but</span>
<span class="pl-c">     * will 'fail fast' with a `CircuitBreaker.OpenException`; Similarly, with a flow control</span>
<span class="pl-c">     * circuit breaker, if the rate per second is too high, requests will 'fail fast' with a</span>
<span class="pl-c">     * 'CircuitBreaker.ThrottledException' - and thus not be counted in the inbound rate stats -</span>
<span class="pl-c">     * until the inbound rate has been brought down to a level the processing rate statistics</span>
<span class="pl-c">     * indicates can be handled.</span>
<span class="pl-c">     <span class="pl-c">*/</span></span>
    result <span class="pl-k">&lt;</span><span class="pl-k">-</span> cb.protect(retrieveQuarterlyProductSales)
  } <span class="pl-k">yield</span> result
}

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * Near the beginning of the universe, create a circuit breaker registry for the</span>
<span class="pl-c"> * system to use. The circuit breaker is passed configuration settings as described</span>
<span class="pl-c"> * above.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">val</span> <span class="pl-en">protectedSystem</span> <span class="pl-k">=</span> (<span class="pl-k">for</span> {
  scheduler <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Scheduler</span>[<span class="pl-en">IO</span>](<span class="pl-c1">1</span>)
  cbRegistry <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Stream</span>.eval(<span class="pl-en">CircuitBreakerRegistry</span>.create[<span class="pl-en">IO</span>](circuitBreakerRegistrySettings, scheduler))
  dbService <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DatabaseService</span>(cbRegistry, databaseCircuitBreakerSettings)
  result <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Stream</span>.eval(dbService.getAllQuarterlyProductSales)
} <span class="pl-k">yield</span> ()).runLast.map(_.getOrElse(<span class="pl-en">Vector</span>.empty))

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * Here would be the rest of the program in a real world application.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>

<span class="pl-c"><span class="pl-c">/*</span> At the end of the universe, run things! <span class="pl-c">*/</span></span>
protectedSystem.unsafeRunSync()</pre>
  </div> 
  <h4><a href="https://github.com/ccadllc/cedi-circuitbreakers#-circuit-breaker-event-subscription" aria-hidden="true" class="anchor" id="user-content--circuit-breaker-event-subscription" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-eventsusage" target="_blank" href=""></a> Circuit Breaker Event Subscription</h4> 
  <p>Interested processes can subscribe to events related to a system's circuit breaker activity. There is an example of its use.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">cats.effect.</span><span class="pl-v">IO</span>
<span class="pl-k">import</span> <span class="pl-v">fs2.</span>{ <span class="pl-v">async</span>, <span class="pl-v">Stream</span> }
<span class="pl-k">import</span> <span class="pl-v">com.ccadllc.cedi.circuitbreaker.</span>{ <span class="pl-v">CircuitBreakerRegistry</span>, <span class="pl-v">CircuitBreaker</span> }
<span class="pl-k">import</span> <span class="pl-v">com.ccadllc.cedi.circuitbreaker.statistics.</span>{ <span class="pl-v">FailureStatistics</span>, <span class="pl-v">FlowControlStatistics</span> }

<span class="pl-c"><span class="pl-c">/**</span></span>
<span class="pl-c"> * In this method, we subscribe to a stream of circuit breaker events triggered on</span>
<span class="pl-c"> * state changes and process them in some manner (that manner is not shown here).</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">def</span> <span class="pl-en">monitorCircuitBreakerEvents</span>(<span class="pl-v">cbRegistry</span>: <span class="pl-en">CircuitBreakerRegistry</span>[<span class="pl-en">IO</span>])<span class="pl-k">:</span> <span class="pl-en">IO</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> {
  <span class="pl-k">def</span> <span class="pl-en">processCircuitBreakerEvent</span>(<span class="pl-v">event</span>: <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">CircuitBreakerEvent</span>)<span class="pl-k">:</span> <span class="pl-en">IO</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> event <span class="pl-k">match</span> {
    <span class="pl-k">case</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">OpenedEvent</span>(<span class="pl-v">id</span>: <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span>, <span class="pl-v">stats</span>: statistics.<span class="pl-en">FailureStatistics</span>) <span class="pl-k">=&gt;</span> <span class="pl-k">???</span>
    <span class="pl-k">case</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">ClosedEvent</span>(<span class="pl-v">id</span>: <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span>, <span class="pl-v">stats</span>: statistics.<span class="pl-en">FailureStatistics</span>) <span class="pl-k">=&gt;</span> <span class="pl-k">???</span>
    <span class="pl-k">case</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">ThrottledDownEvent</span>(<span class="pl-v">id</span>: <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span>, <span class="pl-v">stats</span>: statistics.<span class="pl-en">FlowControlStatistics</span>) <span class="pl-k">=&gt;</span> <span class="pl-k">???</span>
    <span class="pl-k">case</span> <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">ThrottledUpEvent</span>(<span class="pl-v">id</span>: <span class="pl-en">CircuitBreaker</span>.<span class="pl-en">Identifier</span>, <span class="pl-v">stats</span>: statistics.<span class="pl-en">FlowControlStatistics</span>) <span class="pl-k">=&gt;</span> <span class="pl-k">???</span>
  }
  <span class="pl-k">val</span> <span class="pl-en">maxQueuedEvents</span> <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-k">val</span> <span class="pl-en">eventStream</span> <span class="pl-k">=</span> cbRegistry.events(maxQueuedEvents) flatMap { event <span class="pl-k">=&gt;</span>
    <span class="pl-en">Stream</span>.eval_(processCircuitBreakerEvent(event))
  }
  async.start(eventStream.run) map { _ <span class="pl-k">=&gt;</span> () }
}

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * Near the beginning of the universe, create a circuit breaker registry for the</span>
<span class="pl-c"> * system to use. The circuit breaker is passed configuration settings, as described above.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">val</span> <span class="pl-en">protectedSystem</span> <span class="pl-k">=</span> (<span class="pl-k">for</span> {
  scheduler <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Scheduler</span>[<span class="pl-en">IO</span>](<span class="pl-c1">1</span>)
  cbRegistry <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Stream</span>.eval(<span class="pl-en">CircuitBreakerRegistry</span>.create[<span class="pl-en">IO</span>](circuitBreakerRegistrySettings, scheduler))
  dbService <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">DatabaseService</span>(cbRegistry, databaseCircuitBreakerSettings)
  result <span class="pl-k">&lt;</span><span class="pl-k">-</span> <span class="pl-en">Stream</span>.eval(dbService.getAllQuarterlyProductSales)
} <span class="pl-k">yield</span> ()).runLast.map(_.getOrElse(<span class="pl-en">Vector</span>.empty))

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c"> * Here would be the rest of the program in a real world application.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>

<span class="pl-c"><span class="pl-c">/*</span> At the end of the universe, run things! <span class="pl-c">*/</span></span>
protectedSystem.unsafeRunSync()</pre>
  </div> 
  <h3><a href="https://github.com/ccadllc/cedi-circuitbreakers#-configuration" aria-hidden="true" class="anchor" id="user-content--configuration" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-config" target="_blank" href=""></a> Configuration</h3> 
  <h4><a href="https://github.com/ccadllc/cedi-circuitbreakers#-circuit-breaker-registry" aria-hidden="true" class="anchor" id="user-content--circuit-breaker-registry" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-registryconfiguration" target="_blank" href=""></a> Circuit Breaker Registry</h4> 
  <p>The circuit breaker registry settings are defined in the <code>com.ccadllc.cedi.circuitbreaker</code> namespace and the defaults in this library's <code>reference.conf</code> generally do not need to be altered; however they are described below so that the library users understand their purpose.</p> 
  <pre><code>com.ccadllc.cedi.circuitbreaker {
  registry {
    # The circuit breaker registry periodically checks to see if a
    # circuit breaker has been inactive for a lengthy period of time,
    # indicating it is no longer in use.  Since circuit breakers
    # use memory to maintain statistics, it is vital for long running
    # systems which create and discard circuit breakers that we
    # evict such inactive circuit breakers from the registry (they will
    # be re-created again if needed).  If a circuit breaker is inactive
    # for 60 minutes, by default, it shall be so evicted.
    # If check-interval evaluates to 0 (for instance, is specified as 0
    # seconds) then no garbage collection shall occur.
    garbage-collection {
      check-interval: 5 minutes
      inactivity-cutoff: 60 minutes
    }
  }
}
</code></pre> 
  <h4><a href="https://github.com/ccadllc/cedi-circuitbreakers#-cascading-failure-circuit-breaker" aria-hidden="true" class="anchor" id="user-content--cascading-failure-circuit-breaker" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-failureconfiguration" target="_blank" href=""></a> Cascading Failure Circuit Breaker</h4> 
  <p>The cascading failure circuit breaker has a number of configurable parameters, each of which is described below. The circuit breaker settings are typically defined inline subordinate to the subsystem that uses them in the application configuration. For example, for a DynamoDb client circuit breaker in a <code>persistence</code> library, they would be nested in the <code>dynamodb { }</code> settings in the <code>persistence</code> reference.conf file.</p> 
  <pre><code>failure-circuitbreaker {
  # The sample window configuration determines the number of request
  # failure statistics that are maintained.  It is a sliding window.
  # For example, in this configuration, the system will maintain
  # request success/failure metrics for the last 2 minutes, with a
  # maximum of 50,000 entries.  The circuit breaker will only apply
  # protection once the sample window has initially been filled (the
  # first two minutes or 50,000 requests collected in this example).
  # Thereafter, the window continues to slide over the latest two
  # minutes of requests.
  # The maximum-entries entry is meant as a failsafe to ensure that
  # we hold no more than this number at any one time, to avoid
  # excessive memory consumption.
  sample-window {
    duration: 2 minutes
    maximum-entries: 50000
  }
  # This parameter indicates the percentage of failure detected by the
  # circuit breaker of the requests in the sample window which are
  # determine to be failures.  As described in the example below, a failure
  # of a protected task is determined by the `Evaluator` passed to the
  # given circuit breaker when created and may be unique to a given
  # subsystem.  For example, in this configuration, if 40% of the
  # requests processed in the latest 2 minute window have been deemed
  # failures, the circuit breaker will open and subsequent requests
  # will fail fast with a custom exception, with the exception of
  # those passed through for periodic testing.
  degradation-threshold {
    percent: 40.0
  }
  # Once a circuit breaker is open, we need a way to determine
  # that the failure condition(s) have been resolved so that
  # it can be closed again and normal request processing
  # resumed.  This is done by periodically letting a request
  # pass through and monitoring its result.  In this example,
  # when a circuit breaker has opened, a request will be passed
  # through every 30 seconds and if 5 requests in succession are
  # successful, the breaker will again open.
  test {
    interval: 30 seconds
    minimum-successes: 5
  }
  # This is set to true by default but if set to false, the circuit
  # breaker's failure protection will be disabled.  This defaults to
  # 'true' if not specified and is only specified here for illustration
  # purposes as it is not meant to be a 'public' parameter and should
  # generally be changed to 'false' only when troubleshooting.
  enabled: true
}
</code></pre> 
  <h4><a href="https://github.com/ccadllc/cedi-circuitbreakers#-flow-control-circuit-breaker" aria-hidden="true" class="anchor" id="user-content--flow-control-circuit-breaker" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-flowcontrolconfiguration" target="_blank" href=""></a> Flow Control Circuit Breaker</h4> 
  <p>The flow control circuit breaker has a number of configurable parameters, each of which is described below. The circuit breaker settings are typically defined subordinate to the subsystem that uses them in the application configuration. For example, for a circuit breaker protecting an http client in a <code>service</code> microservice, they would be nested in the <code>http-client { }</code> settings in the <code>service</code> reference.conf file. See the <a href="https://github.com/typesafehub/config" target="_blank">typesafe documentation</a> for more details on the general usage of this type of configuration.</p> 
  <pre><code>flow-control-circuitbreaker {
  # Since the throttling circuit breaker also has cascading failure protection, it includes those
  # configuration parameters, as in the previous section above.  Note that if the 'enabled'
  # parameter is set to 'false' in the failure sub-section of the flow control circuit breaker
  # configuration, it will disable failure protection; however, flow control protection will
  # still be enabled unless the flow control 'enabled' parameter is set to 'false.'
  failure {
    sample-window {
      duration: 2 minutes
      maximum-entries: 50000
    }
    degradation-threshold {
      percent: 40.0
    }
    test {
      interval: 30 seconds
      minimum-successes: 5
    }
    enabled: true
  }
  # This sliding sample window maintains the mean rate per second of
  # both inbound requests and requests processed, so it can compare the two
  # to determine if the protected task is keeping up by ensuring the requests
  # processed per second does not fall behind the inbound rate in a sustained manner.
  # For that reason, the sample window here is usually larger than the failure
  # sample window described above as you typically want a larger sample size by
  # which to factor out bursts of traffic versus sustained rates. The circuit
  # breaker protection will not be applied until the sample window has initially
  # been filled (the first 30 seconds in this example). Thereafter, the window
  # continues to slide over the latest 30 seconds of inbound and processing rates.
  # A maximum-entries value can also be specified here; however, in general it
  # is not needed since the maximum entries will never be more than the number of
  # seconds for the sample window (in this case, 30).  It is only if you have a
  # very, very long window that you would need to specify it to override the
  # calculation based on the sample window.
  sample-window {
    duration: 30 seconds
  }

  # In order to ensure we avoid throttling requests unnecessarily, and to further
  # guard against bursts of traffic, you can configure a circuit breaker such that
  # it will not start throttling requests until the observed mean processing
  # rate per second has fallen behind the inbound rate by the percentage configured
  # here.  If set to zero, the mean processing rate must equal the mean inbound
  # rate or throttling will begin.  Because of bursting and timing, You typically
  # want this value to be non-zero to avoid overly aggressive throttling. In the
  # example below, the processing rate must fall behind the inbound rate by 10
  # percent.  Only performance testing and tuning can determine the appropriate
  # value for a given system.

  allowed-over-processing-rate {
    percent: 10.0
  }

  # This value is used to determine whether or not to trigger a throttled up or
  # throttled down event, in order to avoid a flood of events while
  # throttling is in effect.  So in this configuration, an event would only been
  # triggered when throttling up 5% (allowing 5% more requests per second through)
  # or throttling down 5% (throttling - failing fast - 5% more requests per
  # second).
  minimum-reportable-rate-change {
    percent: 5.0
  }
  # This is set to true by default but if set to false, the circuit
  # breaker's flow control protection will be disabled.  This defaults to
  # 'true' if not specified and is only specified here for illustration
  # purposes as it is not meant to be a 'public' parameter and should
  # generally be changed only when troubleshooting.  Note that if this is
  # set to 'false' but the failure sub-config has its enabled set to 'true'
  # failure protection will still be enabled and the circuit breaker will
  # in effect act like a standard failure protection only variant.
  enabled: true

  # This indicates the hard limit for inbound requests per second.  If at any time the
  # number of requests per second exceed this value, requests will get throttled
  # until the start of the next second.  This is meant as a "failsafe" to
  # prevent sudden spikes from overwhelming a protected service prior to the
  # adaptive measures kicking in (the input versus mean processing rates in
  # the sample window).  In general, it should be set higher than the protected
  # service can be handled in a sustained manner but not so high that it will
  # overwhelm the system for the period of time that it takes for the sample window
  # mean values to adjust to the increase in load and provide adaptive protection.
  per-second-rate-threshold: 25
}
</code></pre> 
  <h3><a href="https://github.com/ccadllc/cedi-circuitbreakers#how-to-get-latest-version" aria-hidden="true" class="anchor" id="user-content-how-to-get-latest-version" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a id="user-content-getit" target="_blank" href=""></a>How to get latest Version</h3> 
  <p>Cedi Circuitbreaker supports 2.11 and 2.12. It is published on Maven Central.</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.ccadllc.cedi<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>circuitbreaker<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a href="https://github.com/ccadllc/cedi-circuitbreakers#copyright-and-license" aria-hidden="true" class="anchor" id="user-content-copyright-and-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Copyright and License</h2> 
  <p>This project is made available under the <a href="https://github.com/ccadllc/cedi-circuitbreakers/blob/master/LICENSE" target="_blank">Apache License, Version 2.0</a>. Copyright information can be found in <a href="https://github.com/ccadllc/cedi-circuitbreakers/blob/master/NOTICE" target="_blank">NOTICE</a>.</p> 
 </article>
</div>