<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/kadekm/scrawler#scala-crawler" aria-hidden="true" class="anchor" id="user-content-scala-crawler" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>S(cala) Crawler</h1> 
  <p><a href="https://travis-ci.org/KadekM/scrawler" target="_blank"><img src="https://camo.githubusercontent.com/6cefa598ccdb4a3fc57a1a804f465e5a80c1ad74/68747470733a2f2f7472617669732d63692e6f72672f4b6164656b4d2f73637261776c65722e7376673f6272616e63683d646576" alt="Build Status" data-canonical-src="https://travis-ci.org/KadekM/scrawler.svg?branch=dev" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/com.marekkadek/scrawler_2.11" target="_blank"><img src="https://camo.githubusercontent.com/be6b8188d098712bb3f25b51e7ca24d3962454a4/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f636f6d2e6d6172656b6b6164656b2f73637261776c65725f322e31312e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/com.marekkadek/scrawler_2.11.svg" style="max-width:100%;"></a></p> 
  <h1><a href="https://github.com/kadekm/scrawler#install" aria-hidden="true" class="anchor" id="user-content-install" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Install</h1> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.marekkadek<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>scrawler<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.0.3<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Library cross compiles for Scala 2.11 and 2.12.</p> 
  <h1><a href="https://github.com/kadekm/scrawler#usage" aria-hidden="true" class="anchor" id="user-content-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h1> 
  <h2><a href="https://github.com/kadekm/scrawler#crawlers" aria-hidden="true" class="anchor" id="user-content-crawlers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Crawlers</h2> 
  <p>You can create your specific crawler by subclassing <code>Crawler</code> class. Lets see how would it look, for a crawler who's effects (crawling web) are captured by <code>fs2.Task</code> and that gives us data only in form of <code>String</code>. Let's make a crawler that follows every https link and gives us url's of websites.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MyCrawler</span> <span class="pl-k">extends</span> <span class="pl-e">Crawler</span>[<span class="pl-en">Task</span>, <span class="pl-k">String</span>](<span class="pl-en">Seq</span>(<span class="pl-en">JsoupBrowser</span>[<span class="pl-en">Task</span>])) {
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">onDocument</span>(<span class="pl-v">document</span>: <span class="pl-en">Document</span>)<span class="pl-k">:</span> <span class="pl-en">Stream</span>[<span class="pl-en">Task</span>, <span class="pl-en">Yield</span>[<span class="pl-k">String</span>]] <span class="pl-k">=</span> {
      <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> <span class="pl-en">YieldData</span>(document.location)
      <span class="pl-k">val</span> <span class="pl-en">followableLinks</span> <span class="pl-k">=</span> document.root
        .select(<span class="pl-s"><span class="pl-pds">"</span>a[href^='https://']<span class="pl-pds">"</span></span>)  <span class="pl-c"><span class="pl-c">//</span> follow only links starting by https</span>
        .toSeq
        .flatMap(_.attr(<span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>)) <span class="pl-c"><span class="pl-c">//</span> get the href attribute from link</span>
        .map(<span class="pl-en">Visit</span>) <span class="pl-c"><span class="pl-c">//</span> visit those links</span>

      <span class="pl-c"><span class="pl-c">//</span> first yield title of website as data, and then continue by visiting links</span>
      <span class="pl-en">Stream</span>.emit(title) <span class="pl-k">++</span> <span class="pl-en">Stream</span>.emits(followableLinks)
  }
}</pre>
  </div> 
  <p>We are streaming actions such as <code>YieldData</code> and <code>Visit</code>, which are currently only two allowed. Here's how Yield is defined:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">Yield</span>[<span class="pl-k">+</span><span class="pl-en">A</span>]
<span class="pl-k">final</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">YieldData</span>[<span class="pl-en">A</span>](<span class="pl-v">a</span>: <span class="pl-en">A</span>) <span class="pl-k">extends</span> <span class="pl-e">Yield</span>[<span class="pl-en">A</span>]
<span class="pl-k">final</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Visit</span>(<span class="pl-v">url</span>: <span class="pl-k">String</span>) <span class="pl-k">extends</span> <span class="pl-e">Yield</span>[<span class="pl-en">Nothing</span>]</pre>
  </div> 
  <p>We can execute either sequential or parallel crawling.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">crawler</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">MyCrawler</span>

<span class="pl-c"><span class="pl-c">//</span> crawl wikipedia sequentially and take 10 elements (titles of visited websites)</span>
<span class="pl-k">val</span> <span class="pl-en">titles</span><span class="pl-k">:</span> <span class="pl-en">Vector</span>[<span class="pl-k">String</span>] <span class="pl-k">=</span> crawler.sequentialCrawl(<span class="pl-s"><span class="pl-pds">"</span>https://wikipedia.org<span class="pl-pds">"</span></span>)
    .take(<span class="pl-c1">10</span>).runLog.unsafeRun

<span class="pl-c"><span class="pl-c">//</span> crawl wikipedia in parallel and take 10 elements(titles of visited websites)</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">strategy</span><span class="pl-k">:</span> <span class="pl-en">Strategy</span> <span class="pl-k">=</span> <span class="pl-en">Strategy</span>.fromFixedDaemonPool(<span class="pl-c1">128</span>)
<span class="pl-k">val</span> <span class="pl-en">titles2</span><span class="pl-k">:</span> <span class="pl-en">Vector</span>[<span class="pl-k">String</span>] <span class="pl-k">=</span> crawler.parallelCrawl(<span class="pl-s"><span class="pl-pds">"</span>https://wikipedia.org<span class="pl-pds">"</span></span>, maxConnections <span class="pl-k">=</span> <span class="pl-c1">8</span>)
    .take(<span class="pl-c1">10</span>).runLog.unsafeRun</pre>
  </div> 
  <p>You might as well pipe them into file or kafka or anything that is happy with fs2 :)</p> 
  <p>As observed in example when extending Crawler, it takes sequence of browsers to use during crawling. By default, it randomly selects which browser to use. You can change this behaviour by overriding pickBrowser method.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MyCrawler</span> <span class="pl-k">extends</span> <span class="pl-e">Crawler</span>[<span class="pl-en">Task</span>, <span class="pl-k">String</span>](<span class="pl-en">Seq</span>(<span class="pl-en">JsoupBrowser</span>[<span class="pl-en">Task</span>])) {
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">onDocument</span>(<span class="pl-v">document</span>: <span class="pl-en">Document</span>)<span class="pl-k">:</span> <span class="pl-en">Stream</span>[<span class="pl-en">Task</span>, <span class="pl-en">Yield</span>[<span class="pl-k">String</span>]] <span class="pl-k">=</span> <span class="pl-k">???</span>

  <span class="pl-c"><span class="pl-c">//</span> picking browser may be effectful</span>
  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">pickBrowser</span>(<span class="pl-v">forUrl</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Task</span>[<span class="pl-en">Browser</span>[<span class="pl-en">Task</span>]] <span class="pl-k">=</span> <span class="pl-k">???</span>
 }</pre>
  </div> 
  <h2><a href="https://github.com/kadekm/scrawler#browsers" aria-hidden="true" class="anchor" id="user-content-browsers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Browsers</h2> 
  <p>Any browser that implements <code>Browser</code> trait can be used. Currently, there is JsoupBrowser, and HtmlUnit (work in progress).</p> 
  <p>To create JsoupBrowser, you can use <code>JsoupBrowser[Task]</code> (or different effect if you're not using Task). It has several overloads, i.e. you can also pass in proxy (or user agent or so):</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">proxy</span> <span class="pl-k">=</span> <span class="pl-en">ProxySettings</span>.http(<span class="pl-s"><span class="pl-pds">"</span>122.193.14.106<span class="pl-pds">"</span></span>, <span class="pl-c1">81</span>)
<span class="pl-k">val</span> <span class="pl-en">browser</span> <span class="pl-k">=</span> <span class="pl-en">JsoupBrowser</span>[<span class="pl-en">Task</span>](proxy)
<span class="pl-k">val</span> <span class="pl-en">browser2</span> <span class="pl-k">=</span> <span class="pl-en">JsoupBrowser</span>[<span class="pl-en">Task</span>](connectionTimeout <span class="pl-k">=</span> <span class="pl-c1">5.</span>seconds,
    userAgent <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Mozilla<span class="pl-pds">"</span></span>,
    validateTLSCertificates <span class="pl-k">=</span> <span class="pl-c1">false</span>)
</pre>
  </div> 
  <h1><a href="https://github.com/kadekm/scrawler#credits" aria-hidden="true" class="anchor" id="user-content-credits" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h1> 
  <p>Greatly inspired by awesome [<a href="https://github.com/ruippeixotog/scala-scraper](Rui's" target="_blank">https://github.com/ruippeixotog/scala-scraper](Rui's</a> scala-scraper) and python's Scrapy. Thank you!</p> 
 </article>
</div>