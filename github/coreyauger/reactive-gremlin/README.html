<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/coreyauger/reactive-gremlin#reactive-gremlin" aria-hidden="true" class="anchor" id="user-content-reactive-gremlin" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>reactive-gremlin</h1> 
  <p>High throughput akka http gremlin 3 websocket connector with backpressure.</p> 
  <p>High Flow Gremlin .... Blows your hair back !</p> 
  <p><a href="https://camo.githubusercontent.com/aab5c773c57e3cb27fec8e5a2d76dea4aba943a2/687474703a2f2f7777772e636f72657961756765722e636f6d2f696d616765732f6772656d6c696e2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/aab5c773c57e3cb27fec8e5a2d76dea4aba943a2/687474703a2f2f7777772e636f72657961756765722e636f6d2f696d616765732f6772656d6c696e2e706e67" alt="gremlin" title="Blow your hair back!" data-canonical-src="http://www.coreyauger.com/images/gremlin.png" style="max-width:100%;"></a></p> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#what-is-reactive-gremlin" aria-hidden="true" class="anchor" id="user-content-what-is-reactive-gremlin" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What is reactive-gremlin</h3> 
  <p>reactive-gremlin is a <code>streaming</code> websocket client that connects to a gremlin server to execute gremlin scripts. Current client including the Java client provided by datastax have the capability to crash your gremlin server by overflowing the server with asyn requests. Your gremlin server will buffer incoming requests and service them when it has finished the ones in the queue. For fast consumers (bulk loaders) it is possible to cause Out of memory Exceptions and crash the server.</p> 
  <p>reactive-gremlin provides a way around this by implementing backpressure through a side channel. This will slow down the fast consumer while the server is overloaded and speed it up when the server catches up. It does this throw a user controlled parameter on the maximum <code>in-flight</code> calls allowed to any one server. The stream monitors responses from the server and controlls backpressure on the stream accordingly.</p> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#buildsbt" aria-hidden="true" class="anchor" id="user-content-buildsbt" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Build.sbt</h3> 
  <p>Add the following dependency to your porject.</p> 
  <p><code>resolvers += "Sonatype OSS Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots"</code></p> 
  <p><code>"io.surfkit" %% "reactive-gremlin" % "0.0.1"</code></p> 
  <p>##Usage</p> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#scripts" aria-hidden="true" class="anchor" id="user-content-scripts" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>scripts</h3> 
  <p>I have provided a simple builder to convert you gremlin scripts into the required types for transport. Here are some examples of encoding a few gremlin <code>groovy</code> scripts</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">simple</span> <span class="pl-k">=</span> <span class="pl-en">GremlinClient</span>.buildRequest(<span class="pl-s"><span class="pl-pds">"</span>g.V().has('email','donald@trumpdonald.org').has('is_douchebag','true').valueMap();<span class="pl-pds">"</span></span>)
<span class="pl-k">val</span> <span class="pl-en">create</span> <span class="pl-k">=</span> <span class="pl-en">GremlinClient</span>.buildRequest(<span class="pl-s"><span class="pl-pds">"</span>graph.addVertex(label, 'entity','uri','https://en.wikipedia.org/wiki/Donald_Trump');<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#client" aria-hidden="true" class="anchor" id="user-content-client" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>client</h3> 
  <p>To issue request to your server you must create a <code>GremlinClient</code>. Parameters:</p> 
  <ul> 
   <li><code>host: String</code> is the websocket url to connect to your server (default localhost:8182).</li> 
   <li><code>maxInFlight:Int</code> controls the max number of request that you will allow you server to process at one time (default 250)</li> 
   <li><code>responder:Option[ActorRef]</code> an optional Akka actor that will receive <code>Gremlin.Response</code> messages.</li> 
   <li><code>onResponse:Option[Gremline.Response =&gt; Unit]</code> an optional callback that will receive <code>Gremlin.Response</code> messages.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">gclient</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GremlinClient</span>(host<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>ws://localhost:8182<span class="pl-pds">"</span></span>,maxInFlight<span class="pl-k">=</span><span class="pl-c1">100</span>)</pre>
  </div> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#pushing-data" aria-hidden="true" class="anchor" id="user-content-pushing-data" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>pushing data</h3> 
  <p>There are 3 ways to push your request data into the flow:</p> 
  <ul> 
   <li>as a driver that will return a <code>Future</code></li> 
   <li>via <code>ActorRef</code> publisher (usefull for standard interaction with your gremlin server)</li> 
   <li>via <code>Flow[GremlinRequest, _]</code> flow that you create from another <code>Source</code>. This is extreamly usfull when bulk loading data from a file or other source. More on this below.</li> 
  </ul> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#driver-returning-a-future-example" aria-hidden="true" class="anchor" id="user-content-driver-returning-a-future-example" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>driver returning a future example</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">gclient</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GremlinClient</span>(host<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>ws://localhost:8182<span class="pl-pds">"</span></span>,maxInFlight<span class="pl-k">=</span><span class="pl-c1">100</span>)
gclient.query(<span class="pl-s"><span class="pl-pds">"</span>g.V().has('email','donald@trumpdonald.org').has('is_douchebag','true').valueMap();<span class="pl-pds">"</span></span>)
       .map{ <span class="pl-v">x</span>: <span class="pl-en">Gremlin</span>.<span class="pl-en">Response</span> <span class="pl-k">=&gt;</span>
          <span class="pl-k">val</span> <span class="pl-en">json</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">List</span>[<span class="pl-en">JsValue</span>]] <span class="pl-k">=</span> x.result.data
          ...
       }</pre>
  </div> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#actor-push-example" aria-hidden="true" class="anchor" id="user-content-actor-push-example" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>actor push example</h3> 
  <p>Here is a simple but full example of how to use the client</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">response</span>(res<span class="pl-k">:</span><span class="pl-en">Gremlin</span>.<span class="pl-en">Response</span>)<span class="pl-k">:</span><span class="pl-k">Unit</span> <span class="pl-k">=</span> {
  println(s<span class="pl-s"><span class="pl-pds">"</span>The response is ${res}<span class="pl-pds">"</span></span>)
}

<span class="pl-k">val</span> <span class="pl-en">gclient</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GremlinClient</span>(host<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>ws://localhost:8182<span class="pl-pds">"</span></span>,maxInFlight<span class="pl-k">=</span><span class="pl-c1">100</span>, onResponse <span class="pl-k">=</span> <span class="pl-en">Some</span>(response))
<span class="pl-k">val</span> <span class="pl-en">producer</span> <span class="pl-k">=</span> gclient.connectActor

<span class="pl-k">val</span> <span class="pl-en">simple</span> <span class="pl-k">=</span> <span class="pl-en">GremlinClient</span>.buildRequest(<span class="pl-s"><span class="pl-pds">"</span>g.V().has('email','donald@trumpdonald.org').has('is_douchebag','true').valueMap();<span class="pl-pds">"</span></span>)
<span class="pl-k">val</span> <span class="pl-en">create</span> <span class="pl-k">=</span> <span class="pl-en">GremlinClient</span>.buildRequest(<span class="pl-s"><span class="pl-pds">"</span>graph.addVertex(label, 'entity','uri','https://en.wikipedia.org/wiki/Donald_Trump');<span class="pl-pds">"</span></span>)

producer <span class="pl-k">!</span> simple
producer <span class="pl-k">!</span> create
</pre>
  </div> 
  <h3><a href="https://github.com/coreyauger/reactive-gremlin#flow-example" aria-hidden="true" class="anchor" id="user-content-flow-example" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>flow example</h3> 
  <p>Here is a file streaming example (bulk loader)</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">response</span>(res<span class="pl-k">:</span><span class="pl-en">Gremlin</span>.<span class="pl-en">Response</span>)<span class="pl-k">:</span><span class="pl-k">Unit</span> <span class="pl-k">=</span> {
  println(s<span class="pl-s"><span class="pl-pds">"</span>The response is ${res}<span class="pl-pds">"</span></span>)
}

<span class="pl-k">val</span> <span class="pl-en">gclient</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GremlinClient</span>(host<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>ws://localhost:8182<span class="pl-pds">"</span></span>,maxInFlight<span class="pl-k">=</span><span class="pl-c1">100</span>, onResponse <span class="pl-k">=</span> <span class="pl-en">Some</span>(response))

<span class="pl-k">val</span> <span class="pl-en">csv</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">File</span>(<span class="pl-s"><span class="pl-pds">"</span>/path/to/csv<span class="pl-pds">"</span></span>)
<span class="pl-k">val</span> <span class="pl-en">flow</span> <span class="pl-k">=</span> <span class="pl-en">FileIO</span>.fromFile(outFile)
          .via(<span class="pl-en">Framing</span>.delimiter(
            <span class="pl-en">ByteString</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>),
            maximumFrameLength <span class="pl-k">=</span> <span class="pl-c1">1000000</span>,
            allowTruncation <span class="pl-k">=</span> <span class="pl-c1">false</span>))
          .map(_.utf8String)
          .mapConcat{ line <span class="pl-k">=&gt;</span>
            <span class="pl-c"><span class="pl-c">//</span> parse and form some gremlin groove insert script</span>
            <span class="pl-c"><span class="pl-c">//</span> we call that `gscript`</span>
            <span class="pl-en">GremlinClient</span>.buildRequest(gscript)
          }
          
gclient.connectFlow(flow)   <span class="pl-c"><span class="pl-c">//</span> connect and run graph</span>
</pre>
  </div> 
 </article>
</div>