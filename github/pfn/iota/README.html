<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-iota---an-io-type-for-android" class="anchor" href="https://github.com/pfn/iota#iota---an-io-type-for-android" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>IOTA - an IO Type for Android</h1> 
  <p>A small, an iota, side-effect tracking library and layout DSL</p> 
  <h2><a id="user-content-add-to-your-build" class="anchor" href="https://github.com/pfn/iota#add-to-your-build" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>add to your build</h2> 
  <p><code>libraryDependencies += "com.hanhuy.android" %% "iota" % "1.0.4"</code></p> 
  <p>Clear proguard warnings, these will not cause any runtime crashes (scala 2.10 macro backward compat support)</p> 
  <p><code>proguardOptions += "-dontwarn iota.Internal210**"</code></p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/pfn/iota#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p><code>import iota._</code> or import individual components from <code>iota.std._</code> and <code>iota.IO</code></p> 
  <p>The basic type is <code>iota.IO</code> which is a side-effect tracking monad. It offers the functions <code>perform</code>, <code>performMain</code>, <code>map</code>, <code>flatMap</code> and <code>&gt;&gt;=</code> which is an alias for <code>flatMap</code>. Any side-effects passed to <code>IO</code> will not run until <code>perform</code> is invoked. <code>IO</code> objects can be created using the <code>IO(any)</code> factory, and can be composed using <code>&gt;&gt;=</code> and <code>map</code></p> 
  <p>All compositions are functions, no special classes.</p> 
  <h3><a id="user-content-available-components" class="anchor" href="https://github.com/pfn/iota#available-components" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Available components</h3> 
  <ul> 
   <li><code>Combinators._</code> - defines the K-combinator <code>kestrel[A](f: A =&gt; _)</code>: <code>A =&gt; IO[A]</code></li> 
   <li><code>AutoK._</code> - defines <code>k[A]</code> macro, used to turn any function on <code>A</code> into a K-combinator, e.g. <code>TextView#setHint</code> can be accessed as <code>k.hint</code> and <code>k.setHint</code></li> 
   <li><code>Single._</code> - defines <code>single[A]</code> which can be used to implement anonymous abstract classes and all interfaces. e.g., <code>single[TextWatcher].onTextChanged((s: CharSequence, x: Int, y: Int, z: Int) =&gt; println(s))</code> can implement a <code>TextWatcher#onTextChanged</code> while doing a no-op for the <code>afterTextChanged</code> and <code>beforeTextChanged</code> methods.</li> 
   <li><code>Kleisli._</code> - provides <code>&gt;=&gt;</code> (andThen) to compose <code>A =&gt; IO[B]</code> functions</li> 
   <li><code>Ternary._</code> - <code>condK(condition ? (A =&gt; IO[B]) | (A =&gt; IO[B])) composition</code></li> 
   <li><code>Views._</code> - has <code>w[View]</code>, <code>l[View]</code> and <code>c[View]</code> functions, <code>w</code> and <code>l</code> behave like in macroid, <code>w</code> for creating widgets, and <code>l</code> for creating ViewGroups with children. <code>c</code> is a helper function for providing the ViewGroup type for LayoutParams creation when not inside of <code>IO[_ &lt;: ViewGroup].apply()</code>.</li> 
   <li><code>Contexts._</code> - implicit materializer for <code>android.content.Context</code> depending on what class one is in (<code>Activity</code>, <code>Fragment</code>, <code>HasContext</code>, etc), also implements a type-safe <code>systemService[T]</code> lookup</li> 
   <li><code>Configurations._</code> - has functions for detecting the current configuration: <code>sw(smallest-width)</code>, <code>v(version)</code>, <code>landscape</code> and <code>portrait</code></li> 
   <li><code>FutureCombinators._</code> - defines combinators <code>defer</code> and <code>deferF</code> for working with <code>IO[Future[A]]</code></li> 
   <li><code>LayoutCombinators._</code> - has <code>margins</code>, <code>lp</code> and <code>lpK</code> functions for working with layout params</li> 
   <li><code>ViewCombinators._</code> - generic <code>View</code> manipulation, id, <code>hook*</code>, animate, etc.</li> 
   <li><code>ViewCombinatorExtras._</code> - more generic <code>View</code> manipualation, backgrounds, visibility, etc.</li> 
   <li><code>TextCombinators._</code> - <code>TextView</code> manipulators, for <code>text</code>, <code>inputType</code>, <code>hint</code> and others</li> 
   <li><code>ImageCombinators._</code> - set <code>imageResource</code> and <code>imageScale</code> for <code>ImageView</code>s</li> 
   <li><code>MainThreadExecutionContext</code> - an <code>ExecutionContext</code> for working with <code>Future</code>s that should execute their callbacks on the UI thread</li> 
  </ul> 
  <h2><a id="user-content-example" class="anchor" href="https://github.com/pfn/iota#example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
  <p>The following creates a <code>LinearLayout</code> with 2 buttons, "Click Me" and "Click Me 2", vertically. It also registers onClick listeners to each button using two different approaches, one where the inputs to the listener are ignored, and one where the input is used.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">iota.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">android.app.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">android.os.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">android.content.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">android.view.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">android.widget.</span><span class="pl-v">_</span>

<span class="pl-k">class</span> <span class="pl-en">MyActivity</span> <span class="pl-k">extends</span> <span class="pl-e">Activity</span> {

  <span class="pl-c"><span class="pl-c">//</span> compose multiple A =&gt; IO[A] together, re-use them anywhere we would like</span>
  <span class="pl-c"><span class="pl-c">//</span> c[LinearLayout] is necessary to hint to `lpK` that LinearLayout.LayoutParams</span>
  <span class="pl-c"><span class="pl-c">//</span> need to be created.</span>
  <span class="pl-k">val</span> <span class="pl-en">button2Adjustments</span><span class="pl-k">:</span> <span class="pl-en">Kestrel</span>[<span class="pl-en">Button</span>] <span class="pl-k">=</span> c[<span class="pl-en">LinearLayout</span>](
    k.text(<span class="pl-s"><span class="pl-pds">"</span>Click Me 2<span class="pl-pds">"</span></span>) <span class="pl-k">&gt;=&gt;</span> hook.onClick((<span class="pl-v">v</span>: <span class="pl-en">View</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">IO</span> {
      <span class="pl-en">Toast</span>.makeText(<span class="pl-c1">this</span>, s<span class="pl-s"><span class="pl-pds">"</span>button ${v.getId} was clicked<span class="pl-pds">"</span></span>, <span class="pl-en">Toast</span>.<span class="pl-en">LENGTH_SHORT</span>).show()
    }) <span class="pl-k">&gt;=&gt;</span> lpK(<span class="pl-en">WRAP_CONTENT</span>, <span class="pl-en">WRAP_CONTENT</span>, <span class="pl-c1">1.0f</span>){ <span class="pl-v">p</span>: <span class="pl-en">LinearLayout</span>.<span class="pl-en">LayoutParams</span> <span class="pl-k">=&gt;</span>
      p.gravity <span class="pl-k">=</span> <span class="pl-en">Gravity</span>.<span class="pl-en">CENTER</span>
      margins(all <span class="pl-k">=</span> <span class="pl-c1">16.</span>dp)(p)
    }
  )

  <span class="pl-c"><span class="pl-c">//</span> use a view holder pattern, such as the declaration below, for optimal static safety</span>
  <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">button2</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Button</span>(<span class="pl-c1">this</span>)
  <span class="pl-k">val</span> <span class="pl-en">layout</span> <span class="pl-k">=</span> l[<span class="pl-en">LinearLayout</span>](
    w[<span class="pl-en">Button</span>] <span class="pl-k">&gt;&gt;=</span> k.text(<span class="pl-s"><span class="pl-pds">"</span>Click Me<span class="pl-pds">"</span></span>) <span class="pl-k">&gt;&gt;=</span> hook.onClick { <span class="pl-v">v</span>: <span class="pl-en">View</span> <span class="pl-k">=&gt;</span>
      <span class="pl-c"><span class="pl-c">//</span> this example will animate the button's alpha to transparent and back upon click</span>
      <span class="pl-c"><span class="pl-c">//</span> the text will change to "Alpha 0" when the first animation completes, and will</span>
      <span class="pl-c"><span class="pl-c">//</span> change to "Alpha 1" when the second animation completes</span>
      <span class="pl-en">IO</span>(v.<span class="pl-c1">asInstanceOf</span>[<span class="pl-en">TextView</span>]) <span class="pl-k">&gt;&gt;=</span>
        animate(_.alpha(<span class="pl-c1">0</span>)) <span class="pl-k">&gt;&gt;=</span> defer(k.text(<span class="pl-s"><span class="pl-pds">"</span>Alpha 0<span class="pl-pds">"</span></span>)) <span class="pl-k">&gt;&gt;=</span>
        deferF(animate(_.alpha(<span class="pl-c1">1</span>))) <span class="pl-k">&gt;&gt;=</span> defer(k.text(<span class="pl-s"><span class="pl-pds">"</span>Alpha 1<span class="pl-pds">"</span></span>))
    } <span class="pl-k">&gt;&gt;=</span> lp(<span class="pl-en">WRAP_CONTENT</span>, <span class="pl-en">WRAP_CONTENT</span>, <span class="pl-c1">1.0f</span>),
    <span class="pl-en">IO</span>(button2) <span class="pl-k">&gt;&gt;=</span> button2Adjustments <span class="pl-k">&gt;&gt;=</span> id(<span class="pl-en">Id</span>.button2),
    w[<span class="pl-en">ListView</span>] <span class="pl-k">&gt;&gt;=</span> lp(<span class="pl-en">WRAP_CONTENT</span>, <span class="pl-en">WRAP_CONTENT</span>, <span class="pl-c1">1.0f</span>) <span class="pl-k">&gt;&gt;=</span>
      hookM.scroll.onScrollStateChanged((<span class="pl-v">list</span>: <span class="pl-en">AbsListView</span>, <span class="pl-v">state</span>: <span class="pl-k">Int</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">IO</span> {
        <span class="pl-c"><span class="pl-c">//</span> partially implemented listeners with direct method name overrides</span>
        <span class="pl-c"><span class="pl-c">//</span> can also be used as `hookM0.scroll.onScrollStateChanged` if the input</span>
        <span class="pl-c"><span class="pl-c">//</span> parameters can be ignored.</span>
        <span class="pl-en">Toast</span>.makeText(<span class="pl-c1">this</span>, <span class="pl-s"><span class="pl-pds">"</span>Scroll state changed: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> state, <span class="pl-en">Toast</span>.<span class="pl-en">LENGTH_SHORT</span>).show()
      })
  ) <span class="pl-k">&gt;&gt;=</span> k.orientation(<span class="pl-en">LinearLayout</span>.<span class="pl-en">VERTICAL</span>)

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">onCreate</span>(<span class="pl-v">b</span>: <span class="pl-en">Bundle</span>) {
    setContentView(layout.perform())
    button2.setText(<span class="pl-s"><span class="pl-pds">"</span>new label<span class="pl-pds">"</span></span>)
  }
}</pre>
  </div> 
  <p>This <a href="https://github.com/pfn/iota/blob/master/sample/src/main/scala/iotatest/AnActivity.scala" target="_blank">sample</a> is a sandbox for trying out all the macros and features available in <code>iota</code>.</p> 
  <h4><a id="user-content-motivations-for-creation" class="anchor" href="https://github.com/pfn/iota#motivations-for-creation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Motivations for creation</h4> 
  <p>As a long time user of <code>macroid</code> I enjoy what it brought to layout dsl, but do not like how certain features work: mixing in <code>Contexts[A]</code>, extremely verbose <code>lp</code> layout parameter creation, failures in type inference, lack of type-safety in ID lookups, and operators that don't necessarily make sense (i.e. <code>&lt;~</code>, et al). The design goal here is to be as pure as possible while remaining terse and using an existing vocabulary: <code>kestrel</code> (K-combinator), <code>&gt;&gt;=</code> (flatMap, bind), <code>&gt;=&gt;</code> (kleisli composition), etc.</p> 
 </article>
</div>