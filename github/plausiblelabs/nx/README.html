<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/plausiblelabs/nx#no-exceptions-checked-exceptions-for-scala" aria-hidden="true" class="anchor" id="user-content-no-exceptions-checked-exceptions-for-scala" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>No Exceptions: Checked Exceptions for Scala</h1> 
  <p>NX ("No Exceptions") is a Scala compiler plugin (2.10 and 2.11) that provides support for Java-style <a href="http://en.wikipedia.org/wiki/Exception_handling#Checked_exceptions" target="_blank">checked exceptions</a>.</p> 
  <p><em>This is not an endorsement of the use of exceptions in Scala, checked or otherwise.</em></p> 
  <p>The double-meaning of the name is not an accident; the only thing worse than <em>checked</em> exceptions are <em>unchecked</em> exceptions, but we'd rather have <em>no exceptions</em>:</p> 
  <ul> 
   <li>Checked exceptions are as much part of a function's type as its successful return value. There should be <strong>no exceptions</strong> to compiler type checking.</li> 
   <li>Exceptions are a horrendous way to express error conditions. We always prefer monadic approaches such as <a href="http://www.scala-lang.org/api/2.10.3/index.html#scala.Option" target="_blank">Option</a> and <a href="http://www.scala-lang.org/api/2.10.3/index.html#scala.util.Either" target="_blank">Either</a>. There should be <strong>no exceptions</strong> used in non-Java code (and possibly even there).</li> 
  </ul> 
  <p>Having compiler checked exceptions has been particularly valuable in finding bugs in code that interfaces with traditional exception-throwing Java APIs, and overall, we think that <em>if Scala is going to support exceptions at all</em>, compiler-checked exceptions are a net gain. Checked exceptions simply expose the true cost of exceptions.</p> 
  <p>We're using the plugin with our own code, and in the process of migration, discovered a number of bugs where we'd failed to handle error paths correctly. I expect such latent bugs to be relatively common in most Scala code bases.</p> 
  <h2><a href="https://github.com/plausiblelabs/nx#standard-setup" aria-hidden="true" class="anchor" id="user-content-standard-setup" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Standard Setup</h2> 
  <p>There are two ways to use NX:</p> 
  <ul> 
   <li>As a compiler plugin, which will check all code.</li> 
   <li>As a macro, which can be used to check only specific code paths.</li> 
  </ul> 
  <h4><a href="https://github.com/plausiblelabs/nx#sbt" aria-hidden="true" class="anchor" id="user-content-sbt" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SBT</h4> 
  <p>Enable the NX compiler plugin (if desired) in <code>build.sbt</code>:</p> 
  <pre><code>addCompilerPlugin("coop.plausible.nx" %% "no-exceptions" % "1.0.1")
</code></pre> 
  <p>If you want to use compile-time annotations and macros, add a library dependency to <code>built.sbt</code>:</p> 
  <pre><code>libraryDependencies ++= Seq(
	"coop.plausible.nx"          %%  "no-exceptions"     % "1.0.1"
)
</code></pre> 
  <h4><a href="https://github.com/plausiblelabs/nx#command-line" aria-hidden="true" class="anchor" id="user-content-command-line" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Command Line</h4> 
  <p>Pass <code>-Xplugin:...</code> to <code>scalac</code>:</p> 
  <pre><code>scalac -Xplugin:no-exceptions_2.10-1.0.1.jar source.scala
</code></pre> 
  <h2><a href="https://github.com/plausiblelabs/nx#standard-usage" aria-hidden="true" class="anchor" id="user-content-standard-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Standard Usage</h2> 
  <p>By default, the plugin will apply the standard Java rules for checked and unchecked exceptions:</p> 
  <ul> 
   <li>All subclasses of <code>RuntimeException</code> are considered unchecked.</li> 
   <li>All subclasses of <code>Error</code> are considered unechecked.</li> 
  </ul> 
  <p>The default checked exception behavior can be adjusted with the <code>-P:nx:checked:</code> compiler argument:</p> 
  <ul> 
   <li>Default Java checked exception behavior is enabled with <code>-P:nx:checked:standard</code>.</li> 
   <li>Strict checking (only subtypes of <code>Error</code> will be treated as unchecked) can be enabled with <code>-P:nx:checked:strict</code></li> 
   <li>Fatal checking (only VM "fatal" exceptions will be treated as unchecked -- VirtualMachineError, AssertionError, LinkageError) can be enabled with <code>-P:nx:checked:fatal</code></li> 
  </ul> 
  <p>As an alternative to the compiler plugin, you can use the <code>coop.plausible.nx.exceptionChecked</code> macro to perform compile-time validation of an explicit subset of your code:</p> 
  <pre><code>val address = exceptionChecked {
	InetAddresss.getByName(name)
}
</code></pre> 
  <p>This operates identically to the compiler plugin, validating only the code within the checked block.</p> 
  <h4><a href="https://github.com/plausiblelabs/nx#declaring-thrown-exceptions" aria-hidden="true" class="anchor" id="user-content-declaring-thrown-exceptions" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Declaring Thrown Exceptions</h4> 
  <p>NX will automatically flag unhandled exceptions as compiler errors. These must either by caught via <code>try</code> blocks (see below), or declared to be thrown via Scala's standard <a href="http://www.scala-lang.org/api/2.10.3/index.html#scala.throws" target="_blank">@throws</a> annotation.</p> 
  <p>The <code>@throws</code> behavior follows Scala's standard annotation behavior; we document some of the common usages below.</p> 
  <h5><a href="https://github.com/plausiblelabs/nx#annotating-methods" aria-hidden="true" class="anchor" id="user-content-annotating-methods" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Annotating Methods</h5> 
  <p>If annotated with <code>@throws</code>, a method's annotation applies to the entirity of the method, but <em>not</em> nested <code>def</code> statements:</p> 
  <pre><code>@throws[IOException]("if the file can not be opened")
def openFile (path: Path): Result = { ... }
</code></pre> 
  <p>In addition, NX will not permit a <code>@throws</code>-annotated method to be assigned to a function-typed <code>val</code> or <code>var</code>, or returned as a function-typed value, as this will cause the exception typing to be lost. For example, the following will trigger an NX compile-time error:</p> 
  <pre><code>@throws[IOException]("if something goes pear shaped") def thrower: Unit = { ... }
val nonthrower: (Boolean =&gt; Unit) = thrower
</code></pre> 
  <h5><a href="https://github.com/plausiblelabs/nx#annotating-class-constructors" aria-hidden="true" class="anchor" id="user-content-annotating-class-constructors" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Annotating Class Constructors</h5> 
  <p>If annotated with <code>@throws</code>, the primary class constructor's annotations apply to the entirity of the class initializer, including the class body and any <code>val</code> initializers -- but <em>not</em> <code>lazy val</code> initializers.</p> 
  <p>To annotate a class primary constructor with <code>@throws</code>:</p> 
  <pre><code>class AClass @throws[IOException]("if the file can not be opened") () {
}
</code></pre> 
  <p>Any <code>@throws</code> annotations declared on the primary constructor will be automatically propagated to auxiliary constructors; auxilliary constructors can be further annotated using standard method annotations:</p> 
  <pre><code>class AClass @throws[IOException]("if the file can not be opened") (path: Path) {
	@throws[AdditionalException]
	def this() = { this("...") }
}
</code></pre> 
  <h4><a href="https://github.com/plausiblelabs/nx#handling-exceptions-with-try--catch" aria-hidden="true" class="anchor" id="user-content-handling-exceptions-with-try--catch" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Handling Exceptions With Try / Catch</h4> 
  <p>The standard Scala try/catch mechanism works as expected, with one caveat: <code>catch</code> clauses based on runtime pattern matching cannot be statically validated, and will trigger an unhandled exception compiler error if the exception is not otherwise handled. For example, the following statement will treat IOException exception as unhandled:</p> 
  <pre><code>try {
	...
} catch {
	case e:IOException if e.getMessage.startsWith("What is love?") =&gt; ...
}
</code></pre> 
  <p>Non-static extractors, which rely on runtime evaluation, are also non-statically verifiable and are treated as unhandled. For example, Scala's <code>NonFatal</code> class will not be considered a match for unhandled exceptions:</p> 
  <pre><code>try {
	...
} catch {
	case NonFatal(e) =&gt; 
}
</code></pre> 
  <p>In the future, we may add special-casing for specific classes -- such as NonFatal(e) -- that treat exceptions as handled if we can statically verify the exceptions will be caught via the classes' defined API. Patches to this effect are certainly welcome.</p> 
  <h4><a href="https://github.com/plausiblelabs/nx#asserting-non-throwable-exceptions" aria-hidden="true" class="anchor" id="user-content-asserting-non-throwable-exceptions" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Asserting Non-Throwable Exceptions</h4> 
  <p>If you have a pesky exception that you <strong>know</strong> can not be thrown, you can quiesce NX with the <code>coop.plausible.nx.assertNonThrows</code> macro:</p> 
  <pre><code>val bytes = assertNonThrows[UnsupportedEncodingException](string.getBytes("UTF-8"))
</code></pre> 
  <p>This will cause NX's checking to treat the given exception as handled; if the exception is thrown, it will be promoted to an <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/AssertionError.html" target="_blank">AssertionError</a> and rethrown.</p> 
  <h4><a href="https://github.com/plausiblelabs/nx#selectively-disabling-validation" aria-hidden="true" class="anchor" id="user-content-selectively-disabling-validation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Selectively Disabling Validation</h4> 
  <p>Validation can also be turned off on a per-method and per-class basis by using the <code>coop.plausible.nx.UncheckedExceptions</code> annotation:</p> 
  <pre><code>/* Validation is disabled within the entire method */
@UncheckedExceptions
def livingDangerously (): Unit = {
}

/* Validation is disabled within the primary constructor */
class LivingDangerously @UncheckedExceptions () {
}

/* Validation is disabled within the entire class */
@UncheckedExceptions
class LivingDangerously {
}
</code></pre> 
  <p><strong>Warning:</strong> This API should be considered experimental and subject to change:</p> 
  <ul> 
   <li>The plugin may be extended to consider an <code>@UncheckedExceptions</code> statement to also be a blanket <code>@throws[Throwable]</code>, and require an <code>catch</code> in any checked calling code.</li> 
   <li>The behavior of <code>@UncheckedExceptions</code> may be modified to not apply to nested <code>def</code> statements within a method.</li> 
  </ul> 
 </article>
</div>