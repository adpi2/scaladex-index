<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/t2v/play2-auth#play2x-module-for-authentication-and-authorization-" aria-hidden="true" class="anchor" id="user-content-play2x-module-for-authentication-and-authorization-" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Play2.x module for Authentication and Authorization <a href="https://travis-ci.org/t2v/play2-auth" target="_blank"><img src="https://camo.githubusercontent.com/9630b9e4c2e9086154d495983fe0c1ab3b930cb0/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f7432762f706c6179322d617574682e706e67" alt="Build Status" data-canonical-src="https://secure.travis-ci.org/t2v/play2-auth.png" style="max-width:100%;"></a></h1> 
  <p><a href="https://gitter.im/t2v/play2-auth?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank">![Gitter](https://badges.gitter.im/Join Chat.svg)</a></p> 
  <p>This module offers Authentication and Authorization features to Play2.x applications</p> 
  <h2><a href="https://github.com/t2v/play2-auth#scaladoc" aria-hidden="true" class="anchor" id="user-content-scaladoc" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scaladoc</h2> 
  <ul> 
   <li><a href="http://javadoc-badge.appspot.com/jp.t2v/play2-auth_2.11/index.html#jp.t2v.lab.play2.auth.package" target="_blank"><img src="https://camo.githubusercontent.com/46a45c8cc954e0d6a5cf31a9f4dce6855bb8696c/687474703a2f2f6a617661646f632d62616467652e61707073706f742e636f6d2f6a702e7432762f706c6179322d617574685f322e31312e7376673f6c6162656c3d706c6179322d61757468" alt="play2-auth scaladoc" data-canonical-src="http://javadoc-badge.appspot.com/jp.t2v/play2-auth_2.11.svg?label=play2-auth" style="max-width:100%;"></a></li> 
   <li><a href="http://javadoc-badge.appspot.com/jp.t2v/play2-auth-social_2.11/index.html#jp.t2v.lab.play2.auth.social.package" target="_blank"><img src="https://camo.githubusercontent.com/8a259eb5ea6ed2aa8cc7e3c2702519ed9e7d6b56/687474703a2f2f6a617661646f632d62616467652e61707073706f742e636f6d2f6a702e7432762f706c6179322d617574682d736f6369616c5f322e31312e7376673f6c6162656c3d706c6179322d617574682d736f6369616c" alt="play2-auth-social scaladoc" data-canonical-src="http://javadoc-badge.appspot.com/jp.t2v/play2-auth-social_2.11.svg?label=play2-auth-social" style="max-width:100%;"></a></li> 
   <li><a href="http://javadoc-badge.appspot.com/jp.t2v/play2-auth-test_2.11/index.html#jp.t2v.lab.play2.auth.test.package" target="_blank"><img src="https://camo.githubusercontent.com/8594d583f4349b5f9723964b3381c8edb70f6125/687474703a2f2f6a617661646f632d62616467652e61707073706f742e636f6d2f6a702e7432762f706c6179322d617574682d746573745f322e31312e7376673f6c6162656c3d706c6179322d617574682d74657374" alt="play2-auth-test scaladoc" data-canonical-src="http://javadoc-badge.appspot.com/jp.t2v/play2-auth-test_2.11.svg?label=play2-auth-test" style="max-width:100%;"></a></li> 
  </ul> 
  <h2><a href="https://github.com/t2v/play2-auth#target" aria-hidden="true" class="anchor" id="user-content-target" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Target</h2> 
  <p>This module targets the <strong>Scala</strong> version of <strong>Play2.x</strong>.</p> 
  <h2><a href="https://github.com/t2v/play2-auth#motivation" aria-hidden="true" class="anchor" id="user-content-motivation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Motivation</h2> 
  <h3><a href="https://github.com/t2v/play2-auth#more-secure-than-play2xs-security-trait" aria-hidden="true" class="anchor" id="user-content-more-secure-than-play2xs-security-trait" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More secure than Play2.x's Security trait</h3> 
  <p>The existing <code>Security</code> trait in Play2.x API does not define an identifier that identifies a user.</p> 
  <p>If you use an Email or a userID as an identifier, users can not invalidate their session if the session cookie is intercepted.</p> 
  <p>This module creates a unique SessionID using a secure random number generator. Even if the sessionId cookie is intercepted, users can invalidate the session by logging in again. Your application can expire sessions after a set time limit.</p> 
  <h3><a href="https://github.com/t2v/play2-auth#flexiblity" aria-hidden="true" class="anchor" id="user-content-flexiblity" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Flexiblity</h3> 
  <p>Since the <code>Security</code> trait in Play2.x API returns <code>Action</code>, complicated action methods wind up deeply nested.</p> 
  <p>Play2x-Auth provides a way of composition.</p> 
  <h2><a href="https://github.com/t2v/play2-auth#previous-version" aria-hidden="true" class="anchor" id="user-content-previous-version" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Previous Version</h2> 
  <p>for Play2.3.x, Please see <a href="https://github.com/t2v/play2-auth/blob/release0.13.5/README.md" target="_blank">previous version 0.13.5 README</a></p> 
  <p>for Play2.2.x, Please see <a href="https://github.com/t2v/play2-auth/blob/release0.11.1/README.md" target="_blank">previous version 0.11.1 README</a></p> 
  <h2><a href="https://github.com/t2v/play2-auth#attention" aria-hidden="true" class="anchor" id="user-content-attention" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Attention</h2> 
  <p><strong>Since Play2.3's <code>SimpleResult</code> is renamed to <code>Result</code>, The play2.auth trait signatures are changed at version 0.12.0</strong></p> 
  <p><strong>Since Play2.2's <code>Result</code> is deprecated, The play2.auth trait signatures are changed at version 0.11.0</strong></p> 
  <h2><a href="https://github.com/t2v/play2-auth#installation" aria-hidden="true" class="anchor" id="user-content-installation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>Add dependency declarations into your <code>Build.scala</code> or <code>build.sbt</code> file:</p> 
  <ul> 
   <li> <p><strong>for Play2.4.x</strong></p> <pre><code>  "jp.t2v" %% "play2-auth"        % "0.14.2",
  "jp.t2v" %% "play2-auth-social" % "0.14.2", // for social login
  "jp.t2v" %% "play2-auth-test"   % "0.14.2" % "test",
  play.sbt.Play.autoImport.cache // only when you use default IdContainer
</code></pre> </li> 
  </ul> 
  <p>For example your <code>Build.scala</code> might look like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">val</span> <span class="pl-en">appDependencies</span> <span class="pl-k">=</span> <span class="pl-en">Seq</span>(
    <span class="pl-s"><span class="pl-pds">"</span>jp.t2v<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play2-auth<span class="pl-pds">"</span></span>        <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.14.2<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>jp.t2v<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play2-auth-social<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.14.2<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>jp.t2v<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play2-auth-test<span class="pl-pds">"</span></span>   <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.14.2<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>,
    play.sbt.<span class="pl-en">Play</span>.autoImport.cache
  )</pre>
  </div> 
  <h2><a href="https://github.com/t2v/play2-auth#usage" aria-hidden="true" class="anchor" id="user-content-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <ol> 
   <li> <p>First create a trait that extends <code>jp.t2v.lab.play2.auth.AuthConfig</code> in <code>app/controllers</code>.</p> 
    <div class="highlight highlight-source-scala">
     <pre><span class="pl-c"><span class="pl-c">//</span> Example</span>
<span class="pl-k">import</span> <span class="pl-v">jp.t2v.lab.play2.auth.</span><span class="pl-v">_</span>

<span class="pl-k">trait</span> <span class="pl-en">AuthConfigImpl</span> <span class="pl-k">extends</span> <span class="pl-e">AuthConfig</span> {

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A type that is used to identify a user.</span>
<span class="pl-c">   * `String`, `Int`, `Long` and so on.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">type</span> <span class="pl-en">Id</span> <span class="pl-k">=</span> <span class="pl-k">String</span>

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A type that represents a user in your application.</span>
<span class="pl-c">   * `User`, `Account` and so on.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">type</span> <span class="pl-en">User</span> <span class="pl-k">=</span> <span class="pl-en">Account</span>

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A type that is defined by every action for authorization.</span>
<span class="pl-c">   * This sample uses the following trait:</span>
<span class="pl-c">   *</span>
<span class="pl-c">   * sealed trait Role</span>
<span class="pl-c">   * case object Administrator extends Role</span>
<span class="pl-c">   * case object NormalUser extends Role</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">type</span> <span class="pl-en">Authority</span> <span class="pl-k">=</span> <span class="pl-en">Role</span>

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A `ClassTag` is used to retrieve an id from the Cache API.</span>
<span class="pl-c">   * Use something like this:</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">idTag</span><span class="pl-k">:</span> <span class="pl-en">ClassTag</span>[<span class="pl-en">Id</span>] <span class="pl-k">=</span> classTag[<span class="pl-en">Id</span>]

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * The session timeout in seconds</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">sessionTimeoutInSeconds</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span> <span class="pl-c1">3600</span>

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A function that returns a `User` object from an `Id`.</span>
<span class="pl-c">   * You can alter the procedure to suit your application.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">resolveUser</span>(<span class="pl-v">id</span>: <span class="pl-en">Id</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Option</span>[<span class="pl-en">User</span>]] <span class="pl-k">=</span> <span class="pl-en">Account</span>.findById(id)

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * Where to redirect the user after a successful login.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">loginSucceeded</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span>
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Redirect</span>(routes.<span class="pl-en">Message</span>.main))

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * Where to redirect the user after logging out</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">logoutSucceeded</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span>
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Redirect</span>(routes.<span class="pl-en">Application</span>.login))

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * If the user is not logged in and tries to access a protected resource then redirect them as follows:</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">authenticationFailed</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span>
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Redirect</span>(routes.<span class="pl-en">Application</span>.login))

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * If authorization failed (usually incorrect password) redirect the user as follows:</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">authorizationFailed</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>, <span class="pl-v">user</span>: <span class="pl-en">User</span>, <span class="pl-v">authority</span>: <span class="pl-en">Option</span>[<span class="pl-en">Authority</span>])(<span class="pl-k">implicit</span> <span class="pl-v">context</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span> {
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Forbidden</span>(<span class="pl-s"><span class="pl-pds">"</span>no permission<span class="pl-pds">"</span></span>))
  }

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * A function that determines what `Authority` a user has.</span>
<span class="pl-c">   * You should alter this procedure to suit your application.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">authorize</span>(<span class="pl-v">user</span>: <span class="pl-en">User</span>, <span class="pl-v">authority</span>: <span class="pl-en">Authority</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>] <span class="pl-k">=</span> <span class="pl-en">Future</span>.successful {
    (user.role, authority) <span class="pl-k">match</span> {
      <span class="pl-k">case</span> (<span class="pl-en">Administrator</span>, _)       <span class="pl-k">=&gt;</span> <span class="pl-c1">true</span>
      <span class="pl-k">case</span> (<span class="pl-en">NormalUser</span>, <span class="pl-en">NormalUser</span>) <span class="pl-k">=&gt;</span> <span class="pl-c1">true</span>
      <span class="pl-k">case</span> _                        <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>
    }
  }

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * (Optional)</span>
<span class="pl-c">   * You can custom SessionID Token handler.</span>
<span class="pl-c">   * Default implementation use Cookie.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">override</span> <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">tokenAccessor</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">CookieTokenAccessor</span>(
    <span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">     * Whether use the secure option or not use it in the cookie.</span>
<span class="pl-c">     * Following code is default.</span>
<span class="pl-c">     <span class="pl-c">*/</span></span>
    cookieSecureOption <span class="pl-k">=</span> play.api.<span class="pl-en">Play</span>.isProd(play.api.<span class="pl-en">Play</span>.current),
    cookieMaxAge       <span class="pl-k">=</span> <span class="pl-en">Some</span>(sessionTimeoutInSeconds)
  )

}</pre>
    </div> </li> 
   <li> <p>Next create a <code>Controller</code> that defines both login and logout actions. This <code>Controller</code> mixes in the <code>jp.t2v.lab.play2.auth.LoginLogout</code> trait and the trait that you created in first step.</p> 
    <div class="highlight highlight-source-scala">
     <pre><span class="pl-k">object</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">LoginLogout</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

<span class="pl-c">  <span class="pl-c">/**</span> Your application's login form.  Alter it to fit your application <span class="pl-c">*/</span></span>
  <span class="pl-k">val</span> <span class="pl-en">loginForm</span> <span class="pl-k">=</span> <span class="pl-en">Form</span> {
    mapping(<span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> email, <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> text)(<span class="pl-en">Account</span>.authenticate)(_.map(u <span class="pl-k">=&gt;</span> (u.email, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)))
      .verifying(<span class="pl-s"><span class="pl-pds">"</span>Invalid email or password<span class="pl-pds">"</span></span>, result <span class="pl-k">=&gt;</span> result.isDefined)
  }

<span class="pl-c">  <span class="pl-c">/**</span> Alter the login page action to suit your application. <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">login</span> <span class="pl-k">=</span> <span class="pl-en">Action</span> { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-en">Ok</span>(html.login(loginForm))
  }

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * Return the `gotoLogoutSucceeded` method's result in the logout action.</span>
<span class="pl-c">   *</span>
<span class="pl-c">   * Since the `gotoLogoutSucceeded` returns `Future[Result]`,</span>
<span class="pl-c">   * you can add a procedure like the following.</span>
<span class="pl-c">   *</span>
<span class="pl-c">   *   gotoLogoutSucceeded.map(_.flashing(</span>
<span class="pl-c">   *     "success" -&gt; "You've been logged out"</span>
<span class="pl-c">   *   ))</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">logout</span> <span class="pl-k">=</span> <span class="pl-en">Action</span>.async { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> do something...</span>
    gotoLogoutSucceeded
  }

<span class="pl-c">  <span class="pl-c">/**</span></span>
<span class="pl-c">   * Return the `gotoLoginSucceeded` method's result in the login action.</span>
<span class="pl-c">   *</span>
<span class="pl-c">   * Since the `gotoLoginSucceeded` returns `Future[Result]`,</span>
<span class="pl-c">   * you can add a procedure like the `gotoLogoutSucceeded`.</span>
<span class="pl-c">   <span class="pl-c">*/</span></span>
  <span class="pl-k">def</span> <span class="pl-en">authenticate</span> <span class="pl-k">=</span> <span class="pl-en">Action</span>.async { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    loginForm.bindFromRequest.fold(
      formWithErrors <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>.successful(<span class="pl-en">BadRequest</span>(html.login(formWithErrors))),
      user <span class="pl-k">=&gt;</span> gotoLoginSucceeded(user.get.id)
    )
  }

}</pre>
    </div> </li> 
   <li> <p>Lastly, mix <code>jp.t2v.lab.play2.auth.AuthElement</code> trait and the trait that was created in the first step into your Controllers:</p> 
    <div class="highlight highlight-source-scala">
     <pre><span class="pl-k">object</span> <span class="pl-en">Message</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">AuthElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-c"><span class="pl-c">//</span> The `StackAction` method</span>
  <span class="pl-c"><span class="pl-c">//</span>    takes `(AuthorityKey, Authority)` as the first argument and</span>
  <span class="pl-c"><span class="pl-c">//</span>    a function signature `RequestWithAttributes[AnyContent] =&gt; Result` as the second argument and</span>
  <span class="pl-c"><span class="pl-c">//</span>    returns an `Action`</span>

  <span class="pl-c"><span class="pl-c">//</span> The `loggedIn` method</span>
  <span class="pl-c"><span class="pl-c">//</span>     returns current logged in user</span>

  <span class="pl-k">def</span> <span class="pl-en">main</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">NormalUser</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>message main<span class="pl-pds">"</span></span>
    <span class="pl-en">Ok</span>(html.message.main(title))
  }

  <span class="pl-k">def</span> <span class="pl-en">list</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">NormalUser</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>all messages<span class="pl-pds">"</span></span>
    <span class="pl-en">Ok</span>(html.message.list(title))
  }

  <span class="pl-k">def</span> <span class="pl-en">detail</span>(<span class="pl-v">id</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">NormalUser</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>messages detail <span class="pl-pds">"</span></span>
    <span class="pl-en">Ok</span>(html.message.detail(title <span class="pl-k">+</span> id))
  }

  <span class="pl-c"><span class="pl-c">//</span> Only Administrator can execute this action.</span>
  <span class="pl-k">def</span> <span class="pl-en">write</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">Administrator</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>write message<span class="pl-pds">"</span></span>
    <span class="pl-en">Ok</span>(html.message.write(title))
  }

}</pre>
    </div> </li> 
  </ol> 
  <h2><a href="https://github.com/t2v/play2-auth#test" aria-hidden="true" class="anchor" id="user-content-test" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Test</h2> 
  <p>play2.auth provides test module at version 0.8</p> 
  <p>You can use <code>FakeRequest</code> with logged-in status.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">test</span>

<span class="pl-k">import</span> <span class="pl-v">org.specs2.mutable.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">play.api.test.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.test.Helpers.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">controllers.</span>{<span class="pl-v">AuthConfigImpl</span>, <span class="pl-v">Messages</span>}
<span class="pl-k">import</span> <span class="pl-v">jp.t2v.lab.play2.auth.test.Helpers.</span><span class="pl-v">_</span>

<span class="pl-k">class</span> <span class="pl-en">ApplicationSpec</span> <span class="pl-k">extends</span> <span class="pl-e">Specification</span> {

  <span class="pl-k">object</span> <span class="pl-en">config</span> <span class="pl-k">extends</span> <span class="pl-e">AuthConfigImpl</span>

  <span class="pl-s"><span class="pl-pds">"</span>Messages<span class="pl-pds">"</span></span> should {
    <span class="pl-s"><span class="pl-pds">"</span>return list when user is authorized<span class="pl-pds">"</span></span> in <span class="pl-k">new</span> <span class="pl-en">WithApplication</span> {
      <span class="pl-k">val</span> <span class="pl-en">result</span> <span class="pl-k">=</span> <span class="pl-en">Messages</span>.list(<span class="pl-en">FakeRequest</span>().withLoggedIn(config)(<span class="pl-c1">1</span>))
      contentType(result) must equalTo(<span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>)
    }
  }

}</pre>
  </div> 
  <ol> 
   <li> <p>Import <code>jp.t2v.lab.play2.auth.test.Helpers._</code></p> </li> 
   <li> <p>Define instance what is mixed-in <code>AuthConfigImpl</code></p> <pre><code> object config extends AuthConfigImpl
</code></pre> </li> 
   <li> <p>Call <code>withLoggedIn</code> method on <code>FakeRequest</code></p> 
    <ul> 
     <li>first argument: <code>AuthConfigImpl</code> instance.</li> 
     <li>second argument: user ID of the user who is logged-in at this request</li> 
    </ul> </li> 
  </ol> 
  <p>It makes enable to test controllers with play2.auth</p> 
  <h2><a href="https://github.com/t2v/play2-auth#advanced-usage" aria-hidden="true" class="anchor" id="user-content-advanced-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Advanced usage</h2> 
  <h3><a href="https://github.com/t2v/play2-auth#changing-the-authorization-depending-on-the-request-parameters" aria-hidden="true" class="anchor" id="user-content-changing-the-authorization-depending-on-the-request-parameters" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Changing the authorization depending on the request parameters.</h3> 
  <p>For example, a Social networking application has a function to edit messages.</p> 
  <p>A user must be able to edit their own messages but not other people's messages.</p> 
  <p>To achieve this you could define <code>Authority</code> as a <code>Function</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">AuthConfigImpl</span> <span class="pl-k">extends</span> <span class="pl-e">AuthConfig</span> {

  <span class="pl-c"><span class="pl-c">//</span> Other setup is omitted. </span>

  <span class="pl-k">type</span> <span class="pl-en">Authority</span> <span class="pl-k">=</span> <span class="pl-en">User</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>]

  <span class="pl-k">def</span> <span class="pl-en">authorize</span>(<span class="pl-v">user</span>: <span class="pl-en">User</span>, <span class="pl-v">authority</span>: <span class="pl-en">Authority</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>] <span class="pl-k">=</span> authority(user)

}</pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">AuthElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">sameAuthor</span>(<span class="pl-v">messageId</span>: <span class="pl-k">Int</span>)(<span class="pl-v">account</span>: <span class="pl-en">Account</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>] <span class="pl-k">=</span>
    <span class="pl-en">Message</span>.getAutherAsync(messageId).map(_ <span class="pl-k">==</span> account)

  <span class="pl-k">def</span> <span class="pl-en">edit</span>(<span class="pl-v">messageId</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> sameAuthor(messageId)) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">target</span> <span class="pl-k">=</span> <span class="pl-en">Message</span>.findById(messageId)
    <span class="pl-en">Ok</span>(html.message.edit(messageForm.fill(target)))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#returning-to-the-originally-requested-page-after-login" aria-hidden="true" class="anchor" id="user-content-returning-to-the-originally-requested-page-after-login" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Returning to the originally requested page after login</h3> 
  <p>When an unauthenticated user requests access to page requiring authentication, you first redirect the user to the login page, then, after the user successfully logs in, you redirect the user to the page they originally requested.</p> 
  <p>To achieve this change <code>authenticationFailed</code> and <code>loginSucceeded</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">AuthConfigImpl</span> <span class="pl-k">extends</span> <span class="pl-e">AuthConfig</span> {

  <span class="pl-c"><span class="pl-c">//</span> Other settings are omitted.</span>

  <span class="pl-k">def</span> <span class="pl-en">authenticationFailed</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span>
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Redirect</span>(routes.<span class="pl-en">Application</span>.login).withSession(<span class="pl-s"><span class="pl-pds">"</span>access_uri<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> request.uri))

  <span class="pl-k">def</span> <span class="pl-en">loginSucceeded</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span> {
    <span class="pl-k">val</span> <span class="pl-en">uri</span> <span class="pl-k">=</span> request.session.get(<span class="pl-s"><span class="pl-pds">"</span>access_uri<span class="pl-pds">"</span></span>).getOrElse(routes.<span class="pl-en">Message</span>.main.url.toString)
    <span class="pl-en">Future</span>.successful(<span class="pl-en">Redirect</span>(uri).withSession(request.session <span class="pl-k">-</span> <span class="pl-s"><span class="pl-pds">"</span>access_uri<span class="pl-pds">"</span></span>))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#changing-the-display-depending-on-whether-the-user-is-logged-in" aria-hidden="true" class="anchor" id="user-content-changing-the-display-depending-on-whether-the-user-is-logged-in" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Changing the display depending on whether the user is logged in</h3> 
  <p>If you want to display the application's index differently to non-logged-in users and logged-in users, you can use <code>OptionalAuthElement</code> instead of <code>AuthElement</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">OptionalAuthElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-c"><span class="pl-c">//</span> maybeUser is an instance of `Option[User]`.</span>
  <span class="pl-c"><span class="pl-c">//</span> `OptionalAuthElement` dont need `AuthorityKey`</span>
  <span class="pl-k">def</span> <span class="pl-en">index</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span> { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">maybeUser</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">User</span>] <span class="pl-k">=</span> loggedIn
    <span class="pl-k">val</span> <span class="pl-en">user</span><span class="pl-k">:</span> <span class="pl-en">User</span> <span class="pl-k">=</span> maybeUser.getOrElse(<span class="pl-en">GuestUser</span>)
    <span class="pl-en">Ok</span>(html.index(user))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#for-action-that-doesnt-require-authorization" aria-hidden="true" class="anchor" id="user-content-for-action-that-doesnt-require-authorization" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>For action that doesn't require authorization</h3> 
  <p>you can <code>AuthenticationElement</code> instead of <code>AuthElement</code> for authentication without authorization.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">AuthenticationElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-k">def</span> <span class="pl-en">index</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span> { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">user</span><span class="pl-k">:</span> <span class="pl-en">User</span> <span class="pl-k">=</span> loggedIn
    <span class="pl-en">Ok</span>(html.index(user))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#return-401-when-a-request-is-sent-by-ajax" aria-hidden="true" class="anchor" id="user-content-return-401-when-a-request-is-sent-by-ajax" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Return 401 when a request is sent by Ajax</h3> 
  <p>Normally, you want to return a login page redirection at a authentication failed. Although, when the request is sent by Ajax you want to instead return 401, Unauthorized.</p> 
  <p>You can do it as follows.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">authenticationFailed</span>(<span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)(<span class="pl-k">implicit</span> <span class="pl-v">ctx</span>: <span class="pl-en">ExecutionContext</span>) <span class="pl-k">=</span> <span class="pl-en">Future</span>.successful {
  request.headers.get(<span class="pl-s"><span class="pl-pds">"</span>X-Requested-With<span class="pl-pds">"</span></span>) <span class="pl-k">match</span> {
    <span class="pl-k">case</span> <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>XMLHttpRequest<span class="pl-pds">"</span></span>) <span class="pl-k">=&gt;</span> <span class="pl-en">Unauthorized</span>(<span class="pl-s"><span class="pl-pds">"</span>Authentication failed<span class="pl-pds">"</span></span>)
    <span class="pl-k">case</span> _ <span class="pl-k">=&gt;</span> <span class="pl-en">Redirect</span>(routes.<span class="pl-en">Application</span>.login)
  }
}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#action-composition" aria-hidden="true" class="anchor" id="user-content-action-composition" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Action composition</h3> 
  <p>play2.auth use <a href="https://github.com/t2v/stackable-controller" target="_blank">stackable-controller</a></p> 
  <p>Suppose you want to validate a token at every action in order to defeat a <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)" target="_blank">Cross Site Request Forgery</a> attack.</p> 
  <p>Since it is impractical to perform the validation in all actions, you would define a trait like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">jp.t2v.lab.play2.stackc.</span>{<span class="pl-v">RequestWithAttributes</span>, <span class="pl-v">StackableController</span>}
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">Future</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.mvc.</span>{<span class="pl-v">Result</span>, <span class="pl-v">Request</span>, <span class="pl-v">Controller</span>}
<span class="pl-k">import</span> <span class="pl-v">play.api.data.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.data.Forms.</span><span class="pl-v">_</span>

<span class="pl-k">trait</span> <span class="pl-en">TokenValidateElement</span> <span class="pl-k">extends</span> <span class="pl-e">StackableController</span> {
    <span class="pl-c1">self</span><span class="pl-k">:</span> <span class="pl-en">Controller</span> <span class="pl-k">=&gt;</span>

  <span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">tokenForm</span> <span class="pl-k">=</span> <span class="pl-en">Form</span>(<span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> text)

  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">validateToken</span>(<span class="pl-v">request</span>: <span class="pl-en">Request</span>[_])<span class="pl-k">:</span> <span class="pl-k">Boolean</span> <span class="pl-k">=</span> (<span class="pl-k">for</span> {
    tokenInForm <span class="pl-k">&lt;</span><span class="pl-k">-</span> tokenForm.bindFromRequest()(request).value
    tokenInSession <span class="pl-k">&lt;</span><span class="pl-k">-</span> request.session.get(<span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span>)
  } <span class="pl-k">yield</span> tokenInForm <span class="pl-k">==</span> tokenInSession).getOrElse(<span class="pl-c1">false</span>)

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">proceed</span>[<span class="pl-en">A</span>](<span class="pl-v">request</span>: <span class="pl-en">RequestWithAttributes</span>[<span class="pl-en">A</span>])(<span class="pl-v">f</span>: <span class="pl-en">RequestWithAttributes</span>[<span class="pl-en">A</span>] <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>])<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Result</span>] <span class="pl-k">=</span> {
    <span class="pl-k">if</span> (validateToken(request)) <span class="pl-c1">super</span>.proceed(request)(f)
    <span class="pl-k">else</span> <span class="pl-en">Future</span>.successful(<span class="pl-en">BadRequest</span>)
  }

}</pre>
  </div> 
  <p>You can use <code>TokenValidateElement</code> trait with <code>AuthElement</code> trait.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">Application</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> <span class="pl-k">with</span> <span class="pl-e">TokenValidateElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-k">def</span> <span class="pl-en">page1</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">NormalUser</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> do something</span>
    <span class="pl-en">Ok</span>(html.page1(<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>))
  }

  <span class="pl-k">def</span> <span class="pl-en">page2</span> <span class="pl-k">=</span> <span class="pl-en">StackAction</span>(<span class="pl-en">AuthorityKey</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">NormalUser</span>) { <span class="pl-k">implicit</span> request <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> do something</span>
    <span class="pl-en">Ok</span>(html.page2(<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#asynchronous-support" aria-hidden="true" class="anchor" id="user-content-asynchronous-support" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Asynchronous Support</h3> 
  <p>There are asynchronous libraries ( for example: <a href="http://reactivemongo.org/" target="_blank">ReactiveMongo</a>, <a href="https://github.com/scalikejdbc/scalikejdbc-async" target="_blank">ScalikeJDBC-Async</a>, and so on ).</p> 
  <p>You should use <code>Future[Result]</code> instead of <code>AsyncResult</code> from Play2.2.</p> 
  <p>You can use <code>AsyncStack</code> instead of <code>StackAction</code> for Future[Result]</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">HogeController</span> <span class="pl-k">extends</span> <span class="pl-e">AuthElement</span> <span class="pl-k">with</span> <span class="pl-e">AuthConfigImpl</span> {

  <span class="pl-k">def</span> <span class="pl-en">hoge</span> <span class="pl-k">=</span> <span class="pl-en">AsyncStack</span> { <span class="pl-k">implicit</span> req <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">messages</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Seq</span>[<span class="pl-en">Message</span>]] <span class="pl-k">=</span> <span class="pl-en">AsyncDB</span>.withPool { <span class="pl-k">implicit</span> s <span class="pl-k">=&gt;</span> <span class="pl-en">Message</span>.findAll }
    messages.map(<span class="pl-en">Ok</span>(html.view.messages(_)))
  }

}</pre>
  </div> 
  <h3><a href="https://github.com/t2v/play2-auth#stateless-vs-stateful-implementation" aria-hidden="true" class="anchor" id="user-content-stateless-vs-stateful-implementation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Stateless vs Stateful implementation.</h3> 
  <p>Play2x-Auth follows the Play framework's stateless policy. However, Play2x-Auth's default implementation is stateful, because the stateless implementation has the following security risk:</p> 
  <p>If user logs-in to your application in a internet-cafe, then returns home neglecting to logout. If the user logs in again at home they will <em>not</em> invalidate the session.</p> 
  <p>Nevertheless, you want to use a fully stateless implementation then just override the <code>idContainer</code> method of <code>AuthConfig</code> like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">AuthConfigImpl</span> <span class="pl-k">extends</span> <span class="pl-e">AuthConfig</span> {

  <span class="pl-c"><span class="pl-c">//</span> Other settings omitted.</span>

  <span class="pl-k">override</span> <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">idContainer</span><span class="pl-k">:</span> <span class="pl-en">AsyncIdContainer</span>[<span class="pl-en">Id</span>] <span class="pl-k">=</span> <span class="pl-en">AsyncIdContainer</span>(<span class="pl-k">new</span> <span class="pl-en">CookieIdContainer</span>[<span class="pl-en">Id</span>])

}</pre>
  </div> 
  <p>You could also store the session data in a Relational Database by overriding the id container.</p> 
  <p>Note: <code>CookieIdContainer</code> doesn't support session timeout.</p> 
  <h2><a href="https://github.com/t2v/play2-auth#running-the-sample-application" aria-hidden="true" class="anchor" id="user-content-running-the-sample-application" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Running The Sample Application</h2> 
  <ol> 
   <li><code>git clone https://github.com/t2v/play2-auth.git</code></li> 
   <li><code>cd play2-auth</code></li> 
   <li><code>sbt "project sample" run</code></li> 
   <li>access to <code>http://localhost:9000/</code> on your browser. 
    <ol> 
     <li> <p>click <code>Apply this script now!</code></p> </li> 
     <li> <p>login</p> <p>defined accounts</p> <pre><code> Email             | Password | Role
 alice@example.com | secret   | Administrator
 bob@example.com   | secret   | NormalUser
 chris@example.com | secret   | NormalUser
</code></pre> </li> 
    </ol> </li> 
  </ol> 
  <h2><a href="https://github.com/t2v/play2-auth#attention----distributed-servers" aria-hidden="true" class="anchor" id="user-content-attention----distributed-servers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Attention -- Distributed Servers</h2> 
  <p><a href="http://www.ehcache.org/" target="_blank">Ehcache</a>, the default cache implementation used by Play2.x, does not work on distributed application servers.</p> 
  <p>If you have distributed servers, use the <a href="https://github.com/mumoshu/play2-memcached" target="_blank">Memcached Plugin</a> or something similar.</p> 
  <h2><a href="https://github.com/t2v/play2-auth#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>This library is released under the Apache Software License, version 2, which should be included with the source in a file named <code>LICENSE</code>.</p> 
 </article>
</div>