<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-spark-betweenness" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#spark-betweenness" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>spark-betweenness</h1> 
  <p>k Betweenness Centrality (kBC) algorithm for Spark using GraphX</p> 
  <h2><a id="user-content-details" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#details" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Details</h2> 
  <p>Computing k Betweenness Centrality (kBC) on arbitraty graphs using GraphX.</p> 
  <h3><a id="user-content-steps" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#steps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Steps</h3> 
  <ol> 
   <li>Using Pregel API to create small k-graphlets</li> 
   <li>Local betweenness contribution calculation for each vertex to other vertices using Brandes algorithm for calculating BC.</li> 
   <li>Aggregating results (reduce) from all vertices to conclude each vertex betweenness score.</li> 
   <li>Assemble a graph similar to the original graph that contains the kBC score for each node.</li> 
  </ol> 
  <h3><a id="user-content-notes" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#notes" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Notes</h3> 
  <p>The method above ilustrated that spark-betweenness works best for graphs with a small diameter. We actually hold all k-graphlets in memory for Brandes calculation as they are the core of parallelizing this algorithm. Therefore, we manage to compute kBC on millions of nodes and vertices with large diameter graphs (such as road networks), but fail miserabely to do so on small diameter graphs (such as social networks).</p> 
  <h2><a id="user-content-requirements" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#requirements" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Requirements</h2> 
  <p>Spark 1.5+.</p> 
  <p>Scala 2.10.</p> 
  <h2><a id="user-content-linking" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#linking" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Linking</h2> 
  <p>You can link against this library (for Spark 1.5+) in your program at the following coordinates:</p> 
  <p>Using SBT:</p> 
  <pre><code>libraryDependencies += "com.centrality" %% "spark-betweenness" % "1.0.0"
</code></pre> 
  <p>This library can also be added to Spark jobs launched through <code>spark-shell</code> or <code>spark-submit</code> by using the <code>--packages</code> command line option. For example, to include it when starting the spark shell:</p> 
  <pre><code>$ bin/spark-shell --packages com.centrality:spark-betweenness_2.10:1.0.0
</code></pre> 
  <p>Unlike using <code>--jars</code>, using <code>--packages</code> ensures that this library and its dependencies will be added to the classpath. The <code>--packages</code> argument can also be used with <code>bin/spark-submit</code>.</p> 
  <p>This library is cross-published for Scala 2.10, so 2.11 users should replace 2.10 with 2.11 in the commands listed above.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <h3><a id="user-content-scala-api" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#scala-api" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala API</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c">// import needed for the .avro method to be added</span>
<span class="pl-k">import</span> <span class="pl-v">com.centrality.kBC.</span><span class="pl-v">KBetweenness</span>

<span class="pl-k">val</span> <span class="pl-en">graph</span> <span class="pl-k">=</span> <span class="pl-en">Graph</span>(users, relationships, defaultUser)

<span class="pl-c">// Run kBC to get result graph</span>
<span class="pl-k">val</span> <span class="pl-en">kBCGraph</span> <span class="pl-k">=</span> 
      <span class="pl-en">KBetweenness</span>.run(graph, k)</pre>
  </div> 
  <h3><a id="user-content-running-kbc-from-command-line" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#running-kbc-from-command-line" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Running kBC from command line</h3> 
  <p>You can run kBC directly form command line using spark-submit.</p> 
  <p>Parameters for kBC :</p> 
  <ul> 
   <li><strong>k</strong> size of k-graphlets for kBC</li> 
   <li><strong>numEdgePartitions</strong> number of partitions when loading graph, recommended ( <strong>num-executors</strong> * 2 ) - 6</li> 
   <li><strong>inputDir</strong> HDFS input dir location</li> 
   <li><strong>outputDir</strong> HDFS output dir location</li> 
   <li><strong>inputFileName</strong> input file name containing edge_list for graph (as stated in GraphX GraphLoader.edgeListFile)</li> 
  </ul> 
  <div class="highlight highlight-source-shell">
   <pre>/usr/lib/spark/bin/spark-submit --class com.centrality.kBC.kBCDriver --executor-cores 1 --executor-memory 10000M --master yarn-cluster --num-executors 28 --conf spark.driver.memory=10000m --conf spark.driver.extraJavaOptions=<span class="pl-s"><span class="pl-pds">"</span>-Xms4000m -Xmx10000m<span class="pl-pds">"</span></span> --conf spark.executor.extraJavaOptions=<span class="pl-s"><span class="pl-pds">"</span>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps<span class="pl-pds">"</span></span> --conf spark.kryo.registrationRequired=<span class="pl-c1">false</span> --conf spark.serializer=org.apache.spark.serializer.KryoSerializer --conf spark.yarn.maxAppAttempts=1 --conf spark.task.maxFailures=10 /tmp/kbc_2.10-1.0.jar 4 50 /tmp/input/ /tmp/output/ loc-brightkite_edges.txt</pre>
  </div> 
  <p>When using kBC this way, it is highly recommended to tune these parameters for your own benefit :</p> 
  <ul> 
   <li><strong>executor-cores</strong> recommended to 1 </li> 
   <li><strong>executor-memory</strong> </li> 
   <li><strong>num-executors</strong> as far as memory of the cluster grants, given each executor needs X <strong>executor-memory</strong></li> 
   <li><strong>spark.driver.extraJavaOptions</strong> tune memory requirements</li> 
   <li><strong>spark.executor.extraJavaOptions</strong> tune GC if needed</li> 
   <li><strong>spark.task.maxFailures</strong> recommended larger than 1, tasks fail for out of memory sometimes for large graphs if tuning isn't right</li> 
  </ul> 
  <h2><a id="user-content-building-from-source" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#building-from-source" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Building From Source</h2> 
  <p>This library is built with <a href="http://www.scala-sbt.org/0.13/docs/Command-Line-Reference.html" target="_blank">SBT</a>, which is automatically downloaded by the included shell script. To build a JAR file simply run <code>sbt package</code> from the project root.</p> 
  <h2><a id="user-content-more-information" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#more-information" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More Information</h2> 
  <p>See the research report that led to this project with more details and comparisons to other frameworks <a href="http://www.slideshare.net/DanielMarcous/distributed-kbetweenness-spark" target="_blank">here</a></p> 
  <h2><a id="user-content-credits" class="anchor" href="https://github.com/dmarcous/spark-beetweenness#credits" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Credits</h2> 
  <p>Written and maintained by :</p> 
  <p>Daniel Marcous <a href="mailto:dmarcous@gmail.com" target="_blank">dmarcous@gmail.com</a></p> 
  <p>Yotam Sandbank <a href="mailto:yotamsandbank@gmail.com" target="_blank">yotamsandbank@gmail.com</a></p> 
 </article>
</div>