<div class="announce instapaper_body asciidoc" data-path="README.asciidoc" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/monsantoco/aws2scala#aws2scala-a-scala-friendly-api-for-aws" aria-hidden="true" class="anchor" id="user-content-aws2scala-a-scala-friendly-api-for-aws" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>aws2scala: a Scala-friendly API for AWS</h1> 
  <div id="user-content-preamble"> 
   <div> 
    <div> 
     <table> 
      <tbody>
       <tr> 
        <td> 
         <div>
          Caution
         </div> </td> 
        <td> 
         <div> 
          <p>This is pre-1.0 software, interfaces are subject to change. Please refer to the documentation for each individual service API to find out more.</p> 
         </div> </td> 
       </tr> 
      </tbody>
     </table> 
    </div> 
    <div> 
     <p><a href="https://bintray.com/monsanto/maven/aws2scala/_latestVersion" target="_blank"><img src="https://camo.githubusercontent.com/97621b18dca9c7422502367d47ea1614e910b170/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f6d6f6e73616e746f2f6d6176656e2f617773327363616c612f696d616765732f646f776e6c6f61642e737667" alt="Latest release" data-canonical-src="https://api.bintray.com/packages/monsanto/maven/aws2scala/images/download.svg" style="max-width:100%;"></a> <a href="https://coveralls.io/github/MonsantoCo/aws2scala?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/746fd78df4b9bd33378b529243a2147054bc537b/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f4d6f6e73616e746f436f2f617773327363616c612f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage status" data-canonical-src="https://coveralls.io/repos/github/MonsantoCo/aws2scala/badge.svg?branch=master" style="max-width:100%;"></a> <a href="https://travis-ci.org/MonsantoCo/aws2scala" target="_blank"><img src="https://camo.githubusercontent.com/c8b61e08de7f967cf2473f6005258f9f4cb95b85/68747470733a2f2f7472617669732d63692e6f72672f4d6f6e73616e746f436f2f617773327363616c612e7376673f6272616e63683d6d6173746572" alt="Build status" data-canonical-src="https://travis-ci.org/MonsantoCo/aws2scala.svg?branch=master" style="max-width:100%;"></a></p> 
    </div> 
    <div> 
     <p>This library wraps the <a href="https://aws.amazon.com/sdk-for-java/" target="_blank">AWS SDK for Java</a> to make it much more Scala-friendly and simpler to consume. It provides <a href="https://github.com/monsantoco/aws2scala#sct-feature-async" target="_blank">asynchronous</a> and <a href="https://github.com/monsantoco/aws2scala#sct-feature-streaming" target="_blank">streaming</a> APIs that are <a href="https://github.com/monsantoco/aws2scala#sct-feature-fewer-objects" target="_blank">easier to use</a>, <a href="https://github.com/monsantoco/aws2scala#sct-feature-paging" target="_blank">perform paging automatically</a>, and <a href="https://github.com/monsantoco/aws2scala#sct-feature-idiomatic" target="_blank">more idiomatic</a>.</p> 
    </div> 
   </div> 
   <div id="user-content-toc"> 
    <div id="user-content-toctitle">
     Table of Contents
    </div> 
    <ul> 
     <li><a href="https://github.com/monsantoco/aws2scala#features" target="_blank">Features</a> 
      <ul> 
       <li><a href="https://github.com/monsantoco/aws2scala#sct-feature-async" target="_blank">Fully asynchronous</a></li> 
       <li><a href="https://github.com/monsantoco/aws2scala#sct-feature-fewer-objects" target="_blank">Eliminates most request/result objects</a></li> 
       <li><a href="https://github.com/monsantoco/aws2scala#sct-feature-idiomatic" target="_blank">Uses immutable Scala collections, options, and values</a></li> 
       <li><a href="https://github.com/monsantoco/aws2scala#sct-feature-paging" target="_blank">Pages automatically</a></li> 
       <li><a href="https://github.com/monsantoco/aws2scala#sct-feature-streaming" target="_blank">Streaming</a></li> 
      </ul> </li> 
     <li><a href="https://github.com/monsantoco/aws2scala#supported-clients" target="_blank">Supported clients</a></li> 
     <li><a href="https://github.com/monsantoco/aws2scala#getting-started" target="_blank">Getting started</a> 
      <ul> 
       <li><a href="https://github.com/monsantoco/aws2scala#add-the-resolver-and-dependencies" target="_blank">Add the resolver and dependencies</a></li> 
      </ul> </li> 
    </ul> 
   </div> 
  </div> 
  <div> 
   <h2 id="user-content-features"><a href="https://github.com/monsantoco/aws2scala#features" aria-hidden="true" class="anchor" id="user-content-features" target="_blank">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
     </svg></a><a href="https://github.com/monsantoco/aws2scala#features" target="_blank"></a>Features</h2> 
   <div> 
    <div> 
     <h3 id="user-content-sct-feature-async"><a href="https://github.com/monsantoco/aws2scala#fully-asynchronous" aria-hidden="true" class="anchor" id="user-content-fully-asynchronous" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#sct-feature-async" target="_blank"></a>Fully asynchronous</h3> 
     <div> 
      <p>The AWS SDK for Java provides both synchronous and asynchronous APIs for its clients. Using the synchronous APIs in an asynchronous context, such as a Spray or Akka HTTP route, is problematic. Unfortunately, using the asynchronous APIs is problematic since they use Java futures rather than Scala futures. All of the non-streaming <em>aws2scala</em> APIs are fully asynchronous and return Scala futures, meaning you can compose them and use them with <code>for</code> comprehensions.</p> 
     </div> 
     <div> 
      <p>The following section contains <a href="https://github.com/monsantoco/aws2scala#lst-create-role-aws" target="_blank">an example</a> of using a synchronous AWS API asynchronously.</p> 
     </div> 
    </div> 
    <div> 
     <h3 id="user-content-sct-feature-fewer-objects"><a href="https://github.com/monsantoco/aws2scala#eliminates-most-requestresult-objects" aria-hidden="true" class="anchor" id="user-content-eliminates-most-requestresult-objects" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#sct-feature-fewer-objects" target="_blank"></a>Eliminates most request/result objects</h3> 
     <div> 
      <p>The AWS APIs make extensive use of request and result objects, this is even the case when they are only wrapping just one argument/result object.<sup>[<a id="user-content-_footnoteref_1" href="https://github.com/monsantoco/aws2scala#_footnote_1" title="View footnote." target="_blank">1</a>]</sup> <em>aws2scala</em> generally provides methods that take the essential arguments for a request and return the object of interest in the result.</p> 
     </div> 
     <div> 
      <p>For example, you can compare how creating a role asynchronously differs between using <a href="https://github.com/monsantoco/aws2scala#lst-create-role-aws" target="_blank">the AWS IAM client</a> and <a href="https://github.com/monsantoco/aws2scala#lst-create-role-scala" target="_blank">using the <em>aws2scala</em> IAM client</a>.</p> 
     </div> 
     <div id="user-content-lst-create-role-aws"> 
      <div>
       Using the synchronous AWS API
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre><span class="pl-k">import</span> <span class="pl-v">com.amazonaws.services.identitymanagement.</span><span class="pl-v">AmazonIdentityManagementClient</span>
<span class="pl-k">import</span> <span class="pl-v">com.amazonaws.services.identitymanagement.model.</span><span class="pl-v">CreateRoleRequest</span>
<span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.identitymanagement.model.</span><span class="pl-v">Role</span>

<span class="pl-k">val</span> <span class="pl-en">iam</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AmazonIdentityManagementClient</span>()
<span class="pl-k">val</span> <span class="pl-en">policy</span> <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">//</span> some policy string</span>
<span class="pl-k">val</span> <span class="pl-en">eventualRole</span> <span class="pl-k">=</span>
    <span class="pl-en">Future</span> { (<span class="pl-c1">1</span>)
        <span class="pl-k">val</span> <span class="pl-en">request</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">CreateRoleRequest</span>()  (<span class="pl-c1">2</span>)
                        .withRoleName(<span class="pl-s"><span class="pl-pds">"</span>MyRole<span class="pl-pds">"</span></span>)
                        .witAssumedRolePolicyDocument(policy)
        <span class="pl-k">val</span> <span class="pl-en">result</span> <span class="pl-k">=</span> blocking { iam.createRole(request) } (<span class="pl-c1">3</span>)
        <span class="pl-k">val</span> <span class="pl-en">awsRole</span> <span class="pl-k">=</span> result.getRole (<span class="pl-c1">4</span>)
        <span class="pl-en">Role</span>.fromAws(awsRole) (<span class="pl-c1">5</span>)
    }</pre>
       </div> 
      </div> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Execute the code asynchronously (we are using the synchronous AWS client)</p> </li> 
       <li> <p>Create an AWS request object</p> </li> 
       <li> <p>Execute the request withing a <code>blocking</code> context, getting the result object</p> </li> 
       <li> <p>Extract the mutable AWS <code>Role</code> bean from the result</p> </li> 
       <li> <p>Build an immutable <em>aws2scala</em> <code>Role</code> instance from the AWS result</p> </li> 
      </ol> 
     </div> 
     <div id="user-content-lst-create-role-scala"> 
      <div>
       Using the asynchronous 
       <em>aws2scala</em> IAM client
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre><span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.</span><span class="pl-v">AsyncAwsClient</span>

<span class="pl-k">val</span> <span class="pl-en">iam</span> <span class="pl-k">=</span> <span class="pl-en">AsyncAwsClient</span>.<span class="pl-en">Default</span>.identityManagement
<span class="pl-k">val</span> <span class="pl-en">policy</span> <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">//</span> some policy string</span>
<span class="pl-k">val</span> <span class="pl-en">role</span> <span class="pl-k">=</span> iam.createRole(<span class="pl-s"><span class="pl-pds">"</span>MyRole<span class="pl-pds">"</span></span>, policy) (<span class="pl-c1">1</span>)</pre>
       </div> 
      </div> 
     </div> 
     <div> 
      <ol> 
       <li> <p>This method automatically builds the request object and unpacks the result object, returning an immutable <code>Role</code> value</p> </li> 
      </ol> 
     </div> 
    </div> 
    <div> 
     <h3 id="user-content-sct-feature-idiomatic"><a href="https://github.com/monsantoco/aws2scala#uses-immutable-scala-collections-options-and-values" aria-hidden="true" class="anchor" id="user-content-uses-immutable-scala-collections-options-and-values" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#sct-feature-idiomatic" target="_blank"></a>Uses immutable Scala collections, options, and values</h3> 
     <div> 
      <p>The AWS APIs make extensive use of JavaBeans-style classes. These are mutable objects that use Java-style getters and setters. In cases where one of these properties may be optional, it is a null value. Additionally, all collections are mutable Java collections.</p> 
     </div> 
     <div> 
      <p><em>aws2scala</em> opts to take a more idiomatic Scala approach, it:</p> 
     </div> 
     <div> 
      <ul> 
       <li> <p>Uses immutable <code>Seq</code> and <code>Map</code> objects for all arguments and return values,</p> </li> 
       <li> <p>Represents compound data structures using case classes, ensuring immutability and allowing for pattern matching, and</p> </li> 
       <li> <p>Uses an <code>Option</code> whenever a value is optional.</p> </li> 
      </ul> 
     </div> 
    </div> 
    <div> 
     <h3 id="user-content-sct-feature-paging"><a href="https://github.com/monsantoco/aws2scala#pages-automatically" aria-hidden="true" class="anchor" id="user-content-pages-automatically" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#sct-feature-paging" target="_blank"></a>Pages automatically</h3> 
     <div> 
      <p>Many AWS APIs that perform listings will return paged results. Unfortunately, these paging APIs suffer from a couple of drawbacks:</p> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Preparing a new request usually requires getting data from the previous result. This means that is difficult to process pages fully asynchronously.</p> </li> 
       <li> <p>They are inconsistent. Some use <code>Result.getNextToken</code> and <code>Request.getNextToken</code>, others use <code>Result.getMarker</code> and <code>Request.setMarker</code>, and still others use <code>Result.getNextMarker</code> and <code>Request.setMarker</code>.</p> </li> 
      </ol> 
     </div> 
     <div> 
      <p>You can compare how to manually perform the work <a href="https://github.com/monsantoco/aws2scala#lst-list-roles-aws" target="_blank">using the AWS client</a> versus <a href="https://github.com/monsantoco/aws2scala#lst-list-roles-scala" target="_blank">using <em>aws2scala</em></a>. Note that in both versions, the future will not complete until all pages have been retrieved from AWS. If this is undesirable, i.e. you only want to request new pages as needed, use a <a href="https://github.com/monsantoco/aws2scala#sct-feature-streaming" target="_blank">streaming client</a>.</p> 
     </div> 
     <div id="user-content-lst-list-roles-aws"> 
      <div>
       Listing all roles asynchronously using the synchronous AWS API
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre><span class="pl-k">import</span> <span class="pl-v">com.amazonaws.services.identitymanagement.</span><span class="pl-v">AmazonIdentityManagementClient</span>
<span class="pl-k">import</span> <span class="pl-v">com.amazonaws.services.identitymanagement.model.</span><span class="pl-v">ListRolesRequest</span>
<span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.identitymanagement.model.</span><span class="pl-v">Role</span>
<span class="pl-k">import</span> <span class="pl-v">scala.collection.JavaConverters.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">iam</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">AmazonIdentityManagementClient</span>()

<span class="pl-k">val</span> <span class="pl-en">eventualRoles</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Seq</span>[<span class="pl-en">Role</span>]] <span class="pl-k">=</span>
    <span class="pl-en">Future</span> {
        <span class="pl-k">val</span> <span class="pl-en">request</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ListRolesRequest</span> (<span class="pl-c1">1</span>)
        <span class="pl-k">var</span> <span class="pl-en">result</span><span class="pl-k">:</span> <span class="pl-en">ListRolesResult</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ListRolesResult</span> (<span class="pl-c1">2</span>)
        <span class="pl-k">val</span> <span class="pl-en">rolesListBuilder</span> <span class="pl-k">=</span> <span class="pl-en">Seq</span>.newBuilder[<span class="pl-en">Role</span>] (<span class="pl-c1">3</span>)

        <span class="pl-k">do</span> {
            <span class="pl-en">Option</span>(request.getMarker).foreach(m <span class="pl-k">⇒</span> request.setMarker(m)) (<span class="pl-c1">4</span>)
            result <span class="pl-k">=</span> blocking { iam.listRoles(request) } (<span class="pl-c1">5</span>)
            <span class="pl-k">val</span> <span class="pl-en">pagedRoles</span> <span class="pl-k">=</span> result.getRoles.asScala.map(<span class="pl-en">Role</span>.fromAws) (<span class="pl-c1">6</span>)
            rolesListBuilder <span class="pl-k">++</span><span class="pl-k">=</span> pagedRoles (<span class="pl-c1">7</span>)
        } <span class="pl-k">while</span> (result.isTruncated) (<span class="pl-c1">8</span>)

        rolesListBuilder.result() (<span class="pl-c1">9</span>)
    }</pre>
       </div> 
      </div> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Create the new request</p> </li> 
       <li> <p>Create an empty result</p> </li> 
       <li> <p>Create builder to accumulate results</p> </li> 
       <li> <p>Set the next pages marker if it is in the result</p> </li> 
       <li> <p>Get results in a <code>blocking</code> context</p> </li> 
       <li> <p>Convert the Java collection of JavaBeans to a (mutable) Scala collection of case class instances</p> </li> 
       <li> <p>Add to the accumulated result</p> </li> 
       <li> <p>Repeat until there are no further pages</p> </li> 
       <li> <p>Get the final (immutable) Scala collection of immutable <code>Role</code> instances</p> </li> 
      </ol> 
     </div> 
     <div id="user-content-lst-list-roles-scala"> 
      <div>
       Listing all roles asynchronously using 
       <em>aws2scala</em>
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre><span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.</span><span class="pl-v">AsyncAwsClient</span>

<span class="pl-k">val</span> <span class="pl-en">iam</span> <span class="pl-k">=</span> <span class="pl-en">AsyncAwsClient</span>.<span class="pl-en">Default</span>.identityManagement
<span class="pl-k">val</span> <span class="pl-en">roles</span> <span class="pl-k">=</span> iam.listRoles() (<span class="pl-c1">1</span>)</pre>
       </div> 
      </div> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Can it get any easier than this?</p> </li> 
      </ol> 
     </div> 
    </div> 
    <div> 
     <h3 id="user-content-sct-feature-streaming"><a href="https://github.com/monsantoco/aws2scala#streaming" aria-hidden="true" class="anchor" id="user-content-streaming" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#sct-feature-streaming" target="_blank"></a>Streaming</h3> 
     <div> 
      <p>In addition to the asynchronous APIs, all <em>aws2scala</em> functionality is available through streaming APIs that are built using <a href="http://doc.akka.io/docs/akka/snapshot/scala/stream/index.html" target="_blank">Akka streams</a>. For example, <a href="https://github.com/monsantoco/aws2scala#lst-create-role-for-current-user" target="_blank">the following listing</a> constructs and runs a flow that:</p> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Gets the current IAM user,</p> </li> 
       <li> <p>Creates a role for that user’s account,</p> </li> 
       <li> <p>Attaches a policy to the new role, and</p> </li> 
       <li> <p>Emits the role that was created.</p> </li> 
      </ol> 
     </div> 
     <div> 
      <p>While the same result can be achieved using the asynchronous APIs and future composition, creating reusable graphs can make code easier to understand. Additionally, the various listing flows that process paged results will emit items as soon as they are retrieved. This allows for the construction of graphs that can process items in a listing as they are available without having to wait for the listing to complete.</p> 
     </div> 
     <div id="user-content-lst-create-role-for-current-user"> 
      <div>
       Setting up a role for the current IAM user
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre><span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.identitymanagement.model.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.monsanto.arch.awsutil.</span><span class="pl-v">StreamingAwsClient</span>

<span class="pl-k">val</span> <span class="pl-en">s3ReadOnlyPolicy</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess<span class="pl-pds">"</span></span>
<span class="pl-k">def</span> <span class="pl-en">createAssumRolePolicy</span>(<span class="pl-v">user</span>: <span class="pl-en">User</span>)<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span>
    s<span class="pl-s"><span class="pl-pds">"""</span>{</span>
<span class="pl-s">            "Version": "2012-10-17",</span>
<span class="pl-s">            "Statement": [</span>
<span class="pl-s">                {</span>
<span class="pl-s">                    "Action": "sts:AssumeRole",</span>
<span class="pl-s">                    "Effect": "Allow",</span>
<span class="pl-s">                    "Principal": { "AWS": "arn:aws:iam::${user.account}:root" }</span>
<span class="pl-s">                }</span>
<span class="pl-s">            ]</span>
<span class="pl-s">        }<span class="pl-pds">"""</span></span>

<span class="pl-k">val</span> <span class="pl-en">iam</span> <span class="pl-k">=</span> <span class="pl-en">StreamingAwsClient</span>.<span class="pl-en">Default</span>.identityManagement
<span class="pl-k">val</span> <span class="pl-en">createdRole</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Role</span>] <span class="pl-k">=</span>
    <span class="pl-en">Source</span>.single(<span class="pl-en">GetUserRequest</span>.currentUser) (<span class="pl-c1">1</span>)
        .via(iam.userGetter) (<span class="pl-c1">2</span>)
        .map(user <span class="pl-k">⇒</span> <span class="pl-en">CreateRoleRequest</span>(<span class="pl-s"><span class="pl-pds">"</span>MyRole<span class="pl-pds">"</span></span>, createAssumeRolePolicy(user))) (<span class="pl-c1">3</span>)
        .via(iam.roleCreator) (<span class="pl-c1">4</span>)
        .flatMapConcat { role <span class="pl-k">⇒</span>
            <span class="pl-en">Source</span>.single(<span class="pl-en">AttachRolePolicyRequest</span>(role.name, s3ReadOnlyPolicy)) (<span class="pl-c1">5</span>)
                .via(iam.rolePolicyAttacher)
                .map(_ <span class="pl-k">⇒</span> role) (<span class="pl-c1">6</span>)
        }
        .runWith(<span class="pl-en">Sink</span>.head) (<span class="pl-c1">7</span>)</pre>
       </div> 
      </div> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Start with a single <code>GetUserRequest</code> to get the current user</p> </li> 
       <li> <p>Send it through the IAM <code>userGetter</code> flow, which emits a <code>User</code> instance</p> </li> 
       <li> <p>Now, transform the the user into a <code>CreateRoleRequest</code></p> </li> 
       <li> <p>Send it through the IAM <code>roleCreator</code> flow, which emits a <code>Role</code> instance</p> </li> 
       <li> <p>Create a subflow that will attach the <code>AmazonS3ReadOnlyAccess</code> policy to the role.</p> </li> 
       <li> <p>Have the policy emit the role that was passed in (<code>rolePolicyAttacher</code> emits a role ARN)</p> </li> 
       <li> <p>Runs the entire flow, resulting in a future with the created role</p> </li> 
      </ol> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div> 
   <h2 id="user-content-supported-clients"><a href="https://github.com/monsantoco/aws2scala#supported-clients" aria-hidden="true" class="anchor" id="user-content-supported-clients" target="_blank">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
     </svg></a><a href="https://github.com/monsantoco/aws2scala#supported-clients" target="_blank"></a>Supported clients</h2> 
   <div> 
    <div> 
     <p>The following clients are currently available in <em>aws2scala</em>:</p> 
    </div> 
    <div> 
     <dl> 
      <dt>
       CloudFormation
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, describe, list, and delete stacks</p> </li> 
         <li> <p>Describe stack events</p> </li> 
         <li> <p>List stack resources</p> </li> 
         <li> <p>Validate templates</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Elastic Compute Cloud (EC2)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, describe, and delete key pairs</p> </li> 
         <li> <p>Describe instances</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Identity Management (IAM)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, list, and delete roles</p> </li> 
         <li> <p>Attach, list, and detach managed policies to roles</p> </li> 
         <li> <p>Get users</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Key Management Service (KMS)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, describe, and list keys</p> </li> 
         <li> <p>Schedule and cancel deletion of keys</p> </li> 
         <li> <p>Generate data keys with and without plaintext keys</p> </li> 
         <li> <p>Encrypt and decrypt</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Relational Database Service (RDS)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, describe, and delete DB instances</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Simple Storage Service (S3)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, list, check existence of, empty, and delete buckets</p> </li> 
         <li> <p>Manage bucket policies and tagging</p> </li> 
         <li> <p>Upload and download strings, byte arrays, and files</p> </li> 
         <li> <p>Copy, list, and delete objects</p> </li> 
         <li> <p>Get object URLs</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Security Token Service (STS)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Assume roles</p> </li> 
        </ul> 
       </div> 
      </dd> 
      <dt>
       Simple Notification Service (SNS)
      </dt> 
      <dd> 
       <div> 
        <ul> 
         <li> <p>Create, list, and delete topics</p> </li> 
         <li> <p>Add and remove topic permissions</p> </li> 
         <li> <p>Create, confirm, list, and unsubscribe subscriptions</p> </li> 
         <li> <p>Create, list, and delete platform applications</p> </li> 
         <li> <p>Create, list, and delete platform endpoints</p> </li> 
         <li> <p>Get and set attributes for:</p> 
          <div> 
           <ul> 
            <li> <p>Topics</p> </li> 
            <li> <p>Subscriptions</p> </li> 
            <li> <p>Platform applications</p> </li> 
            <li> <p>Platform endpoints</p> </li> 
           </ul> 
          </div> </li> 
         <li> <p>Publish</p> </li> 
        </ul> 
       </div> 
      </dd> 
     </dl> 
    </div> 
   </div> 
  </div> 
  <div> 
   <h2 id="user-content-getting-started"><a href="https://github.com/monsantoco/aws2scala#getting-started" aria-hidden="true" class="anchor" id="user-content-getting-started" target="_blank">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
     </svg></a><a href="https://github.com/monsantoco/aws2scala#getting-started" target="_blank"></a>Getting started</h2> 
   <div> 
    <div> 
     <h3 id="user-content-add-the-resolver-and-dependencies"><a href="https://github.com/monsantoco/aws2scala#add-the-resolver-and-dependencies" aria-hidden="true" class="anchor" id="user-content-add-the-resolver-and-dependencies" target="_blank">
       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
       </svg></a><a href="https://github.com/monsantoco/aws2scala#add-the-resolver-and-dependencies" target="_blank"></a>Add the resolver and dependencies</h3> 
     <div> 
      <p>You will need to add the following to your <code>build.sbt</code>:</p> 
     </div> 
     <div> 
      <ol> 
       <li> <p>Add the JCenter resolver to get the <em>aws2scala</em> dependency,</p> </li> 
       <li> <p>The <em>aws2scala</em> dependency itself, and</p> </li> 
       <li> <p>Any AWS SDK dependencies you may need.<sup>[<a id="user-content-_footnoteref_2" href="https://github.com/monsantoco/aws2scala#_footnote_2" title="View footnote." target="_blank">2</a>]</sup></p> </li> 
      </ol> 
     </div> 
     <div> 
      <div>
       Adding 
       <em>aws2scala</em> with KMS support to 
       <code>build.sbt</code>
      </div> 
      <div> 
       <div class="highlight highlight-source-scala">
        <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.jcenterRepo                           (<span class="pl-c1">1</span>)

libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
    <span class="pl-s"><span class="pl-pds">"</span>com.monsanto.arch<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>aws2scala<span class="pl-pds">"</span></span>         <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.4.1<span class="pl-pds">"</span></span>    (<span class="pl-c1">2</span>)
    <span class="pl-s"><span class="pl-pds">"</span>com.amazonaws<span class="pl-pds">"</span></span>      <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>aws-java-sdk-kms<span class="pl-pds">"</span></span>  <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.10.52<span class="pl-pds">"</span></span>  (<span class="pl-c1">3</span>)
)</pre>
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div id="user-content-footnotes"> 
   <hr> 
   <div id="user-content-_footnote_1"> 
    <a href="https://github.com/monsantoco/aws2scala#_footnoteref_1" target="_blank">1</a>. In all fairness, most request objects are subclasses of 
    <code>AmazonWebServiceRequest</code> and allow setting things like request timeouts, which is not yet implemented in 
    <em>aws2scala</em>. 
   </div> 
   <div id="user-content-_footnote_2"> 
    <a href="https://github.com/monsantoco/aws2scala#_footnoteref_2" target="_blank">2</a>. 
    <em>aws2scala</em> only transitively depends on 
    <code>aws-java-sdk-core</code>. It uses the 
    <em>provided</em> scope for all other dependencies, allowing consumers to only pull in the library dependencies they need 
   </div> 
  </div>
 </article>
</div>