<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-grafter" class="anchor" href="https://github.com/zalando/grafter#grafter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Grafter</h1> 
  <p><a href="https://gitter.im/zalando/grafter?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/af1673d97c321910437618bc4053a79f065e556e/68747470733a2f2f6261646765732e6769747465722e696d2f7a616c616e646f2f677261667465722e737667" alt="Join the chat at https://gitter.im/zalando/grafter" data-canonical-src="https://badges.gitter.im/zalando/grafter.svg" style="max-width:100%;"></a> <a href="https://travis-ci.org/zalando/grafter" target="_blank"><img src="https://camo.githubusercontent.com/95c4f0f2729ee81edacae6d786c021af55544fcb/68747470733a2f2f7472617669732d63692e6f72672f7a616c616e646f2f677261667465722e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/zalando/grafter.svg?branch=master" style="max-width:100%;"></a> <a href="https://camo.githubusercontent.com/54a69a939e5f943b3809974d7acd231059950d15/68747470733a2f2f6175746f6e6f6d7961637265732e66696c65732e776f726470726573732e636f6d2f323031352f30342f63726f776e2d636c6566742d6772616674696e672d66727569742d74726565732e6a70673f773d33303026683d323834" target="_blank"><img src="https://camo.githubusercontent.com/54a69a939e5f943b3809974d7acd231059950d15/68747470733a2f2f6175746f6e6f6d7961637265732e66696c65732e776f726470726573732e636f6d2f323031352f30342f63726f776e2d636c6566742d6772616674696e672d66727569742d74726565732e6a70673f773d33303026683d323834" alt="grafting" data-canonical-src="https://autonomyacres.files.wordpress.com/2015/04/crown-cleft-grafting-fruit-trees.jpg?w=300&amp;h=284" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-whats-wrong-with-constructor-injection-again" class="anchor" href="https://github.com/zalando/grafter#whats-wrong-with-constructor-injection-again" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What's wrong with constructor injection again?</h1> 
  <p>There are <a href="https://github.com/adamw/macwire" target="_blank">many</a> <a href="https://github.com/google/guice" target="_blank">libraries</a> or <a href="http://www.cakesolutions.net/teamblogs/2011/12/19/cake-pattern-in-depth" target="_blank">approaches</a> for doing <a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank">dependency injection</a> in Scala. Grafter goes back to the fundamentals of dependency injection by <em>just using constructor injection</em>: no reflection, no xml, no annotations, no inheritance or self-types.</p> 
  <p>Then, Grafter add to constructor injection just the necessary support to:</p> 
  <ul> 
   <li>instantiate a component-based application from a configuration</li> 
   <li>fine-tune the wiring (create singletons)</li> 
   <li>test the application by replacing components</li> 
   <li>start / stop the application</li> 
  </ul> 
  <p>Grafter is targeting every possible application because it focuses on associating just 3 ideas:</p> 
  <ul> 
   <li>case classes and interfaces for components</li> 
   <li><code>Reader</code> instances and <a href="http://github.com/milessabin/shapeless" target="_blank">shapeless</a> for the configuration</li> 
   <li><a href="http://www.program-transformation.org/Transform/TreeRewriting" target="_blank">tree rewriting</a> and <a href="https://bitbucket.org/inkytonik/kiama" target="_blank">kiama</a> for everything else!</li> 
  </ul> 
  <p>Please try it and report your experience:</p> 
  <ul> 
   <li>how is it better / worse than another library?</li> 
   <li>is the core model more approachable than other libraries?</li> 
   <li>what could be improved?</li> 
  </ul> 
  <h1><a id="user-content-grafter-components" class="anchor" href="https://github.com/zalando/grafter#grafter-components" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Grafter components</h1> 
  <p>Grafter components are very simple: they are just case classes (possibly) implementing interfaces.</p> 
  <ol> 
   <li>components can depend on other components by having them as case class members</li> 
   <li>the application is the top-level component</li> 
   <li>the application configuration is a just a case class (can be read from a file if necessary)</li> 
   <li>each component can be instantiated from the application configuration</li> 
   <li>so it is possible to recursively build the full application as a <em>tree</em> of components from the application configuration</li> 
   <li>singletons can be made by rewriting the tree, effectively making it a graph</li> 
   <li>the application can be started bottom-up by starting the components extending the <code>Start</code> markup trait</li> 
   <li>the application can also be stopped top-down by stopping all the components extending the <code>Stop</code> markup trait</li> 
   <li>mocking the application for testing can also be done by rewriting the tree</li> 
  </ol> 
  <p>Let's see this on a concrete example.</p> 
  <h3><a id="user-content-create-the-application-configuration" class="anchor" href="https://github.com/zalando/grafter#create-the-application-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create the application configuration</h3> 
  <p>The configuration of the application is a case class possibly containing other case classes. For the examples below we will use</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ApplicationConfig</span>(
  <span class="pl-v">http</span>: <span class="pl-en">HttpConfig</span>,
  <span class="pl-v">db</span>:   <span class="pl-en">DbConfig</span>
)

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">HttpConfig</span>(<span class="pl-v">host</span>: <span class="pl-k">String</span>,
                      <span class="pl-v">port</span>: <span class="pl-k">Int</span>)

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">DbConfig</span>(<span class="pl-v">url</span>: <span class="pl-k">String</span>)</pre>
  </div> 
  <h3><a id="user-content-create-the-first-component" class="anchor" href="https://github.com/zalando/grafter#create-the-first-component" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create the first component</h3> 
  <p>A component of the application is a case class. It must know how to instantiate itself from the configuration. In other terms there needs to be a <a href="http://eed3si9n.com/herding-cats/Reader.html" target="_blank"><code>Reader[ApplicationConfig, Component]</code></a> instance in scope.</p> 
  <p>For example</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">HttpServer</span>(<span class="pl-v">config</span>: <span class="pl-en">HttpConfig</span>)

<span class="pl-k">import</span> <span class="pl-v">cats.data.</span><span class="pl-v">Reader</span>
<span class="pl-k">import</span> <span class="pl-v">cats.implicits.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">HttpServer</span> {
  <span class="pl-c"><span class="pl-c">//</span> we can "map" on a Reader!</span>
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">HttpServer</span>] <span class="pl-k">=</span>
    <span class="pl-en">HttpConfig</span>.reader.map(<span class="pl-en">HttpServer</span>.apply)

}

<span class="pl-k">object</span> <span class="pl-en">HttpConfig</span> {

  <span class="pl-c"><span class="pl-c">//</span> the HttpConfig is extracted directly from</span>
  <span class="pl-c"><span class="pl-c">//</span> the application config</span>
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">HttpConfig</span>] <span class="pl-k">=</span>
    <span class="pl-en">Reader</span>(_.http)

}</pre>
  </div> 
  <h3><a id="user-content-create-other-components-and-use-shapeless" class="anchor" href="https://github.com/zalando/grafter#create-other-components-and-use-shapeless" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create other components and use shapeless</h3> 
  <p>If a component depends on other components. Its <code>Reader</code> instance depends on its dependencies <code>Reader</code> instances. Since this is all recursive and automatable thanks to Shapeless we can write this</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.grafter.GenericReader.</span><span class="pl-v">_</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Application</span>(<span class="pl-v">httpServer</span>: <span class="pl-en">HttpServer</span>, <span class="pl-v">db</span>: <span class="pl-en">Database</span>)

<span class="pl-k">object</span> <span class="pl-en">Application</span> {

  <span class="pl-c"><span class="pl-c">//</span> shapeless will automatically find Reader instances for</span>
  <span class="pl-c"><span class="pl-c">//</span> HttpServer and Database</span>
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">Application</span>] <span class="pl-k">=</span>
    genericReader

}

<span class="pl-k">trait</span> <span class="pl-en">Database</span>

<span class="pl-k">object</span> <span class="pl-en">Database</span> {
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">Database</span>] <span class="pl-k">=</span>
    <span class="pl-en">PostgresDatabase</span>.reader
}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">PostgresDatabase</span>(<span class="pl-v">dbConfig</span>: <span class="pl-en">DbConfig</span>) <span class="pl-k">extends</span> <span class="pl-e">Start</span> {
  <span class="pl-k">def</span> <span class="pl-en">start</span><span class="pl-k">:</span> <span class="pl-en">Eval</span>[<span class="pl-en">StartResult</span>] <span class="pl-k">=</span>
    <span class="pl-en">Start</span>.eval(<span class="pl-s"><span class="pl-pds">"</span>postgres<span class="pl-pds">"</span></span>)(<span class="pl-en">PostgresDriver</span>.start(dbConfig.url))
}

<span class="pl-k">object</span> <span class="pl-en">PostgresDatabase</span> {
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">PostgresDatabase</span>] <span class="pl-k">=</span>
    genericReader
}

<span class="pl-k">object</span> <span class="pl-en">DbConfig</span> {
  <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">reader</span><span class="pl-k">:</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">DbConfig</span>] <span class="pl-k">=</span>
    <span class="pl-en">Reader</span>(_.db)
}
</pre>
  </div> 
  <p>Note that <code>Application</code> depends on the <code>Database</code> interface. When we will create an <code>Application</code> instance <code>Database.reader</code> will be used and will provide a <code>Postgres</code> implementation by default. This means that there must <em>always</em> be a default implementation for each interface introduced in the system. But don't worry we can always change it later!</p> 
  <h4><a id="user-content-remove-some-boilerplate" class="anchor" href="https://github.com/zalando/grafter#remove-some-boilerplate" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Remove some boilerplate</h4> 
  <p>Ultimately configuration components like <code>DbConfig</code> above are extracted from <code>ApplicationConfig</code>. It is possible to generate <code>Reader</code> instances for those values automatically with the <code>@readers</code> annotation:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.grafter.macros.</span><span class="pl-v">_</span>

<span class="pl-k">@</span>readers
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">ApplicationConfig</span>(
  <span class="pl-v">db</span>: <span class="pl-en">DbConfig</span>,
  <span class="pl-v">http</span>: <span class="pl-en">HttpConfig</span>
)</pre>
  </div> 
  <p>Another common element is the <code>implicit def reader</code> that returns <code>genericReader</code>. It is possible to replace the companion object containing this function with a <code>@reader[A]</code> annotation on the case class:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">@</span>reader[<span class="pl-en">ApplicationConfig</span>]
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">PostgresDatabase</span>(<span class="pl-v">dbConfig</span>: <span class="pl-en">DbConfig</span>) <span class="pl-k">extends</span> <span class="pl-e">Start</span> {
  <span class="pl-k">def</span> <span class="pl-en">start</span><span class="pl-k">:</span> <span class="pl-en">Eval</span>[<span class="pl-en">StartResult</span>] <span class="pl-k">=</span>
    <span class="pl-en">Start</span>.eval(<span class="pl-s"><span class="pl-pds">"</span>postgres<span class="pl-pds">"</span></span>)(<span class="pl-en">PostgresDriver</span>.start(dbConfig.url))
}
<span class="pl-c"><span class="pl-c">//</span> no need for the companion object</span></pre>
  </div> 
  <h3><a id="user-content-create-the-full-application" class="anchor" href="https://github.com/zalando/grafter#create-the-full-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create the full application</h3> 
  <p>First you need a full <code>ApplicationConfig</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">prod</span><span class="pl-k">:</span> <span class="pl-en">ApplicationConfig</span> <span class="pl-k">=</span> <span class="pl-en">ApplicationConfig</span>(
  http <span class="pl-k">=</span> <span class="pl-en">HttpConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-c1">8080</span>)
  db   <span class="pl-k">=</span> <span class="pl-en">DbConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>jdbc:localhost/database<span class="pl-pds">"</span></span>)
)</pre>
  </div> 
  <p>Then we can summon the implicit <code>Reader</code> instance for <code>Application</code> and pass it the "prod" configuration:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">application</span><span class="pl-k">:</span> <span class="pl-en">Application</span> <span class="pl-k">=</span>
  <span class="pl-en">GenericReader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">Application</span>].run(prod)</pre>
  </div> 
  <h3><a id="user-content-make-singletons" class="anchor" href="https://github.com/zalando/grafter#make-singletons" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Make singletons</h3> 
  <p>The next step is making sure that however deep our application graph is, we will always use one database, even if 2 components declare 2 dependencies to the database. This is done with the <code>Rewriter</code> object:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.grafter.</span><span class="pl-v">Rewriter</span>

<span class="pl-c"><span class="pl-c">//</span> can also be written application.singleton[Database]</span>
<span class="pl-c"><span class="pl-c">//</span> by importing Rewriter._</span>
<span class="pl-k">val</span> <span class="pl-en">app</span><span class="pl-k">:</span> <span class="pl-en">Application</span> <span class="pl-k">=</span>
  <span class="pl-en">Rewriter</span>.singleton[<span class="pl-en">Database</span>](application)</pre>
  </div> 
  <h3><a id="user-content-start-the-application" class="anchor" href="https://github.com/zalando/grafter#start-the-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Start the application</h3> 
  <p>Now the application can be started, using the <code>Rewriter</code> again which is going to traverse the application graph and start each component implementing <code>Start</code> from the bottom up. If you scroll up you will see that <code>PostgresDatabase</code> is such a component and must implement a <code>start</code> method returning a <code>StartResult</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">cats.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">started</span><span class="pl-k">:</span> <span class="pl-en">Eval</span>[<span class="pl-en">List</span>[<span class="pl-en">StartResult</span>]] <span class="pl-k">=</span>
  <span class="pl-en">Rewriter</span>.start(app)</pre>
  </div> 
  <p>The <code>List[StartResult]</code> can be used to diagnose the start up and produce a nice error message if something went wrong.</p> 
  <h3><a id="user-content-stop-the-application" class="anchor" href="https://github.com/zalando/grafter#stop-the-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Stop the application</h3> 
  <p>The application can also be stopped using the <code>Rewriter</code>. It will stop each component implementing <code>Stop</code> from the top down.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">cats.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">stop</span><span class="pl-k">:</span> <span class="pl-en">Eval</span>[<span class="pl-en">List</span>[<span class="pl-en">StopResult</span>]] <span class="pl-k">=</span>
  <span class="pl-en">Rewriter</span>.stop(app)</pre>
  </div> 
  <p>The major difference between the start and the stop strategies is that <em>all</em> the components will try to be stopped regardless of failures.</p> 
  <p>The <code>List[StopResult]</code> can be used to diagnose the shutdown and produce a nice error message if something went wrong.</p> 
  <h3><a id="user-content-test-the-application" class="anchor" href="https://github.com/zalando/grafter#test-the-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Test the application</h3> 
  <p>For integration testing you generally need to replace components which are at the frontier of your system and deeply embedded in your application. This is done once again with <code>Rewriter</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.grafter.</span><span class="pl-v">_, </span><span class="pl-v">Rewriter.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">mockDb</span> <span class="pl-k">extends</span> <span class="pl-e">Database</span> {
  <span class="pl-c"><span class="pl-c">//</span> mock the database operations</span>
}

<span class="pl-c"><span class="pl-c">//</span> you can also rewrite the prod configuration!</span>
<span class="pl-k">val</span> <span class="pl-en">testConfiguration</span> <span class="pl-k">=</span>
  <span class="pl-en">Application</span>.prod.
    replace[<span class="pl-en">HttpConfig</span>](<span class="pl-en">HttpConfig</span>(<span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-c1">8080</span>))

<span class="pl-c"><span class="pl-c">//</span> create the application</span>
<span class="pl-c"><span class="pl-c">//</span> from the test config</span>
<span class="pl-c"><span class="pl-c">//</span> and mock the database</span>
<span class="pl-k">val</span> <span class="pl-en">application</span><span class="pl-k">:</span> <span class="pl-en">Application</span> <span class="pl-k">=</span>
  <span class="pl-en">GenericReader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">Application</span>].
    run(testConfiguration).
    singleton[<span class="pl-en">Database</span>].
    replace[<span class="pl-en">Database</span>](mockDb)</pre>
  </div> 
  <h3><a id="user-content-integrate-grafter-to-your-application" class="anchor" href="https://github.com/zalando/grafter#integrate-grafter-to-your-application" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Integrate Grafter to your application</h3> 
  <p>In order for the <code>GenericReader</code> functionality to work you need to import it where you want <code>Reader</code> instances to be generated.</p> 
  <p>You can also create a package object for your project, mix-in the <code>GenericReader</code> trait and add a few convenience aliases for your project:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">com.acme</span>

<span class="pl-k">import</span> <span class="pl-v">org.zalando.</span><span class="pl-v">grafter</span>
<span class="pl-k">import</span> <span class="pl-v">shapeless.</span><span class="pl-v">_</span>

<span class="pl-k">package object</span> <span class="pl-en">config</span> <span class="pl-k">extends</span> <span class="pl-e">GenericReader</span> {

  <span class="pl-k">type</span> <span class="pl-en">ConfigReader</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> <span class="pl-en">Reader</span>[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">A</span>]

  <span class="pl-k">def</span> <span class="pl-en">createReader</span>[<span class="pl-en">A</span>, <span class="pl-en">B</span>](<span class="pl-k">implicit</span> <span class="pl-v">gen</span>: <span class="pl-en">LabelledGeneric</span>.<span class="pl-en">Aux</span>[<span class="pl-en">A</span>, <span class="pl-en">B</span>], <span class="pl-v">repr</span>: <span class="pl-en">Lazy</span>[<span class="pl-en">ConfigReader</span>[<span class="pl-en">B</span>]])<span class="pl-k">:</span> <span class="pl-en">ConfigReader</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span>
    genericReader[<span class="pl-en">ApplicationConfig</span>, <span class="pl-en">A</span>, <span class="pl-en">B</span>](gen, repr)

  <span class="pl-k">def</span> <span class="pl-en">configure</span>[<span class="pl-en">A</span>](<span class="pl-v">c</span>: <span class="pl-en">ApplicationConfig</span>)(<span class="pl-k">implicit</span> <span class="pl-v">r</span>: <span class="pl-en">ConfigReader</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">A</span> <span class="pl-k">=</span>
    r(c)

}</pre>
  </div> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/zalando/grafter#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>You add this library as a sbt dependency:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.zalando<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>grafter<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.3.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a id="user-content-contributing" class="anchor" href="https://github.com/zalando/grafter#contributing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contributing</h2> 
  <p>Please read our <a href="https://github.com/zalando/grafter/blob/master/CONTRIBUTING.md" target="_blank">contributor guidelines</a> for more details. And please check these <a href="http://github.com/zalando/grafter/issues" target="_blank">open issues</a> for specific tasks.</p> 
  <hr> 
  <h2><a id="user-content-license" class="anchor" href="https://github.com/zalando/grafter#license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <p>The MIT License (MIT) Copyright © [2016] Zalando SE, <a href="https://tech.zalando.com" target="_blank">https://tech.zalando.com</a></p> 
  <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> 
  <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> 
  <p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p> 
 </article>
</div>