<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-play-prometheus-filters" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#play-prometheus-filters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Play prometheus filters</h1> 
  <p><a href="https://travis-ci.org/stijndehaes/play-prometheus-filters" target="_blank"><img src="https://camo.githubusercontent.com/1146f538e1299868406a41ffc7f8e383ca88ea52/68747470733a2f2f7472617669732d63692e6f72672f7374696a6e6465686165732f706c61792d70726f6d6574686575732d66696c746572732e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/stijndehaes/play-prometheus-filters.svg?branch=master" style="max-width:100%;"></a> <a href="https://coveralls.io/github/stijndehaes/play-prometheus-filters?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/b787a6a44ee42918ccc26722da025532c02b0e7c/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f7374696a6e6465686165732f706c61792d70726f6d6574686575732d66696c746572732f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/github/stijndehaes/play-prometheus-filters/badge.svg?branch=master" style="max-width:100%;"></a> This play library provides four types of filters that collect prometheus metrics.</p> 
  <p>Two of these filters are also compatible with the <a href="https://github.com/lagom/lagom" target="_blank">lagom framework</a>.</p> 
  <p>A simple hello world application using these filters can be found in the following repo: <a href="https://github.com/stijndehaes/play-prometheus-filters-example-app" target="_blank">https://github.com/stijndehaes/play-prometheus-filters-example-app</a></p> 
  <p>To use the library add the following to you build.sbt</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.github.stijndehaes<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>play-prometheus-filters<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.2.0<span class="pl-pds">"</span></span>
</pre>
  </div> 
  <h2><a id="user-content-the-filters" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#the-filters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>The filters</h2> 
  <h3><a id="user-content-request-counter" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#request-counter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Request counter</h3> 
  <p>This filter counts all the requests in your application and adds a label for the status. This filter is compatible with the lagom framework.</p> 
  <h3><a id="user-content-latency-filter" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#latency-filter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Latency filter</h3> 
  <p>This filter collects the latency of all requests. This filter is compatible with the lagom framework.</p> 
  <h3><a id="user-content-route-latency-filter" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#route-latency-filter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Route Latency Filter</h3> 
  <p>This filter collects the latency for all requests and adds a label called RouteActionMethod. This action method is the method name of the method you provided your routes file. This filter makes it possible to measure the latency for all your routes. This filter is not compatible with the lagom framework, since it does not provide the RouteActionMethod.</p> 
  <h3><a id="user-content-status-and-route-latency-filter" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#status-and-route-latency-filter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Status and Route Latency Filter</h3> 
  <p>This filter collects the latency for all requests, adds a label called RouteActionMethod and a label called status. This action method is the method name of the method you provided your routes file. This filter makes it possible to measure the latency for all your routes and the status of the response for this route. It thus combines all the above filters into one. This filter is not compatible with the lagom framework, since it does not provide the RouteActionMethod.</p> 
  <p>Example:</p> 
  <pre><code>GET         /metrics          play.prometheus.controllers.PrometheusController.getMetrics
</code></pre> 
  <p>The RouteActionMethod for the above example would be getMetrics</p> 
  <h2><a id="user-content-how-to-enable-the-filters" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#how-to-enable-the-filters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to enable the filters</h2> 
  <p>See the <a href="https://www.playframework.com/documentation/2.5.x/ScalaHttpFilters#Using-filters" target="_blank">documentation of play</a></p> 
  <p>You should make a filters class:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">javax.inject.</span><span class="pl-v">Inject</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.http.</span><span class="pl-v">DefaultHttpFilters</span>
<span class="pl-k">import</span> <span class="pl-v">play.prometheus.filters.</span><span class="pl-v">LatencyFilter</span>
<span class="pl-k">import</span> <span class="pl-v">play.prometheus.filters.</span><span class="pl-v">StatusCounterFilter</span>

<span class="pl-k">class</span> <span class="pl-en">MyFilters</span> <span class="pl-k">@</span><span class="pl-en">Inject</span>() (
  <span class="pl-v">latencyFilter</span>: <span class="pl-en">LatencyFilter</span>,
  <span class="pl-v">statusCounterFilter</span>: <span class="pl-en">StatusCounterFilter</span>
) <span class="pl-k">extends</span> <span class="pl-e">DefaultHttpFilters</span>(latencyFilter, statusCounterFilter)</pre>
  </div> 
  <p>And the enable this filter in the application.conf</p> 
  <pre lang="$xslt"><code>play.http.filters=com.example.MyFilters
</code></pre> 
  <h2><a id="user-content-prometheus-controller" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#prometheus-controller" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Prometheus controller</h2> 
  <p>The project also provides a prometheus controller with a get metric method. If you add the following to your routes file:</p> 
  <pre><code>GET         /metrics          play.prometheus.controllers.PrometheusController.getMetrics
</code></pre> 
  <p>You should be able to immediately get the metrics</p> 
  <h2><a id="user-content-example" class="anchor" href="https://github.com/stijndehaes/play-prometheus-filters#example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
 </article>
</div>