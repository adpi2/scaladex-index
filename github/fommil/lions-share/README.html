<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p><a href="https://travis-ci.org/fommil/lions-share" target="_blank"><img src="https://camo.githubusercontent.com/0e20dac9b704586886ec4d9ef97cd6c5e2f43a49/68747470733a2f2f7472617669732d63692e6f72672f666f6d6d696c2f6c696f6e732d73686172652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/fommil/lions-share.svg?branch=master" style="max-width:100%;"></a> <a href="https://coveralls.io/r/fommil/lions-share?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/c11c2030486367702ca48c3320e47e0c6ded673a/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f666f6d6d696c2f6c696f6e732d73686172652f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/fommil/lions-share/badge.svg?branch=master" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-lions-share" class="anchor" href="https://github.com/fommil/lions-share#lions-share" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>lions-share</h1> 
  <p>JVM development tools for finding memory and garbage problems.</p> 
  <p>It can be used as a library - as part of custom regression and performance testing frameworks - or as an <a href="https://github.com/sbt/sbt" target="_blank">sbt</a> plugin to get a report on a <code>main</code> class (or scala <code>App</code>).</p> 
  <p>Lion's Share produces HTML reports with interactive Google Charts, e.g. <a href="http://fommil.github.io/lions-share/shapeless/report.html" target="_blank">shapeless' <code>staging.scala</code> example</a>.</p> 
  <p>This project is twinned with <a href="https://github.com/rorygraves/shelmet" target="_blank">Shelmet</a> for heap analysis.</p> 
  <h2><a id="user-content-sbt-plugin" class="anchor" href="https://github.com/fommil/lions-share#sbt-plugin" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SBT Plugin</h2> 
  <h3><a id="user-content-install" class="anchor" href="https://github.com/fommil/lions-share#install" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Install</h3> 
  <p>To use the plugin, add the following to your project's <code>project/plugins.sbt</code> file:</p> 
  <div class="highlight highlight-source-scala">
   <pre>addSbtPlugin(<span class="pl-s"><span class="pl-pds">"</span>com.github.fommil.lion<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>sbt<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.0<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>Then you may run <code>sbt lion</code> to get a report using the default settings on your project's <code>mainClass</code>.</p> 
  <h3><a id="user-content-customise" class="anchor" href="https://github.com/fommil/lions-share#customise" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Customise</h3> 
  <p>The full list of settings is best read <a href="https://github.com/fommil/lions-share/blob/master/sbt/src/main/scala/LionPlugin.scala#L15" target="_blank">from the source code of the plugin</a>.</p> 
  <p>The following are some example settings that can be defined in <code>build.sbt</code> to customise the setup:</p> 
  <div class="highlight highlight-source-scala">
   <pre>lionRuns <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">50</span> <span class="pl-c">// number of times to run the main class (without instrumentation)</span>

lionClass <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-s"><span class="pl-pds">"</span>path.to.MyMain<span class="pl-pds">"</span></span>) <span class="pl-c">// override mainclass just for lions-share</span>

lionOut <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">File</span>(<span class="pl-s"><span class="pl-pds">"</span>my-results<span class="pl-pds">"</span></span>) <span class="pl-c">// output directory for lions-share reports and log files</span>

lionAllocRuns <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">0</span> <span class="pl-c">// runs with the allocation agent (slow)</span>

lionAllocTrim <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">None</span> <span class="pl-c">// no trimming, or trim to this many top-allocated objects</span>

lionAllocRate <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">30</span> <span class="pl-c">// number of seconds to wait between polling the allocation agent.</span>

lionAllocTrace <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-en">Map</span>.empty[<span class="pl-k">String</span>, <span class="pl-k">Long</span>] <span class="pl-c">// classes and byte sample threshold</span></pre>
  </div> 
  <h3><a id="user-content-examples" class="anchor" href="https://github.com/fommil/lions-share#examples" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Examples</h3> 
  <p>There are some examples under the examples module, including:</p> 
  <ul> 
   <li>demonstration of <code>Some</code> creation churn and performance impact <a href="https://issues.scala-lang.org/browse/SI-8519" target="_blank">prompting SI-8519</a></li> 
   <li>shapeless' <a href="http://github.com/milessabin/shapeless/blob/master/examples/src/main/scala/shapeless/examples/staging.scala" target="_blank"><code>staging.scala</code></a> example which does runtime invocation of <code>scalac</code>. <a href="http://fommil.github.io/lions-share/shapeless/report.html" target="_blank"><code>report.html</code></a></li> 
  </ul> 
  <h2><a id="user-content-library" class="anchor" href="https://github.com/fommil/lions-share#library" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Library</h2> 
  <p>To use the Garbage Collection analyser as part of your own testing or analysis framework, you must start your applications with these flags:</p> 
  <pre><code>-Xloggc:gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintHeapAtGC
</code></pre> 
  <p>The <code>GcParser</code> and <code>GcAnalyser</code> classes are then at your disposal, producing a <code>DataTable</code> case class that can be marshalled (using Spray JSON) to the exact form required by Google Charts <a href="https://developers.google.com/chart/interactive/docs/reference#DataTable" target="_blank"><code>DataTable</code> class</a>. See <code>GcReporter</code> and the companion <code>report.html</code> for an example.</p> 
  <p>To use the allocation agent, you must obtain <code>agent-assembly.jar</code> and start your application with</p> 
  <pre><code>-javaagent:agent-assembly.jar=OUTFILE PERIOD TRACES
</code></pre> 
  <p>where</p> 
  <ul> 
   <li><code>OUTFILE</code> is the file to write the samples</li> 
   <li><code>PERIOD</code> is the number of seconds between snapshotting the sampler</li> 
   <li><code>TRACES</code> is a comma separated list of <code>CLASSNAME:BYTES</code> pairs (optional)</li> 
  </ul> 
  <h2><a id="user-content-known-problems" class="anchor" href="https://github.com/fommil/lions-share#known-problems" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Known Problems</h2> 
  <p>Please check the issue tracker to see if we are already aware of an issue (including a workaround). The biggest issues are;</p> 
  <ul> 
   <li><a href="https://github.com/fommil/lions-share/blob/master/analysis/src/main/scala/com/github/fommil/lion/gc/parser.scala#L24" target="_blank">Only specific JVMs are supported by the garbage collection log parser</a>, and <a href="https://github.com/fommil/lions-share/issues/13" target="_blank">G1 is not supported at all</a>.</li> 
  </ul> 
  <p>You might need to run your application under a supported JVM, e.g.:</p> 
  <pre><code>JAVA_HOME=/opt/jdk1.7.0_51 sbt lion
</code></pre> 
  <p>and if you need really robust garbage collection log parsing, try the commercial product <a href="http://www.jclarity.com/censum/" target="_blank">Censum by jClarity</a>.</p> 
  <h2><a id="user-content-planned-features" class="anchor" href="https://github.com/fommil/lions-share#planned-features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Planned Features</h2> 
  <ol> 
   <li>CPU (instrumentation) sampling</li> 
   <li>Scala REPL support (e.g. allocation sizes for a block)</li> 
   <li>non-instrumentation timeseries instance counts</li> 
  </ol> 
 </article>
</div>