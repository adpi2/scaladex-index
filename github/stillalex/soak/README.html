<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/stillalex/soak#soak---a-scala-library-for-oak" aria-hidden="true" class="anchor" id="user-content-soak---a-scala-library-for-oak" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>SOAK - a Scala library for Oak</h1> 
  <p><a href="https://camo.githubusercontent.com/22013194cdabf2f0dba2524b1ada373cefeadda7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f736f616b2d302e302e382d626c75652e737667" target="_blank"><img src="https://camo.githubusercontent.com/22013194cdabf2f0dba2524b1ada373cefeadda7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f736f616b2d302e302e382d626c75652e737667" alt="0.0.8" data-canonical-src="https://img.shields.io/badge/soak-0.0.8-blue.svg" style="max-width:100%;"></a> <em>Latest release: 0.0.8 / May 28, 2017</em></p> 
  <p>Built on <a href="https://www.scala-lang.org/" target="_blank">Scala</a> <code>2.12.2</code> and <a href="https://jackrabbit.apache.org/oak/" target="_blank">Oak</a> <code>1.6.x</code></p> 
  <p><a href="https://www.scala-lang.org/" target="_blank"><img src="https://camo.githubusercontent.com/8e74da71f026b7c38c2c5d9806b759ca89c6b124/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f5363616c612d322e31322d7265642e737667" alt="Scala 2.12" data-canonical-src="https://img.shields.io/badge/Scala-2.12-red.svg" style="max-width:100%;"></a> <a href="https://jackrabbit.apache.org/oak/" target="_blank"><img src="https://camo.githubusercontent.com/bc5b0c26d0cfc134298c6ce376405a6397b353c5/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4f616b2d312e362e312d677265656e2e737667" alt="Oak 1.6.1" data-canonical-src="https://img.shields.io/badge/Oak-1.6.1-green.svg" style="max-width:100%;"></a> <a href="https://travis-ci.org/stillalex/soak" target="_blank"><img src="https://camo.githubusercontent.com/6b7831ba4a4166cd37fede9563b8b96cc4797c61/68747470733a2f2f7472617669732d63692e6f72672f7374696c6c616c65782f736f616b2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/stillalex/soak.svg?branch=master" style="max-width:100%;"></a> <a href="https://coveralls.io/github/stillalex/soak?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/07f0ff3b85aca8e4701cad7f8a23f0e9b6421ec8/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f7374696c6c616c65782f736f616b2f62616467652e7376673f6272616e63683d6d617374657226736572766963653d676974687562" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/stillalex/soak/badge.svg?branch=master&amp;service=github" style="max-width:100%;"></a> <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank"><img src="https://camo.githubusercontent.com/17d81d2643f6ee5fcc87c8f7f74588da4b5e6bb7/687474703a2f2f696d672e736869656c64732e696f2f3a6c6963656e73652d417061636865253230322d7265642e737667" alt="License" data-canonical-src="http://img.shields.io/:license-Apache%202-red.svg" style="max-width:100%;"></a></p> 
  <h2><a href="https://github.com/stillalex/soak#features" aria-hidden="true" class="anchor" id="user-content-features" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h2> 
  <ul> 
   <li><code>Session</code> Operations made simple</li> 
   <li><code>Tree</code> helpers</li> 
   <li><code>PropertyState</code> helpers</li> 
   <li><code>Query</code> helpers (WIP)</li> 
   <li><code>OSGi</code> support, even comes with an <a href="https://github.com/stillalex/soak/blob/master/src/main/scala/com/pfalabs/soak/osgi/OakService.scala#L28" target="_blank">OSGi initializer for the repository</a></li> 
  </ul> 
  <h2><a href="https://github.com/stillalex/soak#sessions-examples" aria-hidden="true" class="anchor" id="user-content-sessions-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sessions Examples</h2> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-s"><span class="pl-pds">"</span>Session ops<span class="pl-pds">"</span></span> should <span class="pl-s"><span class="pl-pds">"</span>create content<span class="pl-pds">"</span></span> in {
    <span class="pl-k">val</span> <span class="pl-en">oak</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Oak</span>(<span class="pl-k">new</span> <span class="pl-en">MemoryNodeStore</span>()).`with`(<span class="pl-k">new</span> <span class="pl-en">OpenSecurityProvider</span>())
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">repository</span> <span class="pl-k">=</span> oak.createContentRepository()

    <span class="pl-k">val</span> <span class="pl-en">o1</span> <span class="pl-k">=</span> runAsAdmin({ root <span class="pl-k">=&gt;</span>
      root.getTree(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>).addChild(<span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>)
      root.commit()
    })
    assert(o1.isSuccess)

    <span class="pl-k">val</span> <span class="pl-en">o2</span> <span class="pl-k">=</span> runAsAdmin({ root <span class="pl-k">=&gt;</span>
      <span class="pl-k">val</span> <span class="pl-en">t</span> <span class="pl-k">=</span> root.getTree(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>).getChild(<span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>)
      assert(t.exists())
    })
    assert(o2.isSuccess)

    <span class="pl-k">val</span> <span class="pl-en">o3</span> <span class="pl-k">=</span> <span class="pl-en">Sessions</span>.run(<span class="pl-s"><span class="pl-pds">"</span>none<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)({ root <span class="pl-k">=&gt;</span>
      fail(<span class="pl-s"><span class="pl-pds">"</span>not allowed here!<span class="pl-pds">"</span></span>)
    })
    assert(o3.isFailure)
  }</pre>
  </div> 
  <h2><a href="https://github.com/stillalex/soak#osgi-examples" aria-hidden="true" class="anchor" id="user-content-osgi-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>OSGi Examples</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.pfalabs.soak.osgi.</span><span class="pl-v">OakService</span>

<span class="pl-k">@</span><span class="pl-en">Component</span>(immediate <span class="pl-k">=</span> <span class="pl-c1">true</span>)
<span class="pl-k">class</span> <span class="pl-en">CustomOakService</span> <span class="pl-k">extends</span> <span class="pl-e">OakService</span> {

  <span class="pl-k">@</span><span class="pl-en">Activate</span>
  <span class="pl-k">def</span> <span class="pl-en">activate</span>(<span class="pl-v">context</span>: <span class="pl-en">ComponentContext</span>) <span class="pl-k">=</span> doActivate(context)

  <span class="pl-k">@</span><span class="pl-en">Deactivate</span>
  <span class="pl-k">def</span> <span class="pl-en">deactivate</span>() <span class="pl-k">=</span> doDeactivate()
}</pre>
  </div> 
  <h2><a href="https://github.com/stillalex/soak#trees-examples" aria-hidden="true" class="anchor" id="user-content-trees-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Trees Examples</h2> 
  <p>Select all child nodes of <code>/test</code>, filter and transform them to <code>Item</code> instances:</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Item</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">choice</span>: <span class="pl-en">Option</span>[<span class="pl-k">String</span>])

    <span class="pl-k">def</span> <span class="pl-en">getFilteredAsItem</span>(<span class="pl-v">root</span>: <span class="pl-en">Root</span>)<span class="pl-k">:</span> <span class="pl-en">Iterable</span>[<span class="pl-en">Item</span>] <span class="pl-k">=</span> (root <span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>/test<span class="pl-pds">"</span></span>) <span class="pl-k">/</span><span class="pl-k">:</span><span class="pl-k">/</span> (filterByChoice, treeToItem)

    <span class="pl-k">def</span> <span class="pl-en">filterByChoice</span>(<span class="pl-v">t</span>: <span class="pl-en">Tree</span>)<span class="pl-k">:</span> <span class="pl-k">Boolean</span> <span class="pl-k">=</span> asS(t <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>choice<span class="pl-pds">"</span></span>).getOrElse(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>).equals(<span class="pl-s"><span class="pl-pds">"</span>yes<span class="pl-pds">"</span></span>)

    <span class="pl-k">def</span> <span class="pl-en">treeToItem</span>(<span class="pl-v">t</span>: <span class="pl-en">Tree</span>)<span class="pl-k">:</span> <span class="pl-en">Item</span> <span class="pl-k">=</span> <span class="pl-en">Item</span>(t.name, asS(t <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>choice<span class="pl-pds">"</span></span>))

    <span class="pl-k">val</span> <span class="pl-en">example</span> <span class="pl-k">=</span> runAsAdmin(getFilteredAsItem)</pre>
  </div> 
  <h2><a href="https://github.com/stillalex/soak#query-examples" aria-hidden="true" class="anchor" id="user-content-query-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Query Examples</h2> 
  <p>Select all child nodes of <code>/testQ</code> that have <code>@lang = 'en'</code> and transform them to <code>Item</code> instances:</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">def</span> <span class="pl-en">treeToItem</span>(<span class="pl-v">t</span>: <span class="pl-en">Tree</span>)<span class="pl-k">:</span> <span class="pl-en">Item</span> <span class="pl-k">=</span> <span class="pl-en">Item</span>(t.name, asI(t <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>).get, asS(t <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>lang<span class="pl-pds">"</span></span>))

    <span class="pl-k">val</span> <span class="pl-en">xpathEn</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/jcr:root/testQ/element(*, oak:Unstructured)[@lang = 'en']<span class="pl-pds">"</span></span>

    <span class="pl-k">val</span> <span class="pl-en">example</span> <span class="pl-k">=</span> <span class="pl-k">val</span> <span class="pl-en">o1</span> <span class="pl-k">=</span> runAsAdmin(xpath(xpathEn, treeToItem))</pre>
  </div> 
  <h2><a href="https://github.com/stillalex/soak#use-it" aria-hidden="true" class="anchor" id="user-content-use-it" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Use it</h2> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.pfalabs&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;com.pfalabs.soak_2.12&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;0.0.8&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>The releases are published on <a href="https://bintray.com/pfalabs/maven/soak" target="_blank">bintray</a>, so make sure you add the repository to the <code>pom.xml</code> file</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">repository</span>&gt;
  &lt;<span class="pl-ent">id</span>&gt;bintray-pfalabs-maven&lt;/<span class="pl-ent">id</span>&gt;
  &lt;<span class="pl-ent">name</span>&gt;bintray&lt;/<span class="pl-ent">name</span>&gt;
  &lt;<span class="pl-ent">layout</span>&gt;default&lt;/<span class="pl-ent">layout</span>&gt;
  &lt;<span class="pl-ent">url</span>&gt;http://dl.bintray.com/pfalabs/maven&lt;/<span class="pl-ent">url</span>&gt;
  &lt;<span class="pl-ent">snapshots</span>&gt;
    &lt;<span class="pl-ent">enabled</span>&gt;false&lt;/<span class="pl-ent">enabled</span>&gt;
  &lt;/<span class="pl-ent">snapshots</span>&gt;
&lt;/<span class="pl-ent">repository</span>&gt;</pre>
  </div> 
  <h2><a href="https://github.com/stillalex/soak#license" aria-hidden="true" class="anchor" id="user-content-license" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>License</h2> 
  <pre><code>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this work except in compliance with the License.
You may obtain a copy of the License in the LICENSE file, or at:

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre> 
 </article>
</div>