<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-mdc-async" class="anchor" href="https://github.com/mdedetrich/mdc-async#mdc-async" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>MDC async</h1> 
  <p>This project contains code that was shamelessly copied from <a href="http://yanns.github.io/blog/2014/05/04/slf4j-mapped-diagnostic-context-mdc-with-play-framework/" target="_blank">here</a> so that it can easily be reused as a dependency.</p> 
  <p>Some slight alterations have been done (i.e. the signatures for MDC context are <code>java.util.Map[String, String]</code> instead of <code>java.util.Map[_, _]</code> due to recent changes in slf4j and <code>MDCHttpExecutionContext</code> has been renamed to <code>MDCExecutionContext</code>) but otherwise its exactly the same</p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/mdedetrich/mdc-async#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>The library can be found here</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-s"><span class="pl-pds">"</span>org.mdedetrich<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>mdc-async<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Currently its published for both Scala 2.11.8</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/mdedetrich/mdc-async#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>The main idea of the library is to be able to use slf4j MDC in asynchronous environments. This library contains two different approaches to solving this problem, one is by using a Akka Dispatcher and the other is by using custom execution context (which you need to use when you are doing your logging)</p> 
  <h3><a id="user-content-akka-dispatcher" class="anchor" href="https://github.com/mdedetrich/mdc-async#akka-dispatcher" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Akka Dispatcher</h3> 
  <p>To use the Akka dispatcher variant, you need to provide a global dispatcher. If you are using Play, then you need to do something like the following</p> 
  <pre lang="conf"><code>play {
  akka {
    actor {
      default-dispatcher = {
        type = "monitoring.MDCPropagatingDispatcherConfigurator"
      }
    }
  }
}
</code></pre> 
  <p>If you are not using Play, then you simple need to provide this dispatcher in context for your Akka application. Note that as stated <a href="https://github.com/jroper/thread-local-context-propagation#thread-local-context-propagation-example" target="_blank">here</a> this can have performance impliciations, quoting directly from <a href="https://github.com/jroper" target="_blank">@jroper</a></p> 
  <blockquote> 
   <p>I don't recommend doing this. It has performance implications, and in an asynchronous application, it can be very difficult to track what is done on what thread - you don't want to have to worry about that, you want the framework to worry about that for you, but transferring state on thread locals forces you to always have this implicit requirement in your mind as you code. In my opinion, this just isn't worth the pain. Pass state/context explicitly, then everything becomes very easy to understand, test, and reason about.</p> 
  </blockquote> 
  <h3><a id="user-content-mdc-execution-context" class="anchor" href="https://github.com/mdedetrich/mdc-async#mdc-execution-context" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>MDC Execution Context</h3> 
  <p>Another solution is to use a custom MDC execution context which propagates a specified <code>ExecutionContext</code>. You can find the execution context in <code>scala.concurrent.MDCExecutionContext</code>. This execution context delegates from an already existing execution context, so if you are using Play (for example) you would do</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">scala.concurrent</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">ExecutionContext</span>

<span class="pl-c"><span class="pl-c">/**</span></span>
<span class="pl-c"> * The standard [[<span class="pl-e">play.api.libs.concurrent.Execution.defaultContext</span>]] loses the MDC context.</span>
<span class="pl-c"> *</span>
<span class="pl-c"> * This custom [[<span class="pl-e">ExecutionContext</span>]] propagates the MDC context, so that the request</span>
<span class="pl-c"> * and the correlation IDs can be logged.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">object</span> <span class="pl-en">Execution</span> {

  <span class="pl-k">object</span> <span class="pl-en">Implicits</span> {
    <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">defaultContext</span><span class="pl-k">:</span> <span class="pl-en">ExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">Execution</span>.defaultContext
  }

  <span class="pl-k">def</span> <span class="pl-en">defaultContext</span><span class="pl-k">:</span> <span class="pl-en">ExecutionContext</span> <span class="pl-k">=</span> <span class="pl-en">MDCExecutionContext</span>.fromThread(play.api.libs.concurrent.<span class="pl-en">Execution</span>.defaultContext)

}</pre>
  </div> 
  <p>Otherwise you could just the default <code>ExecutionContext</code>, i.e. <code>scala.concurrent.ExecutionContext.Implicits.global</code></p> 
  <h2><a id="user-content-dependencies" class="anchor" href="https://github.com/mdedetrich/mdc-async#dependencies" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependencies</h2> 
  <p>Currently all of the dependencies are set as provided, so you need to provide the actual dependency yourself. The dependencies</p> 
  <ul> 
   <li><a href="http://logback.qos.ch/" target="_blank">Logback</a> </li> 
   <li><a href="http://akka.io/" target="_blank">Akka</a> Needed for the Akka Dispatcher</li> 
   <li><a href="https://github.com/typesafehub/config" target="_blank">Typesafe Config</a> Needed for reading configuration values</li> 
  </ul> 
 </article>
</div>