<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-stripe-scala-api-for-stripe-using-scala" class="anchor" href="https://github.com/mdedetrich/stripe-scala#stripe-scala-api-for-stripe-using-scala" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>stripe-scala, API for Stripe Using Scala</h1> 
  <p><a href="https://travis-ci.org/mdedetrich/stripe-scala" target="_blank"><img src="https://camo.githubusercontent.com/e8146f66887a73ac299b21837fde21999192ac88/68747470733a2f2f7472617669732d63692e6f72672f6d6465646574726963682f7374726970652d7363616c612e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/mdedetrich/stripe-scala.svg?branch=master" style="max-width:100%;"></a></p> 
  <p>stripe-scala is a wrapper over the <a href="https://stripe.com/" target="_blank">Stripe</a> <a href="https://stripe.com/docs/api/curl#intro" target="_blank">REST api</a>. Unlike <a href="https://github.com/stripe/stripe-java" target="_blank">stripe-java</a>, stripe-scala binds JSON response to the stripe object models (using Scala case classes) and lets you create requests from typed case classes (rather than just using Java <code>Map&lt;String,Object&gt;</code>)</p> 
  <h2><a id="user-content-libraries-used" class="anchor" href="https://github.com/mdedetrich/stripe-scala#libraries-used" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Libraries Used</h2> 
  <ul> 
   <li><a href="https://www.playframework.com/documentation/2.4.x/ScalaJson" target="_blank">play-json</a> for JSON (play-json provides compile time macros for reading/writing JSON from/to scala case classes). It also provides a very powerful API for validating/querying JSON</li> 
   <li><a href="https://github.com/dispatch/reboot" target="_blank">dispatch</a> for making HTTP requests</li> 
   <li><a href="https://github.com/iheartradio/ficus" target="_blank">ficus</a> for providing config (via <a href="https://github.com/typesafehub/config" target="_blank">typesafe-config</a>)</li> 
   <li><a href="https://github.com/lloydmeta/enumeratum" target="_blank">enumeratum</a> for providing typesafe enumerations on stripe enum models as well</li> 
   <li><a href="https://github.com/NET-A-PORTER/scala-uri" target="_blank">scala-uri</a> for providing a URI DSL to generate query parameters for list operations play-json formats for such models</li> 
  </ul> 
  <p>stripe-scala was intentionally designed to use bare minimum external dependencies so its easier to integrate with scala codebases</p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/mdedetrich/stripe-scala#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>Currently, stripe-scala is in pre-1.0 stage. It is powering the payment processing of at least one company in production but not all endpoints are completed.</p> 
  <p>It has been deployed to Maven Central, so to install it add the following to your build definition:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-s"><span class="pl-pds">"</span>org.mdedetrich<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>stripe-scala<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.0<span class="pl-pds">"</span></span>
)</pre>
  </div> 
  <p>To get the latest version please check the <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.mdedetrich%22%20AND%20a%3A%22stripe-scala_2.11%22" target="_blank">Maven repository search</a>.</p> 
  <h2><a id="user-content-todo-for-release" class="anchor" href="https://github.com/mdedetrich/stripe-scala#todo-for-release" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>TODO for release</h2> 
  <ul class="contains-task-list"> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> Add all operations for all endpoints</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> Add tests</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> Shade jawn/scala-uri/enumeratum if possible. These dependencies don't need to be exposed to users</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> Document Stripe API with ScalaDoc</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> Figure out how to deal with list collections</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> Figure out how to deal with error handling</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> Provide default methods for models so that building them is nicer</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> Implement a single instance of all operation types to figure out if there are any potential issues 
    <ul class="contains-task-list"> 
     <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> get</li> 
     <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> create</li> 
     <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> update</li> 
     <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> list</li> 
     <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> delete</li> 
    </ul></li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> Clean up/refactor code (still a lot of duplication)</li> 
   <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> Webhooks/Events</li> 
  </ul> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/mdedetrich/stripe-scala#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Stripe Api key and url endpoint are provided implicitly by using the <code>org.mdedetrich.stripe.ApiKey</code> and <code>org.mdedetrich.stripe.Endpoint</code> types. The <code>org.mdedetrich.stripe.Config</code> object provides these keys through environment variables/system settings (see <code>application.conf</code> for more details), although you can manually provide your own implicit <code>ApiKey</code> and <code>Endpoint</code> instances.</p> 
  <p>All base responses made are in the format of <code>Future[Try[T]]</code> where <code>T</code> is the model for the object being returned (i.e. creating a charge will return a <code>Future[Try[Charges.Charge]]</code>). If there is an error in making the response that involves either invalid JSON or an error in mapping the JSON to the models <code>case class</code>, this will throw an exception which you need to catch as a failed <code>Future</code> (it is by design that the models defined in stripe-scala are correct and that stripe does actually return valid JSON).</p> 
  <p>If there however is a checked error (such as an invalid API key) this will not throw an exception, instead it will be contained within the <code>Try</code> monad (i.e. you will get a <code>scala.util.Failure</code>)</p> 
  <p>The second parameter for stripe POST requests (often named as create in stripe-scala) has an optional <code>idempotencyKey</code> which defaults to <code>None</code>. You can specify a <code>IdempotencyKey</code> to make sure that you don't create duplicate POST requests with the same input.</p> 
  <p>stripe-scala provides <code>handle</code>/<code>handleIdempotent</code> functions which provides the typical way of dealing with stripe-errors. It will attempt to retry the original request (using the <code>IdempotencyKey</code> to prevent duplicate side effects with <code>handleIdempotent</code>) for errors which are deemed to be network related errors, else it will return a failed <code>Future</code>. If it fails due to going over the retry limit, <code>handle</code>/<code>handleIdempotent</code> will also return a failed <code>Future</code> with <code>MaxNumberOfRetries</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.mdedetrich.stripe.v1.</span>{<span class="pl-v">Customers</span>, <span class="pl-v">handleIdempotent</span>}

<span class="pl-k">val</span> <span class="pl-en">customerInput</span><span class="pl-k">:</span> <span class="pl-en">Customers</span>.<span class="pl-en">CustomerInput</span> <span class="pl-k">=</span> <span class="pl-k">???</span> <span class="pl-c"><span class="pl-c">//</span> Some customer input</span>
<span class="pl-k">val</span> <span class="pl-en">response</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Customers</span>.<span class="pl-en">Customer</span>] <span class="pl-k">=</span> handleIdempotent(<span class="pl-en">Customers</span>.create(customerInput))</pre>
  </div> 
  <p>For the most part you will want to use <code>handleIdempotent</code>/<code>handle</code> however if you want more fine grained control over potential errors then you can use the various <code>.create</code>/<code>.get</code> methods</p> 
  <h3><a id="user-content-default-methods" class="anchor" href="https://github.com/mdedetrich/stripe-scala#default-methods" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Default methods</h3> 
  <p>The stripe object models in stripe-scala provide a <code>.default</code> method on the companion object which simplifies creating the stripe models</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.mdedetrich.stripe.v1.Customers.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">expMonth</span> <span class="pl-k">=</span> <span class="pl-c1">01</span>
<span class="pl-k">val</span> <span class="pl-en">expYear</span> <span class="pl-k">=</span> <span class="pl-c1">2020</span>
<span class="pl-k">val</span> <span class="pl-en">cardNumber</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>4242424242424242<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">cvc</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>536<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">//</span> Inefficient way</span>
<span class="pl-k">val</span> <span class="pl-en">source</span> <span class="pl-k">=</span> <span class="pl-en">Source</span>.<span class="pl-en">Card</span>(expMonth,
                        expYear,
                        cardNumber,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-en">Option</span>(cvc),
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>,
                        <span class="pl-c1">None</span>
                      )

<span class="pl-c"><span class="pl-c">//</span> Efficient way</span>
<span class="pl-k">val</span> <span class="pl-en">source2</span> <span class="pl-k">=</span> <span class="pl-en">Source</span>.<span class="pl-en">Card</span>
  .default(expMonth,expYear,cardNumber)
  .copy(cvc <span class="pl-k">=</span> <span class="pl-en">Option</span>(cvc))</pre>
  </div> 
  <p>The <code>.default</code> methods create an instance of the model with all of the <code>Optional</code> fields filled as <code>None</code>. Models that have no <code>Optional</code> fields do not have a <code>.default</code> method.</p> 
  <h3><a id="user-content-metadata" class="anchor" href="https://github.com/mdedetrich/stripe-scala#metadata" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>metadata</h3> 
  <p>Stripe provides a metadata field which is available as an input field to most of the stripe objects. The metadata in stripe-scala has a type of <code>Option[Map[String,String]]</code>. As you can see, the metadata is wrapped in an <code>Option</code>. This is to make working with metadata easier. If the map for the metadata happens to empty, the metadata will be <code>None</code>.</p> 
  <h3><a id="user-content-timestamps" class="anchor" href="https://github.com/mdedetrich/stripe-scala#timestamps" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Timestamps</h3> 
  <p>Stripe represents all of its timestamps as unix timestamp numbers (<a href="https://support.stripe.com/questions/what-timezone-does-the-dashboard-and-api-use" target="_blank">https://support.stripe.com/questions/what-timezone-does-the-dashboard-and-api-use</a>) however stripe-scala models store these timestamps as an <code>OffsetDateTime</code>. stripe-scala handles converting the unix timestamp to <code>OffsetDateTime</code> and vice versa by using custom play-json writers/readers for JSON (<code>stripeDateTimeReads</code>/<code>stripeDateTimeWrites</code>) and <code>stripeDateTimeParamWrites</code> for form parameters.</p> 
  <p>These functions are exposed publicly via the <a href="https://github.com/mdedetrich/stripe-scala/blob/master/src/main/scala/org/mdedetrich/stripe/v1/package.scala" target="_blank">package object</a>.</p> 
  <h3><a id="user-content-dealing-with-card-errors" class="anchor" href="https://github.com/mdedetrich/stripe-scala#dealing-with-card-errors" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dealing with Card Errors</h3> 
  <p>Since error messages from stripe are properly checked, dealing with errors like invalid CVC when adding a card are very easy to do. Here is an example (we assume that you are using Play, but this can work with any web framework. Only <code>OK</code>,<code>BadRequest</code> and <code>Json.obj</code> are Play related methods)</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.mdedetrich.stripe.v1.Cards.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.mdedetrich.stripe.v1.Errors.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.mdedetrich.stripe.v1.</span>{<span class="pl-v">handleIdempotent</span>,<span class="pl-v">transformParam</span>}

<span class="pl-k">import</span> <span class="pl-v">play.api.</span><span class="pl-v">mvc </span><span class="pl-c"><span class="pl-c">//</span> Play related import</span>

<span class="pl-k">val</span> <span class="pl-en">expMonth</span> <span class="pl-k">=</span> <span class="pl-c1">01</span>
<span class="pl-k">val</span> <span class="pl-en">expYear</span> <span class="pl-k">=</span> <span class="pl-c1">2020</span>
<span class="pl-k">val</span> <span class="pl-en">cardNumber</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>4000000000000127<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">cvc</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>536<span class="pl-pds">"</span></span>

<span class="pl-k">val</span> <span class="pl-en">stripeCustomerId</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-k">???</span> <span class="pl-c"><span class="pl-c">//</span> Some stripe customer Id</span>

<span class="pl-k">val</span> <span class="pl-en">cardData</span> <span class="pl-k">=</span> <span class="pl-en">Cards</span>.<span class="pl-en">CardData</span>.<span class="pl-en">SourceObject</span>
  .default(expMonth, expYear, cardNumber)
  .copy(cvc <span class="pl-k">=</span> <span class="pl-en">Option</span>(cvc))

<span class="pl-k">val</span> <span class="pl-en">cardInput</span> <span class="pl-k">=</span> <span class="pl-en">Cards</span>.<span class="pl-en">CardInput</span>.default(cardData)

<span class="pl-k">val</span> <span class="pl-en">futureResponse</span> <span class="pl-k">=</span> handleIdempotent(<span class="pl-en">Cards</span>.create(stripeCustomerId, cardInput)).recover {
  <span class="pl-k">case</span> <span class="pl-en">Errors</span>.<span class="pl-en">Error</span>.<span class="pl-en">RequestFailed</span>(<span class="pl-en">CardError</span>, _, <span class="pl-en">Some</span>(message), <span class="pl-en">Some</span>(param)) <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> We have a parameter, this usually means one of our fields is incorrect such as an invalid CVC</span>
    <span class="pl-en">BadRequest</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-en">List</span>((transformParam(param), <span class="pl-en">List</span>(message))))
  <span class="pl-k">case</span> <span class="pl-en">Errors</span>.<span class="pl-en">Error</span>.<span class="pl-en">RequestFailed</span>(<span class="pl-en">CardError</span>, _, <span class="pl-en">Some</span>(message), <span class="pl-c1">None</span>) <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> No parameter, usually means a more general error, such as a declined card</span>
    <span class="pl-en">BadRequest</span>(<span class="pl-en">Json</span>.obj(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> message))
}.map { cardData <span class="pl-k">=&gt;</span>
  <span class="pl-en">Ok</span>(<span class="pl-en">Json</span>.toJson(cardData))
}</pre>
  </div> 
  <p>We attempt to create a card, and if it fails due to a <code>CardError</code> we use the <code>.recover</code> method on a <code>Future</code> with pattern matching to map it to a <code>BadRequest</code>. If the request passes, we simply wrap the card data around an <code>Ok</code>. If we don't catch something of type <code>CardError</code> we let it propagate as a failed <code>Future</code>.</p> 
  <p>One thing to note is the <code>transformParam</code> function. Since scala-stripe uses camel case instead of stripe's snake case, returned params for error messages from stripe will use snake case (i.e. "exp_month"). <code>transformParam</code> will convert that to a "expMonth".</p> 
  <p>If you try and run the above code (remembering to implement <code>stripeCustomerId</code>) with that credit card number in a test environment it should return an incorrect CVC, see <a href="https://stripe.com/docs/testing" target="_blank">stripe testing</a> for more info.</p> 
  <h3><a id="user-content-list-collection" class="anchor" href="https://github.com/mdedetrich/stripe-scala#list-collection" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>List collection</h3> 
  <p>stripe can return items in the form a of a list which has the following format</p> 
  <div class="highlight highlight-source-json">
   <pre>{
  <span class="pl-s"><span class="pl-pds">"</span>object<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>/v1/customers/35/sources<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>has_more<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>,
  <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: [
    {<span class="pl-ii">...</span>},
    {<span class="pl-ii">...</span>}
  ]
}</pre>
  </div> 
  <p>In stripe-scala, there is a base List collection at <code>org.mdedetrich.stripe.v1.Collections.List</code> with represents the model for the list. Other stripe objects extend <code>org.mdedetrich.stripe.v1.Collections.List</code> to provide an implementation of the object as a list collection, i.e. <code>BankAccountList</code> for <code>BankAccount</code></p> 
  <h3><a id="user-content-formattingstyle-guide" class="anchor" href="https://github.com/mdedetrich/stripe-scala#formattingstyle-guide" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Formatting/Style Guide</h3> 
  <p>The project uses scalafmt to enforce consistent Scala formatting. Please run scalafmt before commiting your code to github (i.e. do <code>scalafmt</code> inside of sbt)</p> 
  <h3><a id="user-content-testing" class="anchor" href="https://github.com/mdedetrich/stripe-scala#testing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Testing</h3> 
  <p>The project has unit and integration tests. These can be run with:</p> 
  <pre><code>sbt test
sbt it:test
</code></pre> 
 </article>
</div>