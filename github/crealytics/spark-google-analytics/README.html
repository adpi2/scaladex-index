<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/crealytics/spark-google-analytics#spark-google-analytics-library" aria-hidden="true" class="anchor" id="user-content-spark-google-analytics-library" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Spark Google Analytics Library</h1> 
  <p>A library for querying Google Analytics data with Apache Spark, for Spark SQL and DataFrames.</p> 
  <p><a href="https://travis-ci.org/crealytics/spark-google-analytics" target="_blank"><img src="https://camo.githubusercontent.com/7a6b33b9660d6bbdb5606ed579588be156201df5/68747470733a2f2f7472617669732d63692e6f72672f637265616c79746963732f737061726b2d676f6f676c652d616e616c79746963732e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/crealytics/spark-google-analytics.svg?branch=master" style="max-width:100%;"></a></p> 
  <h2><a href="https://github.com/crealytics/spark-google-analytics#requirements" aria-hidden="true" class="anchor" id="user-content-requirements" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Requirements</h2> 
  <p>This library requires Spark 1.4+</p> 
  <h2><a href="https://github.com/crealytics/spark-google-analytics#linking" aria-hidden="true" class="anchor" id="user-content-linking" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Linking</h2> 
  <p>You can link against this library in your program at the following coordinates:</p> 
  <h3><a href="https://github.com/crealytics/spark-google-analytics#scala-210" aria-hidden="true" class="anchor" id="user-content-scala-210" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala 2.10</h3> 
  <pre><code>groupId: com.crealytics
artifactId: spark-google-analytics_2.10
version: 1.1.2
</code></pre> 
  <h3><a href="https://github.com/crealytics/spark-google-analytics#scala-211" aria-hidden="true" class="anchor" id="user-content-scala-211" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala 2.11</h3> 
  <pre><code>groupId: com.crealytics
artifactId: spark-google-analytics_2.11
version: 1.1.2
</code></pre> 
  <h2><a href="https://github.com/crealytics/spark-google-analytics#using-with-spark-shell" aria-hidden="true" class="anchor" id="user-content-using-with-spark-shell" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using with Spark shell</h2> 
  <p>This package can be added to Spark using the <code>--packages</code> command line option. For example, to include it when starting the spark shell:</p> 
  <h3><a href="https://github.com/crealytics/spark-google-analytics#spark-compiled-with-scala-211" aria-hidden="true" class="anchor" id="user-content-spark-compiled-with-scala-211" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Spark compiled with Scala 2.11</h3> 
  <pre><code>$SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-google-analytics_2.11:1.1.2
</code></pre> 
  <h3><a href="https://github.com/crealytics/spark-google-analytics#spark-compiled-with-scala-210" aria-hidden="true" class="anchor" id="user-content-spark-compiled-with-scala-210" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Spark compiled with Scala 2.10</h3> 
  <pre><code>$SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-google-analytics_2.10:1.1.2
</code></pre> 
  <h2><a href="https://github.com/crealytics/spark-google-analytics#features" aria-hidden="true" class="anchor" id="user-content-features" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h2> 
  <p>This package allows querying Google Analytics reports as <a href="https://spark.apache.org/docs/latest/sql-programming-guide.html" target="_blank">Spark DataFrames</a>. The API accepts several options (see the <a href="https://developers.google.com/analytics/devguides/reporting/core/v3/reference#q_details" target="_blank">Google Analytics developer docs</a> for details):</p> 
  <ul> 
   <li><code>serviceAccountId</code>: an account id for accessing the Google Analytics API (<code>xxx-xxxxxxx@developer.gserviceaccount.com</code>)</li> 
   <li><code>keyFileLocation</code>: a key-file that you have to generate from the developer console</li> 
   <li><code>clientId</code>: an account id that you have to generate from the developer console using OAuth 2.0 credentials option</li> 
   <li><code>clientSecret</code>: a client secret id that you have to obtain from the developer console for OAuth 2.0 credentials client id which you have already generated</li> 
   <li><code>refreshToken</code>: a refresh token is need to be obtained by User's Login for which you wanted to collect GA data. Once user login from appropriate call you will get this token in response. See <a href="https://developers.google.com/identity/protocols/OAuth2WebServer#offline" target="_blank">OAuth2WebServer Offline</a> for more information</li> 
   <li><code>ids</code>: the ID of the site for which you want to pull the data</li> 
   <li><code>startDate</code>: the start date for the report</li> 
   <li><code>endDate</code>: the end date for the report</li> 
   <li><code>queryIndividualDays</code>: fetches each day from the chosen date range individually in order to minimize sampling (only works if <code>date</code> is chosen as dimension)</li> 
   <li><code>calculatedMetrics</code>: the suffixes of any calculated metrics (defined in your GA view) you want to query</li> 
  </ul> 
  <h3><a href="https://github.com/crealytics/spark-google-analytics#scala-api" aria-hidden="true" class="anchor" id="user-content-scala-api" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scala API</h3> 
  <p><strong>Spark 1.4+:</strong></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.apache.spark.sql.</span><span class="pl-v">SQLContext</span></pre>
  </div> 
  <p><strong>Option 1 : Authentication with Service Account ID and P12 Key File</strong></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">sqlContext</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SQLContext</span>(sc)
<span class="pl-k">val</span> <span class="pl-en">df</span> <span class="pl-k">=</span> sqlContext.read
    .format(<span class="pl-s"><span class="pl-pds">"</span>com.crealytics.google.analytics<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>serviceAccountId<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>xxx-xxxxxxx@developer.gserviceaccount.com<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>keyFileLocation<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>the_key_file.p12<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>ga:12345678<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>startDate<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>7daysAgo<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>endDate<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>yesterday<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>queryIndividualDays<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>calculatedMetrics<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>averageEngagement<span class="pl-pds">"</span></span>)
    .load()


<span class="pl-c"><span class="pl-c">//</span> You need select the date column if using queryIndividualDays</span>
df.select(<span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>browser<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>calcMetric_averageEngagement<span class="pl-pds">"</span></span>).show()</pre>
  </div> 
  <p><strong>OR</strong></p> 
  <p><strong>Option 2 : Authentication with Client ID, Client Secret and Refresh Token</strong></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">sqlContext</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SQLContext</span>(sc)
<span class="pl-k">val</span> <span class="pl-en">df</span> <span class="pl-k">=</span> sqlContext.read
    .format(<span class="pl-s"><span class="pl-pds">"</span>com.crealytics.google.analytics<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>clientId<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>XXXXXXXX-xyxyxxxxyxyxxxxxyyyx.apps.googleusercontent.com<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>clientSecret<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>73xxYxyxy-XXXYZZx-xZ_Z<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>refreshToken<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>1/ezzzxZYzxxyyXYXzyyXXYYyxxxxyyyyxxxy<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>ids<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>ga:12345678<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>startDate<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>7daysAgo<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>endDate<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>yesterday<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>queryIndividualDays<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>)
    .option(<span class="pl-s"><span class="pl-pds">"</span>calculatedMetrics<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>averageEngagement<span class="pl-pds">"</span></span>)
    .load()


<span class="pl-c"><span class="pl-c">//</span> You need select the date column if using queryIndividualDays</span>
df.select(<span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>browser<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>calcMetric_averageEngagement<span class="pl-pds">"</span></span>).show()</pre>
  </div> 
  <h2><a href="https://github.com/crealytics/spark-google-analytics#building-from-source" aria-hidden="true" class="anchor" id="user-content-building-from-source" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Building From Source</h2> 
  <p>This library is built with <a href="http://www.scala-sbt.org/0.13/docs/Command-Line-Reference.html" target="_blank">SBT</a>, which is automatically downloaded by the included shell script. To build a JAR file simply run <code>sbt/sbt package</code> from the project root. The build configuration includes support for both Scala 2.10 and 2.11.</p> 
 </article>
</div>