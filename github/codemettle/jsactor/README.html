<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-jsactor-" class="anchor" href="https://github.com/codemettle/jsactor#jsactor-" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>jsactor <a href="https://gitter.im/CodeMettle/jsactor?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/CodeMettle/jsactor" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a></h1> 
  <p>Actors on Scala.js</p> 
  <p>Check out a rough example project at <a href="https://github.com/CodeMettle/jsactor-spa-example" target="_blank">https://github.com/CodeMettle/jsactor-spa-example</a></p> 
  <h3><a id="user-content-disclaimer" class="anchor" href="https://github.com/codemettle/jsactor#disclaimer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Disclaimer</h3> 
  <p>Much of this code (the good parts) are straight from <a href="https://github.com/akka/akka" target="_blank">Typesafe/Akka</a> and I don't claim authorship. Most of the code that isn't straight from Akka was at least written while looking at Akka code and uses their concepts and techniques. Anything broken is my fault, everything else is thanks to their work. My hope is that they create and maintain an official Scala.js version of Akka; until then <code>jsactor</code> seems to mostly work.</p> 
  <p>While this projects works, somewhat, it's not close to production-quality.</p> 
  <h1><a id="user-content-why" class="anchor" href="https://github.com/codemettle/jsactor#why" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Why?</h1> 
  <p>I'm used to working with the Actor model on the backend, with Scala.js it feels natural to use Actors and have hierarchy, a well-defined lifecycle, an <code>EventStream</code>, and so on.</p> 
  <h1><a id="user-content-import" class="anchor" href="https://github.com/codemettle/jsactor#import" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Import</h1> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> <span class="pl-en">Seq</span>(
  <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor-bridge-client<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span> if using jsactor-bridge</span>
  <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor-loglevel<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span> to use the LogLevel logging adapter</span>
)</pre>
  </div> 
  <h1><a id="user-content-usage" class="anchor" href="https://github.com/codemettle/jsactor#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h1> 
  <h3><a id="user-content-create-actorsystem" class="anchor" href="https://github.com/codemettle/jsactor#create-actorsystem" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create ActorSystem</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">jsactor.</span><span class="pl-v">JsActorSystem</span>
<span class="pl-k">import</span> <span class="pl-v">jsactor.logging.impl.</span><span class="pl-v">JsLoglevelActorLoggerFactory</span>

<span class="pl-c"><span class="pl-c">//</span> logging defaults to scala.js println statements, this is using LogLevel; JsNullActorLoggerFactory also exists</span>
<span class="pl-k">val</span> <span class="pl-en">system</span> <span class="pl-k">=</span> <span class="pl-en">JsActorSystem</span>(<span class="pl-s"><span class="pl-pds">"</span>mySystemName<span class="pl-pds">"</span></span>, <span class="pl-en">JsLoglevelActorLoggerFactory</span>)</pre>
  </div> 
  <h3><a id="user-content-create-an-actor" class="anchor" href="https://github.com/codemettle/jsactor#create-an-actor" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create an Actor</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">system</span><span class="pl-k">:</span> <span class="pl-en">JsActorSystem</span> <span class="pl-k">=</span> <span class="pl-k">???</span>

<span class="pl-k">class</span> <span class="pl-en">MyActor</span> <span class="pl-k">extends</span> <span class="pl-e">JsActor</span> <span class="pl-k">with</span> <span class="pl-e">JsActorLogging</span> {
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">preStart</span>() <span class="pl-k">=</span> {
    <span class="pl-c1">super</span>.preStart()

    log.info(s<span class="pl-s"><span class="pl-pds">"</span>$self is starting at ${self.path}<span class="pl-pds">"</span></span>)
  }

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> <span class="pl-en">JsActor</span>.emptyBehavior
}

<span class="pl-k">val</span> <span class="pl-en">myactor</span> <span class="pl-k">=</span> system.actorOf(<span class="pl-en">JsProps</span>(<span class="pl-k">new</span> <span class="pl-en">MyActor),</span> <span class="pl-s"><span class="pl-pds">"</span>myactor<span class="pl-pds">"</span></span>)

myactor <span class="pl-k">!</span> <span class="pl-en">MyMessage</span>()</pre>
  </div> 
  <h3><a id="user-content-more-usage" class="anchor" href="https://github.com/codemettle/jsactor#more-usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More usage</h3> 
  <p>A lot of stuff you expect from Akka exists with pretty much the same signatures; this includes <code>context.system.eventStream</code>, <code>context.actorOf()</code>, <code>sender()</code>, <code>?</code> (import <code>jsactor.pattern.ask</code>), <code>context watch actor</code> (with <code>JsTerminated</code> messages), <code>JsActor with JsStash</code>, <code>context.setReceiveTimeout</code> (with <code>JsReceiveTimeout</code> messages), etc.</p> 
  <h3><a id="user-content-whats-missing" class="anchor" href="https://github.com/codemettle/jsactor#whats-missing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What's missing?</h3> 
  <p>Probably the feature you need.</p> 
  <p>In all seriousness, most of the basic functionality of vanilla akka-actor is there.</p> 
  <h4><a id="user-content-supervision" class="anchor" href="https://github.com/codemettle/jsactor#supervision" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Supervision</h4> 
  <p>Supervision probably wouldn't be hard to write, but I haven't had a need for it. Most of the code that isn't straight from Akka is comprised of ugly hacks and casts and "just barely works on my box"isms, and that probably makes supervision harder to implement than it should be.</p> 
  <h4><a id="user-content-fsm" class="anchor" href="https://github.com/codemettle/jsactor#fsm" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>FSM</h4> 
  <p>I copied the FSM trait straight from Akka, but it has strange runtime errors. This is probably the biggest hole that I personally care about; hopefully I'll have time to look at it again someday.</p> 
  <h1><a id="user-content-server-client-interop" class="anchor" href="https://github.com/codemettle/jsactor#server-client-interop" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Server-client Interop</h1> 
  <p>This is the part we care about, right? Why use Actors on the client if we're not interacting with a backend ActorSystem?</p> 
  <p>To that end, I'm including some extra projects that make interaction pretty seamless, at least in our usage. We have many µservices running on the backend, one of which consolidates large amounts of data from many different sources and transforms to model objects and pushes changes to the GUI. No pull, no REST, no client-side polling for changes - the backend reacts to changes it cares about, based on the current client view (what it cares about), and when the model objects change then the server pushes them.</p> 
  <h3><a id="user-content-shared-model" class="anchor" href="https://github.com/codemettle/jsactor#shared-model" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Shared model</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> project with model classes shared between client &amp; server, cross-compiled to JVM &amp; JS</span>
 ...
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor-bridge-shared<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span>
 ...</pre>
  </div> 
  <p><del>Currently this project (so, by extension, client and server bridge projects) depends on <a href="https://github.com/lihaoyi/upickle" target="_blank">uPickle</a>, with no way to change that.</del></p> 
  <p>This whole readme is out of date, but nobody uses this library anyway, so NBD. But there now are <code>*-upickle</code> projects that are based on uPickle. I aim to add <a href="https://github.com/ochrons/boopickle" target="_blank">BooPickle</a> and/or <a href="https://github.com/travisbrown/circe" target="_blank">Circe</a> implementations of client-server bridges.</p> 
  <p><code>uPickle</code> was written, I assume, with <a href="https://github.com/lihaoyi/autowire" target="_blank">autowire</a> in mind - all types are known in advance. That presents an issue for <code>jsactor</code> since the Akka model is typeless and depends on pattern matching. I worked around this with inspiration from (or, really, by copying) <a href="https://github.com/scala-js/scala-js-pickling" target="_blank">scala-js-pickling</a>'s <code>PicklerRegistry</code>. The top-level bridge actor on client and server need an implicit <code>BridgeProtocol</code> in scope. The protocol has to register every top-level message that is going to be sent across the bridge.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">MyProjectProtocol</span> <span class="pl-k">extends</span> <span class="pl-e">BridgeProtocol</span> {
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">registerMessages</span>(<span class="pl-v">registry</span>: <span class="pl-en">MessageRegistry</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    <span class="pl-k">def</span> <span class="pl-en">add</span>[<span class="pl-en">A</span> <span class="pl-k">:</span> <span class="pl-en">Reader</span> <span class="pl-k">:</span> <span class="pl-en">Writer</span> <span class="pl-k">:</span> <span class="pl-en">ClassTag</span>] <span class="pl-k">=</span> registry.add[<span class="pl-en">A</span>]
    <span class="pl-k">def</span> <span class="pl-en">addObj</span>[<span class="pl-en">A</span> <span class="pl-k">&lt;</span><span class="pl-k">:</span> <span class="pl-en">Singleton</span> <span class="pl-k">:</span> <span class="pl-en">Reader</span> <span class="pl-k">:</span> <span class="pl-en">Writer</span> <span class="pl-k">:</span> <span class="pl-en">ClassTag</span>](<span class="pl-v">obj</span>: <span class="pl-en">A</span>) <span class="pl-k">=</span> registry.addObj(obj)

    addObj(<span class="pl-en">SessionApi</span>.<span class="pl-en">SubscribeToUserAndAlarmPrefs</span>)
    add[<span class="pl-en">SessionApi</span>.<span class="pl-en">UserUpdate</span>]
    add[<span class="pl-en">SessionApi</span>.<span class="pl-en">PreferenceUpdate</span>]
    add[<span class="pl-en">SessionApi</span>.<span class="pl-en">UpdatePreferences</span>]
    add[<span class="pl-en">SessionApi</span>.<span class="pl-en">PreferenceUpdateResult</span>]
  }
}</pre>
  </div> 
  <h3><a id="user-content-server-side" class="anchor" href="https://github.com/codemettle/jsactor#server-side" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Server-side</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> server project; also needs to depend on the shared model project</span>
 ...
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor-bridge-server<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span>
 ...</pre>
  </div> 
  <p>The server-side of the bridge takes a reference to an Actor which sends/receives Strings to/from the client, presumably over a WebSocket.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">ServerBridgeActor</span>(<span class="pl-v">clientWebSocket</span>: <span class="pl-en">ActorRef</span>)(<span class="pl-k">implicit</span> <span class="pl-v">bridgeProtocol</span>: <span class="pl-en">BridgeProtocol</span>) <span class="pl-k">extends</span> <span class="pl-e">Actor</span></pre>
  </div> 
  <p>Play 2.3 happens to give us an Actor representing a WebSocket, so this is pretty trivial in Play:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">MyController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {
  ...

  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">getSession</span>(<span class="pl-k">implicit</span> <span class="pl-v">request</span>: <span class="pl-en">RequestHeader</span>)<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Option</span>[<span class="pl-en">ClientSession</span>]] <span class="pl-k">=</span> <span class="pl-k">???</span>

  <span class="pl-k">def</span> <span class="pl-en">ws</span> <span class="pl-k">=</span> <span class="pl-en">WebSocket</span>.tryAcceptWithActor[<span class="pl-k">String</span>, <span class="pl-k">String</span>] { request <span class="pl-k">⇒</span>
    getSession(request) map {
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">⇒</span> <span class="pl-en">Left</span>(<span class="pl-en">Forbidden</span>)

      <span class="pl-k">case</span> <span class="pl-en">Some</span>(session) <span class="pl-k">⇒</span>
        <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">bridgeProtocol</span> <span class="pl-k">=</span> <span class="pl-en">MyProjectProtocol</span>
        <span class="pl-en">Right</span>((wsActor) <span class="pl-k">⇒</span> <span class="pl-en">ServerBridgeActor</span>.props(wsActor))
    }
  }

  ...
}</pre>
  </div> 
  <h3><a id="user-content-client-side" class="anchor" href="https://github.com/codemettle/jsactor#client-side" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Client-side</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> client project; also needs to depend on the shared model project</span>
 ...
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.codemettle.jsactor<span class="pl-pds">"</span></span> <span class="pl-k">%%%</span> <span class="pl-s"><span class="pl-pds">"</span>jsactor-bridge-client<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.6.9<span class="pl-pds">"</span></span>
 ...</pre>
  </div> 
  <p><code>jsactor-bridge-client</code> provides building blocks for creating the client-side of a bridge, any/all of the provided classes can be replaced with your own, but it's easiest to use <code>jsactor.bridge.client.{ClientBridgeActor, SocketManager, WebSocketActor}</code>.</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">val</span> <span class="pl-en">actorSystem</span><span class="pl-k">:</span> <span class="pl-en">JsActorSystem</span> <span class="pl-k">=</span> <span class="pl-k">???</span>

  <span class="pl-k">private</span> <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">bridgeProtocal</span> <span class="pl-k">=</span> <span class="pl-en">MyProjectProtocol</span>
  <span class="pl-k">val</span> <span class="pl-en">wsManager</span> <span class="pl-k">=</span> actorSystem.actorOf(<span class="pl-en">SocketManager</span>.props(<span class="pl-en">SocketManager</span>.<span class="pl-en">Config</span>(<span class="pl-s"><span class="pl-pds">"</span>ws://localhost:9000/ws<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>socketManager<span class="pl-pds">"</span></span>)

  <span class="pl-k">class</span> <span class="pl-en">MyActor</span> <span class="pl-k">extends</span> <span class="pl-e">JsActor</span> {
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">preStart</span>() <span class="pl-k">=</span> {
      <span class="pl-c1">super</span>.preStart()

      wsManager <span class="pl-k">!</span> <span class="pl-en">SocketManager</span>.<span class="pl-en">Events</span>.<span class="pl-en">SubscribeToEvents</span>
    }

    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">receive</span> <span class="pl-k">=</span> {
      <span class="pl-k">case</span> <span class="pl-en">SocketManager</span>.<span class="pl-en">Events</span>.<span class="pl-en">WebSocketConnected</span>(socket) <span class="pl-k">⇒</span>
        socket <span class="pl-k">!</span> <span class="pl-en">WebSocketActor</span>.<span class="pl-en">Messages</span>.<span class="pl-en">SendMessageToServer</span>(<span class="pl-s"><span class="pl-pds">"</span>/user/MyServerActor<span class="pl-pds">"</span></span>, <span class="pl-en">MessageThatIHaveRegistered</span>())
        socket <span class="pl-k">!</span> <span class="pl-en">WebSocketActor</span>.<span class="pl-en">Messages</span>.<span class="pl-en">SendMessageToServer</span>(<span class="pl-s"><span class="pl-pds">"</span>akka.tcp://ActorSystem@address:port/user/MyServerActor<span class="pl-pds">"</span></span>, <span class="pl-en">MessageThatIHaveRegistered</span>())

        <span class="pl-c"><span class="pl-c">//</span> could receive a jsactor.bridge.protocol.ServerActorNotFound message,</span>
        <span class="pl-c"><span class="pl-c">//</span> otherwise the server-side actor will have a proxy representing this client-side actor, any messages the</span>
        <span class="pl-c"><span class="pl-c">//</span> server sends to that actor will come to this actor; the server can DeathWatch that proxy to be notified</span>
        <span class="pl-c"><span class="pl-c">//</span> that this actor has shutdown (or the WebSocket was interrupted)</span>

        socket <span class="pl-k">!</span> <span class="pl-en">WebSocketActor</span>.<span class="pl-en">Messages</span>.<span class="pl-en">IdentifyServerActor</span>(<span class="pl-s"><span class="pl-pds">"</span>/user/MyServerActor<span class="pl-pds">"</span></span>)

        <span class="pl-c"><span class="pl-c">//</span> this actor will receive a jsactor.bridge.protocol.ServerActorNotFound message, or will receive a</span>
        <span class="pl-c"><span class="pl-c">//</span> jsactor.bridge.protocol.ServerActorFound message (sent from the client-side proxy of that server-side actor).</span>
        <span class="pl-c"><span class="pl-c">//</span> Any message sent to this client-side proxy will be sent to the corresponding server-side actor, and the</span>
        <span class="pl-c"><span class="pl-c">//</span> client-side proxy can be DeathWatched to notify that the server actor has shutdown (or WebSocket was interrupted).</span>
    }
  }</pre>
  </div> 
  <p>I've also included a rough utility trait, <code>jsactor.bridge.client.util.RemoteActorListener</code>, that can be used to automatically start trying to <code>Identify</code> a server-side actor when the websocket connects (or reconnects):</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">jsactor.bridge.client.util.</span><span class="pl-v">RemoteActorListener</span>

<span class="pl-k">class</span> <span class="pl-en">MyClientActor</span>(<span class="pl-k">val</span> <span class="pl-en">wsManager</span><span class="pl-k">:</span> <span class="pl-en">JsActorRef</span>) <span class="pl-k">extends</span> <span class="pl-e">RemoteActorListener</span> {
  <span class="pl-k">def</span> <span class="pl-en">actorPath</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/user/MyServerActor<span class="pl-pds">"</span></span>

  <span class="pl-k">def</span> <span class="pl-en">onConnect</span>(<span class="pl-v">serverActor</span>: <span class="pl-en">JsActorRef</span>) <span class="pl-k">=</span> {
    serverActor <span class="pl-k">!</span> <span class="pl-en">MyRegisteredMessage</span>
  }

  <span class="pl-k">def</span> <span class="pl-en">whenConnected</span>(<span class="pl-v">serverActor</span>: <span class="pl-en">JsActorRef</span>) <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-en">RegisteredMessageFromServer</span>(param) <span class="pl-k">=&gt;</span> log.info(s<span class="pl-s"><span class="pl-pds">"</span>got $param from server<span class="pl-pds">"</span></span>)
    <span class="pl-k">case</span> msg<span class="pl-k">@</span><span class="pl-en">RegisteredMessageFromClient</span> <span class="pl-k">=&gt;</span> serverActor forward msg
  }
}</pre>
  </div> 
 </article>
</div>