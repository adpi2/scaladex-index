<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content------" class="anchor" href="https://github.com/rouzwawi/flo#-----" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a href="https://camo.githubusercontent.com/8bc9bb78f1b0f05749a7d629939a4b301173d655/687474703a2f2f726f757a2e696f2f666c6f2f646f632f666c6f2d6c6f676f2e737667" target="_blank"><img src="https://camo.githubusercontent.com/8bc9bb78f1b0f05749a7d629939a4b301173d655/687474703a2f2f726f757a2e696f2f666c6f2f646f632f666c6f2d6c6f676f2e737667" alt="flo" data-canonical-src="http://rouz.io/flo/doc/flo-logo.svg" style="max-width:100%;"></a> &nbsp;&nbsp; <a href="https://circleci.com/gh/rouzwawi/flo" target="_blank"><img src="https://camo.githubusercontent.com/8e43cb773369648e52e146d4e4669235b96706ed/68747470733a2f2f696d672e736869656c64732e696f2f636972636c6563692f70726f6a6563742f726f757a776177692f666c6f2f6d61737465722e737667" alt="CircleCI" data-canonical-src="https://img.shields.io/circleci/project/rouzwawi/flo/master.svg" style="max-width:100%;"></a> <a href="https://codecov.io/github/rouzwawi/flo" target="_blank"><img src="https://camo.githubusercontent.com/55f6851916911662e52c4ca0e728ad4fe067d124/68747470733a2f2f696d672e736869656c64732e696f2f636f6465636f762f632f6769746875622f726f757a776177692f666c6f2f6d61737465722e7376673f6d61784167653d32353932303030" alt="Codecov" data-canonical-src="https://img.shields.io/codecov/c/github/rouzwawi/flo/master.svg?maxAge=2592000" style="max-width:100%;"></a> <a href="https://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.rouz%22%20flo*" target="_blank"><img src="https://camo.githubusercontent.com/3228e98a3da43240ed0ed27bb8941490b76f73b5/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f696f2e726f757a2f666c6f2e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/io.rouz/flo.svg" style="max-width:100%;"></a> <a href="https://github.com/rouzwawi/flo/blob/master/LICENSE.txt" target="_blank"><img src="https://camo.githubusercontent.com/7198db4aadb068c4cd9280542aa09c97b69e62cb/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f726f757a776177692f666c6f2e737667" alt="License" data-canonical-src="https://img.shields.io/github/license/rouzwawi/flo.svg" style="max-width:100%;"></a></h1> 
  <p><a href="https://camo.githubusercontent.com/9769fe342eec372a243aff781be5a1f462133e56/687474703a2f2f726f757a2e696f2f666c6f2f646f632f666c6f2d6c6f676f2d736d616c6c2e737667" target="_blank"><img src="https://camo.githubusercontent.com/9769fe342eec372a243aff781be5a1f462133e56/687474703a2f2f726f757a2e696f2f666c6f2f646f632f666c6f2d6c6f676f2d736d616c6c2e737667" alt="flo" data-canonical-src="http://rouz.io/flo/doc/flo-logo-small.svg" style="max-width:100%;"></a> is a lightweight workflow definition library</p> 
  <ul> 
   <li>It's not a workflow management system</li> 
   <li>It's not a workflow scheduler</li> 
  </ul> 
  <p><strong>Some key features</strong></p> 
  <ul> 
   <li>Programmatic Java and Scala API for expressing workflow construction (<em>task <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_blank">DAG</a> expansion</em>)</li> 
   <li>Use of arbitrary program logic for DAG expansion</li> 
   <li>Recursive definitions</li> 
   <li>Lazy DAG expansion</li> 
   <li>DAG serialization (for 3rd party persistence)</li> 
   <li>Extensible DAG evaluation</li> 
   <li>A command line parser generator for instantiation of workflow definitions: <code>flo-cli</code></li> 
  </ul> 
  <h2><a id="user-content-dependency" class="anchor" href="https://github.com/rouzwawi/flo#dependency" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependency</h2> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;io.rouz&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;flo-workflow&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;${flo.version}&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>JavaDocs here: <a href="http://rouz.io/flo/maven/latest/apidocs/" target="_blank">http://rouz.io/flo/maven/latest/apidocs/</a></p> 
  <h2><a id="user-content-table-of-contents" class="anchor" href="https://github.com/rouzwawi/flo#table-of-contents" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Table of contents</h2> 
  <ul> 
   <li><a href="https://github.com/rouzwawi/flo#quick-example-fibonacci" target="_blank">Quick Example: Fibonacci</a></li> 
   <li><a href="https://github.com/rouzwawi/flo#taskt" target="_blank"><code>Task&lt;T&gt;</code></a> 
    <ul> 
     <li><a href="https://github.com/rouzwawi/flo#tasks-are-defined-by-regular-methods" target="_blank">Tasks are defined by regular methods</a> 
      <ul> 
       <li><a href="https://github.com/rouzwawi/flo#task-embedding" target="_blank">Task embedding</a></li> 
      </ul></li> 
     <li><a href="https://github.com/rouzwawi/flo#tasks-are-lazy" target="_blank">Tasks are lazy</a></li> 
     <li><a href="https://github.com/rouzwawi/flo#task-dags-as-data-structures" target="_blank">Task DAGs as data structures</a></li> 
    </ul></li> 
   <li><a href="https://github.com/rouzwawi/flo#taskcontext" target="_blank"><code>TaskContext</code></a></li> 
   <li><a href="https://github.com/rouzwawi/flo#cli-generator" target="_blank">CLI generator</a></li> 
  </ul> 
  <h2><a id="user-content-quick-example-fibonacci" class="anchor" href="https://github.com/rouzwawi/flo#quick-example-fibonacci" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Quick Example: Fibonacci</h2> 
  <p>Fibonacci serves as a good example even though it's not at all the kind of thing that <code>flo</code> is meant to be used for. Nevertheless, it demonstrates how a task DAG can be recursively defined with arbitrary logic governing which inputs are chosen.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">class</span> <span class="pl-en">Fib</span> {

  <span class="pl-k">static</span> <span class="pl-k">Task&lt;<span class="pl-smi">Long</span>&gt;</span> <span class="pl-en">fib</span>(<span class="pl-k">long</span> <span class="pl-v">n</span>) {
    <span class="pl-k">TaskBuilder&lt;<span class="pl-smi">Long</span>&gt;</span> builder <span class="pl-k">=</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>fib<span class="pl-pds">"</span></span>, n)<span class="pl-k">.</span>ofType(<span class="pl-smi">Long</span><span class="pl-k">.</span>class);
    <span class="pl-k">if</span> (n <span class="pl-k">&lt;</span> <span class="pl-c1">2</span>) {
      <span class="pl-k">return</span> builder
          .process(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> n);
    } <span class="pl-k">else</span> {
      <span class="pl-k">return</span> builder
          .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> fib(n <span class="pl-k">-</span> <span class="pl-c1">1</span>))
          .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> fib(n <span class="pl-k">-</span> <span class="pl-c1">2</span>))
          .process((a, b) <span class="pl-k">-</span><span class="pl-k">&gt;</span> a <span class="pl-k">+</span> b);
    }
  }

  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
    <span class="pl-k">Task&lt;<span class="pl-smi">Long</span>&gt;</span> fib92 <span class="pl-k">=</span> fib(<span class="pl-c1">92</span>);
    <span class="pl-smi">TaskContext</span> taskContext <span class="pl-k">=</span> <span class="pl-smi">TaskContext</span><span class="pl-k">.</span>inmem();
    <span class="pl-smi">TaskContext</span><span class="pl-k">.</span><span class="pl-k">Value&lt;<span class="pl-smi">Long</span>&gt;</span> value <span class="pl-k">=</span> taskContext<span class="pl-k">.</span>evaluate(fib92);

    value<span class="pl-k">.</span>consume(f92 <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>fib(92) = <span class="pl-pds">"</span></span> <span class="pl-k">+</span> f92));
  }
}</pre>
  </div> 
  <p>Scala equivalent</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">io.rouz.flo.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">Fib</span> <span class="pl-k">extends</span> <span class="pl-e">App</span> {

  <span class="pl-k">def</span> <span class="pl-en">fib</span>(<span class="pl-v">n</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-en">Task</span>[<span class="pl-k">Long</span>] <span class="pl-k">=</span> <span class="pl-k">if</span> (n <span class="pl-k">&lt;</span> <span class="pl-c1">2</span>) {
    task[<span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>fib<span class="pl-pds">"</span></span>, n)
        .process(n)
  } <span class="pl-k">else</span> {
    task[<span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>fib<span class="pl-pds">"</span></span>, n)
        .in(fib(n <span class="pl-k">-</span> <span class="pl-c1">1</span>))
        .in(fib(n <span class="pl-k">-</span> <span class="pl-c1">2</span>))
        .process(_ <span class="pl-k">+</span> _)
  }

  <span class="pl-k">val</span> <span class="pl-en">fib92</span> <span class="pl-k">=</span> fib(<span class="pl-c1">92</span>)
  <span class="pl-k">val</span> <span class="pl-en">taskContext</span> <span class="pl-k">=</span> <span class="pl-en">TaskContext</span>.inmem
  <span class="pl-k">val</span> <span class="pl-en">value</span> <span class="pl-k">=</span> taskContext.evaluate(fib92)

  value.consume((f92<span class="pl-k">:</span><span class="pl-k">Long</span>) <span class="pl-k">=&gt;</span> println(<span class="pl-s"><span class="pl-pds">"</span>fib(92) = <span class="pl-pds">"</span></span> <span class="pl-k">+</span> f92))
}</pre>
  </div> 
  <h1><a id="user-content-taskt" class="anchor" href="https://github.com/rouzwawi/flo#taskt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/Task.html" target="_blank"><code>Task&lt;T&gt;</code></a></h1> 
  <p><a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/Task.html" target="_blank"><code>Task&lt;T&gt;</code></a> is one of the more central types in <code>flo</code>. It represents some task which will evaluate a value of type <code>T</code>. It has a parameterized name, zero or more input tasks and a processing function which will be executed when inputs are evaluated. Tasks come with a few key properties governing how they are defined, behave and are interacted with. We'll cover these in the following sections.</p> 
  <h2><a id="user-content-tasks-are-defined-by-regular-methods" class="anchor" href="https://github.com/rouzwawi/flo#tasks-are-defined-by-regular-methods" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tasks are defined by regular methods</h2> 
  <p>Your workflow tasks are not defined as classes that extend <a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/Task.html" target="_blank"><code>Task&lt;T&gt;</code></a>, rather they are defined by using the <a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/dsl/TaskBuilder.html" target="_blank"><code>TaskBuilder</code></a> API as we've already seen in the fibonacci example. This is in many ways very similar to a very clean class with no mutable state, only final members and two overriden methods for inputs and evaluation function. But with a very important difference, we're handling the input tasks in a type-safe manner. Each input task you add will further construct the type for your evaluation function. This is how we can get a clean lambda such as <code>(a, b) -&gt; a + b</code> as the evaluation function for our fibonacci example.</p> 
  <p>Here's a simple example of a <code>flo</code> task depending on two other tasks:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">Task&lt;<span class="pl-smi">Integer</span>&gt;</span> myTask(<span class="pl-smi">String</span> arg) {
  <span class="pl-k">return</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>MyTask<span class="pl-pds">"</span></span>, arg)<span class="pl-k">.</span>ofType(<span class="pl-smi">Integer</span><span class="pl-k">.</span>class)
      .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> otherTask(arg))
      .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> yetATask(arg))
      .process((otherResult, yetAResult) <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c">/* ... */</span>);
}</pre>
  </div> 
  <p>This is how the same thing would typically look like in other libraries:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">class</span> <span class="pl-en">MyTask</span> <span class="pl-k">extends</span> <span class="pl-e">Task&lt;<span class="pl-smi">Integer</span>&gt;</span> {

  <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-smi">String</span> arg;

  <span class="pl-en">MyTask</span>(<span class="pl-smi">String</span> <span class="pl-v">arg</span>) {
    <span class="pl-v">super</span>(<span class="pl-s"><span class="pl-pds">"</span>MyTask<span class="pl-pds">"</span></span>, arg);
    <span class="pl-v">this</span><span class="pl-k">.</span>arg <span class="pl-k">=</span> arg;
  }

  <span class="pl-k">@Override</span>
  <span class="pl-k">public</span> <span class="pl-k">List&lt;? extends <span class="pl-k">Task&lt;?&gt;</span>&gt;</span> <span class="pl-en">inputs</span>() {
    <span class="pl-k">return</span> <span class="pl-smi">Arrays</span><span class="pl-k">.</span>asList(<span class="pl-k">new</span> <span class="pl-smi">OtherTask</span>(arg), <span class="pl-k">new</span> <span class="pl-smi">YetATask</span>(arg));
  }

  <span class="pl-k">@Override</span>
  <span class="pl-k">public</span> <span class="pl-smi">Integer</span> <span class="pl-en">process</span>(<span class="pl-k">List&lt;<span class="pl-smi">Object</span>&gt;</span> <span class="pl-v">inputs</span>) {
    <span class="pl-c">// loose all type safety and guess your inputs</span>
    <span class="pl-c">// ...</span>
  }
}</pre>
  </div> 
  <h3><a id="user-content-task-embedding" class="anchor" href="https://github.com/rouzwawi/flo#task-embedding" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Task embedding</h3> 
  <p>There's of course nothing stopping you from having the task defined in a regular class. It might even be useful if your evaluation function is part of an existing class. <code>flo</code> does not force anything on to your types, it just needs to know what to run.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">class</span> <span class="pl-en">SomeExistingClass</span> {

  <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-smi">String</span> arg;

  <span class="pl-en">SomeExistingClass</span>(<span class="pl-smi">String</span> <span class="pl-v">arg</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>arg <span class="pl-k">=</span> arg;
  }

  <span class="pl-k">Task&lt;<span class="pl-smi">Integer</span>&gt;</span> <span class="pl-en">task</span>() {
    <span class="pl-k">return</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>EmbeddedTask<span class="pl-pds">"</span></span>, arg)<span class="pl-k">.</span>ofType(<span class="pl-smi">Integer</span><span class="pl-k">.</span>class)
        .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> otherTask(arg))
        .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> yetATask(arg))
        .process(<span class="pl-v">this</span><span class="pl-k">::</span>process);
  }

  <span class="pl-k">int</span> <span class="pl-en">process</span>(<span class="pl-smi">String</span> <span class="pl-v">otherResult</span>, <span class="pl-k">int</span> <span class="pl-v">yetAResult</span>) {
    <span class="pl-c">// ...</span>
  }
}</pre>
  </div> 
  <h2><a id="user-content-tasks-are-lazy" class="anchor" href="https://github.com/rouzwawi/flo#tasks-are-lazy" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tasks are lazy</h2> 
  <p>Creating instances of <code>Task&lt;T&gt;</code> is cheap. No matter how complex and deep the task DAG might be, creating the top level <code>Task&lt;T&gt;</code> will not cause the whole DAG to be created. This is because all inputs are declared using a <code>Supplier&lt;T&gt;</code>, utilizing their properties for deferred evaluation:</p> 
  <div class="highlight highlight-source-java">
   <pre>someLibrary<span class="pl-k">.</span>maybeNeedsValue(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> expensiveCalculation());</pre>
  </div> 
  <p>This pattern is on its way to become an idiom for achieving lazyness in Java 8. A good example is the additions to the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html#finest-java.util.function.Supplier-" target="_blank">Java 8 Logger</a> class which lets the logger decide if the log line for a certain log level should be computed or not.</p> 
  <p>So we can easily create an endlessly recursive task (useless, but illustrative) and still be able to construct instances of it without having to worry about how complex or resource consuming the construction might be.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">Task&lt;<span class="pl-smi">String</span>&gt;</span> endless() {
  <span class="pl-k">return</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>Endless<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>ofType(<span class="pl-smi">String</span><span class="pl-k">.</span>class)
      .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> endless())
      .process((impossible) <span class="pl-k">-</span><span class="pl-k">&gt;</span> impossible);
}</pre>
  </div> 
  <p>This means that we can always refer to tasks directly by using their definition:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-smi">TaskId</span> endlessTaskId <span class="pl-k">=</span> endless()<span class="pl-k">.</span>id();</pre>
  </div> 
  <h2><a id="user-content-task-dags-as-data-structures" class="anchor" href="https://github.com/rouzwawi/flo#task-dags-as-data-structures" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Task DAGs as data structures</h2> 
  <p>A <code>Task&lt;T&gt;</code> can be transformed into a data structure where a materialized view of the task DAG is needed. In this example we have two simple tasks where one is used as the input to the other.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">Task&lt;<span class="pl-smi">String</span>&gt;</span> first(<span class="pl-smi">String</span> arg) {
  <span class="pl-k">return</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>First<span class="pl-pds">"</span></span>, arg)<span class="pl-k">.</span>ofType(<span class="pl-smi">String</span><span class="pl-k">.</span>class)
      .process(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>hello <span class="pl-pds">"</span></span> <span class="pl-k">+</span> arg);
}

<span class="pl-k">Task&lt;<span class="pl-smi">String</span>&gt;</span> second(<span class="pl-smi">String</span> arg) {
  <span class="pl-k">return</span> <span class="pl-smi">Task</span><span class="pl-k">.</span>named(<span class="pl-s"><span class="pl-pds">"</span>Second<span class="pl-pds">"</span></span>, arg)<span class="pl-k">.</span>ofType(<span class="pl-smi">String</span><span class="pl-k">.</span>class)
      .in(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> first(arg))
      .process((firstResult) <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>well, <span class="pl-pds">"</span></span> <span class="pl-k">+</span> firstResult);
}

<span class="pl-k">void</span> printTaskInfo() {
  <span class="pl-k">Task&lt;<span class="pl-smi">String</span>&gt;</span> task <span class="pl-k">=</span> second(<span class="pl-s"><span class="pl-pds">"</span>flo<span class="pl-pds">"</span></span>);
  <span class="pl-smi">TaskInfo</span> taskInfo <span class="pl-k">=</span> <span class="pl-smi">TaskInfo</span><span class="pl-k">.</span>ofTask(task);
  <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>taskInfo = <span class="pl-pds">"</span></span> <span class="pl-k">+</span> taskInfo);
}</pre>
  </div> 
  <p><code>taskInfo</code> in this example will be:</p> 
  <pre><code>taskInfo = TaskInfo {
  id=Second(flo)#375f5234,
  isReference=false,
  inputs=[
    TaskInfo {
      id=First(flo)#65f4e738,
      isReference=false,
      inputs=[]
    }
  ]
}
</code></pre> 
  <p>The <code>id</code> and <code>inputs</code> fileds should be pretty self explanatory. <code>isReference</code> is a boolean which signals if some task has already been materialized eariler in the tree, given a depth first, post-order traversal.</p> 
  <p>Recall that the DAG expansion can chose inputs artibrarily based on the arguments. In workflow libraries where expansion is coupled with evaluation, it's hard to know what will be evaluated beforehand. Evaluation planning and result caching/memoizing becomes integral parts of such libraries. <code>flo</code> aims to expose useful information together with flexible evaluation apis to make it a library for easily building workflow management systems, rather than trying to be the can-do-it-all workflow management system itself. More about how this is achieved in the <a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/TaskContext.html" target="_blank"><code>TaskContext</code></a> sections.</p> 
  <h1><a id="user-content-taskcontext" class="anchor" href="https://github.com/rouzwawi/flo#taskcontext" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/TaskContext.html" target="_blank"><code>TaskContext</code></a></h1> 
  <p><a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/TaskContext.html" target="_blank"><code>TaskContext</code></a> defines an interface to a context in which <code>Task&lt;T&gt;</code> instances are evaluated. The context is responsible for expanding the task DAG and invoking the task process-functions. It gives library authors a powerful abstraction to use when implementing the specific details of evaluating a task DAG. All details around setting up wiring of dependencies between tasks, interaction with user code for DAG expansion, invoking task functions with upstream arguments, and other mundane plumbing is dealt with by flo.</p> 
  <p>These are just a few aspects of evaluation that can be implemented in a <code>TaskContext</code>:</p> 
  <ul> 
   <li>Evaluation concurrency and thread pool management</li> 
   <li>Persisted memoization of previous task evaluations</li> 
   <li>Distributed coordination of evaluating shared DAGs</li> 
   <li>Short-circuiting DAG expansion of previously evaluated tasks</li> 
  </ul> 
  <p>Since multi worker, asynchronous evaluation is a very common pre-requisite for many evaluation implementations, flo comes with a base implementation of an <a href="http://rouz.io/flo/maven/latest/apidocs/io/rouz/task/context/AsyncContext.html" target="_blank"><code>AsyncContext</code></a> that can be extended with further behaviour.</p> 
  <h1><a id="user-content-cli-generator" class="anchor" href="https://github.com/rouzwawi/flo#cli-generator" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>CLI generator</h1> 
  <blockquote> 
   <p><code>flo-cli</code> is in an experimental stage of development and not really useful at this time.</p> 
  </blockquote> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;io.rouz&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;flo-cli&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;${flo.version}&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>By adding the <code>@RootTask</code> annotation to the <code>nth(long)</code> constructor in the Fibonacci example, <code>flo</code> will generate a CLI:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">class</span> <span class="pl-en">Fib</span> {

  <span class="pl-k">@RootTask</span>
  <span class="pl-k">static</span> <span class="pl-k">Task&lt;<span class="pl-smi">Long</span>&gt;</span> <span class="pl-en">nth</span>(<span class="pl-k">long</span> <span class="pl-v">n</span>) {
    <span class="pl-c">// ...</span>
  }

  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) <span class="pl-k">throws</span> <span class="pl-smi">IOException</span> {
    <span class="pl-smi">Cli</span><span class="pl-k">.</span>forFactories(<span class="pl-smi">FloRootTaskFactory</span><span class="pl-k">.</span>Fib_Nth())<span class="pl-k">.</span>run(args);
  }
}</pre>
  </div> 
  <pre><code>$ java -jar fib.jar list
available tasks:

Fib.nth
</code></pre> 
  <pre><code>$ java -jar fib.jar create Fib.nth -h
Option (* = required)  Description
---------------------  -----------
-h, --help
* -n &lt;Integer: n&gt;
</code></pre> 
  <pre><code>$ java -jar fib.jar create Fib.nth -n 92

task.id() = Fib(92)#7178b126
task.out() = 7540113804746346429
</code></pre> 
 </article>
</div>