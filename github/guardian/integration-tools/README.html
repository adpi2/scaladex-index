<div class="announce instapaper_body md" data-path="readme.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p>Integration tools provides you with your working webapp inside a Scala test!</p> 
  <ul> 
   <li>no build scripts to startup</li> 
   <li>starts once, keeps running for all your tests</li> 
   <li>same tests work in your IDE or build scripts!</li> 
   <li>clear declaritive interface for your tests dependencies</li> 
  </ul> 
  <p>This library contains stuff that we find helpful when integration testing our projects. Currently, it addresses the step-one problem of firing up multiple web application under test.</p> 
  <h2><a id="user-content-doesnt-this-belong-on-your-build-scripts" class="anchor" href="https://github.com/guardian/integration-tools#doesnt-this-belong-on-your-build-scripts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Doesn't this belong on your build scripts?</h2> 
  <p>Our experience is that everything gets much simpler when your tests are standalone, and don't require shell scripts or build scripts to start. This external dependency means it's harder to run the tests reliably, and therefore the tests get run less regularly.</p> 
  <p>By putting setup where it belongs - in the "before test" construct of your test runner - you can run individual tests anywhere, including in your ide. If you have non-trivial setup that needs to happen before your webapp will start (though of course its A Very Good Thing to avoid this) it's much easier to write this code in your "real" test code, not in the xml of your build scipt or a build script plugin.</p> 
  <p>As a by-product, you can run your tests from anywhere, including in your IDE of choice.</p> 
  <p>Tools like the <a href="http://maven.apache.org/plugins/maven-failsafe-plugin/" target="_blank">maven failsafe plugin</a> attempt to make it easy to add integration tests to your build script. Many people have great success with this; our experience is that it led to a focus on build scripts over a focus of delivering tests.</p> 
  <h2><a id="user-content-limitations" class="anchor" href="https://github.com/guardian/integration-tools#limitations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Limitations</h2> 
  <ul> 
   <li>Webapps are started using jetty. Not other container is supported currently.</li> 
   <li>No class loader hacking is performed: the web apps are loaded into the same classloader as your tests. This will cause problems if you web apps share libraries that use statics for state. (See note below on Google Guice.)</li> 
  </ul> 
  <h1><a id="user-content-getting-started-with-simple-build-tool-and-scalatest" class="anchor" href="https://github.com/guardian/integration-tools#getting-started-with-simple-build-tool-and-scalatest" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Getting started with simple-build-tool and scalatest</h1> 
  <ol> 
   <li><p>in your sbt build script include:</p> <pre><code>val guardianGithub = "Guardian Github Releases" at "http://guardian.github.com/maven/repo-releases"
val integrationTools = "com.gu" %% "integration-tools" % "1.0" % "test"
</code></pre></li> 
   <li><p>you'll also to include <a href="http://www.scalatest.org" target="_blank">scalatest</a>:</p> <pre><code>val scalatest = "org.scalatest" % "scalatest" % "1.3" % "test"
</code></pre></li> 
   <li><p>define the webapps your tests need to have started:</p> <pre><code>import com.gu.integration._
import scalax.file.Path

object ContentApi extends AppServer with LazyStop {
  override val port = 8700
  lazy val apps = List(ContentApiWebApp, ContentApiExplorerWebApp, SolrWebApp)

  object ContentApiWebApp extends ClasspathWebApp {
    lazy val srcPath = "content-api"
    override lazy val contextPath = "/content-api"

    override def postStart() {
      LocalApiBootstrap.ensureIndexPopulated()
    }
  }

  object ContentApiExplorerWebApp extends ClasspathWebApp {
    lazy val srcPath = "content-api-explorer"
    override lazy val contextPath = "/content-api-explorer"
  }

  object SolrWebApp extends WarWebApp {
    lazy val warPath = "solr-server/src/main/solr-server/webapps/solr.war"
    override lazy val contextPath = "/solr"

    override def preStart() {
      System.setProperty("solr.solr.home",
        SiblingProjectFile("solr-server/src/main/solr-server/solr").path)
      System.setProperty("solr.data.dir", Path("integration/target/dependency/solr/data").toAbsolute.path)
      System.setProperty("master.enable", "true")
    }
  }
}
</code></pre></li> 
   <li><p>create a trait that calls this before and after all tests:</p> <pre><code>trait RequiresRunningContentApi extends Suite with BeforeAndAfterAll  {
  override protected def beforeAll() { ContentApi.start() }
  override protected def afterAll() { ContentApi.stopUnlessSomeoneCallsStartAgainSoon() }
}

// stopUnlessSomeoneCallsStartAgainSoon -&gt; will shutdown after (by default) 2 seconds
// if noone calls start in this time period. Normally your test runner will do this
// milliseconds later if its running another test.
</code></pre></li> 
   <li><p>mix this trait into each of your tests that require the app under test to be running</p></li> 
  </ol> 
  <h2><a id="user-content-special-note-on-guice-20" class="anchor" href="https://github.com/guardian/integration-tools#special-note-on-guice-20" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Special note on Guice 2.0</h2> 
  <p>Guice 2.0 uses a static member to communicate between the bootstrap and the filter. This fails miserably if you attempt to start two guice applications in the same classloader, as this helper will do. It looks like guice 3.0 fixes this problem.</p> 
 </article>
</div>