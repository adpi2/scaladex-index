<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h2><a id="user-content-akka-stream-extensions" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#akka-stream-extensions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Akka Stream Extensions</h2> 
  <p>We are proud to opensource <code>Akka-Stream-Extensions</code> extending the very promising <a href="http://doc.akka.io/docs/akka-stream-and-http-experimental/1.0/scala.html" target="_blank">Typesafe Akka-Stream</a>.</p> 
  <p>The main purpose of this project is to:</p> 
  <ol> 
   <li> <p>Develop generic <code>Sources</code>/<code>Flows</code>/<code>Sinks</code> not provided out-of-the-box by Akka-Stream.</p> </li> 
   <li> <p>Make those structures very well tested &amp; production ready.</p> </li> 
   <li> <p>Study/evaluate streaming concepts based on Akka-Stream &amp; other technologies (AWS, Postgres, ElasticSearch, ...).</p> </li> 
  </ol> 
  <p>We have been developing this library in the context of <a href="http://mfglabs.com" target="_blank">MFG Labs</a> for our production projects after identifying a few primitive structures that were common to many use-cases, not provided by Akka-Stream out of the box and not so easy to implement in a robust way.</p> 
  <h2><a id="user-content-how-to" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#how-to" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How-To</h2> 
  <p>Scaladoc is available <a href="http://mfglabs.github.io/akka-stream-extensions/api/#package" target="_blank">there</a>.</p> 
  <h3><a id="user-content-add-resolvers-to-your-buildsbt" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#add-resolvers-to-your-buildsbt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Add resolvers to your <code>build.sbt</code></h3> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.bintrayRepo(<span class="pl-s"><span class="pl-pds">"</span>mfglabs<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>maven<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <h3><a id="user-content-add-dependencies-to-your-buildsbt" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#add-dependencies-to-your-buildsbt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Add dependencies to your <code>build.sbt</code></h3> 
  <p>Currently depends on <code>akka-stream-2.4.2</code></p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.mfglabs<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-stream-extensions<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.10.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-sample" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#sample" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sample</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.mfglabs.stream.</span><span class="pl-v">_</span>

<span class="pl-c"><span class="pl-c">//</span> Source from a paginated REST Api</span>
<span class="pl-k">val</span> <span class="pl-en">pagesStream</span><span class="pl-k">:</span> <span class="pl-en">Source</span>[<span class="pl-en">Page</span>, <span class="pl-en">ActorRef</span>] <span class="pl-k">=</span> <span class="pl-en">SourceExt</span>
  .bulkPullerAsync(<span class="pl-c1">0L</span>) { (currentPosition, downstreamDemand) <span class="pl-k">=&gt;</span>
    <span class="pl-k">val</span> <span class="pl-en">futResult</span><span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">Seq</span>[<span class="pl-en">Page</span>]] <span class="pl-k">=</span> <span class="pl-en">WSService</span>.get(offset <span class="pl-k">=</span> currentPosition, nbPages <span class="pl-k">=</span> downstreamDemand)
    futResult.map {
      <span class="pl-k">case</span> <span class="pl-c1">Nil</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Nil</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">true</span> <span class="pl-c"><span class="pl-c">//</span> stop the stream if the REST Api delivers no more results</span>
      <span class="pl-k">case</span> p   <span class="pl-k">=&gt;</span> p <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">false</span>
    }
  }

someBinaryStream
  .via(<span class="pl-en">FlowExt</span>.rechunkByteStringBySeparator(<span class="pl-en">ByteString</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>), maximumChunkBytes <span class="pl-k">=</span> <span class="pl-c1">5</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>))
  .map(_.utf8String)
  .via(
    <span class="pl-en">FlowExt</span>.customStatefulProcessor(<span class="pl-en">Vector</span>.empty[<span class="pl-k">String</span>])( <span class="pl-c"><span class="pl-c">//</span> grouping by 100 except when we encounter a "flush" line</span>
      (acc, line) <span class="pl-k">=&gt;</span> {
        <span class="pl-k">if</span> (acc.length <span class="pl-k">==</span> <span class="pl-c1">100</span>) (<span class="pl-c1">None</span>, acc)
        <span class="pl-k">else</span> <span class="pl-k">if</span> (line <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>flush<span class="pl-pds">"</span></span>) (<span class="pl-c1">None</span>, acc <span class="pl-k">:</span><span class="pl-k">+</span> line)
        <span class="pl-k">else</span> (<span class="pl-en">Some</span>(acc <span class="pl-k">:</span><span class="pl-k">+</span> line), <span class="pl-en">Vector</span>.empty)
      },
      lastPushIfUpstreamEnds <span class="pl-k">=</span> acc <span class="pl-k">=&gt;</span> acc
    )
  )</pre>
  </div> 
  <p>Many more helpers, check the <a href="http://mfglabs.github.io/akka-stream-extensions/api/#package" target="_blank">Scaladoc</a>!</p> 
  <h2><a id="user-content-postgres-extension" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#postgres-extension" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Postgres extension</h2> 
  <p>This extension provides tools to stream data from/to Postgres.</p> 
  <h3><a id="user-content-dependencies" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#dependencies" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependencies</h3> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.mfglabs<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-stream-extensions-postgres<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.10.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-prerequisites" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#prerequisites" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Prerequisites</h3> 
  <h4><a id="user-content-test-only" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#test-only" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Test only</h4> 
  <p>Pull all docker images launched by the tests</p> 
  <div class="highlight highlight-source-shell">
   <pre>docker pull postgres:8.4
docker pull postgres:9.3</pre>
  </div> 
  <h3><a id="user-content-sample-1" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#sample-1" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sample</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.mfglabs.stream.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.mfglabs.stream.extensions.postgres.</span><span class="pl-v">_</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">pgConnection</span> <span class="pl-k">=</span> <span class="pl-en">PgStream</span>.sqlConnAsPgConnUnsafe(sqlConnection)
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">blockingEc</span> <span class="pl-k">=</span> <span class="pl-en">ExecutionContextForBlockingOps</span>(someEc)

<span class="pl-en">PgStream</span>
  .getQueryResultAsStream(
    <span class="pl-s"><span class="pl-pds">"</span>select a, b, c from table<span class="pl-pds">"</span></span>,
    options <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>FORMAT<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>CSV<span class="pl-pds">"</span></span>)
  )
  .via(<span class="pl-en">FlowExt</span>.rechunkByteStringBySeparator(<span class="pl-en">ByteString</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>), maximumChunkBytes <span class="pl-k">=</span> <span class="pl-c1">5</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>))

someLineStream
  .via(<span class="pl-en">PgStream</span>.insertStreamToTable(
    <span class="pl-s"><span class="pl-pds">"</span>schema<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>table<span class="pl-pds">"</span></span>,
    options <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>FORMAT<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>CSV<span class="pl-pds">"</span></span>)
  ))</pre>
  </div> 
  <h2><a id="user-content-elasticsearch-extension" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#elasticsearch-extension" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Elasticsearch extension</h2> 
  <h3><a id="user-content-dependencies-1" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#dependencies-1" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependencies</h3> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.mfglabs<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-stream-extensions-elasticsearch<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.10.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-sample-2" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#sample-2" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sample</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.mfglabs.stream.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.mfglabs.stream.extensions.elasticsearch.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.elasticsearch.client.</span><span class="pl-v">Client</span>
<span class="pl-k">import</span> <span class="pl-v">org.elasticsearch.index.query.</span><span class="pl-v">QueryBuilders</span>

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">blockingEc</span> <span class="pl-k">=</span> <span class="pl-en">ExecutionContextForBlockingOps</span>(someEc)
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">esClient</span><span class="pl-k">:</span> <span class="pl-en">Client</span> <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">//</span> ...</span>

<span class="pl-en">EsStream</span>
  .queryAsAsStream(
    <span class="pl-en">QueryBuilders</span>.matchAllQuery(),
    index <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>index<span class="pl-pds">"</span></span>,
    `type` <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>,
    scrollKeepAlive <span class="pl-k">=</span> <span class="pl-c1">1</span> minutes,
    scrollSize <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  )</pre>
  </div> 
  <h2><a id="user-content-shapeless-extension" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#shapeless-extension" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Shapeless extension</h2> 
  <p>This extension allows to build at compile-time a fully typed-controlled flow that transforms a HList of Flows to a Flow from the Coproduct of inputs to the Coproduct of outputs.</p> 
  <p>For more details on the history of this extension, read <a href="http://mandubian.com/2015/05/05/shapelessstream/" target="_blank">this article</a>.</p> 
  <h3><a id="user-content-dependencies-2" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#dependencies-2" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dependencies</h3> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.mfglabs<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>akka-stream-extensions-shapeless<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.10.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-sample-3" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#sample-3" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sample</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> 1 - Create a type alias for your coproduct</span>
<span class="pl-k">type</span> <span class="pl-en">C</span> <span class="pl-k">=</span> <span class="pl-k">Int</span> <span class="pl-k">:</span><span class="pl-k">+</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">:</span><span class="pl-k">+</span><span class="pl-k">:</span> <span class="pl-k">Boolean</span> <span class="pl-k">:</span><span class="pl-k">+</span><span class="pl-k">:</span> <span class="pl-en">CNil</span>

<span class="pl-c"><span class="pl-c">//</span> The sink to consume all output data</span>
<span class="pl-k">val</span> <span class="pl-en">sink</span> <span class="pl-k">=</span> <span class="pl-en">Sink</span>.fold[<span class="pl-en">Seq</span>[<span class="pl-en">C</span>], <span class="pl-en">C</span>](<span class="pl-en">Seq</span>())(_ <span class="pl-k">:</span><span class="pl-k">+</span> _)

<span class="pl-c"><span class="pl-c">//</span> 2 - a sample source wrapping incoming data in the Coproduct</span>
<span class="pl-k">val</span> <span class="pl-en">f</span> <span class="pl-k">=</span> <span class="pl-en">GraphDSL</span>.create(sink) { <span class="pl-k">implicit</span> builder <span class="pl-k">=&gt;</span> sink <span class="pl-k">=&gt;</span>
      <span class="pl-k">import</span> <span class="pl-v">GraphDSL.Implicits.</span><span class="pl-v">_</span>
      <span class="pl-k">val</span> <span class="pl-en">s</span> <span class="pl-k">=</span> <span class="pl-en">Source</span>.fromIterator(() <span class="pl-k">=&gt;</span> <span class="pl-en">Seq</span>(
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">1</span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">2</span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">false</span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-s"><span class="pl-pds">"</span>bar<span class="pl-pds">"</span></span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">3</span>),
        <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">true</span>)
      ).toIterator)

<span class="pl-c"><span class="pl-c">//</span> 3 - our typed flows</span>
      <span class="pl-k">val</span> <span class="pl-en">flowInt</span> <span class="pl-k">=</span> <span class="pl-en">Flow</span>[<span class="pl-k">Int</span>].map{i <span class="pl-k">=&gt;</span> println(<span class="pl-s"><span class="pl-pds">"</span>i:<span class="pl-pds">"</span></span><span class="pl-k">+</span>i); i}
      <span class="pl-k">val</span> <span class="pl-en">flowString</span> <span class="pl-k">=</span> <span class="pl-en">Flow</span>[<span class="pl-k">String</span>].map{s <span class="pl-k">=&gt;</span> println(<span class="pl-s"><span class="pl-pds">"</span>s:<span class="pl-pds">"</span></span><span class="pl-k">+</span>s); s}
      <span class="pl-k">val</span> <span class="pl-en">flowBool</span> <span class="pl-k">=</span> <span class="pl-en">Flow</span>[<span class="pl-k">Boolean</span>].map{s <span class="pl-k">=&gt;</span> println(<span class="pl-s"><span class="pl-pds">"</span>s:<span class="pl-pds">"</span></span><span class="pl-k">+</span>s); s}

<span class="pl-c"><span class="pl-c">//</span> &gt;&gt;&gt;&gt;&gt;&gt; THE IMPORTANT THING</span>
<span class="pl-c"><span class="pl-c">//</span> 4 - build the coproductFlow in a 1-liner</span>
<span class="pl-k">val</span> <span class="pl-en">fr</span> <span class="pl-k">=</span> builder.add(<span class="pl-en">ShapelessStream</span>.coproductFlow(flowInt <span class="pl-k">::</span> flowString <span class="pl-k">::</span> flowBool <span class="pl-k">::</span> <span class="pl-en">HNil</span>))
<span class="pl-c"><span class="pl-c">//</span> &lt;&lt;&lt;&lt;&lt;&lt; THE IMPORTANT THING</span>

<span class="pl-c"><span class="pl-c">//</span> 5 - plug everything together using akkastream DSL</span>
  s <span class="pl-k">~</span><span class="pl-k">&gt;</span> fr.in
  fr.out <span class="pl-k">~</span><span class="pl-k">&gt;</span> sink
  <span class="pl-en">ClosedShape</span>
}

<span class="pl-c"><span class="pl-c">//</span> 6 - run it</span>
<span class="pl-en">RunnableGraph</span>.fromGraph(f).run().futureValue.toSet should equal (<span class="pl-en">Set</span>(
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">1</span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">2</span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">false</span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-s"><span class="pl-pds">"</span>bar<span class="pl-pds">"</span></span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">3</span>),
  <span class="pl-en">Coproduct</span>[<span class="pl-en">C</span>](<span class="pl-c1">true</span>)
))</pre>
  </div> 
  <h2><a id="user-content-aws" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#aws" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>AWS</h2> 
  <p>Check our project <a href="https://github.com/MfgLabs/commons-aws" target="_blank">MFG Labs/commons-aws</a> also providing streaming extensions for Amazon S3 &amp; SQS.</p> 
  <h2><a id="user-content-testing" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#testing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Testing</h2> 
  <p>To test postgres-extensions, you need to have Docker installed and running on your computer (the tests will automatically launch a docker container with a Postgres db).</p> 
  <h2><a id="user-content-tributes" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#tributes" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tributes</h2> 
  <p><a href="http://mfglabs.com" target="_blank">MFG Labs</a> sponsored the development and the opensourcing of this library.</p> 
  <p>We hope this library will be useful &amp; interesting to a few ones and that some of you will help us debug &amp; build more useful structures.</p> 
  <div> 
   <p>So don't hesitate to contribute</p> 
   <a href="https://github.com/mfglabs/akka-stream-extensions/blob/master/{{ site.baseurl }}/contributing/" alt="go one contribute page" target="_blank"> </a> 
  </div> 
  <div> 
   <h2><a id="user-content-license" class="anchor" href="https://github.com/mfglabs/akka-stream-extensions#license" aria-hidden="true" target="_blank">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
     </svg></a>License</h2> 
   <p>This software is licensed under the Apache 2 license, quoted below.</p> 
   <p> Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License <a href="http://www.apache.org/licenses/LICENSE-2.0" alt="go to apache.org" target="_blank">here</a>. </p> 
   <p> Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p> 
  </div> 
 </article>
</div>