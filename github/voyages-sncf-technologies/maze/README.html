<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-maze-automate-your-technical-tests" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#maze-automate-your-technical-tests" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>&nbsp;Maze, automate your technical tests</h1> 
  <p>Maze is a tool to automate technical tests. You might want them in some of the following cases :</p> 
  <ul> 
   <li>You have a new product (kafka, redis, ...) you need to deploy for your application, and want to understand how it behaves to configure it as needed and understand better what could happen in production</li> 
   <li>You need to connect to some external system and want to make sure your application will be robust when perturbations happen</li> 
   <li>You have micro-services architecture with some scenarios including different components and want to make sure you will always have consistent behaviour when perturbations happen</li> 
   <li>You need to run these tests frequently to ensure you don't have resilience regressions</li> 
  </ul> 
  <h2><a id="user-content-how-it-works" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#how-it-works" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How it works</h2> 
  <p>Maze is a unit test library, made for scalatest, that will have the following lifecycle :</p> 
  <ul> 
   <li>In the beginning of a test, create a dedicated docker network</li> 
   <li>Before each test, start the configured clusters</li> 
   <li>execute the test</li> 
   <li>Stop the clusters</li> 
   <li>In the end of all the tests, remove the network</li> 
  </ul> 
  <p>All the tests will then consist in communications with your applications / tools, deployed as docker images and the unit test, orchestrating them.</p> 
  <h2><a id="user-content-get-it-in-your-project" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#get-it-in-your-project" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>&nbsp;Get it in your project</h2> 
  <h3><a id="user-content-using-sbt-preferred" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#using-sbt-preferred" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using sbt (preferred)</h3> 
  <div class="highlight highlight-source-scala">
   <pre>scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">2.12</span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>fr.vsct.dt<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>maze<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.4<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-using-maven" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#using-maven" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using maven</h3> 
  <div class="highlight highlight-text-xml">
   <pre>...
&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;fr.vsct.dt&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;maze_2.12&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;1.0.4&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;
...
&lt;<span class="pl-ent">plugin</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;net.alchim31.maven&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;scala-maven-plugin&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;3.2.2&lt;/<span class="pl-ent">version</span>&gt;
    &lt;<span class="pl-ent">executions</span>&gt;
        &lt;<span class="pl-ent">execution</span>&gt;
            &lt;<span class="pl-ent">goals</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;compile&lt;/<span class="pl-ent">goal</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;testCompile&lt;/<span class="pl-ent">goal</span>&gt;
            &lt;/<span class="pl-ent">goals</span>&gt;
        &lt;/<span class="pl-ent">execution</span>&gt;
    &lt;/<span class="pl-ent">executions</span>&gt;
&lt;/<span class="pl-ent">plugin</span>&gt;
&lt;<span class="pl-ent">plugin</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;org.scalatest&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;scalatest-maven-plugin&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.0&lt;/<span class="pl-ent">version</span>&gt;
    &lt;<span class="pl-ent">configuration</span>&gt;
        &lt;<span class="pl-ent">reportsDirectory</span>&gt;${project.build.directory}/surefire-reports&lt;/<span class="pl-ent">reportsDirectory</span>&gt;
        &lt;<span class="pl-ent">junitxml</span>&gt;.&lt;/<span class="pl-ent">junitxml</span>&gt;
        &lt;<span class="pl-ent">filereports</span>&gt;TestSuite.txt&lt;/<span class="pl-ent">filereports</span>&gt;
    &lt;/<span class="pl-ent">configuration</span>&gt;
&lt;/<span class="pl-ent">plugin</span>&gt;</pre>
  </div> 
  <h2><a id="user-content-developing-a-test-using-maze" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#developing-a-test-using-maze" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Developing a test using maze</h2> 
  <p>Afin d'utiliser les différents outils, les tests sont configurés en étendant un trait de configuration. Ce trait a pour but de mettre dans le contexte des tests tous les différents paramètres implicites.</p> 
  <p>Ainsi, la configuration de tel ou tel composant peut être facilement différents d'un test à un autre.</p> 
  <h2><a id="user-content-les-objets-de-type-dsl-et-les-opérations-supportées" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#les-objets-de-type-dsl-et-les-opérations-supportées" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Les objets de type DSL et les opérations supportées</h2> 
  <hr> 
  <p>Les objets de type DSL permettent de répéter des opérations et avoir des assertions sur les résultats dans un langage qui se veut lisible.</p> 
  <p>Actuellement, les cas d'usage de ces objets sont :</p> 
  <ul> 
   <li>Attendre qu'une condition se réalise (par exemple attendre qu'un serveur finisse de se lancer, qu'une élection master / slave se produise, etc..)</li> 
   <li>Avoir des assertions sur certaines conditions. Ce point est mitigé par le fait que scalatest fournisse également des assertions riches.</li> 
  </ul> 
  <p>Le trait DSL (l'implémentation des méthodes a été supprimée pour plus de clarté) :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] {

  <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span>

  <span class="pl-k">def</span> <span class="pl-en">execute</span>()<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>]

  <span class="pl-k">def</span> <span class="pl-en">map</span>[<span class="pl-en">B</span>](<span class="pl-v">f</span>: (<span class="pl-en">A</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">B</span>)<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>] <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">flatMap</span>[<span class="pl-en">B</span>](<span class="pl-v">f</span>: (<span class="pl-en">A</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>])<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>] <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">value</span>()<span class="pl-k">:</span> <span class="pl-en">A</span> <span class="pl-k">=</span> get().result.get

  <span class="pl-k">def</span> <span class="pl-en">labelled</span>(<span class="pl-v">text</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> ...

}</pre>
  </div> 
  <p>Dans sa forme la plus simple, un objet de type DSL contient :</p> 
  <ul> 
   <li>une description : stringFragment</li> 
   <li>une méthode pour calculer un résultat : get()</li> 
  </ul> 
  <p>Ensuite, d'autres méthodes plus utilitaires viennent l'enrichir :</p> 
  <ul> 
   <li>La méthode withText permet de changer la dercription d'un objet DSL. Cette méthode est principalement utile après l'utilisation de map ou flatmap</li> 
   <li>La méthode value() permet de récupérer la valeur calculée sans enrobage, mais lance une exception si le calcule de la valeur a lancé une exception</li> 
   <li>Les méthodes map et flatmap permettent des transformations analogues à la manipulation d'objets de type Option ou Try, et permettent l'utilisation de patterns scala, tels que le for-comprehension.</li> 
  </ul> 
  <p>Enrichir les objets DSL selon leur type :</p> 
  <p>Afin d'enrichir les objets de type DSL sans polluer le trait de base, des méthodes sont ajoutées aux objets, selon le type qu'ils enveloppent.</p> 
  <p>Ainsi, un objet de type Execution[String] aura des méthodes telles que length ou contains. De même, pour tout objet de type Execution (Execution[Any]), certaines méthodes sont ajoutées, telles que is ou isNot.</p> 
  <p>Cet enrichissement est fait par le mécanisme de conversions implicites.</p> 
  <p>Ainsi, la classe com.vsct.dt.dsl.RichDsl va ajouter des méthodes à tous les objets de type DSL, la classe com.vsct.dt.dsl.ArrayDsl va ajouter des méthodes à tous les objets DSL mappant des tableaux, etc.</p> 
  <p>Afin que les conversions puissent être utilisées ensuite, il suffit de les déclarer dans le trait com.vsct.dt.dsl.RicherDsl</p> 
  <h2><a id="user-content-les-objets-bas-niveau" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#les-objets-bas-niveau" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Les objets bas niveau</h2> 
  <hr> 
  <h3><a id="user-content-lobjet-docker" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#lobjet-docker" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>L'objet Docker</h3> 
  <p>L'objet docker encapsule tous les appels à l'api docker-java.</p> 
  <p>Afin de fonctionner correctement, l'objet docker a besoin, en implicite, d'une instance de com.github.dockerjava.api.DockerClient. Le plus simple est d'utiliser le trait com.vsct.dt.configuration.DockerDefaultConfiguration, également contenu dans com.vsct.dt.configuration.DockerDefaultConfiguration. Cette configuration permet l'utilisation de variables d'environnement pour spécifier le DOCKER_HOST, etc..</p> 
  <p>L'objet Docker ne devrait pas être utilisé directement dans les classes de test unitaire, mais être utilisés dans les modules fonctionnels.</p> 
  <h3><a id="user-content-lobjet-network" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#lobjet-network" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>L'objet Network</h3> 
  <p>L'objet Network permet de jouer sur le réseau. Il supporte pour le moment les points suivants :</p> 
  <ul> 
   <li>Gestion du réseau docker</li> 
   <li>Ajout de latence à un conteneur</li> 
   <li>Possibilité de splitter créer des partitions réseau puis de rétablir la situation</li> 
  </ul> 
  <p>Cet objet peut être utilisé dans les tests unitaires.</p> 
  <h3><a id="user-content-lobjet-http" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#lobjet-http" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>L'objet Http</h3> 
  <p>Cet objet sert à effecter des requêtes http et retourne des DSL. Il est conseillé d'encapsuler les appels à l'objet Http dans les modules fonctionnels.</p> 
  <p>Attention : afin de pouvoir effectuer les appels, les ports doivent être "bindés" sur le host, sinon, il est possible que le réseau créé précédemment crée des problèmes de routage (gateway à ajouter sur le poste local)</p> 
  <h2><a id="user-content-les-objets-fonctionnels" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#les-objets-fonctionnels" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Les objets fonctionnels</h2> 
  <hr> 
  <p>Les objets fonctionnels sont des objets utilitaires spécialisés pour l'utilisation d'un outil donné. Ces objets doivent savoir gérer des clusters et leurs noeuds.</p> 
  <h3><a id="user-content-gestion-des-clusters" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#gestion-des-clusters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Gestion des clusters</h3> 
  <p>L'unité de base est le noeud du cluster. Pour les créer, il faut hériter de la classe com.vsct.dt.dsl.ClusterNode.</p> 
  <p>Cette class abstraite prend en paramètre de constructeur une spécification de conteneur Docker, décrivant comment lancer le noeud. Cette dernière peut être crée à partir de l'objet docker. Ainsi, lors de la création du cluster, les différent noeuds sont créés depuis ces définitions.</p> 
  <p>Ensuite, pour contrôler ces noeuds, il suffit d'étendre de la classe com.vsct.dt.dsl.Cluster. Cette classe prend en paramètre de constructeur un ensemble de noeuds.</p> 
  <p>Ainsi, les opérations de base (start, stop, kill, etc.) sont implémentées</p> 
  <h3><a id="user-content-opérations-spécifiques" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#opérations-spécifiques" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Opérations spécifiques</h3> 
  <p>Les objets fonctionnels permettent des opérations riches basées sur l'outil à tester. Il est conseillé d'y mettre les méthodes utilitaires de création de cluster.</p> 
  <p>Par exemple, dans com.vsct.dt.components.Zookeeper :</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">def</span> <span class="pl-en">cluster</span>(<span class="pl-v">nodes</span>: <span class="pl-k">Int</span>)(<span class="pl-k">implicit</span> <span class="pl-v">dockerClient</span>: <span class="pl-en">DockerClient</span>) <span class="pl-k">=</span> {

      <span class="pl-k">val</span> <span class="pl-en">range</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> to nodes

      <span class="pl-k">val</span> <span class="pl-en">servers</span> <span class="pl-k">=</span> range.map(s <span class="pl-k">=&gt;</span> s<span class="pl-s"><span class="pl-pds">"</span>zk$s<span class="pl-pds">"</span></span>).mkString(<span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span>)

      <span class="pl-k">new</span> <span class="pl-en">ZookeeperCluster</span>(range map { i <span class="pl-k">=&gt;</span>
        <span class="pl-k">new</span> <span class="pl-en">ZookeeperNode</span>(<span class="pl-en">Docker</span>.prepareCreateContainer(<span class="pl-s"><span class="pl-pds">"</span>dockerregistrydev.socrate.vsct.fr/resilience/zookeeper:3.4.6<span class="pl-pds">"</span></span>)
          .withEnv(s<span class="pl-s"><span class="pl-pds">"</span>SERVERS=$servers<span class="pl-pds">"</span></span>, s<span class="pl-s"><span class="pl-pds">"</span>MYID=$i<span class="pl-pds">"</span></span>)
          .withHostName(s<span class="pl-s"><span class="pl-pds">"</span>zk$i<span class="pl-pds">"</span></span>)
          .withName(s<span class="pl-s"><span class="pl-pds">"</span>zk$i<span class="pl-pds">"</span></span>)
          .withNetworkMode(<span class="pl-s"><span class="pl-pds">"</span>technical-tests<span class="pl-pds">"</span></span>) <span class="pl-c">// Docker 1.10 : specify a network other than default network will give you a free dns.</span>
          , i)
      }<span class="pl-k">:</span>_<span class="pl-k">*</span>)
    }</pre>
  </div> 
  <p>Ainsi la création d'un cluster zookeeper se fait ainsi :</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">val</span> <span class="pl-en">zookeeperCluster</span> <span class="pl-k">=</span> <span class="pl-en">Zookeeper</span>.cluster(nodes <span class="pl-k">=</span> <span class="pl-c1">3</span>)</pre>
  </div> 
  <p>Le paramètre implicite dockerClient est fourni par la configuration.</p> 
 </article>
</div>