<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-maze-automate-your-technical-tests" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#maze-automate-your-technical-tests" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>&nbsp;Maze, automate your technical tests</h1> 
  <p><a href="https://travis-ci.org/voyages-sncf-technologies/maze" target="_blank"><img src="https://camo.githubusercontent.com/f855f5c4ef275d180a452f22ef6fad1311b54e0b/68747470733a2f2f7472617669732d63692e6f72672f766f79616765732d736e63662d746563686e6f6c6f676965732f6d617a652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/voyages-sncf-technologies/maze.svg?branch=master" style="max-width:100%;"></a> <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank"><img src="https://camo.githubusercontent.com/5cf3e8cb468d201080e97b17c969767e755a470b/687474703a2f2f696d672e736869656c64732e696f2f3a6c6963656e73652d417061636865253230322d79656c6c6f772e737667" alt="License" data-canonical-src="http://img.shields.io/:license-Apache%202-yellow.svg" style="max-width:100%;"></a> <a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22maze_2.12%22" target="_blank"><img src="https://camo.githubusercontent.com/7606b86642488fb7ce815723b127c28aeffb6d60/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f66722e767363742e64742f6d617a655f322e31322e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/fr.vsct.dt/maze_2.12.svg" style="max-width:100%;"></a> <a href="https://codecov.io/gh/voyages-sncf-technologies/maze" target="_blank"><img src="https://camo.githubusercontent.com/8fda3de60265e9cfbfa3296967b62545b03859ad/68747470733a2f2f636f6465636f762e696f2f67682f766f79616765732d736e63662d746563686e6f6c6f676965732f6d617a652f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="Codecov" data-canonical-src="https://codecov.io/gh/voyages-sncf-technologies/maze/branch/master/graph/badge.svg" style="max-width:100%;"></a> <a href="https://www.codacy.com/app/flaroche/maze" target="_blank"><img src="https://camo.githubusercontent.com/52492b86d733cba239b249d7d582c5da133ba95a/68747470733a2f2f696d672e736869656c64732e696f2f636f646163792f67726164652f34363035643164653433353234386434386633356265336638323961646639302e737667" alt="Codacy grade" data-canonical-src="https://img.shields.io/codacy/grade/4605d1de435248d48f35be3f829adf90.svg" style="max-width:100%;"></a></p> 
  <p>Maze is a tool to automate technical tests. You might want them in some of the following cases :</p> 
  <ul> 
   <li>You have a new product (kafka, redis, ...) you need to deploy for your application, and want to understand how it behaves to configure it as needed and understand better what could happen in production</li> 
   <li>You need to connect to some external system and want to make sure your application will be robust when perturbations happen</li> 
   <li>You have micro-services architecture with some scenarios including different components and want to make sure you will always have consistent behaviour when perturbations happen</li> 
   <li>You need to run these tests frequently to ensure you don't have resilience regressions</li> 
  </ul> 
  <h2><a id="user-content-how-it-works" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#how-it-works" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How it works</h2> 
  <p>Maze is a unit test library, made for scalatest, that will have the following lifecycle :</p> 
  <ul> 
   <li>In the beginning of a test, create a dedicated docker network</li> 
   <li>Before each test, start the configured clusters</li> 
   <li>execute the test</li> 
   <li>Stop the clusters</li> 
   <li>In the end of all the tests, remove the network</li> 
  </ul> 
  <p>All the tests will then consist in communications with your applications / tools, deployed as docker images and the unit test, orchestrating them.</p> 
  <h2><a id="user-content-get-it-in-your-project" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#get-it-in-your-project" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>&nbsp;Get it in your project</h2> 
  <h3><a id="user-content-using-sbt-preferred" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#using-sbt-preferred" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using sbt (preferred)</h3> 
  <div class="highlight highlight-source-scala">
   <pre>scalaVersion <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>2.12.1<span class="pl-pds">"</span></span>

libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>fr.vsct.dt<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>maze<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.14<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-using-maven" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#using-maven" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using maven</h3> 
  <div class="highlight highlight-text-xml">
   <pre>...
&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;fr.vsct.dt&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;maze_2.12&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;1.0.14&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;
...
&lt;<span class="pl-ent">plugin</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;net.alchim31.maven&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;scala-maven-plugin&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;3.2.2&lt;/<span class="pl-ent">version</span>&gt;
    &lt;<span class="pl-ent">executions</span>&gt;
        &lt;<span class="pl-ent">execution</span>&gt;
            &lt;<span class="pl-ent">goals</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;compile&lt;/<span class="pl-ent">goal</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;testCompile&lt;/<span class="pl-ent">goal</span>&gt;
            &lt;/<span class="pl-ent">goals</span>&gt;
        &lt;/<span class="pl-ent">execution</span>&gt;
    &lt;/<span class="pl-ent">executions</span>&gt;
&lt;/<span class="pl-ent">plugin</span>&gt;
&lt;<span class="pl-ent">plugin</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;org.scalatest&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;scalatest-maven-plugin&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.0&lt;/<span class="pl-ent">version</span>&gt;
    &lt;<span class="pl-ent">configuration</span>&gt;
        &lt;<span class="pl-ent">reportsDirectory</span>&gt;${project.build.directory}/surefire-reports&lt;/<span class="pl-ent">reportsDirectory</span>&gt;
        &lt;<span class="pl-ent">junitxml</span>&gt;.&lt;/<span class="pl-ent">junitxml</span>&gt;
        &lt;<span class="pl-ent">filereports</span>&gt;TestSuite.txt&lt;/<span class="pl-ent">filereports</span>&gt;
    &lt;/<span class="pl-ent">configuration</span>&gt;
&lt;/<span class="pl-ent">plugin</span>&gt;</pre>
  </div> 
  <h2><a id="user-content-developing-a-test-using-maze" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#developing-a-test-using-maze" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Developing a test using maze</h2> 
  <p>Step 1: Dockerize the application you want to test Step 2: Configure nodes for it </p> 
  <div class="highlight highlight-source-scala">
   <pre>...
<span class="pl-k">import</span> <span class="pl-v">fr.vsct.dt.maze.core.Predef.</span><span class="pl-v">_</span>
...

<span class="pl-k">class</span> <span class="pl-en">MyAwesomeApplicationNode</span> <span class="pl-k">extends</span> <span class="pl-e">SingleContainerClusterNode</span> {
  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">servicePort</span><span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span> <span class="pl-c1">9000</span>
  <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">serviceContainer</span><span class="pl-k">:</span> <span class="pl-en">CreateContainerCmd</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>some/image:1.2.3<span class="pl-pds">"</span></span>.withEnv(<span class="pl-s"><span class="pl-pds">"</span>SOME_VARIABLE=some-value<span class="pl-pds">"</span></span>)
} </pre>
  </div> 
  <p>Maze uses docker-java to interact with docker, more information on container creation there.</p> 
  <p>Step 3: Create your cluster</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MyAwesomeApplicationCluster</span> <span class="pl-k">extends</span> <span class="pl-e">Cluster</span>[<span class="pl-en">MyAwesomeApplicationNode</span>]
</pre>
  </div> 
  <p>Step 4: Create a unit test</p> 
  <div class="highlight highlight-source-scala">
   <pre>...
<span class="pl-k">import</span> <span class="pl-v">fr.vsct.dt.maze.core.Predef.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">fr.vsct.dt.maze.core.Commands.</span><span class="pl-v">_</span>
...

<span class="pl-k">class</span> <span class="pl-en">MyAwesomeApplicationTest</span> <span class="pl-k">extends</span> <span class="pl-e">TechnicalTest</span> {

  <span class="pl-k">var</span> <span class="pl-en">myAwesomeCluster</span><span class="pl-k">:</span> <span class="pl-en">MyAwesomeApplicationCluster</span> <span class="pl-k">=</span> _

  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">beforeEach</span>()<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    myAwesomeCluster <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">MyAwesomeApplicationCluster</span>
    myAwesomeCluster.add(<span class="pl-c1">3.</span>nodes named <span class="pl-s"><span class="pl-pds">"</span>my-awesome-node<span class="pl-pds">"</span></span> constructedLike(<span class="pl-k">new</span> <span class="pl-en">MyAwesomeApplicationNode))</span>
    myAwesomeCluster.start()
  }

  <span class="pl-s"><span class="pl-pds">"</span>my awesome applications<span class="pl-pds">"</span></span> should <span class="pl-s"><span class="pl-pds">"</span>response to http requests<span class="pl-pds">"</span></span> in {
    <span class="pl-c"><span class="pl-c">//</span> Do all your testing logic here, for instance:</span>
    <span class="pl-k">val</span> <span class="pl-en">someNode</span> <span class="pl-k">=</span> myAwesomeCluster.nodes.head
    expectThat(<span class="pl-en">Http</span>.get(s<span class="pl-s"><span class="pl-pds">"</span>http://${someNode.externalIp}:${someNode.mappedPort.get}/healthcheck<span class="pl-pds">"</span></span>).status is <span class="pl-c1">200</span>)
  }

  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">afterEach</span>()<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    myAwesomeCluster.stop()
  }

}
</pre>
  </div> 
  <h2><a id="user-content-execution-and-predicates" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#execution-and-predicates" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Execution and predicates</h2> 
  <p>Technical tests often require observation: wait for a cluster to recover, for some messages to be consumed, and so on. That's why we need to create repeatable commands and checks. These commands are subclasses of the Execution trait :</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">trait</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] {

  <span class="pl-k">def</span> <span class="pl-en">execute</span>()<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>]

  <span class="pl-k">def</span> <span class="pl-en">map</span>[<span class="pl-en">B</span>](<span class="pl-v">f</span>: (<span class="pl-en">A</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">B</span>)<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>] <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">flatMap</span>[<span class="pl-en">B</span>](<span class="pl-v">f</span>: (<span class="pl-en">A</span>) <span class="pl-k">=&gt;</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>])<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">B</span>] <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">value</span>()<span class="pl-k">:</span> <span class="pl-en">A</span> <span class="pl-k">=</span> get().result.get

  <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span>
  <span class="pl-k">def</span> <span class="pl-en">labelled</span>(<span class="pl-v">text</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> ...

}</pre>
  </div> 
  <p>This trait describes commands that can be executed, returning a new result with each execution.</p> 
  <ul> 
   <li>the execute method will do the actual method call, which will certainly include side effects, and would have many reasons to be in error.</li> 
   <li>The map / flaMap method allows to compose the execution the same way as it can be dome with any other monad. FlatMap also allows the use of for-comprehensions.</li> 
   <li>the value method returns the result of an execution, throwing an exception if an error occurred</li> 
   <li>The field / methods label / labelled allow to describe the execution in a human readable way. This allows better error messages.</li> 
  </ul> 
  <p>A special case of these executions are the boolean executions: when we have one, there cases when you'd want to apply a function Boolean =&gt; A is quite rare (or maybe you wanted to use something more meaningful then a boolean?), and in most of case, you'll have at most boolean operations (and, or, not). </p> 
  <p>Since these Execution[Boolean] can be seen as leaves, and that the 3 states (true, false, error) are important, maze defines a Predicate class. A predicate class is like an Execution[Boolean], but less generic.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">abstract</span> <span class="pl-k">class</span> <span class="pl-en">Predicate</span> {
  <span class="pl-c1">self</span> <span class="pl-k">=&gt;</span>

  <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span>

  <span class="pl-k">def</span> <span class="pl-en">get</span>()<span class="pl-k">:</span> <span class="pl-en">PredicateResult</span>

  <span class="pl-k">def</span> <span class="pl-en">execute</span>()<span class="pl-k">:</span> <span class="pl-k">Boolean</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">labeled</span>(<span class="pl-v">text</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">unary_!</span> <span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> ...

  def <span class="pl-k">&amp;&amp;</span>(<span class="pl-v">other</span>: <span class="pl-en">Predicate</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">||</span>(<span class="pl-v">other</span>: <span class="pl-en">Predicate</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> ...

}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">PredicateResult</span>(<span class="pl-v">result</span>: <span class="pl-en">Try</span>[<span class="pl-k">Boolean</span>], <span class="pl-v">message</span>: <span class="pl-k">String</span>)
</pre>
  </div> 
  <p>The results of the predicates include the boolean result, but also a message. This message is meant to be a human readable message to display to the user.</p> 
  <p>This makes error message readable.</p> 
  <p>In order to create a Predicate from an execution, the most simple way is to use the toPredicate method:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">is</span>(<span class="pl-v">other</span>: <span class="pl-en">A</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.toPredicate(s<span class="pl-s"><span class="pl-pds">"</span>${self.label} is '$other'?<span class="pl-pds">"</span></span>) {
  <span class="pl-k">case</span> a <span class="pl-k">if</span> a <span class="pl-k">==</span> other <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.success
  <span class="pl-k">case</span> a <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.failure(s<span class="pl-s"><span class="pl-pds">"</span>Expected '$a' to be '$other'<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <p>This example is taken from the core of maze. </p> 
  <p>These executions and predicate are then to be manipulated with the commands.</p> 
  <h2><a id="user-content-the-commands" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#the-commands" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>The commands</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">commands</span> {

  <span class="pl-k">def</span> <span class="pl-en">expectThat</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">print</span>(<span class="pl-v">dsl</span>: <span class="pl-en">Execution</span>[_])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">exec</span>[<span class="pl-en">A</span>](<span class="pl-v">execution</span>: <span class="pl-en">Execution</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">A</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">waitFor</span>(<span class="pl-v">duration</span>: <span class="pl-en">FiniteDuration</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">waitUntil</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">waitWhile</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">repeatWhile</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)(<span class="pl-v">doSomething</span>: <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

  <span class="pl-k">def</span> <span class="pl-en">doIf</span>(<span class="pl-v">condition</span>: <span class="pl-en">Predicate</span>)(<span class="pl-v">code</span>: <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>)<span class="pl-k">:</span> <span class="pl-en">IfResult</span> <span class="pl-k">=</span> ...

  <span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">ElseResult</span> {
    <span class="pl-k">def</span> <span class="pl-en">onError</span>(<span class="pl-v">code</span>: <span class="pl-en">Exception</span> <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>) <span class="pl-k">=</span> {}
  }

  <span class="pl-k">sealed</span> <span class="pl-k">trait</span> <span class="pl-en">IfResult</span> <span class="pl-k">extends</span> <span class="pl-e">ElseResult</span> {
    <span class="pl-k">def</span> <span class="pl-en">orElse</span>(<span class="pl-v">code</span>: <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>)<span class="pl-k">:</span> <span class="pl-en">ElseResult</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>
  }

}</pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">expectThat</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

<span class="pl-c"><span class="pl-c">//</span> For instance:</span>

expectThat(<span class="pl-en">Http</span>.get(<span class="pl-s"><span class="pl-pds">"</span>http://www.google.fr<span class="pl-pds">"</span></span>).status is <span class="pl-c1">200</span>)</pre>
  </div> 
  <p>Expects that a given Predicate will return Success(true). If not, throws an exception using the label of the predicate and the message of the PredicateResult.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">print</span>(<span class="pl-v">dsl</span>: <span class="pl-en">Execution</span>[_])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...</pre>
  </div> 
  <p>Prints the label and result of an Execution</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">exec</span>[<span class="pl-en">A</span>](<span class="pl-v">execution</span>: <span class="pl-en">Execution</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">A</span> <span class="pl-k">=</span> ...</pre>
  </div> 
  <p>Executes an Execution right away, throwing an Exception if an error occurs</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">waitFor</span>(<span class="pl-v">duration</span>: <span class="pl-en">FiniteDuration</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> ...

<span class="pl-c"><span class="pl-c">//</span> for instance</span>
waitFor(<span class="pl-c1">1</span> minute)</pre>
  </div> 
  <p>A more expressive way to wait than Thread.sleep.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">waitUntil</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)<span class="pl-k">:</span> <span class="pl-en">Duration</span> <span class="pl-k">=</span> ...

<span class="pl-k">def</span> <span class="pl-en">waitWhile</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)<span class="pl-k">:</span> <span class="pl-en">Duration</span> <span class="pl-k">=</span> ...

<span class="pl-k">def</span> <span class="pl-en">repeatWhile</span>(<span class="pl-v">predicate</span>: <span class="pl-en">Predicate</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-en">FiniteDuration</span> <span class="pl-k">=</span> <span class="pl-c1">5</span> minutes)(<span class="pl-v">doSomething</span>: <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>)<span class="pl-k">:</span> <span class="pl-en">Duration</span> <span class="pl-k">=</span> ...</pre>
  </div> 
  <p>Loop on predicate conditions and returns the time taken for the condition to happen. For Instance:</p> 
  <div class="highlight highlight-source-scala">
   <pre>waitUntil(<span class="pl-en">Http</span>.get(<span class="pl-s"><span class="pl-pds">"</span>http://some-url<span class="pl-pds">"</span></span>).status is <span class="pl-c1">200</span>, <span class="pl-v">butNoLongerThan</span>: <span class="pl-c1">30</span> seconds)

<span class="pl-c"><span class="pl-c">//</span> Or you can also write:</span>

waitUntil(<span class="pl-en">Http</span>.get(<span class="pl-s"><span class="pl-pds">"</span>http://some-url<span class="pl-pds">"</span></span>).status is <span class="pl-c1">200</span>) butNoLongerThan(<span class="pl-c1">30</span> seconds)</pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">doIf</span>(<span class="pl-v">condition</span>: <span class="pl-en">Predicate</span>)(<span class="pl-v">code</span>: <span class="pl-k">=&gt;</span> <span class="pl-k">Unit</span>)<span class="pl-k">:</span> <span class="pl-en">IfResult</span> <span class="pl-k">=</span> ...

<span class="pl-c"><span class="pl-c">//</span> For instance</span>
doIf(somePredicate) {
  expectThat(...)
} orElse {
  expectThat(...)
} onError { e <span class="pl-k">=&gt;</span>
    ...
}</pre>
  </div> 
  <h2><a id="user-content-introducing-perturbations-in-your-test" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#introducing-perturbations-in-your-test" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Introducing perturbations in your test</h2> 
  <p>Maze can introduce some system / network perturbations in your nodes, in order to test the resilience of the system.</p> 
  <p>To be able to introduce these perturbations, maze will need:</p> 
  <ul> 
   <li>Some rights on container (containers are run as privileged with a few capabilities added)</li> 
   <li>Some tools available in the container, for instance iptables or tc.</li> 
  </ul> 
  <h3><a id="user-content-stopping-nodes" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#stopping-nodes" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Stopping nodes</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> Stops the node using docker stop</span>
node.stop()

<span class="pl-c"><span class="pl-c">//</span> Stops the node by sending a SIGTERM signal to the process</span>
node.kill()

<span class="pl-c"><span class="pl-c">//</span> Stops the node by sending a KILL signal to the process</span>
node.crash()</pre>
  </div> 
  <h3><a id="user-content-network-isolation--partition" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#network-isolation--partition" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Network isolation / partition</h3> 
  <div class="highlight highlight-source-scala">
   <pre>tag(injector <span class="pl-k">+</span> master) as <span class="pl-s"><span class="pl-pds">"</span>Isolated injector and master<span class="pl-pds">"</span></span>
<span class="pl-en">DockerNetwork</span>.isolate(<span class="pl-s"><span class="pl-pds">"</span>Isolated injector and master<span class="pl-pds">"</span></span>)

...

<span class="pl-en">DockerNetwork</span>.cancelIsolation()</pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">DockerNetwork</span>.split(node1 <span class="pl-k">+</span> node2, node3)

...

<span class="pl-en">DockerNetwork</span>.cancelIsolation()</pre>
  </div> 
  <h3><a id="user-content-network-lag" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#network-lag" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Network lag</h3> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> Adds network lag on node to anything</span>
node.lag(<span class="pl-c1">2</span> seconds)


<span class="pl-c"><span class="pl-c">//</span> Adds lag towards another node</span>
<span class="pl-k">val</span> <span class="pl-en">sourceNode</span> <span class="pl-k">=</span> ...
<span class="pl-k">val</span> <span class="pl-en">destinationNode</span> <span class="pl-k">=</span> ...

<span class="pl-en">DockerNetwork</span>.setLag(from <span class="pl-k">=</span> sourceNode.containerId, to <span class="pl-k">=</span> destinationNode.containerId, lag <span class="pl-k">=</span> <span class="pl-c1">2</span> seconds)


<span class="pl-c"><span class="pl-c">//</span> Adds lag to an external host</span>
<span class="pl-en">DockerNetwork</span>.setLagToExternalHost(on <span class="pl-k">=</span> node.containerId, externalHost <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>10.11.12.13<span class="pl-pds">"</span></span>, lag <span class="pl-k">=</span> <span class="pl-c1">2</span> seconds)



<span class="pl-c"><span class="pl-c">//</span> Remove lag</span>
<span class="pl-en">DockerNetwork</span>.removeLag(on <span class="pl-k">=</span> node.containerId)</pre>
  </div> 
  <h2><a id="user-content-making-executions-richer" class="anchor" href="https://github.com/voyages-sncf-technologies/maze#making-executions-richer" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Making executions richer</h2> 
  <p>The execution trait is simple, map / flatMap allow almost anything, but don't make user friendly code (someone not too much used to scala will need time to read it well).</p> 
  <p>In order to make them richer, methods are added to Executions, according to the type of it. These are added using implicits. In order to use the basinc implicits, you must import the maze Predef package.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">fr.vsct.dt.maze.core.Predef.</span><span class="pl-v">_</span></pre>
  </div> 
  <p>For instance, the following implicits are available on any execution:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">implicit</span> <span class="pl-k">class</span> <span class="pl-en">RichExecution</span>[<span class="pl-en">A</span>](<span class="pl-k">val</span> <span class="pl-en">self</span><span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>]) <span class="pl-k">extends</span> <span class="pl-e">AnyVal</span> {
    <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">toExecutionWrappingExecuted</span><span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> {
      <span class="pl-k">val</span> <span class="pl-en">returnValue</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.execute()
      <span class="pl-k">new</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] {
        <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">execute</span>()<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> returnValue

        <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.label
      }
    }

    <span class="pl-k">def</span> <span class="pl-en">withSnapshot</span>[<span class="pl-en">B</span>](<span class="pl-v">fn</span>: (<span class="pl-en">Execution</span>[<span class="pl-en">A</span>]) <span class="pl-k">=&gt;</span> <span class="pl-en">B</span>)<span class="pl-k">:</span> <span class="pl-en">B</span> <span class="pl-k">=</span> fn(toExecutionWrappingExecuted)

    <span class="pl-k">def</span> <span class="pl-en">untilSuccess</span><span class="pl-k">:</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Execution</span>[<span class="pl-en">A</span>] {
      <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.label

      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">execute</span>()<span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> {
        <span class="pl-k">val</span> <span class="pl-en">result</span><span class="pl-k">:</span> <span class="pl-en">Try</span>[<span class="pl-en">A</span>] <span class="pl-k">=</span> <span class="pl-c1">self</span>.execute()
        result <span class="pl-k">match</span> {
          <span class="pl-k">case</span> <span class="pl-en">Success</span>(_) <span class="pl-k">=&gt;</span> result
          <span class="pl-k">case</span> <span class="pl-en">Failure</span>(_) <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.execute()
        }
      }
    }

    <span class="pl-k">def</span> <span class="pl-en">is</span>(<span class="pl-v">other</span>: <span class="pl-en">Execution</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-c1">self</span> is other.execute().get

    <span class="pl-k">def</span> <span class="pl-en">is</span>(<span class="pl-v">other</span>: <span class="pl-en">A</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.toPredicate(s<span class="pl-s"><span class="pl-pds">"</span>${self.label} is '$other'?<span class="pl-pds">"</span></span>) {
      <span class="pl-k">case</span> a <span class="pl-k">if</span> a <span class="pl-k">==</span> other <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.success
      <span class="pl-k">case</span> a <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.failure(s<span class="pl-s"><span class="pl-pds">"</span>Expected '$a' to be '$other'<span class="pl-pds">"</span></span>)
    }

    <span class="pl-k">def</span> <span class="pl-en">isNot</span>(<span class="pl-v">other</span>: <span class="pl-en">A</span>)<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.toPredicate(s<span class="pl-s"><span class="pl-pds">"</span>${self.label} isn't '$other'?<span class="pl-pds">"</span></span>) {
      <span class="pl-k">case</span> a <span class="pl-k">if</span> a <span class="pl-k">!=</span> other <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.success
      <span class="pl-k">case</span> a <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.failure(s<span class="pl-s"><span class="pl-pds">"</span>Expected '$a' to be different from '$other'<span class="pl-pds">"</span></span>)
    }

    <span class="pl-k">def</span> <span class="pl-en">isError</span><span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Predicate</span> {
      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">get</span>()<span class="pl-k">:</span> <span class="pl-en">PredicateResult</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.execute() <span class="pl-k">match</span> {
        <span class="pl-k">case</span> <span class="pl-en">Failure</span>(_) <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.success
        <span class="pl-k">case</span> _ <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.failure(<span class="pl-s"><span class="pl-pds">"</span>Expected execution to be in error, but it is not.<span class="pl-pds">"</span></span>)
      }


      <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.label <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> is in error?<span class="pl-pds">"</span></span>
    }

    <span class="pl-k">def</span> <span class="pl-en">isSuccess</span><span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Predicate</span> {

      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">get</span>()<span class="pl-k">:</span> <span class="pl-en">PredicateResult</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.execute() <span class="pl-k">match</span> {
        <span class="pl-k">case</span> <span class="pl-en">Success</span>(_) <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.success
        <span class="pl-k">case</span> _ <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.failure(<span class="pl-s"><span class="pl-pds">"</span>Expected execution to be in success, but it is not.<span class="pl-pds">"</span></span>)
      }

      <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> <span class="pl-c1">self</span>.label <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> is in success?<span class="pl-pds">"</span></span>
    }


    <span class="pl-k">def</span> <span class="pl-en">toPredicate</span>(<span class="pl-v">predicateLabel</span>: <span class="pl-k">String</span>)(<span class="pl-v">fn</span>: <span class="pl-en">PartialFunction</span>[<span class="pl-en">A</span>, <span class="pl-en">PredicateResult</span>])<span class="pl-k">:</span> <span class="pl-en">Predicate</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Predicate</span> {
      <span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">label</span><span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> predicateLabel

      <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">get</span>()<span class="pl-k">:</span> <span class="pl-en">PredicateResult</span> <span class="pl-k">=</span> {
        <span class="pl-c1">self</span>.execute() <span class="pl-k">match</span> {
          <span class="pl-k">case</span> <span class="pl-en">Success</span>(r) <span class="pl-k">=&gt;</span> fn(r)
          <span class="pl-k">case</span> <span class="pl-en">Failure</span>(e) <span class="pl-k">=&gt;</span> <span class="pl-en">Result</span>.exception(e)
        }
      }
    }

  }</pre>
  </div> 
  <p>Using this mechanism, it's easy to create your own rich executions.</p> 
 </article>
</div>