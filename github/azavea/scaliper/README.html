<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/azavea/scaliper#scaliper" aria-hidden="true" class="anchor" id="user-content-scaliper" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Scaliper</h1> 
  <p>[ ![Build Status] <a href="https://travis-ci.org/azavea/scaliper.png?branch=master" target="_blank">travis-image</a> ] <a href="https://travis-ci.org/azavea/scaliper" target="_blank">travis</a> [ <a href="https://camo.githubusercontent.com/26ce5edd55e66e76eb17bf1039c8833d1b27e6f7/687474703a2f2f7777772e6170616368652e6f72672f6c6963656e7365732f4c4943454e53452d322e30" target="_blank"><img src="https://camo.githubusercontent.com/26ce5edd55e66e76eb17bf1039c8833d1b27e6f7/687474703a2f2f7777772e6170616368652e6f72672f6c6963656e7365732f4c4943454e53452d322e30" alt="License" data-canonical-src="http://www.apache.org/licenses/LICENSE-2.0" style="max-width:100%;"></a> <a href="http://img.shields.io/badge/license-Apache--2-blue.svg?style=flat" target="_blank">license-image</a> ] <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">license</a> [ ![Download] <a href="https://api.bintray.com/packages/azavea/maven/scaliper/images/download.svg" target="_blank">bintray-version-image</a> ] <a href="https://bintray.com/azavea/maven/scaliper/_latestVersion" target="_blank">bintray-version</a></p> 
  <h2><a href="https://github.com/azavea/scaliper#overview" aria-hidden="true" class="anchor" id="user-content-overview" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Overview</h2> 
  <p>Scaliper is a microbenchmarking tool based on <a href="https://github.com/google/caliper" target="_blank">Google's Caliper</a>. The codebase conatins a partial port from Java to Scala of some of Caliper's measurment code, as well as the method of running benchmarks in a seperate JVM and the warm up routines, based on an early version of Caliper. It contains methods of declaring benchmarks in test suites, so that they can be run as part of the ScalaTest framework.</p> 
  <h2><a href="https://github.com/azavea/scaliper#using-scaliper" aria-hidden="true" class="anchor" id="user-content-using-scaliper" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using Scaliper</h2> 
  <p>Scaliper exists in a bintray repository. This is a new project and so there will potentially be many updates, but each travis build of master will publish an artifact that can be referenced by the first 7 characters of the commit hash. You can find the latest published binary here: <a href="https://bintray.com/azavea/maven/scaliper/view" target="_blank">https://bintray.com/azavea/maven/scaliper/view</a></p> 
  <p>You can add scaliper to your project by adding the following lines to your <code>build.sbt</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.bintrayRepo(<span class="pl-s"><span class="pl-pds">"</span>azavea<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>maven<span class="pl-pds">"</span></span>)
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.azavea<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>scaliper<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.5.0-e9d4266<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>Where in the above case, <code>e9d4266</code> is the hash of a published snapshot of scaliper on bintray.</p> 
  <p>Also, be sure to tell SBT not to execute tests in parallel, since we want to run benchmarks serially. You do this with the setting:</p> 
  <div class="highlight highlight-source-scala">
   <pre>parallelExecution in <span class="pl-en">Test</span> <span class="pl-k">:</span><span class="pl-k">=</span> <span class="pl-c1">false</span></pre>
  </div> 
  <h2><a href="https://github.com/azavea/scaliper#example" aria-hidden="true" class="anchor" id="user-content-example" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
  <p>Say you have some function <code>thisTakesTime(arr: Array[Int]): Unit</code> that you'd like to benchmark, in a class Foo:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">Foo</span>(<span class="pl-v">sleepTime</span>: <span class="pl-k">Int</span>) {
  <span class="pl-k">def</span> <span class="pl-en">thisTakesTime</span>(<span class="pl-v">arr</span>: <span class="pl-en">Array</span>[<span class="pl-k">Int</span>])<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    <span class="pl-k">val</span> <span class="pl-en">dummy</span> <span class="pl-k">=</span> arr.map(_ <span class="pl-k">+</span> <span class="pl-c1">1</span>).reduce(_ <span class="pl-k">+</span> _)
    <span class="pl-en">Thread</span>.sleep(sleepTime)
  }

  <span class="pl-k">def</span> <span class="pl-en">stop</span>() <span class="pl-k">=</span> { 
    <span class="pl-c"><span class="pl-c">//</span> dummy </span>
  }
}</pre>
  </div> 
  <p>You want to compare it's run time against another function, <code>thisTakesLessTime(arr: Array[Int]): Unit</code>, in another class Bar.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">Bar</span>(<span class="pl-v">sleepTime</span>: <span class="pl-k">Int</span>) {
  <span class="pl-k">def</span> <span class="pl-en">thisTakesLessTime</span>(<span class="pl-v">arr</span>: <span class="pl-en">Array</span>[<span class="pl-k">Int</span>]) <span class="pl-k">=</span> {
    <span class="pl-en">Thread</span>.sleep(sleepTime)
  }
}</pre>
  </div> 
  <p>You could write your benchmarks like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">ReadmeExampleBenchmarks</span> <span class="pl-k">extends</span> <span class="pl-e">Benchmarks</span> <span class="pl-k">with</span> <span class="pl-e">ConsoleReport</span> {
  <span class="pl-k">val</span> <span class="pl-en">arraySize</span> <span class="pl-k">=</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>

  benchmark(<span class="pl-s"><span class="pl-pds">"</span>Doing things that take time<span class="pl-pds">"</span></span>) {
    run(<span class="pl-s"><span class="pl-pds">"</span>Taking some time<span class="pl-pds">"</span></span>) {
      <span class="pl-k">new</span> <span class="pl-en">Benchmark</span> {
        <span class="pl-k">var</span> <span class="pl-en">arr</span><span class="pl-k">:</span> <span class="pl-en">Array</span>[<span class="pl-k">Int</span>] <span class="pl-k">=</span> _
        <span class="pl-k">var</span> <span class="pl-en">foo</span><span class="pl-k">:</span> <span class="pl-en">Foo</span> <span class="pl-k">=</span> _
        
        <span class="pl-c"><span class="pl-c">//</span> We want to capture closed over values as vals inside this trait</span>
        <span class="pl-k">val</span> <span class="pl-en">size</span> <span class="pl-k">=</span> arraySize 

        <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">setUp</span>() <span class="pl-k">=</span> {
          <span class="pl-c"><span class="pl-c">//</span> You want to initialize all data through the setUp function.</span>
          <span class="pl-c"><span class="pl-c">//</span> You do not want to be timing the initial setUp logic in "run",</span>
          <span class="pl-c"><span class="pl-c">//</span> and you do not want to have to serialize the initialized data</span>
          <span class="pl-c"><span class="pl-c">//</span> through to the JVM that will be running the benchmark.</span>
          arr <span class="pl-k">=</span> <span class="pl-en">Array</span>.fill(size)(scala.util.<span class="pl-en">Random</span>.nextInt)
          foo <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Foo</span>(<span class="pl-c1">1010</span>)
        }

        <span class="pl-k">def</span> <span class="pl-en">run</span>() <span class="pl-k">=</span> foo.thisTakesTime(arr)

        <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">tearDown</span>() <span class="pl-k">=</span> {
          foo.stop()
        }
      }
    }

    run(<span class="pl-s"><span class="pl-pds">"</span>Taking less time<span class="pl-pds">"</span></span>) {
      <span class="pl-k">new</span> <span class="pl-en">Benchmark</span> {
        <span class="pl-k">var</span> <span class="pl-en">arr</span><span class="pl-k">:</span> <span class="pl-en">Array</span>[<span class="pl-k">Int</span>] <span class="pl-k">=</span> _
        <span class="pl-k">var</span> <span class="pl-en">bar</span><span class="pl-k">:</span> <span class="pl-en">Bar</span> <span class="pl-k">=</span> _
        
        <span class="pl-k">val</span> <span class="pl-en">size</span> <span class="pl-k">=</span> arraySize 

        <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">setUp</span>() <span class="pl-k">=</span> {
          arr <span class="pl-k">=</span> <span class="pl-en">Array</span>.fill(size)(scala.util.<span class="pl-en">Random</span>.nextInt)
          bar <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Bar</span>(<span class="pl-c1">510</span>)
        }

        <span class="pl-k">def</span> <span class="pl-en">run</span>() <span class="pl-k">=</span> bar.thisTakesLessTime(arr)
      }
    }
  }
}</pre>
  </div> 
  <p>Define this in your project's <code>src/test/scala</code> folder, so it will be picked up by the test framework.</p> 
  <p>You can run this benchmark in the examples with:</p> 
  <p><code>&gt; ./sbt "project examples" "test-only scaliper.examples.ReadmeExampleBenchmarks</code></p> 
  <p>To get console output like:</p> 
  <div class="highlight highlight-text-shell-session">
   <pre><span class="pl-c1">[info] ReadmeExampleBenchmarks:</span>
<span class="pl-c1">Running benchmarks for Doing things that take time...</span>
<span class="pl-c1">  1 of 2: Taking some time              1022223792.00 ns; σ=1077518487.04474 ns @ 10 trials</span>
<span class="pl-c1">  2 of 2: Taking less time              510909828.30 ns; σ=538546245.46452 ns @ 10 trials</span>

<span class="pl-c1">  Name                                     s  linear runtime</span>
<span class="pl-c1">  Taking some time                      1.02  =============================</span>
<span class="pl-c1">  Taking less time                      0.51  ==============</span>
<span class="pl-c1">[info] - [scaliper] Doing things that take time</span></pre>
  </div> 
 </article>
</div>