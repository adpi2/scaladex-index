<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-web--mobile-sessions-for-akka-http" class="anchor" href="https://github.com/softwaremill/akka-http-session#web--mobile-sessions-for-akka-http" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Web &amp; mobile sessions for akka-http</h1> 
  <p><a href="https://travis-ci.org/softwaremill/akka-http-session" target="_blank"><img src="https://camo.githubusercontent.com/7f082313641d1b15f7b852b28a0752e628e77c95/68747470733a2f2f7472617669732d63692e6f72672f736f6674776172656d696c6c2f616b6b612d687474702d73657373696f6e2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/softwaremill/akka-http-session.svg?branch=master" style="max-width:100%;"></a> <a href="https://gitter.im/softwaremill/akka-http-session?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/softwaremill/akka-http-session" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/com.softwaremill.akka-http-session/core_2.11" target="_blank"><img src="https://camo.githubusercontent.com/a6890f6536006fa598513bd15392d735bbcb8a8c/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f636f6d2e736f6674776172656d696c6c2e616b6b612d687474702d73657373696f6e2f636f72655f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/com.softwaremill.akka-http-session/core_2.11/badge.svg" style="max-width:100%;"></a> <a href="https://app.updateimpact.com/latest/634276070333485056/akka-http-session" target="_blank"><img src="https://camo.githubusercontent.com/819ec4a566a0d23c0bf68a22259ff5bd395a510e/68747470733a2f2f6170702e757064617465696d706163742e636f6d2f62616467652f3633343237363037303333333438353035362f616b6b612d687474702d73657373696f6e2e7376673f636f6e6669673d636f6d70696c65" alt="Dependencies" data-canonical-src="https://app.updateimpact.com/badge/634276070333485056/akka-http-session.svg?config=compile" style="max-width:100%;"></a></p> 
  <p><a href="http://doc.akka.io/docs/akka/2.4.2/scala/http/index.html" target="_blank">akka-http</a> is an Akka module, originating from <a href="http://spray.io" target="_blank">spray.io</a>, for building <em>reactive</em> REST services with an elegant DSL.</p> 
  <p><code>akka-http</code> is a great toolkit for building backends for single-page or mobile applications. In almost all apps there is a need to maintain user sessions, make sure session data is secure and cannot be tampered with.</p> 
  <p><code>akka-http-session</code> provides directives for client-side session management in web and mobile applications, using cookies or custom headers + local storage, with optional <a href="http://jwt.io/" target="_blank">Json Web Tokens</a> format support. </p> 
  <h2><a id="user-content-what-is-a-session" class="anchor" href="https://github.com/softwaremill/akka-http-session#what-is-a-session" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What is a session?</h2> 
  <p>Session data typically contains at least the id or username of the logged in user. This id must be secured so that a session cannot be "stolen" or forged easily.</p> 
  <p>Sessions can be stored on the server, either in-memory or in a database, with the session id sent to the client, or entirely on the client in a serialized format. The former approach requires sticky sessions or additional shared storage, while using the latter (which is supported by this library) sessions can be easily deserialized on any server.</p> 
  <p>A session is a string token which is sent to the client and should be sent back to the server on every request.</p> 
  <p>To prevent forging, serialized session data is <strong>signed</strong> using a server secret. The signature is appended to the session data that is sent to the client, and verified when the session token is received back.</p> 
  <h2><a id="user-content-akka-http-session-features" class="anchor" href="https://github.com/softwaremill/akka-http-session#akka-http-session-features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><code>akka-http-session</code> features</h2> 
  <ul> 
   <li>type-safe client-side sessions</li> 
   <li>sessions can be encrypted</li> 
   <li>sessions contain an expiry date</li> 
   <li>cookie or custom header transport</li> 
   <li>support for <a href="http://jwt.io/" target="_blank">JWT</a></li> 
   <li>refresh token support (e.g. to implement "remember me")</li> 
   <li>CSRF tokens support</li> 
  </ul> 
  <h2><a id="user-content-example" class="anchor" href="https://github.com/softwaremill/akka-http-session#example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.http.scaladsl.server.Directives.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.</span>{<span class="pl-v">SessionConfig</span>, <span class="pl-v">SessionManager</span>}
<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.SessionDirectives.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.SessionOptions.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">sessionConfig</span> <span class="pl-k">=</span> <span class="pl-en">SessionConfig</span>.default(<span class="pl-s"><span class="pl-pds">"</span>some_very_long_secret_and_random_string_some_very_long_secret_and_random_string<span class="pl-pds">"</span></span>)
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">sessionManager</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SessionManager</span>[<span class="pl-k">Long</span>](sessionConfig)

path(<span class="pl-s"><span class="pl-pds">"</span>login<span class="pl-pds">"</span></span>) {
  post {
    entity(as[<span class="pl-k">String</span>]) { body <span class="pl-k">=&gt;</span>
      setSession(oneOff, usingCookies, <span class="pl-c1">812832L</span>) { ctx <span class="pl-k">=&gt;</span>
        ctx.complete(<span class="pl-s"><span class="pl-pds">"</span>ok<span class="pl-pds">"</span></span>)
      }
    }
  }
} <span class="pl-k">~</span>
path(<span class="pl-s"><span class="pl-pds">"</span>secret<span class="pl-pds">"</span></span>) {
  get {
    requiredSession(oneOff, usingCookies) { session <span class="pl-k">=&gt;</span> <span class="pl-c"><span class="pl-c">//</span> type: Long, or whatever the T parameter is</span>
      complete { <span class="pl-s"><span class="pl-pds">"</span>treasure<span class="pl-pds">"</span></span> }
    }
  }
} <span class="pl-k">~</span>
path(<span class="pl-s"><span class="pl-pds">"</span>logout<span class="pl-pds">"</span></span>) {
  get {
    invalidateSession(oneOff, usingCookies) {
      complete { <span class="pl-s"><span class="pl-pds">"</span>logged out<span class="pl-pds">"</span></span> }
    }
  }
}</pre>
  </div> 
  <p>You can try out a simple example by running <code>com.softwaremill.example.Example</code> in the <code>example</code> project and opening <a href="http://localhost:8080" target="_blank">http://localhost:8080</a>, or you can just take a look <a href="https://github.com/softwaremill/akka-http-session/blob/master/example/src/main/scala/com/softwaremill/example/Example.scala" target="_blank">at the source</a>.</p> 
  <h2><a id="user-content-sessionmanager--configuration" class="anchor" href="https://github.com/softwaremill/akka-http-session#sessionmanager--configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><code>SessionManager</code> &amp; configuration</h2> 
  <p>All directives require an implicit instance of a <code>SessionManager[T]</code>, which can be created by providing a server secret (via a <code>SessionConfig</code>). The secret should be a long, random string unique to each environment your app is running in. You can generate one with <code>SessionUtil.randomServerSecret()</code>. Note that when you change the secret, all sessions will become invalid.</p> 
  <p>A <code>SessionConfig</code> instance can be created using <a href="https://github.com/typesafehub/config" target="_blank">Typesafe config</a>, The only value that you need to provide is <code>akka.http.session.server-secret</code>, preferably via <code>application.conf</code> (then you can safely call <code>SessionConfig.fromConfig</code>) or by using <code>SessionConfig.default()</code>.</p> 
  <p>You can customize any of the <a href="https://github.com/softwaremill/akka-http-session/blob/master/core/src/main/resources/reference.conf" target="_blank">default config options</a> either by modifying them through <code>application.conf</code> or by modifying the <code>SessionConfig</code> case class. If a value has type <code>Option[]</code>, you can set it to <code>None</code> by using a <code>none</code> value in the config file.</p> 
  <p>When using cookies, by default the <code>secure</code> attribute of cookies is not set (for development), however it is recommended that all sites use <code>https</code> and all cookies have this attribute set. </p> 
  <h2><a id="user-content-client-side-sessions" class="anchor" href="https://github.com/softwaremill/akka-http-session#client-side-sessions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Client-side sessions</h2> 
  <p>All session-related directives take at least two parameters:</p> 
  <ul> 
   <li>session continuity: <code>oneOff</code> vs <code>refreshable</code>; specifies what should happen when the session expires. If <code>refreshable</code> and a refresh token is present, the session will be re-created. See below for details.</li> 
   <li>session transport: <code>usingCookies</code> vs <code>usingHeaders</code></li> 
  </ul> 
  <p>Typically, you would create aliases for the session-related directives which use the right parameters basing on the current request and logic specific to your application.</p> 
  <h3><a id="user-content-cookies-vs-header" class="anchor" href="https://github.com/softwaremill/akka-http-session#cookies-vs-header" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Cookies vs header</h3> 
  <p>Session data can be sent to the client using cookies or custom headers. The first approach is the simplest to use, as cookies are automatically sent to the server on each request. </p> 
  <p>However, cookies have some security vulnerabilities, and are typically not used in mobile applications. For these scenarios, session data can be transported using custom headers (the names of the headers are configurable in the config).</p> 
  <p>When using headers, you need to store the session (and, if used, refresh-) tokens yourself. These tokens can be stored in-memory, or persistently e.g. using the browser's local storage.</p> 
  <p>You can dynamically decide which transport to use, basing e.g. on the user-agent or other request properties.</p> 
  <h3><a id="user-content-basic-usage" class="anchor" href="https://github.com/softwaremill/akka-http-session#basic-usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Basic usage</h3> 
  <p>Sessions are typed; the <code>T</code> type parameter in <code>SessionManager[T]</code> determines what data is stored in the session. Basic types like <code>String</code>, <code>Int</code>, <code>Long</code>, <code>Float</code>, <code>Double</code> and <code>Map[String, String]</code> are supported out-of-the box. Support for other types can be added by providing an implicit <code>SessionSerializer[T, String]</code>. For case classes, it's most convenient to use a <code>MultiValueSessionSerializer[T]</code> which should convert the instance into a <code>String -&gt; String</code> map (nested types are not supported on purpose, as session data should be small &amp; simple).</p> 
  <p>Here we are creating a manager where the session content will be a single <code>Long</code> number:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.</span>{<span class="pl-v">SessionConfig</span>, <span class="pl-v">SessionManager</span>}

<span class="pl-k">val</span> <span class="pl-en">sessionConfig</span> <span class="pl-k">=</span> <span class="pl-en">SessionConfig</span>.default(<span class="pl-s"><span class="pl-pds">"</span>some_very_long_secret_and_random_string_some_very_long_secret_and_random_string<span class="pl-pds">"</span></span>)
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">sessionManager</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SessionManager</span>[<span class="pl-k">Long</span>](sessionConfig)</pre>
  </div> 
  <p>The basic directives enable you to set, read and invalidate the session. To create a new client-side session (create and set a new session cookie), you need to use the <code>setSession</code> directive:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.http.scaladsl.server.Directives.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.SessionDirectives.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.SessionOptions.</span><span class="pl-v">_</span>

path(<span class="pl-s"><span class="pl-pds">"</span>login<span class="pl-pds">"</span></span>) {
  post {
    entity(as[<span class="pl-k">String</span>]) { body <span class="pl-k">=&gt;</span>
      setSession(oneOff, usingCookies, <span class="pl-c1">812832L</span>) { ctx <span class="pl-k">=&gt;</span>
        ctx.complete(<span class="pl-s"><span class="pl-pds">"</span>ok<span class="pl-pds">"</span></span>)
      }
    }
  }
}</pre>
  </div> 
  <p>Note that when using cookies, their size is limited to 4KB, so you shouldn't put too much data in there (the signature takes about 50 characters). </p> 
  <p>You can require a session to be present, optionally require a session or get a full description of possible session decode outcomes:</p> 
  <div class="highlight highlight-source-scala">
   <pre>path(<span class="pl-s"><span class="pl-pds">"</span>secret<span class="pl-pds">"</span></span>) {
  get {
    requiredSession(oneOff, usingCookies) { session <span class="pl-k">=&gt;</span> <span class="pl-c"><span class="pl-c">//</span> type: Long, or whatever the T parameter is</span>
      complete { <span class="pl-s"><span class="pl-pds">"</span>treasure<span class="pl-pds">"</span></span> }
    }
  }
} <span class="pl-k">~</span>
path(<span class="pl-s"><span class="pl-pds">"</span>open<span class="pl-pds">"</span></span>) {
  get {
    optionalSession(oneOff, usingCookies) { session <span class="pl-k">=&gt;</span> <span class="pl-c"><span class="pl-c">//</span> type: Option[Long] (Option[T])</span>
      complete { <span class="pl-s"><span class="pl-pds">"</span>small treasure<span class="pl-pds">"</span></span> }
    }
  }
} <span class="pl-k">~</span>
path(<span class="pl-s"><span class="pl-pds">"</span>detail<span class="pl-pds">"</span></span>) {
  get {
    <span class="pl-c"><span class="pl-c">//</span> type: SessionResult[Long] (SessionResult[T])</span>
    <span class="pl-c"><span class="pl-c">//</span> which can be: Decoded, CreatedFromToken, Expired, Corrupt, NoSession</span>
    session(oneOff, usingCookies) { session <span class="pl-k">=&gt;</span> 
      complete { <span class="pl-s"><span class="pl-pds">"</span>small treasure<span class="pl-pds">"</span></span> }
    }
  }
}</pre>
  </div> 
  <p>If a required session is not present, by default a 403 is returned. Finally, a session can be invalidated:</p> 
  <div class="highlight highlight-source-scala">
   <pre>path(<span class="pl-s"><span class="pl-pds">"</span>logout<span class="pl-pds">"</span></span>) {
  get {
    requiredSession(oneOff, usingCookies) { session <span class="pl-k">=&gt;</span> 
      invalidateSession(oneOff, usingCookies) {
        complete { <span class="pl-s"><span class="pl-pds">"</span>logged out<span class="pl-pds">"</span></span> }
      }
    }
  }
}</pre>
  </div> 
  <h3><a id="user-content-encrypting-the-session" class="anchor" href="https://github.com/softwaremill/akka-http-session#encrypting-the-session" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Encrypting the session</h3> 
  <p>It is possible to encrypt the session data by modifying the <code>akka.http.session.encrypt-data</code> config option. When sessions are encrypted, it's not possible to read their content on the client side.</p> 
  <p>The key used for encrypting will be calculated basing on the server secret.</p> 
  <h3><a id="user-content-session-expirytimeout" class="anchor" href="https://github.com/softwaremill/akka-http-session#session-expirytimeout" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Session expiry/timeout</h3> 
  <p>By default, sessions expire after a week. This can be disabled or changed with the <code>akka.http.session.max-age</code> config option.</p> 
  <p>Note that when using cookies, even though the cookie sent will be a session cookie, it is possible that the client will have the browser open for a very long time, <a href="http://stackoverflow.com/questions/10617954/chrome-doesnt-delete-session-cookies" target="_blank">uses Chrome or FF</a>, or if an attacker steals the cookie, it can be re-used. Hence having an expiry date for sessions is highly recommended.</p> 
  <h2><a id="user-content-jwt-encoding-sessions" class="anchor" href="https://github.com/softwaremill/akka-http-session#jwt-encoding-sessions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>JWT: encoding sessions</h2> 
  <p>By default, sessions are encoded into a string using a custom format, where expiry/data/signature parts are separated using <code>-</code>, and data fields are separated using <code>=</code> and url-encoded.</p> 
  <p>You can also encode sessions in the <a href="http://jwt.io" target="_blank">Json Web Tokens</a> format, by adding the additional <code>jwt</code> dependency, which makes use of <a href="http://json4s.org" target="_blank"><code>json4s</code></a>.</p> 
  <p>To use JWT, you need to create an implicit session encoder before creating a session manager:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">SessionData</span>(...)

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">serializer</span> <span class="pl-k">=</span> <span class="pl-en">JValueSessionSerializer</span>.caseClass[<span class="pl-en">SessionData</span>]
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">encoder</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">JwtSessionEncoder</span>[<span class="pl-en">SessionData</span>]
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">manager</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SessionManager</span>(<span class="pl-en">SessionConfig</span>.fromConfig())</pre>
  </div> 
  <p>When using JWT, you need to provide a serializer which serializes session data to a <code>JValue</code> instead of a <code>String</code>. A number of implicit serializers for the basic types are present in <code>JValueSessionSerializer</code>, as well as a generic serializer for case classes (used above).</p> 
  <p>There are many tools available to read JWT session data using various platforms, e.g. <a href="https://github.com/auth0/angular-jwt" target="_blank">for Angular</a>.</p> 
  <p>It is also possible to customize the session data content generated by overriding appropriate methods in <code>JwtSessionEncoder</code> (e.g. provide additional claims in the payload).</p> 
  <h2><a id="user-content-csrf-protection-cookie-transport-only" class="anchor" href="https://github.com/softwaremill/akka-http-session#csrf-protection-cookie-transport-only" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>CSRF protection (cookie transport only)</h2> 
  <p>CSRF is an attack where an attacker issues a <code>GET</code> or <code>POST</code> request on behalf of a user, if the user e.g. clicks on a specially constructed link. See the <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet" target="_blank">OWASP page</a> or the <a href="https://www.playframework.com/documentation/2.2.x/JavaCsrf" target="_blank">Play! docs</a> for a thorough introduction.</p> 
  <p>Web apps which use cookies for session management should be protected against CSRF attacks. This implementation:</p> 
  <ul> 
   <li>assumes that <code>GET</code> requests are non-mutating (have no side effects)</li> 
   <li>uses double-submit cookies to verify requests</li> 
   <li>requires the token to be set in a custom header or (optionally) in a form field</li> 
   <li>generates a new token on the first <code>GET</code> request that doesn't have the token cookie set</li> 
  </ul> 
  <p>Note that if the token is passed in a form field, the website isn't protected by HTTPS or you don't control all subdomains, this scheme <a href="http://security.stackexchange.com/questions/59470/double-submit-cookies-vulnerabilities/61039#61039" target="_blank">can be broken</a>. Currently, setting a custom header seems to be a secure solution, and is what a number of projects do (that's why, when using custom headers to send session data, no additional protection is needed).</p> 
  <p>It is recommended to generate a new CSRF token after logging in, see <a href="http://security.stackexchange.com/questions/22903/why-refresh-csrf-token-per-form-request" target="_blank">this SO question</a>. A new token can be generated using the <code>setNewCsrfToken</code> directive.</p> 
  <p>By default the name of the CSRF cookie and the custom header matches what <a href="https://docs.angularjs.org/api/ng/service/$http" target="_blank">AngularJS expects and sets</a>. These can be customized in the config.</p> 
  <p>Example usage:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">akka.http.scaladsl.server.Directives.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.CsrfDirectives.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.softwaremill.session.CsrfOptions.</span><span class="pl-v">_</span>

randomTokenCsrfProtection(checkHeader) {
  get(<span class="pl-s"><span class="pl-pds">"</span>site<span class="pl-pds">"</span></span>) {
    <span class="pl-c"><span class="pl-c">//</span> read from disk</span>
  } <span class="pl-k">~</span>
  post(<span class="pl-s"><span class="pl-pds">"</span>transfer_money<span class="pl-pds">"</span></span>) {
    <span class="pl-c"><span class="pl-c">//</span> token already checked</span>
  }
}</pre>
  </div> 
  <h2><a id="user-content-refresh-tokens-remember-me" class="anchor" href="https://github.com/softwaremill/akka-http-session#refresh-tokens-remember-me" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Refresh tokens ("remember me")</h2> 
  <p>If you'd like to implement persistent, "remember-me" sessions, you should use <code>refreshable</code> instead of <code>oneOff</code> sessions. This is especially useful in mobile applications, where you log in once, and the session is remembered for a long time. Make sure to adjust the <code>akka.http.session.refresh-token.max-age</code> config option appropriately (defaults to 1 month)!</p> 
  <p>You can dynamically decide, basing on the request properties (e.g. a query parameter), if a session should be refreshable or not. Just pass the right parameter to <code>setSession</code>.</p> 
  <p>When using refreshable sessions, in addition to an implicit <code>SessionManager</code> instance, you need to provide an implementation of the <code>RefreshTokenStorage</code> trait. This trait has methods to lookup, store and delete refresh tokens. Typically it would use some persistent storage.</p> 
  <p>The tokens are never stored directly, instead only token hashes are passed to the storage. That way even if the token database is leaked, it won't be possible to forge sessions using the hashes. Moreover, in addition to the token hash, a selector value is stored. That value is used to lookup stored hashes; tokens are compared using using a special constant-time comparison method, to prevent timing attacks.</p> 
  <p>When a session expires or is not present, but the refresh token is (sent from the client using either a cookie, or a custom header), a new session will be created (using the <code>RefreshTokenLookupResult.createSession</code> function), and a new refresh token will be created.</p> 
  <p>Note that you can differentiate between sessions created from refresh tokens and from regular authentication by storing appropriate information in the session data. That way, you can force the user to re-authenticate if the session was created by a refresh token before crucial operations.</p> 
  <p>It is of course possible to read <code>oneOff</code>-session using <code>requiredSession(refreshable, ...)</code>. If a session was created as <code>oneOff</code>, using <code>refreshable</code> has no additional effect.</p> 
  <h3><a id="user-content-touching-sessions" class="anchor" href="https://github.com/softwaremill/akka-http-session#touching-sessions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Touching sessions</h3> 
  <p>The semantics of <code>touch[Required|Optional]Session()</code> are a bit subtle. You can still use expiring client sessions when using refresh tokens. You will then have 2 stages of expiration: expiration of the client session (should be shorter), and expiry of the refresh token. That way you can have strongly-authenticated sessions which expire fast, and weaker-authenticated re-creatable sessions (as described in the paragraph above).</p> 
  <p>When touching an existing session, the refresh token will not be re-generated and extended, only the session cookie.</p> 
  <h2><a id="user-content-links" class="anchor" href="https://github.com/softwaremill/akka-http-session#links" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Links</h2> 
  <ul> 
   <li><a href="https://github.com/softwaremill/bootzooka" target="_blank">Bootzooka</a>, a web application template project using <code>akka-http</code> and <code>akka-http-session</code></li> 
   <li><a href="https://github.com/gnieh/spray-session" target="_blank">Spray session</a>, similar project for spray.io</li> 
   <li><a href="https://github.com/enetsee/Spray-SPA" target="_blank">Spray SPA</a>, a single-page-application demo built using spray.io, also containing an implementation of client-side sessions</li> 
   <li><a href="https://playframework.com" target="_blank">Play framework</a>, a full web framework, from which parts of the session encoding/decoding code was taken</li> 
   <li><a href="http://guides.rubyonrails.org/security.html#session-storage" target="_blank">Rails security guide</a>, a description of how sessions are stored in Rails</li> 
   <li><a href="https://github.com/akka/akka/issues/16855" target="_blank">Akka issue 16855</a> for implementing similar functionality straight in Akka</li> 
   <li><a href="https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence#title.2" target="_blank">Implementing remember me</a></li> 
   <li><a href="http://stackoverflow.com/questions/549/the-definitive-guide-to-form-based-website-authentication" target="_blank">The definitive guide to form-based website authorization</a></li> 
   <li><a href="https://scotch.io/tutorials/the-anatomy-of-a-json-web-token" target="_blank">The Anatomy of a JSON Web Token</a></li> 
   <li><a href="https://auth0.com/blog/2014/01/07/angularjs-authentication-with-cookies-vs-token/" target="_blank">Cookies vs tokens</a></li> 
  </ul> 
  <h2><a id="user-content-using-from-sbt" class="anchor" href="https://github.com/softwaremill/akka-http-session#using-from-sbt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using from SBT</h2> 
  <p>For <code>akka</code> version <code>2.4.11</code>, <code>akka-http</code> version <code>10.0.0</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.softwaremill.akka-http-session<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>core<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.3.0<span class="pl-pds">"</span></span>
libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.softwaremill.akka-http-session<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>jwt<span class="pl-pds">"</span></span>  <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.3.0<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span> optional</span></pre>
  </div> 
 </article>
</div>