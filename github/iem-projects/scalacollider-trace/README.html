<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-scalacollider-trace" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#scalacollider-trace" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ScalaCollider-Trace</h1> 
  <p><a href="https://travis-ci.org/iem-projects/ScalaCollider-Trace" target="_blank"><img src="https://camo.githubusercontent.com/31ce3256d5d62bbb20758daf4b7db355f2fd357d/68747470733a2f2f7472617669732d63692e6f72672f69656d2d70726f6a656374732f5363616c61436f6c6c696465722d54726163652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/iem-projects/ScalaCollider-Trace.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/at.iem/scalacollider-trace_2.11" target="_blank"><img src="https://camo.githubusercontent.com/b76a82b10a0fd767bb0b6a42339b8a9c0fe89794/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f61742e69656d2f7363616c61636f6c6c696465722d74726163655f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/at.iem/scalacollider-trace_2.11/badge.svg" style="max-width:100%;"></a></p> 
  <p>A library for <a href="https://github.com/Sciss/ScalaCollider" target="_blank">ScalaCollider</a> to aids in debugging synth graphs by providing abstractions that monitor the values of UGens graph. This project is (C)opyright 2016 by the Institute of Electronic Music and Acoustics (IEM), Graz. Written by Hanns Holger Rutz. This software is published under the GNU Lesser General Public License v2.1+.</p> 
  <h2><a id="user-content-linking" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#linking" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>linking</h2> 
  <p>The following artifact is available from Maven Central:</p> 
  <pre><code>"at.iem" %% "scalacollider-trace" % v
</code></pre> 
  <p>The current stable version <code>v</code> is <code>"0.2.0"</code>.</p> 
  <h2><a id="user-content-building" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#building" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>building</h2> 
  <p>This project builds with sbt 0.13 and Scala 2.11, 2.10. To compile <code>sbt test:compile</code>. To print the test output, <code>sbt test:run</code>.</p> 
  <h2><a id="user-content-contributing" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#contributing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>contributing</h2> 
  <p>Please see the file <a href="https://github.com/iem-projects/scalacollider-trace/blob/master/CONTRIBUTING.md" target="_blank">CONTRIBUTING.md</a></p> 
  <h2><a id="user-content-documentation" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#documentation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>documentation</h2> 
  <p>We introduce a new graph element <code>Trace</code> that explicitly enables the tracing of an input signal, associated with a label:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Trace</span>(in, label <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>For this to work, we require a specific UGen graph builder that extends <code>TracingUGenGraphBuilder</code>. All <code>Trace</code> instances participating are receiving offsets to a debugging bus (or two debugging buses, one for control rate signals and one for audio rate signals). The builder's companion object has a specific build function that not only expands a UGen graph but also returns a debugging object that encapsulates the knowledge of the tracing instances. This object can then be used to issue recordings of the values. A separate GUI display component is available for then browsing the recorded data.</p> 
  <p>Example:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">de.sciss.synth.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">ugen.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">trace.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">trace.ugen.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">TraceOps.</span><span class="pl-v">_</span>

<span class="pl-en">Server</span>.run() { s <span class="pl-k">=&gt;</span>
  <span class="pl-k">import</span> <span class="pl-v">s.clientConfig.</span><span class="pl-v">executionContext</span>

  <span class="pl-k">val</span> <span class="pl-en">x</span> <span class="pl-k">=</span> tracePlay {
    <span class="pl-k">val</span> <span class="pl-en">n</span> <span class="pl-k">=</span> <span class="pl-en">WhiteNoise</span>.ar
    <span class="pl-en">Trace</span>(n, <span class="pl-s"><span class="pl-pds">"</span>noise<span class="pl-pds">"</span></span>)
    <span class="pl-en">Pan2</span>.ar(n)
  }

  <span class="pl-k">val</span> <span class="pl-en">fut</span> <span class="pl-k">=</span> x.traceFor(numFrames <span class="pl-k">=</span> <span class="pl-c1">8</span>)
  fut.foreach { traces <span class="pl-k">=&gt;</span>
    traces.foreach(_.print())
  }
}</pre>
  </div> 
  <p>Here, <code>tracePlay</code> returns an enhanced <code>Synth</code>, more precisely <code>TraceSynth</code> that encapsulates the running runs as well as the debug traces and buses. <code>traceFor</code> returns a future to the data objects containing the trace. The type is <code>List[Data]</code>, containing one <code>Data</code> instance for control-rate and one for audio-rate traces (if any of these rates are used). The <code>Trace</code> graph element automatically uses the rate of its input argument.</p> 
  <p>The <code>print</code> method on <code>Data</code> is a convenience method for creating a nicely formatted text, a short cut for <code>println(mkString)</code>. A possible output from the above example is:</p> 
  <pre><code>-------------------------
audio-rate data: 8 frames
-------------------------
noise    :      -0.00180101     -0.266668      0.0157881      0.00469923     -0.880886     -0.242413      0.812972     -0.205941
</code></pre> 
  <h3><a id="user-content-synchronous-trace-start" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#synchronous-trace-start" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Synchronous trace start</h3> 
  <p>In order to start playing and tracing synchronously, one can use <code>traceGraph</code> to build the enhanced graph-function (<code>TraceGraphFunction</code>), and then use <code>traceFor</code> in a similar way:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">x</span> <span class="pl-k">=</span> traceGraph {
  <span class="pl-en">RandSeed</span>.ir
  <span class="pl-k">val</span> <span class="pl-en">n</span> <span class="pl-k">=</span> <span class="pl-en">WhiteNoise</span>.ar
  <span class="pl-en">Trace</span>(n, <span class="pl-s"><span class="pl-pds">"</span>noise<span class="pl-pds">"</span></span>)
  <span class="pl-en">Pan2</span>.ar(n)
}

<span class="pl-k">val</span> <span class="pl-en">fut</span> <span class="pl-k">=</span> x.traceFor(numFrames <span class="pl-k">=</span> <span class="pl-c1">8</span>)
fut.foreach { traces <span class="pl-k">=&gt;</span>
  traces.foreach(_.print())
}</pre>
  </div> 
  <p>This variant frees the synth automatically after the trace has been recorded. The correct output here would be:</p> 
  <pre><code>-------------------------
audio-rate data: 8 frames
-------------------------
noise    :      -0.0793402      0.608976     -0.491325      0.387161     -0.563370      0.307421      0.290958      0.928846
</code></pre> 
  <h3><a id="user-content-control-rate-traces" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#control-rate-traces" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Control rate traces</h3> 
  <p>Here is an example for control rate debugging:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">y</span> <span class="pl-k">=</span> tracePlay {
  <span class="pl-k">val</span> <span class="pl-en">tr</span>    <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>trig<span class="pl-pds">"</span></span>.tr
  <span class="pl-k">val</span> <span class="pl-en">count</span> <span class="pl-k">=</span> <span class="pl-en">PulseCount</span>.kr(tr)
  <span class="pl-en">Trace</span>(count, <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>)
  <span class="pl-k">val</span> <span class="pl-en">sweep</span> <span class="pl-k">=</span> <span class="pl-en">Sweep</span>.kr(tr, <span class="pl-c1">1</span>)
  <span class="pl-en">Trace</span>(sweep, <span class="pl-s"><span class="pl-pds">"</span>sweep<span class="pl-pds">"</span></span>)
}

y.set(<span class="pl-s"><span class="pl-pds">"</span>trig<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)

y.set(<span class="pl-s"><span class="pl-pds">"</span>trig<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)

y.traceFor(numBlocks <span class="pl-k">=</span> <span class="pl-c1">2</span>).foreach { traces <span class="pl-k">=&gt;</span>
  traces.foreach(_.print())
}</pre>
  </div> 
  <p>With an example output:</p> 
  <pre><code>---------------------------
control-rate data: 2 frames
---------------------------
count    :       2.00000        2.00000  
sweep    :       3.25224        3.25370  
</code></pre> 
  <h3><a id="user-content-auxiliary-infra-structure-with-bundle-builder" class="anchor" href="https://github.com/iem-projects/scalacollider-trace#auxiliary-infra-structure-with-bundle-builder" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Auxiliary infra-structure with bundle-builder</h3> 
  <p>If you need to feed external synchronized input to the synth, one way to do so is using the <code>bundle</code> argument of type <code>BundleBuilder</code>. It allows to add asynchronous preparation messages as well as the add synchronous messages (such as <code>synth.newMsg</code> or <code>node.setMsg</code>) to the start or to the end of the overall bundle that is generated by the tracing commands.</p> 
  <p>The following more intricate example shows how a timed control signal can be fed into the synth that is being traced, using an auxiliary group, an auxiliary control generator synth, and a bus mapping:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">x</span> <span class="pl-k">=</span> traceGraph {
  <span class="pl-k">val</span> <span class="pl-en">in</span>  <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>in<span class="pl-pds">"</span></span>.kr
  <span class="pl-k">val</span> <span class="pl-en">sig</span> <span class="pl-k">=</span> <span class="pl-en">Integrator</span>.kr(in)
  <span class="pl-en">Trace</span>(sig, <span class="pl-s"><span class="pl-pds">"</span>integ<span class="pl-pds">"</span></span>)
}

<span class="pl-k">val</span> <span class="pl-en">c</span> <span class="pl-k">=</span> <span class="pl-en">Bus</span>.control(s)
<span class="pl-k">val</span> <span class="pl-en">g</span> <span class="pl-k">=</span> <span class="pl-en">Group</span>.head(s)

<span class="pl-k">val</span> <span class="pl-en">genDef</span> <span class="pl-k">=</span> <span class="pl-en">SynthDef</span>(<span class="pl-s"><span class="pl-pds">"</span>gen<span class="pl-pds">"</span></span>) {
  <span class="pl-k">val</span> <span class="pl-en">sig</span> <span class="pl-k">=</span> <span class="pl-en">Phasor</span>.kr(lo <span class="pl-k">=</span> <span class="pl-c1">0</span>, hi <span class="pl-k">=</span> <span class="pl-c1">5</span>)
  <span class="pl-en">Out</span>.kr(c.index, sig)
}

<span class="pl-k">val</span> <span class="pl-en">gen</span> <span class="pl-k">=</span> <span class="pl-en">Synth</span>(s)

<span class="pl-k">val</span> <span class="pl-en">b</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BundleBuilder</span>
b.addAsync(genDef.recvMsg)
b.addSyncToStart(gen.newMsg(genDef.name, target <span class="pl-k">=</span> g, addAction <span class="pl-k">=</span> addToHead))
b.addSyncToEnd(g.mapMsg(<span class="pl-s"><span class="pl-pds">"</span>in<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> c.index))

<span class="pl-k">val</span> <span class="pl-en">fut</span> <span class="pl-k">=</span> x.traceFor(target <span class="pl-k">=</span> g, addAction <span class="pl-k">=</span> addToTail, numBlocks <span class="pl-k">=</span> <span class="pl-c1">5</span>, bundle <span class="pl-k">=</span> b)
fut.foreach { traces <span class="pl-k">=&gt;</span>
  traces.foreach(_.print())
  c.free()
}</pre>
  </div> 
  <p>The output from this:</p> 
  <pre><code>---------------------------
control-rate data: 5 frames
---------------------------
integ    :     0.00000      1.00000      3.00000      6.00000     10.00000  
</code></pre> 
 </article>
</div>