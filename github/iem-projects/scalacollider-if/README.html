<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/iem-projects/scalacollider-if#scalacollider-if" aria-hidden="true" class="anchor" id="user-content-scalacollider-if" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>ScalaCollider-If</h1> 
  <p><a href="https://travis-ci.org/iem-projects/ScalaCollider-If" target="_blank"><img src="https://camo.githubusercontent.com/ad50a89b1793c947d99ce2f4153d38f284cfd64d/68747470733a2f2f7472617669732d63692e6f72672f69656d2d70726f6a656374732f5363616c61436f6c6c696465722d49662e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/iem-projects/ScalaCollider-If.svg?branch=master" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/at.iem/scalacollider-if_2.11" target="_blank"><img src="https://camo.githubusercontent.com/ffff38931429abab1d3bf43abe2a042cb8d03e58/68747470733a2f2f6d6176656e2d6261646765732e6865726f6b756170702e636f6d2f6d6176656e2d63656e7472616c2f61742e69656d2f7363616c61636f6c6c696465722d69665f322e31312f62616467652e737667" alt="Maven Central" data-canonical-src="https://maven-badges.herokuapp.com/maven-central/at.iem/scalacollider-if_2.11/badge.svg" style="max-width:100%;"></a></p> 
  <p>A set of additional graph elements for <a href="https://github.com/Sciss/ScalaCollider" target="_blank">ScalaCollider</a>, allowing the nesting of a graph in a resource efficient manner, by pausing the inactive branches. This is facilitated by a new nested UGen graph builder that, unlike the standard builder, creates an entire tree of UGen graphs to which the conditional branches are decomposed. This project is (C)opyright 2016â€“2017 by the Institute of Electronic Music and Acoustics (IEM), Graz. Written by Hanns Holger Rutz. This software is published under the GNU Lesser General Public License v2.1+.</p> 
  <h2><a href="https://github.com/iem-projects/scalacollider-if#linking" aria-hidden="true" class="anchor" id="user-content-linking" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>linking</h2> 
  <p>The following artifact is available from Maven Central:</p> 
  <pre><code>"at.iem" %% "scalacollider-if" % v
</code></pre> 
  <p>The current stable version <code>v</code> is <code>"0.3.1"</code>.</p> 
  <h2><a href="https://github.com/iem-projects/scalacollider-if#building" aria-hidden="true" class="anchor" id="user-content-building" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>building</h2> 
  <p>This project builds with sbt 0.13 and Scala 2.12, 2.11, 2.10. To compile <code>sbt test:compile</code>. To print the test output, <code>sbt test:run</code>.</p> 
  <h2><a href="https://github.com/iem-projects/scalacollider-if#contributing" aria-hidden="true" class="anchor" id="user-content-contributing" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>contributing</h2> 
  <p>Please see the file <a href="https://github.com/iem-projects/scalacollider-if/blob/master/CONTRIBUTING.md" target="_blank">CONTRIBUTING.md</a></p> 
  <h2><a href="https://github.com/iem-projects/scalacollider-if#examples" aria-hidden="true" class="anchor" id="user-content-examples" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>examples</h2> 
  <p>A "side-effecting" block does not produce a dedicated return signal but is used for UGens that have side effects. For example:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> ---- Unit result ----</span>

<span class="pl-en">If</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">100</span>) <span class="pl-en">Then</span> {
  <span class="pl-en">Out</span>.ar(<span class="pl-c1">0</span>, <span class="pl-en">SinOsc</span>.ar(freq))
}

<span class="pl-en">If</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">100</span>) <span class="pl-en">Then</span> {
  <span class="pl-en">Out</span>.ar(<span class="pl-c1">0</span>, <span class="pl-en">SinOsc</span>.ar(freq))
} <span class="pl-en">Else</span> {
  freq.poll(<span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">"</span>freq<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <p>A block where each case evaluates to a sub-type of <code>GE</code> produces a dedicated return signal that can then be further processed. For example:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> ---- GE result ----</span>

<span class="pl-k">val</span> <span class="pl-en">res</span><span class="pl-k">:</span> <span class="pl-en">GE</span> <span class="pl-k">=</span> <span class="pl-en">If</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">100</span>) <span class="pl-en">Then</span> {
  <span class="pl-en">SinOsc</span>.ar(freq)
} <span class="pl-en">Else</span> {
  <span class="pl-en">WhiteNoise</span>.ar
}
<span class="pl-en">Out</span>.ar(<span class="pl-c1">0</span>, res)

<span class="pl-k">val</span> <span class="pl-en">res</span><span class="pl-k">:</span> <span class="pl-en">GE</span> <span class="pl-k">=</span> <span class="pl-en">If</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">1000</span>) <span class="pl-en">Then</span> {
  <span class="pl-en">SinOsc</span>.ar(freq)
} <span class="pl-en">ElseIf</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">100</span>) <span class="pl-en">Then</span> {
  <span class="pl-en">Dust</span>.ar(freq)
} <span class="pl-en">Else</span> {
  <span class="pl-en">WhiteNoise</span>.ar
}
<span class="pl-en">Out</span>.ar(<span class="pl-c1">0</span>, res <span class="pl-k">*</span> <span class="pl-c1">0.5</span>)</pre>
  </div> 
  <p>If a branch refers to UGens from the outer scope, for example the <code>freq</code> element in <code>SinOsc.ar(freq)</code>, the UGen graph builder automatically inserts link buses. Recursive nesting of if-then-else blocks is also supported.</p> 
  <p>Each branch can check its state using the <code>ThisBranch()</code> graph element. For a non-lagging <code>If</code> block, this creates a control signal trigger each time the branch is activated. Because of problems in the current SuperCollider versions with respect to initial states of triggers, this signal might not work in all circumstances the first time the branch is activated. For example <code>T2A.ar(ThisBranch())</code> will incorrectly ignore the initial trigger. There are workarounds, for example using <code>Latch</code>, which can be seen in the test suite.</p> 
  <p>Next to <code>If(cond) ...</code> there is an alternative element <code>IfLag(cond, dur) ...</code> which makes it possible to fade out a branch before it is deactivated. When <code>cond</code> becomes false, instead of pausing the branch immediately, a delay of <code>dur</code> happens. This also affects the newly selected branch, so there is no way of creating a cross-fade, while preserving the CPU saving property that no two branches are resumed at the same time. When using <code>IfLag</code>, the <code>ThisBranch</code> element instead of producing a single pulse trigger when the branch becomes active, it now provides a gate signal that remains high until the branch is released. Therefore, the branch can use, for example, an envelope generator that fades out no slower than <code>dur</code> when the <code>ThisBranch</code> gate signal becomes low.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">dur</span> <span class="pl-k">=</span> <span class="pl-c1">0.5</span>  <span class="pl-c"><span class="pl-c">//</span> seconds</span>
<span class="pl-k">val</span> <span class="pl-en">res</span><span class="pl-k">:</span> <span class="pl-en">GE</span> <span class="pl-k">=</span> <span class="pl-en">IfLag</span> (freq <span class="pl-k">&gt;</span> <span class="pl-c1">1000</span>, dur) <span class="pl-en">Then</span> {
  <span class="pl-k">val</span> <span class="pl-en">gate</span> <span class="pl-k">=</span> <span class="pl-en">ThisBranch</span>()
  <span class="pl-k">val</span> <span class="pl-en">env</span> <span class="pl-k">=</span> <span class="pl-en">EnvGen</span>.ar(<span class="pl-en">Env</span>.asr(release <span class="pl-k">=</span> dur), gate)
  <span class="pl-en">SinOsc</span>.ar(freq) <span class="pl-k">*</span> env
} <span class="pl-en">Else</span> {
  <span class="pl-k">val</span> <span class="pl-en">gate</span> <span class="pl-k">=</span> <span class="pl-en">ThisBranch</span>()
  <span class="pl-k">val</span> <span class="pl-en">env</span> <span class="pl-k">=</span> <span class="pl-en">EnvGen</span>.ar(<span class="pl-en">Env</span>.asr(release <span class="pl-k">=</span> dur), gate)
  <span class="pl-en">WhiteNoise</span>.ar <span class="pl-k">*</span> env
}
<span class="pl-en">Out</span>.ar(<span class="pl-c1">0</span>, res)</pre>
  </div> 
  <p>Classes are placed in the conventional <code>de.sciss.synth</code> package, matching with the other types and UGens of ScalaCollider.</p> 
  <p>For more background information and design considerations, see the <a href="https://github.com/iem-projects/sysson-experiments/releases/tag/if-then-else" target="_blank">sysson-experiments Project</a>.</p> 
  <h2><a href="https://github.com/iem-projects/scalacollider-if#limitations" aria-hidden="true" class="anchor" id="user-content-limitations" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>limitations</h2> 
  <ul> 
   <li>currently, <code>ControlProxy</code> elements do not properly propagate from outer to inner scope.</li> 
   <li>the number of cases per if-block is limited to 24</li> 
   <li>while the compound result signal from an if-block uses the maximum of the number of channels used by each individual case, the signals of the cases are not "wrap-expanded" as in regular multi-channel-expansion. The user should thus ensure that all branches produce signals of the same number of channels.</li> 
  </ul> 
 </article>
</div>