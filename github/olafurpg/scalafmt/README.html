<div class="announce instapaper_body md" data-path="readme.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-scalafmt---" class="anchor" href="https://github.com/olafurpg/scalafmt#scalafmt---" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>scalafmt <a href="https://codecov.io/github/olafurpg/scalafmt?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/75d300982e3330c6b8eaaba63adad94fecd71287/68747470733a2f2f636f6465636f762e696f2f6769746875622f6f6c6166757270672f7363616c61666d742f636f7665726167652e7376673f6272616e63683d6d6173746572" alt="codecov.io" data-canonical-src="https://codecov.io/github/olafurpg/scalafmt/coverage.svg?branch=master" style="max-width:100%;"></a> <a href="https://travis-ci.org/olafurpg/scalafmt" target="_blank"><img src="https://camo.githubusercontent.com/6b6e23e24c648ccd29152db1fbee32bf88eccb46/68747470733a2f2f7472617669732d63692e6f72672f6f6c6166757270672f7363616c61666d742e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/olafurpg/scalafmt.svg?branch=master" style="max-width:100%;"></a> <a href="https://gitter.im/olafurpg/scalafmt?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/382ebf95f5b4df9275ac203229928db8c8fd5c50/68747470733a2f2f6261646765732e6769747465722e696d2f6f6c6166757270672f7363616c61666d742e737667" alt="Join the chat at https://gitter.im/olafurpg/scalafmt" data-canonical-src="https://badges.gitter.im/olafurpg/scalafmt.svg" style="max-width:100%;"></a></h1> 
  <h3><a id="user-content-user-documentation" class="anchor" href="https://github.com/olafurpg/scalafmt#user-documentation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a><a href="http://scalafmt.org" target="_blank">User documentation</a></h3> 
  <p>Head over to <a href="http://scalafmt.org" target="_blank">the user docs</a> for instructions on how to install scalafmt. To build the docs yourself, <code>sbt readme/run</code> will produce the docs which you can open with <code>open readme/target/scalatex/index.html</code>.</p> 
  <h2><a id="user-content-hacking-on-scalafmt" class="anchor" href="https://github.com/olafurpg/scalafmt#hacking-on-scalafmt" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Hacking on scalafmt</h2> 
  <p>I hope to make scalafmt a community effort so that the project has a <a href="https://en.wikipedia.org/wiki/Bus_factor" target="_blank">truck number</a> bigger than 1. I've tried to do my best to concisely summarise how I work on scalafmt. For any questions, don't hesitate to ask on gitter.</p> 
  <h3><a id="user-content-tips" class="anchor" href="https://github.com/olafurpg/scalafmt#tips" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tips</h3> 
  <ul> 
   <li><code>core/testOnly org.scalafmt.FormatTests</code>: runs the fast, most relevant, unit tests. 
    <ul> 
     <li>After each run, a performance report is generated in <code>target/index.html</code>. I usually keep a browser tab open at <code>localhost:3000/target/index.html</code> along with this background process: <code>browser-sync start --server --files "target/*.html"</code>. See <a href="https://www.browsersync.io/" target="_blank">Browsersync</a>.</li> 
    </ul></li> 
   <li><code>core/testOnly org.scalafmt.FidelityTest</code>: runs the formatter on all files in this project.</li> 
   <li><code>run-benchmarks.sh</code> script to run jmh benchmarks.</li> 
   <li><code>core/test:runMain org.scalafmt.FormatExperimentApp</code>: 
    <ol> 
     <li>Uses <code>wget</code> to download a ~20mb tar (<a href="https://github.com/olafurpg/scalafmt/releases/tag/v0.1.4" target="_blank">repos.tar.gz</a>) that contains ~28.000 Scala source files from public Github repos,</li> 
     <li>untars with <code>tar</code>,</li> 
     <li>runs scalafmt on a subset of the files, specified in <code>FormatExperiment</code>. Runs various property based checks under timing constraints (around 10s per file),</li> 
     <li>prints summary report to console.</li> 
    </ol></li> 
   <li>instructions for the tests <a href="https://github.com/olafurpg/scalafmt/blob/master/core/src/test/resources" target="_blank">are here</a>.</li> 
  </ul> 
  <h3><a id="user-content-tutorial-add-spacesinparentheses-flag" class="anchor" href="https://github.com/olafurpg/scalafmt#tutorial-add-spacesinparentheses-flag" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tutorial: add spacesInParentheses flag</h3> 
  <p>I want to add a new configuration flag <code>spacesInParentheses</code> so that function applications look like this</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c">// Before</span>
function(a, b, c)
<span class="pl-c">// After</span>
function( a, b, c )</pre>
  </div> 
  <ul> 
   <li>Clone the repo, cd into it, start <code>sbt</code> and then run <code>~core/testOnly org.scalafmt.FormatTests</code>. The unit tests should pass.</li> 
   <li>Open <code>ScalafmtStyle.scala</code> and add a member <code>spacesInParentheses: Boolean</code>. Now you get a compiler error. Fix <code>ScalafmtStyle.default</code> style so that it has <code>spacesInParentheses = true</code>. The code should compile now and all tests should pass.</li> 
   <li>Open <code>core/src/test/resources/unit/Hacking.stat</code> and you will see a test like this</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c1">40</span> columns                              <span class="pl-k">|</span>
<span class="pl-k">&lt;&lt;&lt;</span> <span class="pl-en">SKIP</span> <span class="pl-en">Spaces</span> in parentheses
function(a, b, c)
<span class="pl-k">&gt;&gt;&gt;</span>
function( a, b, c )</pre>
  </div> 
  <ul> 
   <li>The column limit is 40 characters, because the test is in the <code>unit</code> directory.</li> 
   <li>The test does not run because its name starts with SKIP.</li> 
   <li>Change SKIP to ONLY, save and sbt should now only run this test and give you a failing output like this:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>                     <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">56</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>                     <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">56</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">8</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     function        <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">281</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">9</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     (               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">448</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[<span class="pl-c1">4</span>], <span class="pl-en">P</span><span class="pl-k">:</span><span class="pl-c1">412</span>(<span class="pl-en">D</span><span class="pl-k">=</span><span class="pl-c1">true</span>)) <span class="pl-c1">4</span> <span class="pl-c1">10</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     a               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">494</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">11</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     ,               <span class="pl-en">Space</span><span class="pl-k">:</span><span class="pl-c1">514</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">13</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     b               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">494</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">14</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     ,               <span class="pl-en">Space</span><span class="pl-k">:</span><span class="pl-c1">514</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">16</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     c               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">1005</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">17</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     )               <span class="pl-en">Newline</span><span class="pl-k">:</span><span class="pl-c1">60</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">127</span>    <span class="pl-en">Total</span> <span class="pl-v">cost</span>: <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">90</span>      <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">56</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>), <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">448</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>), <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">514</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>)
[debug] <span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">91</span>      <span class="pl-en">Total</span> <span class="pl-v">explored</span>: <span class="pl-c1">12</span>
[info] <span class="pl-en">FormatTests</span><span class="pl-k">:</span>
[info] <span class="pl-k">-</span> unit<span class="pl-k">/</span><span class="pl-en">Hacking</span>.stat<span class="pl-k">:</span> <span class="pl-en">Spaces</span> in parentheses                               <span class="pl-k">|</span> <span class="pl-k">***</span> <span class="pl-en">FAILED</span> <span class="pl-k">***</span> (<span class="pl-c1">278</span> milliseconds)
[info]   <span class="pl-k">===========</span>
[info]   <span class="pl-k">=&gt;</span> <span class="pl-en">Obtained</span>
[info]   <span class="pl-k">===========</span>
[info]   function(a, b, c)
[info]
[info]
[info]   <span class="pl-k">=======</span>
[info]   <span class="pl-k">=&gt;</span> <span class="pl-en">Diff</span>
[info]   <span class="pl-k">=======</span>
[info]   <span class="pl-k">-</span>function(a, b, c)
[info]   <span class="pl-k">+</span>function( a, b, c ) (<span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">33</span>)
[info] <span class="pl-en">Run</span> completed in <span class="pl-c1">443</span> milliseconds.
[info] <span class="pl-en">Total</span> number of tests <span class="pl-v">run</span>: <span class="pl-c1">1</span>
[info] <span class="pl-en">Suites</span><span class="pl-k">:</span> completed <span class="pl-c1">1</span>, aborted <span class="pl-c1">0</span>
[info] <span class="pl-en">Tests</span><span class="pl-k">:</span> succeeded <span class="pl-c1">0</span>, failed <span class="pl-c1">1</span>, canceled <span class="pl-c1">0</span>, ignored <span class="pl-c1">0</span>, pending <span class="pl-c1">0</span>
[info] <span class="pl-k">***</span> <span class="pl-c1">1</span> <span class="pl-en">TEST</span> <span class="pl-en">FAILED</span> <span class="pl-k">***</span>
[error] <span class="pl-en">Failed</span> <span class="pl-v">tests</span>:</pre>
  </div> 
  <ul> 
   <li>Cool. The lines printed out from FormatWriter are interesting. Look at the first line, it has <code>NoSplit:56(cost=0 ...)</code>. This means that between the beginning of the file and the <code>function</code> token is a NoSplit that origins from line 56 in <code>core/src/main/scala/org/scalafmt/internal/Router.scala</code>. Lets find that line:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">private</span> <span class="pl-k">def</span> <span class="pl-en">getSplits</span>(<span class="pl-v">formatToken</span>: <span class="pl-en">FormatToken</span>)<span class="pl-k">:</span> <span class="pl-en">Seq</span>[<span class="pl-en">Split</span>] <span class="pl-k">=</span> {
    <span class="pl-k">val</span> <span class="pl-en">leftOwner</span> <span class="pl-k">=</span> owners(formatToken.left)
    <span class="pl-k">val</span> <span class="pl-en">rightOwner</span> <span class="pl-k">=</span> owners(formatToken.right)
    <span class="pl-k">val</span> <span class="pl-en">newlines</span> <span class="pl-k">=</span> newlinesBetween(formatToken.between)
    formatToken <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">FormatToken</span>(<span class="pl-v">_</span>: <span class="pl-en">BOF</span>, _, _) <span class="pl-k">=&gt;</span>
        <span class="pl-en">Seq</span>(
            <span class="pl-en">Split</span>(<span class="pl-en">NoSplit</span>, <span class="pl-c1">0</span>) <span class="pl-c">// &lt;--- Line 56</span>
        )
      ...</pre>
  </div> 
  <ul> 
   <li>BOF stands for "beginning of file".</li> 
   <li>Look at <code>NoSplit:281</code></li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>      <span class="pl-c">// Opening ( with no leading space.</span>
      <span class="pl-k">case</span> <span class="pl-en">FormatToken</span>(
          <span class="pl-v">_</span>: `<span class="pl-v">this</span>` <span class="pl-k">|</span> <span class="pl-v">_</span>: <span class="pl-en">Ident</span> <span class="pl-k">|</span> <span class="pl-v">_</span>: `]` <span class="pl-k">|</span> <span class="pl-v">_</span>: `}` <span class="pl-k">|</span> <span class="pl-v">_</span>: `)`, <span class="pl-v">_</span>: `(` <span class="pl-k">|</span> <span class="pl-v">_</span>: `[`, _)
          <span class="pl-k">if</span> noSpaceBeforeOpeningParen(rightOwner) <span class="pl-k">&amp;&amp;</span> {
            leftOwner.parent.forall {
              <span class="pl-c">// infix applications have no space.</span>
              <span class="pl-k">case</span> <span class="pl-v">_</span>: <span class="pl-en">Type</span>.<span class="pl-en">ApplyInfix</span> <span class="pl-k">|</span> <span class="pl-v">_</span>: <span class="pl-en">Term</span>.<span class="pl-en">ApplyInfix</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>
              <span class="pl-k">case</span> parent <span class="pl-k">=&gt;</span> <span class="pl-c1">true</span>
            }
          } <span class="pl-k">=&gt;</span>
        <span class="pl-en">Seq</span>(
            <span class="pl-en">Split</span>(<span class="pl-en">NoSplit</span>, <span class="pl-c1">0</span>) <span class="pl-c">// &lt;-- Line 281</span>
        )</pre>
  </div> 
  <ul> 
   <li>Looks a lot more scary than line 56. What's happening is that we're matching on a FormatToken, which has three members:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">FormatToken</span>(<span class="pl-v">left</span>: <span class="pl-en">Token</span>, <span class="pl-v">right</span>: <span class="pl-en">Token</span>, <span class="pl-v">between</span>: <span class="pl-en">Vector</span>[<span class="pl-en">Whitespace</span>])</pre>
  </div> 
  <ul> 
   <li>We matched on line 281 because left was <code>function</code> which is of type <code>Ident</code> (identifier) and right was the opening parenthesis of type <code>&lt;backtick&gt;(&lt;backtick&gt;</code>.</li> 
   <li>Let's look at <code>NoSplit:448</code> then, we want to put a space there instead of a NoSplit.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>        <span class="pl-en">Seq</span>(
            <span class="pl-en">Split</span>(modification, <span class="pl-c">// &lt;-- line 448</span>
                  <span class="pl-c1">0</span>,
                  policy <span class="pl-k">=</span> singleLine(<span class="pl-c1">6</span>),
                  ignoreIf <span class="pl-k">=</span> <span class="pl-k">!</span>fitsOnOneLine)
              .withOptimalToken(expirationToken)
              .withIndent(indent, close, <span class="pl-en">Left</span>),</pre>
  </div> 
  <ul> 
   <li><code>modification</code> is a variable, it's defined like this:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>        <span class="pl-k">val</span> <span class="pl-en">modification</span> <span class="pl-k">=</span>
          <span class="pl-k">if</span> (right.<span class="pl-c1">isInstanceOf</span>[<span class="pl-en">Comment</span>]) newlines2Modification(between)
          <span class="pl-k">else</span> <span class="pl-en">NoSplit</span></pre>
  </div> 
  <ul> 
   <li>Let's modify it into this:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>        <span class="pl-k">val</span> <span class="pl-en">modification</span> <span class="pl-k">=</span>
          <span class="pl-k">if</span> (right.<span class="pl-c1">isInstanceOf</span>[<span class="pl-en">Comment</span>]) newlines2Modification(between)
          <span class="pl-k">else</span> <span class="pl-k">if</span> (style.spacesInParentheses) <span class="pl-en">Space</span>
          <span class="pl-k">else</span> <span class="pl-en">NoSplit</span></pre>
  </div> 
  <ul> 
   <li>Save and see the test run.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>                     <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">56</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>                     <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">56</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">8</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     function        <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">281</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">9</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     (               <span class="pl-en">Space</span><span class="pl-k">:</span><span class="pl-c1">448</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[<span class="pl-c1">4</span>], <span class="pl-en">P</span><span class="pl-k">:</span><span class="pl-c1">412</span>(<span class="pl-en">D</span><span class="pl-k">=</span><span class="pl-c1">true</span>)) <span class="pl-c1">4</span> <span class="pl-c1">11</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     a               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">494</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">12</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     ,               <span class="pl-en">Space</span><span class="pl-k">:</span><span class="pl-c1">514</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">14</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     b               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">494</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">15</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     ,               <span class="pl-en">Space</span><span class="pl-k">:</span><span class="pl-c1">514</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">17</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     c               <span class="pl-en">NoSplit</span><span class="pl-k">:</span><span class="pl-c1">1005</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">4</span> <span class="pl-c1">18</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">85</span>     )               <span class="pl-en">Newline</span><span class="pl-k">:</span><span class="pl-c1">60</span>(cost<span class="pl-k">=</span><span class="pl-c1">0</span>, indents<span class="pl-k">=</span>[], <span class="pl-en">NoPolicy</span>) <span class="pl-c1">0</span> <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatWriter</span>.scala<span class="pl-k">:</span><span class="pl-c1">127</span>    <span class="pl-en">Total</span> <span class="pl-v">cost</span>: <span class="pl-c1">0</span>
[debug] <span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">90</span>      <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">56</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>), <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">448</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>), <span class="pl-en">Split</span>(line<span class="pl-k">=</span><span class="pl-c1">514</span>, count<span class="pl-k">=</span><span class="pl-c1">1</span>)
[debug] <span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">91</span>      <span class="pl-en">Total</span> <span class="pl-v">explored</span>: <span class="pl-c1">12</span>
[info] <span class="pl-en">FormatTests</span><span class="pl-k">:</span>
[info] <span class="pl-k">-</span> unit<span class="pl-k">/</span><span class="pl-en">Hacking</span>.stat<span class="pl-k">:</span> <span class="pl-en">Spaces</span> in parentheses                               <span class="pl-k">|</span> <span class="pl-k">***</span> <span class="pl-en">FAILED</span> <span class="pl-k">***</span> (<span class="pl-c1">298</span> milliseconds)
[info]   <span class="pl-k">===========</span>
[info]   <span class="pl-k">=&gt;</span> <span class="pl-en">Obtained</span>
[info]   <span class="pl-k">===========</span>
[info]   function( a, b, c)
[info]
[info]
[info]   <span class="pl-k">=======</span>
[info]   <span class="pl-k">=&gt;</span> <span class="pl-en">Diff</span>
[info]   <span class="pl-k">=======</span>
[info]   <span class="pl-k">-</span>function( a, b, c)
[info]   <span class="pl-k">+</span>function( a, b, c ) (<span class="pl-en">FormatTests</span>.scala<span class="pl-k">:</span><span class="pl-c1">33</span>)</pre>
  </div> 
  <ul> 
   <li>Neat, there's a space after the opening <code>(</code>! Only missing space before closing parenthesis.</li> 
   <li>Look at line 1005</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>      <span class="pl-k">case</span> <span class="pl-en">FormatToken</span>(_, <span class="pl-v">_</span>: `]` <span class="pl-k">|</span> <span class="pl-v">_</span>: `)`, _) <span class="pl-k">=&gt;</span>
        <span class="pl-en">Seq</span>(
            <span class="pl-en">Split</span>(<span class="pl-en">NoSplit</span>, <span class="pl-c1">0</span>) <span class="pl-c">// &lt;- line 1005</span>
        )</pre>
  </div> 
  <ul> 
   <li>Change the line to this</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>            <span class="pl-en">Split</span>(<span class="pl-k">if</span> (style.spacesInParentheses) <span class="pl-en">Space</span> <span class="pl-k">else</span> <span class="pl-en">NoSplit</span>, <span class="pl-c1">0</span>)</pre>
  </div> 
  <ul> 
   <li>Save and yay, the test passes now.</li> 
   <li>Open <code>Hacking.stat</code> again and remove ONLY from the test name so it looks like this <code>&lt;&lt;&lt; Spaces in parentheses</code>.</li> 
   <li>Run the tests. Awww, 295 failing tests.</li> 
   <li>Look carefully through the diffs check if the output looks nice.</li> 
   <li>Change spacesInParentheses to false in the default style.</li> 
   <li>Create a new directory in <code>core/src/test/resources</code> named spaces (it already exists).</li> 
   <li>Move <code>unit/Hacking.stat</code> to <code>spaces/Spaces.stat</code>.</li> 
   <li>Run the test and you will get an error like</li> 
  </ul> 
  <pre><code>[trace] Stack trace suppressed: run last core/test:testOnly for the full output.
[error] Could not run test org.scalafmt.FormatTests: org.scalafmt.Error$UnknownStyle: Don't understand style spaces
</code></pre> 
  <ul> 
   <li>Open the file <code>core/src/test/scala/org/scalafmt/util/HasTests.scala</code> and look at the <code>file2style</code> method.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">def</span> <span class="pl-en">file2style</span>(<span class="pl-v">filename</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-en">ScalafmtStyle</span> <span class="pl-k">=</span>
    filename.split(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>).reverse(<span class="pl-c1">1</span>) <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>unit<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-en">ScalafmtStyle</span>.unitTest40
      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span> <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>standard<span class="pl-pds">"</span></span> <span class="pl-k">|</span> <span class="pl-s"><span class="pl-pds">"</span>scala<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-en">ScalafmtStyle</span>.unitTest80
      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>scalajs<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-en">ScalafmtStyle</span>.scalaJs
      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>stripMargin<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-en">ScalafmtStyle</span>.default
      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>align<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span>
        <span class="pl-en">ScalafmtStyle</span>.default.copy(alignTokens <span class="pl-k">=</span> <span class="pl-en">AlignToken</span>.default)
      <span class="pl-k">case</span> style <span class="pl-k">=&gt;</span> <span class="pl-k">throw</span> <span class="pl-en">UnknownStyle</span>(style)
    }</pre>
  </div> 
  <ul> 
   <li>Add a case like this</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>      <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>spaces<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span>
        <span class="pl-en">ScalafmtStyle</span>.default.copy(spacesInParentheses <span class="pl-k">=</span> <span class="pl-c1">true</span>)</pre>
  </div> 
  <ul> 
   <li>Run the tests. Yay everything seems to be working fine.</li> 
   <li>The last thing to do is to add spacesInParentheses to the CLI flags.</li> 
   <li>Open <code>cli/src/main/scala/org/scalafmt/cli/Cli.scala</code></li> 
   <li>Add a new flag option like this</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre>    opt[<span class="pl-k">Boolean</span>](<span class="pl-s"><span class="pl-pds">"</span>spacesInParentheses<span class="pl-pds">"</span></span>) action { (bool, c) <span class="pl-k">=&gt;</span>
      c.copy(style <span class="pl-k">=</span> c.style.copy(spacesInParentheses <span class="pl-k">=</span> bool))
    } text s<span class="pl-s"><span class="pl-pds">"</span>See ScalafmtConfig scaladoc.<span class="pl-pds">"</span></span></pre>
  </div> 
  <ul> 
   <li>Clean up your branch and open a PR. I'm sure there will be lots of cases that still need more fixing but this is a great proof-of-concept. I recommend you get some feedback.</li> 
  </ul> 
  <h2><a id="user-content-contribution-guidelines" class="anchor" href="https://github.com/olafurpg/scalafmt#contribution-guidelines" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contribution Guidelines</h2> 
  <p>Shamelessly stolen from <a href="https://github.com/lihaoyi/Ammonite" target="_blank">lihaoyi/ammonite</a>.</p> 
  <ul> 
   <li><strong>All code PRs should come with</strong>: a meaningful description, inline-comments for important things, unit tests (positive and negative), and a green build in <a href="https://travis-ci.org/olafurpg/scalafmt" target="_blank">CI</a>. Note, the tests format 1.2 million lines of code twice which takes ~1hr to run on travis.</li> 
   <li><strong>Format your code with the lastest release of scalafmt, default style.</strong>.</li> 
   <li><strong>PRs for features should generally come with <em>something</em> added to the <a href="https://olafurpg.github.io/scalafmt" target="_blank">Documentation</a></strong>, so people can discover that it exists. The docs are written in <code>readme/Readme.scalatex</code>.</li> 
   <li><strong>Be prepared to discuss/argue-for your changes if you want them merged</strong>! You will probably need to refactor so your changes fit into the larger codebase - <strong>If your code is hard to unit test, and you don't want to unit test it, that's ok</strong>. But be prepared to argue why that's the case!</li> 
   <li><strong>It's entirely possible your changes won't be merged</strong>, or will get ripped out later. This is also the case for my changes, as the Author!</li> 
   <li><strong>Even a rejected/reverted PR is valuable</strong>! It helps explore the solution space, and know what works and what doesn't. For every line in the repo, at least three lines were tried, committed, and reverted/refactored, and more than 10 were tried without committing.</li> 
   <li><strong>Feel free to send Proof-Of-Concept PRs</strong> that you don't intend to get merged.</li> 
  </ul> 
  <h2><a id="user-content-acknowledgements" class="anchor" href="https://github.com/olafurpg/scalafmt#acknowledgements" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Acknowledgements</h2> 
  <p><a href="http://www.ej-technologies.com/products/jprofiler/overview.html" target="_blank"> <img src="https://camo.githubusercontent.com/e06f6733a8854245f9f9add5627fe703e1cbfe9d/68747470733a2f2f7777772e656a2d746563686e6f6c6f676965732e636f6d2f696d616765732f70726f647563745f62616e6e6572732f6a70726f66696c65725f6c617267652e706e67" align="right" data-canonical-src="https://www.ej-technologies.com/images/product_banners/jprofiler_large.png" style="max-width:100%;"> </a> <a href="http://www.ej-technologies.com/products/jprofiler/overview.html" target="_blank">JProfiler</a> generously supports scalafmt with its full-featured Java Profiler.</p> 
 </article>
</div>