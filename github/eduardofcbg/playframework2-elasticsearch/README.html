<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p>This module integrates Elasticsearch into your PlayFramework app.</p> 
  <h2><a id="user-content-versions" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#versions" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Versions</h2> 
  <table>
   <thead> 
    <tr> 
     <th>Module</th> 
     <th>Playframework</th> 
     <th>Elasticsearch</th> 
     <th>Comments</th> 
    </tr> 
   </thead>
   <tbody> 
    <tr> 
     <td>0.11</td> 
     <td>2.5</td> 
     <td>2.3.2</td> 
     <td>Added scala support</td> 
    </tr> 
    <tr> 
     <td>0.1</td> 
     <td>2.4.3</td> 
     <td>2.0</td> 
     <td>Initial version</td> 
    </tr> 
   </tbody>
  </table> 
  <h2><a id="user-content-install" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#install" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Install</h2> 
  <p>Add the following resolver to your <code>build.sbt</code></p> 
  <pre><code>resolvers += "eduardofcbg" at "http://dl.bintray.com/eduardofcbg/maven"
</code></pre> 
  <p>And the following dependency declaration:</p> 
  <pre><code>  "com.github.eduardofcbg" %% "playframework2-elasticsearch" % "0.11"
</code></pre> 
  <p>Your <code>build.sbt</code> should look something like this:</p> 
  <pre><code>name := """myproject"""

version := "1.0-SNAPSHOT"

lazy val root = (project in file(".")).enablePlugins(PlayJava)

scalaVersion := "2.11.1"

libraryDependencies ++= Seq(
  cache,
  "com.github.eduardofcbg" %% "playframework2-elasticsearch" % "0.11"
)

resolvers += "eduardofcbg" at "http://dl.bintray.com/eduardofcbg/maven"
</code></pre> 
  <h2><a id="user-content-configure-the-plugin" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#configure-the-plugin" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configure the plugin</h2> 
  <p>You should enable and configure the plugin in <code>conf/application.conf</code></p> 
  <pre><code>## ElasticSearch

## Enable the plugin
play.modules.enabled += "com.github.eduardofcbg.plugin.es.ESModule"

## Enable embedded database for developing
es.embed=true
## Where to save the embedded database (defaults to "db")
#es.local.path="db"

## For connecting to a remote database
## List of hosts
#es.hosts=["127.0.0.1:9300"]

## Name of the index (defaults to "play-es")
#es.index="play-es"

## Adicional options
#es.log=true
#es.sniff=true
#es.timeout=5
#es.ping=5
#es.cluster="mycluster"
#es.mappings="{ analysis: { analyzer: { my_analyzer: { type: \"custom\", tokenizer: \"standard\" } } } }"

</code></pre> 
  <h2><a id="user-content-usage-from-java" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#usage-from-java" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage from Java</h2> 
  <p>Make your models extend the <code>com.github.eduardofcbg.plugin.es.Index</code> class and annotate it with the name of the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html" target="_blank">type</a> that will be associated with the indexed objects of this class. On each model add a find helper. This is the object that you will use query your ES cluster.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">models</span>;

<span class="pl-k">@Type.Name</span>(<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>)
<span class="pl-k">@Type.ResultsPerPage</span>(<span class="pl-c1">5</span>)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Person</span> <span class="pl-k">extends</span> <span class="pl-e">Index</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> name;
    <span class="pl-k">public</span> <span class="pl-k">int</span> age;

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">Finder&lt;<span class="pl-smi">Person</span>&gt;</span> find <span class="pl-k">=</span> finder(<span class="pl-smi">Person</span><span class="pl-k">.</span>class);

    <span class="pl-k">public</span> <span class="pl-en">Person</span>(<span class="pl-smi">String</span> <span class="pl-v">name</span>, <span class="pl-k">int</span> <span class="pl-v">age</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
        <span class="pl-v">this</span><span class="pl-k">.</span>age <span class="pl-k">=</span> age;
    }

    <span class="pl-k">public</span> <span class="pl-en">Person</span>() {}

    <span class="pl-k">public</span> <span class="pl-k">CompletionStage&lt;<span class="pl-smi">IndexResponse</span>&gt;</span> <span class="pl-en">index</span>() {
        <span class="pl-k">return</span> find<span class="pl-k">.</span>index(<span class="pl-v">this</span>);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">CompletionStage&lt;<span class="pl-k">Optional&lt;<span class="pl-smi">Person</span>&gt;</span>&gt;</span> <span class="pl-en">get</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>) {
        <span class="pl-k">return</span> find<span class="pl-k">.</span>get(id);
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">CompletionStage&lt;<span class="pl-k">List&lt;<span class="pl-smi">Person</span>&gt;</span>&gt;</span> <span class="pl-en">getAdults</span>(<span class="pl-k">int</span> <span class="pl-v">page</span>) {
        <span class="pl-k">return</span> find<span class="pl-k">.</span>search(s <span class="pl-k">-</span><span class="pl-k">&gt;</span> s<span class="pl-k">.</span>setQuery(rangeQuery(<span class="pl-s"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>from(<span class="pl-c1">18</span>)), page);
    }

}</pre>
  </div> 
  <p>As you can see in the last method, you can easily construct any search query by passing a method that will change your <code>SearchRequestBuilder</code> object via side effects. This way you can use the ES java API directly in your models.</p> 
  <p>All the finder's methods are asynchronous. They return <code>CompletionStage</code> which can be easily turned into actual responses and even better, they can be turned into <code>CompletionStage&lt;Result&gt;</code>, being the <code>Result</code> the type returned by play's actions. This means you can easily construct asynchronous controllers like the one bellow.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">PersonController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

    <span class="pl-k">@Inject</span>
    <span class="pl-k">public</span> <span class="pl-en">PersonController</span>(<span class="pl-smi">ES</span> <span class="pl-v">es</span>) {
        <span class="pl-smi">Person</span><span class="pl-k">.</span>registerAsType(es);
    }

    <span class="pl-k">public</span> <span class="pl-k">CompletionStage&lt;<span class="pl-smi">Result</span>&gt;</span> <span class="pl-en">getAdults</span>(<span class="pl-k">int</span> <span class="pl-v">page</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">Person</span><span class="pl-k">.</span>getAdults(page)<span class="pl-k">.</span>thenApply(persons <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            ok(listOfPerson<span class="pl-k">.</span>render(persons));
        });
    }

    <span class="pl-k">public</span> <span class="pl-k">CompletionStage&lt;<span class="pl-smi">Result</span>&gt;</span> <span class="pl-en">getPerson</span>(<span class="pl-smi">String</span> <span class="pl-v">id</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">Person</span><span class="pl-k">.</span>get(id)<span class="pl-k">.</span>thenApply(p <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-k">if</span> (p<span class="pl-k">.</span>isPresent()) ok(person<span class="pl-k">.</span>render(p<span class="pl-k">.</span>get()));
            <span class="pl-k">else</span> notFound(<span class="pl-s"><span class="pl-pds">"</span>not found person with id <span class="pl-pds">"</span></span> <span class="pl-k">+</span> id);
        });
    }

}</pre>
  </div> 
  <p>Additionally, every controller must register the type associated with it as seen above.</p> 
  <p>Of course you can also get the ES transport client by calling:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-smi">Finder</span><span class="pl-k">.</span>getClient();</pre>
  </div> 
  <p>You also can get the index name and the type any model, just by accessing it's Finder helper object. </p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-smi">Person</span><span class="pl-k">.</span>find<span class="pl-k">.</span>getType();</pre>
  </div> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-smi">Person</span><span class="pl-k">.</span>find<span class="pl-k">.</span>getIndex();</pre>
  </div> 
  <p>There are also some methods that will help you parse a <code>SearchResponse</code> and a <code>GetResponse</code>:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-smi">Person</span> person <span class="pl-k">=</span> find<span class="pl-k">.</span>parse(response);
<span class="pl-k">List&lt;<span class="pl-smi">Person</span>&gt;</span> persons <span class="pl-k">=</span> find<span class="pl-k">.</span>parse(response);</pre>
  </div> 
  <h2><a id="user-content-dealing-with-concurrency-problems" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#dealing-with-concurrency-problems" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Dealing with concurrency problems</h2> 
  <p>ElasticSearch uses the <a href="https://www.elastic.co/guide/en/elasticsearch/guide/master/optimistic-concurrency-control.html#optimistic-concurrency-control" target="_blank">Optimistic concurrency control</a> method. This plugin allows one to update a document without having to deal with the case when there are such problems.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">CompletionStage&lt;<span class="pl-smi">UpdateResponse</span>&gt;</span> incrementAge(<span class="pl-smi">String</span> id) {
        <span class="pl-k">return</span> find<span class="pl-k">.</span>update(id, original <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            original<span class="pl-k">.</span>age<span class="pl-k">++</span>;
            <span class="pl-k">return</span> original;
        });
}</pre>
  </div> 
  <p>An update can be done by specifying the document's Id and a Function that will be applied to the Object associated with it. This means that the Finder is aware of what transformation you are applying to the original object and can simply redo it if a problem related with concurrency occurs.</p> 
  <h2><a id="user-content-document-relationships-and-mapping" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#document-relationships-and-mapping" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Document relationships and mapping</h2> 
  <p>You are able to set mappings in your index using the <code>application.conf</code>, but mappings that affect specific types should be specified in your actual models just by passing them when you create the Finder helper.</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">Finder&lt;<span class="pl-smi">Person</span>&gt;</span> finder <span class="pl-k">=</span> finder(<span class="pl-smi">Person</span><span class="pl-k">.</span>class, m <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
    <span class="pl-k">try</span> {
        m<span class="pl-k">.</span>startObject(<span class="pl-s"><span class="pl-pds">"</span>_timestamp<span class="pl-pds">"</span></span>)
                .field(<span class="pl-s"><span class="pl-pds">"</span>enabled<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>)
                .field(<span class="pl-s"><span class="pl-pds">"</span>path<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>timestamp<span class="pl-pds">"</span></span>)
        .endObject();
    } <span class="pl-k">catch</span> (<span class="pl-smi">IOException</span> e) { e<span class="pl-k">.</span>printStackTrace() }
});</pre>
  </div> 
  <p>Additionally, if you want to set a parent-child relationship or a nested type, it is as easy as setting an annotation:</p> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">models</span>;

<span class="pl-k">@Type.Name</span>(<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>)
<span class="pl-k">@Type.ResultsPerPage</span>(<span class="pl-c1">5</span>)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Person</span> <span class="pl-k">extends</span> <span class="pl-e">Index</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> name;
    <span class="pl-k">public</span> <span class="pl-k">int</span> age;
    <span class="pl-k">@Type</span><span class="pl-k">.</span><span class="pl-smi">NestedField</span>
    <span class="pl-k">public</span> <span class="pl-k">List&lt;<span class="pl-smi">Book</span>&gt;</span> books;

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">Finder&lt;<span class="pl-smi">Person</span>&gt;</span> find <span class="pl-k">=</span> finder(<span class="pl-smi">Person</span><span class="pl-k">.</span>class);

    <span class="pl-k">public</span> <span class="pl-en">Person</span>(<span class="pl-smi">String</span> <span class="pl-v">name</span>, <span class="pl-k">int</span> <span class="pl-v">age</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
        <span class="pl-v">this</span><span class="pl-k">.</span>age <span class="pl-k">=</span> age;
    }

    <span class="pl-k">public</span> <span class="pl-en">Person</span>() {}

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">CompletionStage&lt;<span class="pl-k">List&lt;<span class="pl-smi">Pet</span>&gt;</span>&gt;</span> <span class="pl-en">getPets</span>(<span class="pl-smi">String</span> <span class="pl-v">personId</span>, <span class="pl-k">int</span> <span class="pl-v">page</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">Pet</span><span class="pl-k">.</span>find<span class="pl-k">.</span>getAsChildrenOf(<span class="pl-smi">Person</span><span class="pl-k">.</span>class, personId, page);
    }

}</pre>
  </div> 
  <div class="highlight highlight-source-java">
   <pre><span class="pl-k">package</span> <span class="pl-smi">models</span>;

<span class="pl-k">@Type.Name</span>(<span class="pl-s"><span class="pl-pds">"</span>pet<span class="pl-pds">"</span></span>)
<span class="pl-k">@Type.Parent</span>(<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>)
<span class="pl-k">@Type.ResultsPerPage</span>(<span class="pl-c1">5</span>)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Pet</span> <span class="pl-k">extends</span> <span class="pl-e">Index</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> name; 

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">Finder&lt;<span class="pl-smi">Pet</span>&gt;</span> find <span class="pl-k">=</span> finder(<span class="pl-smi">Pet</span><span class="pl-k">.</span>class);

    <span class="pl-k">public</span> <span class="pl-en">Pet</span>(<span class="pl-smi">String</span> <span class="pl-v">name</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
    }

    <span class="pl-k">public</span> <span class="pl-en">Pet</span>() {}

    <span class="pl-k">public</span> <span class="pl-k">CompletionStage&lt;<span class="pl-smi">IndexResponse</span>&gt;</span> <span class="pl-en">index</span>(<span class="pl-smi">String</span> <span class="pl-v">personId</span>) {
        <span class="pl-k">return</span> find<span class="pl-k">.</span>indexChild(<span class="pl-v">this</span>, personId);
    }

}</pre>
  </div> 
  <p>A sample application based on this guide can be found <a href="https://github.com/eduardofcbg/playframework2-elasticsearch-sample" target="_blank">here</a></p> 
  <h2><a id="user-content-usage-from-scala" class="anchor" href="https://github.com/eduardofcbg/playframework2-elasticsearch#usage-from-scala" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage from Scala</h2> 
  <p>Instead of the official Java API, <a href="https://github.com/sksamuel/elastic4s" target="_blank">elastic4s</a> is exposed along with some methods for helping to build most of the common queries.</p> 
  <p>Conceptually the same as the Java API, the models simply look like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Person</span>(
    <span class="pl-v">name</span>: <span class="pl-k">String</span>,
    <span class="pl-v">age</span>: <span class="pl-k">Int</span>,
    <span class="pl-v">book</span>: <span class="pl-en">Book</span>
) <span class="pl-k">extends</span> <span class="pl-e">Index</span>[<span class="pl-en">Person</span>]
<span class="pl-k">object</span> <span class="pl-en">Person</span> <span class="pl-k">extends</span> <span class="pl-e">Index</span>[<span class="pl-en">Person</span>] {
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">format</span><span class="pl-k">:</span> <span class="pl-en">Format</span>[<span class="pl-en">Person</span>] <span class="pl-k">=</span> (
      (__ \ <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>).format[<span class="pl-k">String</span>] and
      (__ \ <span class="pl-s"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>).format[<span class="pl-k">Int</span>] and
      (__ \ <span class="pl-s"><span class="pl-pds">"</span>book<span class="pl-pds">"</span></span>).format[<span class="pl-en">Book</span>]
    )(<span class="pl-en">Person</span>.apply, unlift(<span class="pl-en">Person</span>.unapply))
    <span class="pl-k">val</span> <span class="pl-en">finder</span> <span class="pl-k">=</span> <span class="pl-en">Finder</span>()
}

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Book</span>(
    <span class="pl-v">title</span>: <span class="pl-k">String</span>,
    <span class="pl-v">author</span>: <span class="pl-k">String</span>
)
<span class="pl-k">object</span> <span class="pl-en">Book</span> {
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">format</span><span class="pl-k">:</span> <span class="pl-en">Format</span>[<span class="pl-en">Book</span>] <span class="pl-k">=</span> (
      (__ \ <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>).format[<span class="pl-k">String</span>] and
      (__ \ <span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span>).format[<span class="pl-k">String</span>]
    )(<span class="pl-en">Book</span>.apply, unlift(<span class="pl-en">Book</span>.unapply))
}</pre>
  </div> 
  <p>Now instead of setting the mappings using annotations, we specify them when injecting the ES object into our models.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">@</span><span class="pl-en">Singleton</span>
<span class="pl-k">class</span> <span class="pl-en">Application</span> <span class="pl-k">@</span><span class="pl-en">Inject</span>() (<span class="pl-v">es</span>: <span class="pl-en">ES</span>, <span class="pl-v">cache</span>: <span class="pl-en">CacheApi</span>) {

    <span class="pl-k">val</span> <span class="pl-en">client</span> <span class="pl-k">=</span> <span class="pl-en">RegisterClient</span>(es, cache, mappings <span class="pl-k">=</span> 
        mapping(<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>) fields {
            field(<span class="pl-s"><span class="pl-pds">"</span>books<span class="pl-pds">"</span></span>) typed <span class="pl-en">NestedType</span>
        }
    )

    <span class="pl-k">def</span> <span class="pl-en">getPerson</span>(<span class="pl-v">personId</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
        <span class="pl-en">Person</span>.finder(personId) map {
            <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span> <span class="pl-en">NotFound</span>
            <span class="pl-k">case</span> <span class="pl-en">Some</span>(person) <span class="pl-k">=&gt;</span> <span class="pl-en">Ok</span>(<span class="pl-en">Json</span>.toJson(person))
        }
    }

    <span class="pl-k">def</span> <span class="pl-en">getReading</span>(<span class="pl-v">bookTitle</span>: <span class="pl-k">String</span>, <span class="pl-v">page</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
        <span class="pl-en">Person</span>.finder.searchNestedTerm(<span class="pl-s"><span class="pl-pds">"</span>book<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>, bookTitle)(page).map(persons <span class="pl-k">=&gt;</span> 
            <span class="pl-en">Ok</span>(<span class="pl-en">Json</span>.toJson(persons))
        )
    }

    <span class="pl-k">def</span> <span class="pl-en">getPersonsByName</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span>, <span class="pl-v">page</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> <span class="pl-en">Action</span>.async {
        <span class="pl-en">Person</span>.finder.searchWhere(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, name)(page).map(persons <span class="pl-k">=&gt;</span>
            <span class="pl-en">Ok</span>(<span class="pl-en">Json</span>.toJson(persons))
        )
    }

}</pre>
  </div> 
  <p>Analogous to the Java API, the scala client is exposed through the finder instance as well:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">client</span> <span class="pl-k">=</span> <span class="pl-en">Person</span>.finder.client</pre>
  </div> 
 </article>
</div>