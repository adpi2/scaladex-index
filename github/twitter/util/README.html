<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-twitter-util" class="anchor" href="https://github.com/twitter/util#twitter-util" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Twitter Util</h1> 
  <p><a href="https://travis-ci.org/twitter/util" target="_blank"><img src="https://camo.githubusercontent.com/1a79280294b9d05216b83cfb3c1d11832feb004c/68747470733a2f2f7472617669732d63692e6f72672f747769747465722f7574696c2e7376673f6272616e63683d646576656c6f70" alt="Build status" data-canonical-src="https://travis-ci.org/twitter/util.svg?branch=develop" style="max-width:100%;"></a> <a href="http://codecov.io/github/twitter/util?branch=develop" target="_blank"><img src="https://camo.githubusercontent.com/a23cfc3151c2ac51bd1d77691c5950a007168e5d/68747470733a2f2f696d672e736869656c64732e696f2f636f6465636f762f632f6769746875622f747769747465722f7574696c2f646576656c6f702e737667" alt="Codecov branch" data-canonical-src="https://img.shields.io/codecov/c/github/twitter/util/develop.svg" style="max-width:100%;"></a> <a href="https://github.com/twitter/util#status" target="_blank"><img src="https://camo.githubusercontent.com/8ed5ef79fffe4effb5533ff9c3fcb88f647c10c3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7374617475732d6163746976652d627269676874677265656e2e737667" alt="Project status" data-canonical-src="https://img.shields.io/badge/status-active-brightgreen.svg" style="max-width:100%;"></a> <a href="https://gitter.im/twitter/finagle?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank"><img src="https://camo.githubusercontent.com/9b52186233ef85483f5c65b95243444e9392be66/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6769747465722d6a6f696e253230636861742d677265656e2e737667" alt="Gitter" data-canonical-src="https://img.shields.io/badge/gitter-join%20chat-green.svg" style="max-width:100%;"></a> <a href="https://maven-badges.herokuapp.com/maven-central/com.twitter/util_2.11" target="_blank"><img src="https://camo.githubusercontent.com/45ff464896121f6fd421dcaa28755d0afea8a234/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f636f6d2e747769747465722f7574696c5f322e31312e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/com.twitter/util_2.11.svg" style="max-width:100%;"></a></p> 
  <p>A bunch of idiomatic, small, general purpose tools.</p> 
  <p>See the Scaladoc <a href="https://twitter.github.com/util" target="_blank">here</a>.</p> 
  <h2><a id="user-content-status" class="anchor" href="https://github.com/twitter/util#status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Status</h2> 
  <p>This project is used in production at Twitter (and many other organizations), and is being actively developed and maintained. Please note that some sub-projects (including <code>util-eval</code>), classes, and methods may be deprecated, however.</p> 
  <h2><a id="user-content-releases" class="anchor" href="https://github.com/twitter/util#releases" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Releases</h2> 
  <p><a href="https://maven-badges.herokuapp.com/maven-central/com.twitter/util_2.11" target="_blank">Releases</a> are done on an approximately monthly schedule. While <a href="http://semver.org/" target="_blank">semver</a> is not followed, the <a href="https://github.com/twitter/util/blob/master/CHANGES" target="_blank">changelogs</a> are detailed and include sections on public API breaks and changes in runtime behavior.</p> 
  <h2><a id="user-content-contributing" class="anchor" href="https://github.com/twitter/util#contributing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Contributing</h2> 
  <p>The <code>master</code> branch of this repository contains the latest stable release of Util, and weekly snapshots are published to the <code>develop</code> branch. In general pull requests should be submitted against <code>develop</code>. See <a href="https://github.com/twitter/util/blob/master/CONTRIBUTING.md" target="_blank">CONTRIBUTING.md</a> for more details about how to contribute.</p> 
  <h1><a id="user-content-using-in-your-project" class="anchor" href="https://github.com/twitter/util#using-in-your-project" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using in your project</h1> 
  <p>An example SBT dependency string for the <code>util-collection</code> tools would look like this:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">collUtils</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.twitter<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>util-collection<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>6.39.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <h1><a id="user-content-units" class="anchor" href="https://github.com/twitter/util#units" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Units</h1> 
  <h2><a id="user-content-time" class="anchor" href="https://github.com/twitter/util#time" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Time</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.conversions.time.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">duration1</span> <span class="pl-k">=</span> <span class="pl-c1">1.</span>second
<span class="pl-k">val</span> <span class="pl-en">duration2</span> <span class="pl-k">=</span> <span class="pl-c1">2.</span>minutes
duration1.inMillis <span class="pl-c"><span class="pl-c">//</span> =&gt; 1000L</span></pre>
  </div> 
  <h2><a id="user-content-space" class="anchor" href="https://github.com/twitter/util#space" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Space</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.conversions.storage.</span><span class="pl-v">_</span>
<span class="pl-k">val</span> <span class="pl-en">amount</span> <span class="pl-k">=</span> <span class="pl-c1">8.</span>megabytes
amount.inBytes <span class="pl-c"><span class="pl-c">//</span> =&gt; 8388608L</span>
amount.inKilobytes <span class="pl-c"><span class="pl-c">//</span> =&gt; 8192L</span></pre>
  </div> 
  <h1><a id="user-content-futures" class="anchor" href="https://github.com/twitter/util#futures" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Futures</h1> 
  <p>A Non-actor re-implementation of Scala Futures.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.conversions.time.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">com.twitter.util.</span>{<span class="pl-v">Await</span>, <span class="pl-v">Future</span>, <span class="pl-v">Promise</span>}

<span class="pl-k">val</span> <span class="pl-en">f</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>[<span class="pl-k">Int</span>]
<span class="pl-k">val</span> <span class="pl-en">g</span> <span class="pl-k">=</span> f.map { result <span class="pl-k">=&gt;</span> result <span class="pl-k">+</span> <span class="pl-c1">1</span> }
f.setValue(<span class="pl-c1">1</span>)
<span class="pl-en">Await</span>.result(g, <span class="pl-c1">1.</span>second) <span class="pl-c"><span class="pl-c">//</span> =&gt; this blocks for the futures result (and eventually returns 2)</span>

<span class="pl-c"><span class="pl-c">//</span> Another option:</span>
g.onSuccess { result <span class="pl-k">=&gt;</span>
  println(result) <span class="pl-c"><span class="pl-c">//</span> =&gt; prints "2"</span>
}

<span class="pl-c"><span class="pl-c">//</span> Using for expressions:</span>
<span class="pl-k">val</span> <span class="pl-en">xFuture</span> <span class="pl-k">=</span> <span class="pl-en">Future</span>(<span class="pl-c1">1</span>)
<span class="pl-k">val</span> <span class="pl-en">yFuture</span> <span class="pl-k">=</span> <span class="pl-en">Future</span>(<span class="pl-c1">2</span>)

<span class="pl-k">for</span> {
  x <span class="pl-k">&lt;</span><span class="pl-k">-</span> xFuture
  y <span class="pl-k">&lt;</span><span class="pl-k">-</span> yFuture
} {
  println(x <span class="pl-k">+</span> y) <span class="pl-c"><span class="pl-c">//</span> =&gt; prints "3"</span>
}</pre>
  </div> 
  <h1><a id="user-content-collections" class="anchor" href="https://github.com/twitter/util#collections" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Collections</h1> 
  <h2><a id="user-content-lrumap" class="anchor" href="https://github.com/twitter/util#lrumap" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>LruMap</h2> 
  <p>The LruMap is an LRU with a maximum size passed in. If the map is full it expires items in FIFO order. Reading a value will move an item to the top of the stack.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.util.</span><span class="pl-v">LruMap</span>

<span class="pl-k">val</span> <span class="pl-en">map</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">LruMap</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>](<span class="pl-c1">15</span>) <span class="pl-c"><span class="pl-c">//</span> this is of type mutable.Map[String, String]</span></pre>
  </div> 
  <h1><a id="user-content-object-pool" class="anchor" href="https://github.com/twitter/util#object-pool" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Object Pool</h1> 
  <p>The pool order is FIFO.</p> 
  <h2><a id="user-content-a-pool-of-constants" class="anchor" href="https://github.com/twitter/util#a-pool-of-constants" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>A pool of constants</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">scala.collection.</span><span class="pl-v">mutable</span>
<span class="pl-k">import</span> <span class="pl-v">com.twitter.util.</span>{<span class="pl-v">Await</span>, <span class="pl-v">SimplePool</span>}

<span class="pl-k">val</span> <span class="pl-en">queue</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mutable.Queue</span>[<span class="pl-k">Int</span>] <span class="pl-k">++</span> <span class="pl-en">List</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-k">val</span> <span class="pl-en">pool</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SimplePool</span>(queue)

<span class="pl-c"><span class="pl-c">//</span> Note that the pool returns Futures, it doesn't block on exhaustion.</span>
assert(<span class="pl-en">Await</span>.result(pool.reserve()) <span class="pl-k">==</span> <span class="pl-c1">1</span>)
pool.reserve().onSuccess { item <span class="pl-k">=&gt;</span>
  println(item) <span class="pl-c"><span class="pl-c">//</span> prints "2"</span>
}</pre>
  </div> 
  <h2><a id="user-content-a-pool-of-dynamically-created-objects" class="anchor" href="https://github.com/twitter/util#a-pool-of-dynamically-created-objects" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>A pool of dynamically created objects</h2> 
  <p>Here is a pool of even-number generators. It stores 4 numbers at a time:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.util.</span>{<span class="pl-v">Future</span>, <span class="pl-v">FactoryPool</span>}

<span class="pl-k">val</span> <span class="pl-en">pool</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">FactoryPool</span>[<span class="pl-k">Int</span>](<span class="pl-c1">4</span>) {
  <span class="pl-k">var</span> <span class="pl-en">count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>
  <span class="pl-k">def</span> <span class="pl-en">makeItem</span>() <span class="pl-k">=</span> { count <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-c1">1</span>; <span class="pl-en">Future</span>(count) }
  <span class="pl-k">def</span> <span class="pl-en">isHealthy</span>(<span class="pl-v">i</span>: <span class="pl-k">Int</span>) <span class="pl-k">=</span> i <span class="pl-k">%</span> <span class="pl-c1">2</span> <span class="pl-k">==</span> <span class="pl-c1">0</span>
}</pre>
  </div> 
  <p>It checks the health when you successfully reserve an object (i.e., when the Future yields).</p> 
  <h1><a id="user-content-hashing" class="anchor" href="https://github.com/twitter/util#hashing" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Hashing</h1> 
  <p><code>util-hashing</code> is a collection of hash functions and hashing distributors (eg. ketama).</p> 
  <p>To use one of the available hash functions:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.hashing.</span><span class="pl-v">KeyHasher</span>

<span class="pl-en">KeyHasher</span>.<span class="pl-en">FNV1_32</span>.hashKey(<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>.getBytes)</pre>
  </div> 
  <p>Available hash functions are:</p> 
  <pre><code>FNV1_32
FNV1A_32
FNV1_64
FNV1A_64
KETAMA
CRC32_ITU
HSIEH
</code></pre> 
  <p>To use <code>KetamaDistributor</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.hashing.</span>{<span class="pl-v">KetamaDistributor</span>, <span class="pl-v">KetamaNode</span>, <span class="pl-v">KeyHasher</span>}

<span class="pl-k">val</span> <span class="pl-en">nodes</span> <span class="pl-k">=</span> <span class="pl-en">List</span>(<span class="pl-en">KetamaNode</span>(<span class="pl-s"><span class="pl-pds">"</span>host:port<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span> <span class="pl-c"><span class="pl-c">/*</span> weight <span class="pl-c">*/</span></span>, <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">/*</span> handle <span class="pl-c">*/</span></span>))
<span class="pl-k">val</span> <span class="pl-en">distributor</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">KetamaDistributor</span>(nodes, <span class="pl-c1">1</span> <span class="pl-c"><span class="pl-c">/*</span> num reps <span class="pl-c">*/</span></span>)
distributor.nodeForHash(<span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>.##) <span class="pl-c"><span class="pl-c">//</span> =&gt; client</span></pre>
  </div> 
  <h1><a id="user-content-logging" class="anchor" href="https://github.com/twitter/util#logging" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Logging</h1> 
  <p><code>util-logging</code> is a small wrapper around Java's built-in logging to make it more Scala-friendly.</p> 
  <h2><a id="user-content-using" class="anchor" href="https://github.com/twitter/util#using" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Using</h2> 
  <p>To access logging, you can usually just use:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.logging.</span><span class="pl-v">Logger</span>
<span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">log</span> <span class="pl-k">=</span> <span class="pl-en">Logger</span>.get(getClass)</pre>
  </div> 
  <p>This creates a <code>Logger</code> object that uses the current class or object's package name as the logging node, so class "com.example.foo.Lamp" will log to node <code>com.example.foo</code> (generally showing "foo" as the name in the logfile). You can also get a logger explicitly by name:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">log</span> <span class="pl-k">=</span> <span class="pl-en">Logger</span>.get(<span class="pl-s"><span class="pl-pds">"</span>com.example.foo<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>Logger objects wrap everything useful from <code>java.util.logging.Logger</code>, as well as adding some convenience methods:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> log a string with sprintf conversion:</span>
log.info(<span class="pl-s"><span class="pl-pds">"</span>Starting compaction on zone %d...<span class="pl-pds">"</span></span>, zoneId)

<span class="pl-k">try</span> {
  ...
} <span class="pl-k">catch</span> {
  <span class="pl-c"><span class="pl-c">//</span> log an exception backtrace with the message:</span>
  <span class="pl-k">case</span> <span class="pl-v">e</span>: <span class="pl-en">IOException</span> <span class="pl-k">=&gt;</span>
    log.error(e, <span class="pl-s"><span class="pl-pds">"</span>I/O exception: %s<span class="pl-pds">"</span></span>, e.getMessage)
}</pre>
  </div> 
  <p>Each of the log levels (from "fatal" to "trace") has these two convenience methods. You may also use <code>log</code> directly:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.logging.</span><span class="pl-v">Level</span>
log(<span class="pl-en">Level</span>.<span class="pl-en">DEBUG</span>, <span class="pl-s"><span class="pl-pds">"</span>Logging %s at debug level.<span class="pl-pds">"</span></span>, name)</pre>
  </div> 
  <p>An advantage to using sprintf ("%s", etc) conversion, as opposed to:</p> 
  <div class="highlight highlight-source-scala">
   <pre>log(<span class="pl-en">Level</span>.<span class="pl-en">DEBUG</span>, s<span class="pl-s"><span class="pl-pds">"</span>Logging $name at debug level.<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>is that Java &amp; Scala perform string concatenation at runtime, even if nothing will be logged because the log file isn't writing debug messages right now. With <code>sprintf</code> parameters, the arguments are just bundled up and passed directly to the logging level before formatting. If no log message would be written to any file or device, then no formatting is done and the arguments are thrown away. That makes it very inexpensive to include verbose debug logging which can be turned off without recompiling and re-deploying.</p> 
  <p>If you prefer, there are also variants that take lazily evaluated parameters, and only evaluate them if logging is active at that level:</p> 
  <div class="highlight highlight-source-scala">
   <pre>log.ifDebug(s<span class="pl-s"><span class="pl-pds">"</span>Login from $name at $date.<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>The logging classes are done as an extension to the <code>java.util.logging</code> API, and so you can use the Java interface directly, if you want to. Each of the Java classes (Logger, Handler, Formatter) is just wrapped by a Scala class.</p> 
  <h2><a id="user-content-configuring" class="anchor" href="https://github.com/twitter/util#configuring" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuring</h2> 
  <p>In the Java style, log nodes are in a tree, with the root node being "" (the empty string). If a node has a filter level set, only log messages of that priority or higher are passed up to the parent. Handlers are attached to nodes for sending log messages to files or logging services, and may have formatters attached to them.</p> 
  <p>Logging levels are, in priority order of highest to lowest:</p> 
  <ul> 
   <li><code>FATAL</code> - the server is about to exit</li> 
   <li><code>CRITICAL</code> - an event occurred that is bad enough to warrant paging someone</li> 
   <li><code>ERROR</code> - a user-visible error occurred (though it may be limited in scope)</li> 
   <li><code>WARNING</code> - a coder may want to be notified, but the error was probably not user-visible</li> 
   <li><code>INFO</code> - normal informational messages</li> 
   <li><code>DEBUG</code> - coder-level debugging information</li> 
   <li><code>TRACE</code> - intensive debugging information</li> 
  </ul> 
  <p>Each node may also optionally choose to <em>not</em> pass messages up to the parent node.</p> 
  <p>The <code>LoggerFactory</code> builder is used to configure individual log nodes, by filling in fields and calling the <code>apply</code> method. For example, to configure the root logger to filter at <code>INFO</code> level and write to a file:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.logging.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">factory</span> <span class="pl-k">=</span> <span class="pl-en">LoggerFactory</span>(
  node <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
  level <span class="pl-k">=</span> <span class="pl-en">Some</span>(<span class="pl-en">Level</span>.<span class="pl-en">INFO</span>),
  handlers <span class="pl-k">=</span> <span class="pl-en">List</span>(
    <span class="pl-en">FileHandler</span>(
      filename <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/var/log/example/example.log<span class="pl-pds">"</span></span>,
      rollPolicy <span class="pl-k">=</span> <span class="pl-en">Policy</span>.<span class="pl-en">SigHup</span>
    )
  )
)

<span class="pl-k">val</span> <span class="pl-en">logger</span> <span class="pl-k">=</span> factory()</pre>
  </div> 
  <p>As many <code>LoggerFactory</code>s can be configured as you want, so you can attach to several nodes if you like. To remove all previous configurations, use:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">Logger</span>.clearHandlers()</pre>
  </div> 
  <h2><a id="user-content-handlers" class="anchor" href="https://github.com/twitter/util#handlers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Handlers</h2> 
  <ul> 
   <li><p><code>QueueingHandler</code></p> <p>Queues log records and publishes them in another thread thereby enabling "async logging".</p></li> 
   <li><p><code>ConsoleHandler</code></p> <p>Logs to the console.</p></li> 
   <li><p><code>FileHandler</code></p> <p>Logs to a file, with an optional file rotation policy. The policies are:</p> 
    <ul> 
     <li><code>Policy.Never</code> - always use the same logfile (default)</li> 
     <li><code>Policy.Hourly</code> - roll to a new logfile at the top of every hour</li> 
     <li><code>Policy.Daily</code> - roll to a new logfile at midnight every night</li> 
     <li><code>Policy.Weekly(n)</code> - roll to a new logfile at midnight on day N (0 = Sunday)</li> 
     <li><code>Policy.SigHup</code> - reopen the logfile on SIGHUP (for logrotate and similar services)</li> 
    </ul> <p>When a logfile is rolled, the current logfile is renamed to have the date (and hour, if rolling hourly) attached, and a new one is started. So, for example, <code>test.log</code> may become <code>test-20080425.log</code>, and <code>test.log</code> will be reopened as a new file.</p></li> 
   <li><p><code>SyslogHandler</code></p> <p>Log to a syslog server, by host and port.</p></li> 
   <li><p><code>ScribeHandler</code></p> <p>Log to a scribe server, by host, port, and category. Buffering and backoff can also be configured: You can specify how long to collect log lines before sending them in a single burst, the maximum burst size, and how long to backoff if the server seems to be offline.</p></li> 
   <li><p><code>ThrottledHandler</code></p> <p>Wraps another handler, tracking (and squelching) duplicate messages. If you use a format string like <code>"Error %d at %s"</code>, the log messages will be de-duped based on the format string, even if they have different parameters.</p></li> 
  </ul> 
  <h2><a id="user-content-formatters" class="anchor" href="https://github.com/twitter/util#formatters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Formatters</h2> 
  <p>Handlers usually have a formatter attached to them, and these formatters generally just add a prefix containing the date, log level, and logger name.</p> 
  <ul> 
   <li><p><code>Formatter</code></p> <p>A standard log prefix like <code>"ERR [20080315-18:39:05.033] jobs: "</code>, which can be configured to truncate log lines to a certain length, limit the lines of an exception stack trace, and use a special time zone.</p> <p>You can override the format string used to generate the prefix, also.</p></li> 
   <li><p><code>BareFormatterConfig</code></p> <p>No prefix at all. May be useful for logging info destined for scripts.</p></li> 
   <li><p><code>SyslogFormatterConfig</code></p> <p>A formatter required by the syslog protocol, with configurable syslog priority and date format.</p></li> 
  </ul> 
  <h2><a id="user-content-future-interrupts" class="anchor" href="https://github.com/twitter/util#future-interrupts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Future interrupts</h2> 
  <p>Method <code>raise</code> on <code>Future</code> (<code>def raise(cause: Throwable)</code>) raises the interrupt described by <code>cause</code> to the producer of this <code>Future</code>. Interrupt handlers are installed on a <code>Promise</code> using <code>setInterruptHandler</code>, which takes a partial function:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">p</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>[<span class="pl-en">T</span>]
p.setInterruptHandler {
  <span class="pl-k">case</span> <span class="pl-v">exc</span>: <span class="pl-en">MyException</span> <span class="pl-k">=&gt;</span>
    <span class="pl-c"><span class="pl-c">//</span> deal with interrupt..</span>
}</pre>
  </div> 
  <p>Interrupts differ in semantics from cancellation in important ways: there can only be one interrupt handler per promise, and interrupts are only delivered if the promise is not yet complete.</p> 
  <h2><a id="user-content-time-and-duration" class="anchor" href="https://github.com/twitter/util#time-and-duration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Time and Duration</h2> 
  <p>Like arithmetic on doubles, <code>Time</code> and <code>Duration</code> arithmetic is now free of overflows. Instead, they overflow to <code>Top</code> and <code>Bottom</code> values, which are analogous to positive and negative infinity.</p> 
  <p>Since the resolution of <code>Time.now</code> has been reduced (and is also more expensive due to its use of system time), a new <code>Stopwatch</code> API has been introduced in order to calculate durations of time.</p> 
  <p>It's used simply:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.twitter.util.</span>{<span class="pl-v">Duration</span>, <span class="pl-v">Stopwatch</span>}
<span class="pl-k">val</span> <span class="pl-en">elapsed</span><span class="pl-k">:</span> () <span class="pl-k">=&gt;</span> <span class="pl-en">Duration</span> <span class="pl-k">=</span> <span class="pl-en">Stopwatch</span>.start()</pre>
  </div> 
  <p>which is read by applying <code>elapsed</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">duration</span><span class="pl-k">:</span> <span class="pl-en">Duration</span> <span class="pl-k">=</span> elapsed()</pre>
  </div> 
 </article>
</div>