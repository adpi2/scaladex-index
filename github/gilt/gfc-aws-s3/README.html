<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-gfc-aws-s3" class="anchor" href="https://github.com/gilt/gfc-aws-s3#gfc-aws-s3" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>gfc-aws-s3</h1> 
  <p><a href="https://travis-ci.com/gilt/gfc-aws-s3" target="_blank"><img src="https://camo.githubusercontent.com/cacba8f3126fc38843af185bd936d337fff556c2/68747470733a2f2f7472617669732d63692e636f6d2f67696c742f6766632d6177732d73332e7376673f746f6b656e3d474d484a6e7a526b4d6d715773627a7545576757266272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.com/gilt/gfc-aws-s3.svg?token=GMHJnzRkMmqWsbzuEWgW&amp;branch=master" style="max-width:100%;"></a></p> 
  <p>Tools for streaming data to and from S3. Part of the <a href="https://github.com/gilt?q=gfc" target="_blank">Gilt Foundation Classes</a>.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/gilt/gfc-aws-s3#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>The library provides tools to integrate akka-streams with Amazon S3 storage service. To use it add to your dependencies:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-s"><span class="pl-pds">"</span>com.gilt<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>gfc-aws-s3-akka<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.0<span class="pl-pds">"</span></span></pre>
  </div> 
  <p>The library contains akka-stream Sources and Sinks to Stream data from and to S3.</p> 
  <h3><a id="user-content-sinks" class="anchor" href="https://github.com/gilt/gfc-aws-s3#sinks" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sinks</h3> 
  <p>Allows uploading data to S3 in a streaming manner. The underlying implementation uses <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/llJavaUploadFile.html" target="_blank">S3 Multipart upload API</a>. Due to the API requirements the size of the part could not be less than 5Mb. You are to provide the size of the chunk on Source creation, the internals will automatically slice the incoming data into the chunks of the given size and upload those chunks to S3.</p> 
  <p>To create the source:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.gilt.gfc.s3.akka.S3MultipartUploaderSink.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">bucketName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-bucket<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">fileKey</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-file<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">s3Client</span> <span class="pl-k">=</span> <span class="pl-en">AmazonS3ClientBuilder</span>.standard()
  .withRegion(<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>)
  .build
<span class="pl-k">val</span> <span class="pl-en">chunkSize</span> <span class="pl-k">=</span> <span class="pl-c1">6</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-c"><span class="pl-c">//</span> 6 Megabytes</span>

<span class="pl-k">val</span> <span class="pl-en">sink</span> <span class="pl-k">=</span> <span class="pl-en">Sink</span>.s3MultipartUpload(s3Client, bucketName, fileKey, chunkSize)</pre>
  </div> 
  <p>The sink could also be created in different style manner:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.gilt.gfc.s3.akka.</span><span class="pl-v">S3MultipartUploaderSink</span>

<span class="pl-k">val</span> <span class="pl-en">sink</span> <span class="pl-k">=</span> <span class="pl-en">S3MultipartUploaderSink</span>(s3Client, bucketName, fileKey, chunkSize)</pre>
  </div> 
  <p>The materialized value of the sink is the total length of the uploaded file in case of successful uploads.</p> 
  <p>Please, bear in mind, that incomplete uploads eat S3 space (meaning cost you some money) but are not shown in AWS S3 UI. Probably the best idea is to configure S3 so that it will delete parts of the incomplete uploads automatically after given amount of time (<a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/object-lifecycle-mgmt.html" target="_blank">docs</a>)</p> 
  <h3><a id="user-content-sources" class="anchor" href="https://github.com/gilt/gfc-aws-s3#sources" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sources</h3> 
  <p>Allows accessing S3 objects as a stream source in two different manners - by parts and by chunks. The difference is subtle but important:</p> 
  <ol> 
   <li>accessing by parts means that you know or assume that the file was uploaded using S3 multipart API. If the was not uploaded using multipart API it would be downloaded in a single chunk. This will not eat memory, as the source does real streaming, and allows to control the buffer size for download, but could lead to some problems with very large files, as S3 tends to drop long-lasting connections sometimes.</li> 
  </ol> 
  <p>To do that, use:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.gilt.gfc.s3.akka.S3DownloaderSource.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">bucketName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-bucket<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">fileKey</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-file<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">s3Client</span> <span class="pl-k">=</span> <span class="pl-en">AmazonS3ClientBuilder</span>.standard()
  .withRegion(<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>)
  .build
<span class="pl-k">val</span> <span class="pl-en">memoryBufferSize</span> <span class="pl-k">=</span> <span class="pl-c1">128</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-c"><span class="pl-c">//</span> 128 Kb buffer</span>

<span class="pl-k">val</span> <span class="pl-en">source</span> <span class="pl-k">=</span> <span class="pl-en">Source</span>.s3MultipartDownload(s3Client, bucketName, fileKey, memoryBufferSize)</pre>
  </div> 
  <ol start="2"> 
   <li>accessing by chunks means that you provide a size of the part to download, and the source will ultimately use <code>Range</code> header to access file in "seek-and-read" manner. This approach could be used with any S3 object, regardless of whether it was uploaded using multipart API or not. The size of the chunk will affect the number of the requests sent to S3.</li> 
  </ol> 
  <p>To do that use:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.gilt.gfc.s3.akka.S3DownloaderSource.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">bucketName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-bucket<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">fileKey</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test-file<span class="pl-pds">"</span></span>
<span class="pl-k">val</span> <span class="pl-en">s3Client</span> <span class="pl-k">=</span> <span class="pl-en">AmazonS3ClientBuilder</span>.standard()
  .withRegion(<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>)
  .build
<span class="pl-k">val</span> <span class="pl-en">chunkSize</span> <span class="pl-k">=</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>       <span class="pl-c"><span class="pl-c">//</span> 1 Mb chunks to request from S3</span>
<span class="pl-k">val</span> <span class="pl-en">memoryBufferSize</span> <span class="pl-k">=</span> <span class="pl-c1">128</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-c"><span class="pl-c">//</span> 128 Kb buffer</span>

<span class="pl-k">val</span> <span class="pl-en">source</span> <span class="pl-k">=</span> <span class="pl-en">Source</span>.s3ChunkedDownload(s3Client, bucketName, fileKey, chunkSize, memoryBufferSize)</pre>
  </div> 
  <p>The pieces of code above will crease a Source[ByteString], where each ByteString represents a part of the file.</p> 
  <h2><a id="user-content-copyright-and-license" class="anchor" href="https://github.com/gilt/gfc-aws-s3#copyright-and-license" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Copyright and license</h2> 
  <p>Copyright 2017 Gilt Groupe, Hudson's Bay Company</p> 
  <p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> 
  <p><a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">http://www.apache.org/licenses/LICENSE-2.0</a></p> 
  <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p> 
 </article>
</div>