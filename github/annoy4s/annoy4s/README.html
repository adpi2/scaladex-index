<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-annoy4s" class="anchor" href="https://github.com/annoy4s/annoy4s#annoy4s" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>annoy4s</h1> 
  <p><a href="https://travis-ci.org/annoy4s/annoy4s" target="_blank"><img src="https://camo.githubusercontent.com/fe8f24c1ddc863decc5f0ee7b53d4c46d6eedcfc/68747470733a2f2f7472617669732d63692e6f72672f616e6e6f7934732f616e6e6f7934732e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/annoy4s/annoy4s.svg?branch=master" style="max-width:100%;"></a></p> 
  <p>A JNA wrapper around <a href="https://github.com/spotify/annoy" target="_blank">spotify/annoy</a> which calls the C++ library of annoy directly from Scala/JVM.</p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/annoy4s/annoy4s#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>For linux-x86-64 or Mac users, just add the library directly as:</p> 
  <pre><code>libraryDependencies += "net.pishen" %% "annoy4s" % "0.5.0"
</code></pre> 
  <p>If you meet an error like below when using annoy4s, you may have to compile the native library by yourself.</p> 
  <pre><code>java.lang.UnsatisfiedLinkError: Unable to load library 'annoy': Native library
</code></pre> 
  <p>To compile the native library and install annoy4s on local machine:</p> 
  <ol> 
   <li>Clone this repository.</li> 
   <li>Check the values of <code>organization</code> and <code>version</code> in <code>build.sbt</code>, you may change it to the value you want, it's recommended to let <code>version</code> have the <code>-SNAPSHOT</code> suffix.</li> 
   <li>Run <code>compileNative</code> in sbt (Note that g++ installation is required).</li> 
   <li>Run <code>test</code> in sbt to see if the native library is successfully compiled.</li> 
   <li>Run <code>publishLocal</code> in sbt to install annoy4s on your machine.</li> 
  </ol> 
  <p>Now you can add the library dependency as (organization and version may be different according to your settings):</p> 
  <pre><code>libraryDependencies += "net.pishen" %% "annoy4s" % "0.5.0-SNAPSHOT"
</code></pre> 
  <p>The library file generated by the g++ command in <code>compileNative</code> can also be installed independently on your machine. Please reference to <a href="http://java-native-access.github.io/jna/4.4.0/javadoc/com/sun/jna/NativeLibrary.html#library_search_paths" target="_blank">library search paths</a> for more details on how to make JNA able to load the library.</p> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/annoy4s/annoy4s#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Create and query the index in memory mode:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">annoy4s.</span><span class="pl-v">_</span>

<span class="pl-k">val</span> <span class="pl-en">annoy</span> <span class="pl-k">=</span> <span class="pl-en">Annoy</span>.create[<span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>./input_vectors<span class="pl-pds">"</span></span>, numOfTrees <span class="pl-k">=</span> <span class="pl-c1">10</span>, metric <span class="pl-k">=</span> <span class="pl-en">Euclidean</span>, verbose <span class="pl-k">=</span> <span class="pl-c1">true</span>)

<span class="pl-k">val</span> <span class="pl-en">result</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">Seq</span>[(<span class="pl-k">Int</span>, <span class="pl-k">Float</span>)]] <span class="pl-k">=</span> annoy.query(itemId, maxReturnSize <span class="pl-k">=</span> <span class="pl-c1">30</span>)</pre>
  </div> 
  <ul> 
   <li>The format of <code>./input_vectors</code> is <code>&lt;item id&gt; &lt;vector&gt;</code> for each line, here is an example:</li> 
  </ul> 
  <pre><code>3 0.2 -1.5 0.3
5 0.4 0.01 -0.5
0 1.1 0.9 -0.1
2 1.2 0.8 0.2
</code></pre> 
  <ul> 
   <li><code>&lt;item id&gt;</code> could be <code>Int</code>, <code>Long</code>, <code>String</code>, or <code>UUID</code>, just change the type parameter at <code>Annoy.create[T]</code>. You can also implement a <code>KeyConverter[T]</code> by yourself to support your own type.</li> 
   <li><code>metric</code> could be <code>Euclidean</code>, <code>Angular</code>, or <code>Manhattan</code>.</li> 
   <li><code>result</code> is a tuple list of id and distances, where the query item is itself contained.</li> 
  </ul> 
  <p>To use the index in disk mode, one need to provide an <code>outputDir</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">annoy</span> <span class="pl-k">=</span> <span class="pl-en">Annoy</span>.create[<span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>./input_vectors<span class="pl-pds">"</span></span>, <span class="pl-c1">10</span>, outputDir <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>./annoy_result/<span class="pl-pds">"</span></span>, <span class="pl-en">Euclidean</span>)

<span class="pl-k">val</span> <span class="pl-en">result</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">Seq</span>[(<span class="pl-k">Int</span>, <span class="pl-k">Float</span>)]] <span class="pl-k">=</span> annoy.query(itemId, maxReturnSize <span class="pl-k">=</span> <span class="pl-c1">30</span>)

annoy.close()

<span class="pl-c"><span class="pl-c">//</span> load an created index</span>
<span class="pl-k">val</span> <span class="pl-en">reloadedAnnoy</span> <span class="pl-k">=</span> <span class="pl-en">Annoy</span>.load[<span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>./annoy_result/<span class="pl-pds">"</span></span>)

<span class="pl-k">val</span> <span class="pl-en">reloadedResult</span><span class="pl-k">:</span> <span class="pl-en">Option</span>[<span class="pl-en">Seq</span>[(<span class="pl-k">Int</span>, <span class="pl-k">Float</span>)]] <span class="pl-k">=</span> reloadedAnnoy.query(itemId, <span class="pl-c1">30</span>)</pre>
  </div> 
 </article>
</div>