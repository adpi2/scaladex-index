<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-validated-typesafe-configuration" class="anchor" href="https://github.com/carlpulley/validated-config#validated-typesafe-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Validated Typesafe Configuration</h1> 
  <p>When building reactive applications, it is important to fail early and to avoid throwing exceptions. Here, we apply these principles to the <a href="https://github.com/typesafehub/config" target="_blank">Typesafe config</a> library without introducing unnecessary boilerplate code.</p> 
  <p><a href="http://travis-ci.org/carlpulley/validated-config" target="_blank"><img src="https://camo.githubusercontent.com/886bd38864f220ddfb3a74302ad358fef63d55db/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f6361726c70756c6c65792f76616c6964617465642d636f6e6669672e706e673f7461673d312e312e32" alt="Build Status" data-canonical-src="https://secure.travis-ci.org/carlpulley/validated-config.png?tag=1.1.2" style="max-width:100%;"></a> <a href="http://search.maven.org/#artifactdetails%7Cnet.cakesolutions%7Cvalidated-config_2.12%7C1.1.2%7Cjar" target="_blank"><img src="https://camo.githubusercontent.com/304d30b50c86d9ec65ca2f22a99323bea68c2ca4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d6176656e2d2d63656e7472616c2d76312e312e322d626c75652e737667" alt="Maven Central" data-canonical-src="https://img.shields.io/badge/maven--central-v1.1.2-blue.svg" style="max-width:100%;"></a> <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank"><img src="https://camo.githubusercontent.com/2a8aa7a49c97f05dd640050081de2dc08a458840/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f6c2f706c75672e7376673f6d61784167653d32353932303030" alt="Apache 2" data-canonical-src="https://img.shields.io/hexpm/l/plug.svg?maxAge=2592000" style="max-width:100%;"></a> <a href="https://carlpulley.github.io/validated-config/latest/api#cakesolutions.config.package" target="_blank"><img src="https://camo.githubusercontent.com/b6913ba18483a8d22fc6f72342a0d0353ca3bcfc/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f7069702f62616467652f" alt="API" data-canonical-src="https://readthedocs.org/projects/pip/badge/" style="max-width:100%;"></a> <a href="https://www.codacy.com/app/c-pulley/validated-config" target="_blank"><img src="https://camo.githubusercontent.com/199fbf297c6315e7fca5ad83b92b751c7f3202b4/68747470733a2f2f6170692e636f646163792e636f6d2f70726f6a6563742f62616467652f47726164652f3463623737616432353733343465363138353630336463656237623261663635" alt="Codacy Badge" data-canonical-src="https://api.codacy.com/project/badge/Grade/4cb77ad257344e6185603dceb7b2af65" style="max-width:100%;"></a> <a href="https://www.codacy.com/app/c-pulley/validated-config" target="_blank"><img src="https://camo.githubusercontent.com/c27d85bf2e0163431c94f4f78bdbd69340e16976/68747470733a2f2f6170692e636f646163792e636f6d2f70726f6a6563742f62616467652f436f7665726167652f3463623737616432353733343465363138353630336463656237623261663635" alt="Codacy Badge" data-canonical-src="https://api.codacy.com/project/badge/Coverage/4cb77ad257344e6185603dceb7b2af65" style="max-width:100%;"></a></p> 
  <h2><a id="user-content-setup-and-usage" class="anchor" href="https://github.com/carlpulley/validated-config#setup-and-usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Setup and Usage</h2> 
  <p>To use this library, add the following dependency to your <code>build.sbt</code> file:</p> 
  <pre><code>libraryDependencies += "net.cakesolutions" %% "validated-config" % "1.1.2"
</code></pre> 
  <p>To access the validated Typesafe configuration library code in your project code, simply <code>import net.cakesolutions.config._</code>.</p> 
  <h2><a id="user-content-validating-configuration-values" class="anchor" href="https://github.com/carlpulley/validated-config#validating-configuration-values" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Validating Configuration Values</h2> 
  <p>Using <a href="https://github.com/typesafehub/config" target="_blank">Typesafe config</a> we read in and parse configuration files. Paths into these files are then retrieved and type checked using <a href="https://github.com/iheartradio/ficus" target="_blank">Ficus</a>.</p> 
  <p>Using a lightweight DSL, we are able to then check and validate these type checked values. For example, given that the Typesafe configuration:</p> 
  <pre><code>top-level-name = "test"
test {
  nestedVal = 50.68
  nestedDuration = 4 h
  nestedList = []
  context {
    valueInt = 30
    valueStr = "test string"
    valueDuration = 12 ms
    valueStrList = [ "addr1:10", "addr2:20", "addr3:30" ]
    valueDoubleList = [ 10.2, 20, 0.123 ]
  }
}
</code></pre> 
  <p>has been parsed and read into an implicit of type <code>Config</code>, then we are able to validate that the value at the path <code>test.nestedVal</code> has type <code>Double</code> and that it satisfies specified size bounds as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">ShouldBeAPercentageValue</span> <span class="pl-k">extends</span> <span class="pl-e">Exception</span>

validate[<span class="pl-k">Double</span>](<span class="pl-s"><span class="pl-pds">"</span>test.nestedVal<span class="pl-pds">"</span></span>, <span class="pl-en">ShouldBeAPercentageValue</span>)(n <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span> <span class="pl-k">&lt;=</span> n <span class="pl-k">&amp;&amp;</span> n <span class="pl-k">&lt;=</span> <span class="pl-c1">100</span>)</pre>
  </div> 
  <p>If the configuration value at path <code>test.nestedVal</code> fails to pass the percentage bounds check, then <code>Validated.Invalid(NonEmptyList.of(ShouldBeAPercentageValue))</code> is returned. Here, we are using the <a href="https://github.com/typelevel/cats" target="_blank">cats</a> <code>Validated</code> data type.</p> 
  <p>Likewise, we can enforce that all values in the array at the path <code>test.context.valueStrList</code> match the regular expression pattern <code>[a-z0-9]+:[0-9]+</code> as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">ShouldBeASocketValue</span> <span class="pl-k">extends</span> <span class="pl-e">Exception</span>

validate[<span class="pl-en">List</span>[<span class="pl-k">String</span>]](<span class="pl-s"><span class="pl-pds">"</span>test.context.valueStrList<span class="pl-pds">"</span></span>, <span class="pl-en">ShouldBeASocketValue</span>)(_.matches(<span class="pl-s"><span class="pl-pds">"</span>[a-z0-9]+:[0-9]+<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <p>In some instances, we may not care about checking the value at a configuration path. In these cases we can use <code>unchecked</code>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>unchecked[<span class="pl-en">FiniteDuration</span>](<span class="pl-s"><span class="pl-pds">"</span>test.nestedDuration<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>When we require a path to have a value set, then we have two possible options:</p> 
  <ul> 
   <li>check if the configuration path exists and is defined</li> 
   <li>or, use a <a href="https://en.wikipedia.org/wiki/Sentinel_value" target="_blank">sentinal value</a> and validate that the path has a differing value.</li> 
  </ul> 
  <p>When configuration paths are specific to your application, then the first of these approaches is suitable to use. However, if you are overriding the values in 3rd party libraries and <strong>require</strong> a value to be set, then it is necessary to use sentinal values.</p> 
  <p>In the first case, we use <code>required</code> as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre>unchecked[<span class="pl-en">FiniteDuration</span>](required(<span class="pl-s"><span class="pl-pds">"</span>test.nestedDuration<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <p>When using <code>required</code> with sentinal values, it is necessary to specify what the expected sentinal value is as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre>unchecked[<span class="pl-en">FiniteDuration</span>](required(<span class="pl-s"><span class="pl-pds">"</span>test.nestedDuration<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>UNDEFINED<span class="pl-pds">"</span></span>))</pre>
  </div> 
  <h2><a id="user-content-building-validated-config-instances" class="anchor" href="https://github.com/carlpulley/validated-config#building-validated-config-instances" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Building Validated <code>Config</code> Instances</h2> 
  <p>Building validated configuration case class instances is performed using the methods <code>via</code> and <code>mapN</code> (where <code>N</code> is the number to paths being validated). <code>via</code> allows the currently in-scope implicit <code>Config</code> instance to be restricted to a specified path. <code>mapN</code> can be used to construct the case class instance from a product of <code>Validated.Valid</code> values. To do this, <code>mapN</code> takes a validated tuple of arguments that should be the results of either building inner validated case class instances or from using the <code>validate</code> and <code>unchecked</code> methods to validate values at a given path.</p> 
  <h2><a id="user-content-parsing-custom-configuration-values" class="anchor" href="https://github.com/carlpulley/validated-config#parsing-custom-configuration-values" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Parsing Custom Configuration Values</h2> 
  <p>As both <code>unchecked</code> and <code>validate</code> use <a href="https://github.com/iheartradio/ficus" target="_blank">Ficus</a> <a href="https://github.com/iheartradio/ficus/blob/master/src/main/scala/net/ceedubs/ficus/readers/ValueReader.scala" target="_blank">ValueReader</a>'s to parse and type check configuration values, we only need to define a <a href="https://github.com/iheartradio/ficus#custom-extraction" target="_blank">custom extractor</a>.</p> 
  <h2><a id="user-content-example" class="anchor" href="https://github.com/carlpulley/validated-config#example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
  <p>Given the following Scala case classes (with <a href="https://github.com/fthomas/refined" target="_blank">refined</a> refinement types):</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">NameShouldBeNonEmptyAndLowerCase</span> <span class="pl-k">extends</span> <span class="pl-e">Exception</span>
<span class="pl-k">case</span> <span class="pl-k">object</span> <span class="pl-en">ShouldBePositive</span> <span class="pl-k">extends</span> <span class="pl-e">Exception</span>

<span class="pl-k">final</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">HttpConfig</span>(<span class="pl-v">host</span>: <span class="pl-k">String</span>, <span class="pl-v">port</span>: <span class="pl-k">Int</span> <span class="pl-en">Refined</span> <span class="pl-en">Positive</span>)
<span class="pl-k">final</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Settings</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span> <span class="pl-en">Refined</span> <span class="pl-en">MatchesRegex</span>[<span class="pl-en">W</span>.`<span class="pl-s"><span class="pl-pds">"</span>[a-z0-9_-]+<span class="pl-pds">"</span></span>`.<span class="pl-en">T</span>], <span class="pl-v">timeout</span>: <span class="pl-en">FiniteDuration</span>, <span class="pl-v">http</span>: <span class="pl-en">HttpConfig</span>)</pre>
  </div> 
  <p>and the following Typesafe configuration objects (e.g. stored in a file named <code>application.conf</code>):</p> 
  <pre><code>name = "test-data"
http {
  host = "localhost"
  host = ${?HTTP_ADDR}
  port = 80
  port = ${?HTTP_PORT}

  timeout = 30 s
}
</code></pre> 
  <p>then we can generate a validated <code>Settings</code> case class instance as follows:</p> 
  <div class="highlight highlight-source-scala">
   <pre> validateConfig[<span class="pl-en">Settings</span>](<span class="pl-s"><span class="pl-pds">"</span>application.conf<span class="pl-pds">"</span></span>) { <span class="pl-k">implicit</span> config <span class="pl-k">=&gt;</span>
   <span class="pl-en">Applicative</span>[<span class="pl-en">ValidationFailure</span>].map3(
     unchecked[<span class="pl-k">String</span> <span class="pl-en">Refined</span> <span class="pl-en">MatchesRegex</span>[<span class="pl-en">W</span>.`<span class="pl-s"><span class="pl-pds">"</span>[a-z0-9_-]+<span class="pl-pds">"</span></span>`.<span class="pl-en">T</span>]](<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>),
     validate[<span class="pl-en">FiniteDuration</span>](<span class="pl-s"><span class="pl-pds">"</span>http.timeout<span class="pl-pds">"</span></span>, <span class="pl-en">ShouldBePositive</span>)(_ <span class="pl-k">&gt;=</span> <span class="pl-c1">0.</span>seconds),
     via[<span class="pl-en">HttpConfig</span>](<span class="pl-s"><span class="pl-pds">"</span>http<span class="pl-pds">"</span></span>) { <span class="pl-k">implicit</span> config <span class="pl-k">=&gt;</span>
       <span class="pl-en">Applicative</span>[<span class="pl-en">ValidationFailure</span>].map2(
         unchecked[<span class="pl-k">String</span>](<span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>),
         unchecked[<span class="pl-k">Int</span> <span class="pl-en">Refined</span> <span class="pl-k">Int</span>](<span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>)
       )(<span class="pl-en">HttpConfig</span>)
     }
   )(<span class="pl-en">Settings</span>)
 }</pre>
  </div> 
  <p>Internally, we use <code>NonEmptyList[ValueError]</code> for error signal management - however, <code>validateConfig</code> aggregates and materialises such errors as a <code>ConfigError</code> instance.</p> 
  <h2><a id="user-content-secure-validated-configuration" class="anchor" href="https://github.com/carlpulley/validated-config#secure-validated-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Secure Validated Configuration</h2> 
  <p>Using abstract sealed case classes, we can validate configuration data and then ensure that the validated case class instances can not be faked (e.g. via copy constructors or uses of the apply method).</p> 
  <p>If we want to do this, then the previous example's case classes could be rewritten as say:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">net.cakesolutions.example</span>

<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">scala.util.</span><span class="pl-v">Try</span>

<span class="pl-k">import</span> <span class="pl-v">cats.data.</span><span class="pl-v">Validated</span>
<span class="pl-k">import</span> <span class="pl-v">cats.implicits.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">cats.syntax.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">eu.timepit.refined.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">eu.timepit.refined.api.</span><span class="pl-v">Refined</span>
<span class="pl-k">import</span> <span class="pl-v">eu.timepit.refined.auto.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">eu.timepit.refined.numeric.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">eu.timepit.refined.string.</span><span class="pl-v">_</span>

<span class="pl-k">import</span> <span class="pl-v">net.cakesolutions.config.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">LoadValidatedConfig</span> {
  <span class="pl-k">sealed</span> <span class="pl-k">abstract</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">HttpConfig</span>(<span class="pl-v">host</span>: <span class="pl-k">String</span>, <span class="pl-v">port</span>: <span class="pl-k">Int</span> <span class="pl-en">Refined</span> <span class="pl-en">Positive</span>)
  <span class="pl-k">sealed</span> <span class="pl-k">abstract</span> <span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Settings</span>(<span class="pl-v">name</span>: <span class="pl-k">String</span> <span class="pl-en">Refined</span> <span class="pl-en">MatchesRegex</span>[<span class="pl-en">W</span>.`<span class="pl-s"><span class="pl-pds">"</span>[a-z0-9_-]+<span class="pl-pds">"</span></span>`.<span class="pl-en">T</span>], <span class="pl-v">timeout</span>: <span class="pl-en">FiniteDuration</span>, <span class="pl-v">http</span>: <span class="pl-en">HttpConfig</span>)

  <span class="pl-k">def</span> <span class="pl-en">apply</span>()<span class="pl-k">:</span> <span class="pl-en">Validated</span>[<span class="pl-en">ConfigError</span>, <span class="pl-en">Settings</span>] <span class="pl-k">=</span>
    validateConfig[<span class="pl-en">Settings</span>](<span class="pl-s"><span class="pl-pds">"</span>application.conf<span class="pl-pds">"</span></span>) { <span class="pl-k">implicit</span> config <span class="pl-k">=&gt;</span>
      <span class="pl-en">Applicative</span>[<span class="pl-en">ValidationFailure</span>].map3(
        unchecked[<span class="pl-k">String</span> <span class="pl-en">Refined</span> <span class="pl-en">MatchesRegex</span>[<span class="pl-en">W</span>.`<span class="pl-s"><span class="pl-pds">"</span>[a-z0-9_-]+<span class="pl-pds">"</span></span>`.<span class="pl-en">T</span>]](<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>),
        validate[<span class="pl-en">FiniteDuration</span>](<span class="pl-s"><span class="pl-pds">"</span>http.timeout<span class="pl-pds">"</span></span>, <span class="pl-en">ShouldBePositive</span>)(_ <span class="pl-k">&gt;=</span> <span class="pl-c1">0.</span>seconds),
        via[<span class="pl-en">HttpConfig</span>](<span class="pl-s"><span class="pl-pds">"</span>http<span class="pl-pds">"</span></span>) { <span class="pl-k">implicit</span> config <span class="pl-k">=&gt;</span>
          <span class="pl-en">Applicative</span>[<span class="pl-en">ValidationFailure</span>].map2(
            unchecked[<span class="pl-k">String</span>](<span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>),
            unchecked[<span class="pl-k">Int</span> <span class="pl-en">Refined</span> <span class="pl-en">Positive</span>](<span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>)
          )(<span class="pl-k">new</span> <span class="pl-en">HttpConfig</span>(_, _) {})
        }
      )(<span class="pl-k">new</span> <span class="pl-en">Settings</span>(_, _, _) {})
    }
}</pre>
  </div> 
  <p>Here, package <code>net.cakesolutions.example</code> is responsible for loading and parsing our configuration files.</p> 
  <p>As first reported by <a href="https://gist.github.com/tpolecat/a5cb0dc9adeacc93f846835ed21c92d2" target="_blank">@tpolecat</a> and discussed further in <a href="http://www.cakesolutions.net/teamblogs/enforcing-invariants-in-scala-datatypes" target="_blank">Enforcing invariants in Scala datatypes</a>, the use of an sealed abstract case class ensures that constructors, copy constructors and companion apply methods are not created by the compiler. Hence, the only way that instances of <code>HttpConfig</code> and <code>Settings</code> can be created is via the package protected code in the respective implicits - and so we ensure that all such validated configurations are compile time checked as being invariant!</p> 
 </article>
</div>