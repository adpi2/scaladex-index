<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/ovotech/comms-kafka-serialisation#comms-platform-kafka-avro-serialisation" aria-hidden="true" class="anchor" id="user-content-comms-platform-kafka-avro-serialisation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Comms platform Kafka Avro serialisation</h1> 
  <p><a href="https://circleci.com/gh/ovotech/comms-kafka-serialisation/tree/master" target="_blank"> <img src="https://camo.githubusercontent.com/0138d5d8c9a8043b399d8c954907ccc4423922f1/68747470733a2f2f636972636c6563692e636f6d2f67682f6f766f746563682f636f6d6d732d6b61666b612d73657269616c69736174696f6e2f747265652f6d61737465722e7376673f7374796c653d737667" alt="CircleCI" data-canonical-src="https://circleci.com/gh/ovotech/comms-kafka-serialisation/tree/master.svg?style=svg" style="max-width:100%;"> </a></p> 
  <p><a href="https://bintray.com/ovotech/maven/comms-kafka-serialisation/_latestVersion" target="_blank"><img src="https://camo.githubusercontent.com/da3a929a9d67a5f45dc7dda99b2a153fa72590db/68747470733a2f2f6170692e62696e747261792e636f6d2f7061636b616765732f6f766f746563682f6d6176656e2f636f6d6d732d6b61666b612d73657269616c69736174696f6e2f696d616765732f646f776e6c6f61642e737667" alt="Download" data-canonical-src="https://api.bintray.com/packages/ovotech/maven/comms-kafka-serialisation/images/download.svg" style="max-width:100%;"></a></p> 
  <p>This contains various utility functions to generate Kakfa serialisers, deserialisers, producers and consumers for case classes with Avro schemas. It consists of three modules:</p> 
  <ul> 
   <li>comms-kafka-serialisation</li> 
   <li>comms-kafka-cakesolutions-helpers</li> 
   <li>comms-kafka-akka-helpers</li> 
  </ul> 
  <h2><a href="https://github.com/ovotech/comms-kafka-serialisation#how-to-use" aria-hidden="true" class="anchor" id="user-content-how-to-use" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to use</h2> 
  <p>Add a resolver in sbt for the Maven repo on Bintray:</p> 
  <pre><code>resolvers := Resolver.withDefaultResolvers(
    Seq(
      Resolver.bintrayRepo("ovotech", "maven"),
      "confluent-release" at "http://packages.confluent.io/maven/"
    )
  )
</code></pre> 
  <p>Then add a dependency on the library:</p> 
  <pre><code>libraryDependencies += Seq("com.ovoenergy" %% "comms-kafka-serialisation" % "version",
"com.ovoenergy" %% "comms-kafka-cakesolutions-helpers" % "version",
"com.ovoenergy" %% "comms-kafka-akka-helpers" % "version"
)
</code></pre> 
  <p>See the Bintray badge above for the latest version.</p> 
  <h3><a href="https://github.com/ovotech/comms-kafka-serialisation#serialisation" aria-hidden="true" class="anchor" id="user-content-serialisation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Serialisation</h3> 
  <p>Then in your code, for vanilla avro json (de)serialisers with no dependency on a schema registry:</p> 
  <pre><code>import com.ovoenergy.comms.serialisation._

val deserializer = Serialisation.avroDeserializer[MyLovelyKafkaEvent]
val result: Option[MyLovelyKafkaEvent] = deserializer.deserialize("my-topic", messageBytes)
</code></pre> 
  <p>Or for binary avro (de)serialisers with schema registry support:</p> 
  <pre><code>import com.ovoenergy.comms.serialisation._
import com.ovoenergy.kafka.serialization.avro.SchemaRegistryClientSettings

val schemaRegistrySettings = SchemaRegistryClientSettings("schemaRegistryEndpoint:666", Authentication.None, 10, 5)
val deserializerMaybe: Either[Retry.Failed, Deserializer[Option[T]]]= Serialisation.avroBinarySchemaRegistryDeserializer[MyLovelyKafkaEvent](schemaRegistrySettings, false, "my-topic")
// For the sake of a simple example ;)
val deserializer: Deserializer[Option[T]] = deserializerMaybe.right.get
val result: Option[MyLovelyKafkaEvent] = deserializer.deserialize("my-topic", messageBytes)
</code></pre> 
  <p>Note that this functionality is a thin wrapper around the kafka-serialization library, more information on how the schema registry works on its <a href="https://github.com/ovotech/kafka-serialization" target="_blank">readme</a>. The only difference in functionality is that this wrapper will register the schema with the schema registry immediately on startup when the de(serialiser) is created rather than lazily, and deserialised values will be optional, returning Optional.None when deserialisation fails. Additionally, if the call to register the schema fails on creation of a serialiser or deserialiser this will return a Retry.Failed</p> 
  <h3><a href="https://github.com/ovotech/comms-kafka-serialisation#helpers" aria-hidden="true" class="anchor" id="user-content-helpers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Helpers</h3> 
  <p>This is a collection of classes for dealing with the kafka topics. It enumerates all of the topics and events on offer and allows users to make type-safe producers and consumers for either aiven or legacy.</p> 
  <pre><code>    import com.ovoenergy.comms.helpers.{Kafka, Topic}
    import com.ovoenergy.comms.serialisation.Codecs._

    val consumer: Either[Retry.Failed, KafkaConsumer[String, Option[TriggeredV3]]] = Kafka.aiven.triggered.v3.consumer
    val producer: Either[Retry.Failed, KafkaProducer[String, TriggeredV2]] = Kafka.legacy.triggered.v2.producer
</code></pre> 
  <h3><a href="https://github.com/ovotech/comms-kafka-serialisation#test-helpers" aria-hidden="true" class="anchor" id="user-content-test-helpers" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Test Helpers</h3> 
  <p>Currently this consists of a utility to iterate over available topics</p> 
  <pre><code>    import com.ovoenergy.comms.helpers.{Kafka, Topic}
    import ArbGenerator._
    import TopicListTraverser._
    import com.ovoenergy.comms.serialisation.Codecs._
    import shapeless._
    import org.scalacheck.Shapeless._
    
    val visitor = new TopicListVisitor {
        override def apply[E: SchemaFor : Arbitrary : ToRecord : FromRecord : ClassTag](topic: Topic[E]): Unit = {
          println(topic.name)
        }
      }
    TopicListTraverser(Kafka.legacy.allTopics, visitor)
</code></pre> 
  <h2><a href="https://github.com/ovotech/comms-kafka-serialisation#to-release-a-new-version" aria-hidden="true" class="anchor" id="user-content-to-release-a-new-version" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>To release a new version</h2> 
  <p>You will need to be a member of the <code>ovotech</code> organisation on Bintray.</p> 
  <pre><code>$ sbt release
</code></pre> 
  <p>will run the tests, bump the version, build all the artifacts and publish them to Bintray.</p> 
  <p>The first time you run it, you will need to configure sbt with your Bintray credentials beforehand: <code>$ sbt bintrayChangeCredentials</code></p> 
 </article>
</div>