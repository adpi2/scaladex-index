<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/nicolasstucki/multisets#multisets-api-for-scala-collections-bag-trait" aria-hidden="true" class="anchor" id="user-content-multisets-api-for-scala-collections-bag-trait" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Multisets API for Scala collections (<code>Bag</code> trait)</h1> 
  <p>Multisets API for Scala is a new kind of scala.collection (on scala) that is intended to have efficient implementations of multiset operations. Multisets are represented as: <code>scala.scala.collection.Bag</code></p> 
  <p>The multiset operations consist of: <code>union</code>, <code>intersect</code>, <code>diff</code>, <code>maxUnion</code> (a variant of union that represents the generalised set union), <code>contains</code>, <code>multiplicity</code>, <code>mostCommon</code>, <code>leastCommon</code>, ...</p> 
  <p>In Scala, the finite <code>Seq</code> can be used to represent multisets but are not optimized for their uses cases. Bag is not a subtype of Seq mainly because it has no indexing. <code>Bag</code> is not subtype (or supertype) of Set mainly because of incoherences between the definition of <code>union</code>, <code>intersect</code>, and <code>diff</code>. <code>Bag</code> is a subtype of <code>Iterable</code>.</p> 
  <p>Other languages usually use a compact representation of multisets where the data structure keeps a mapping from it's elements to the multiplicity of that element.</p> 
  <p>The implementation of <code>Bag</code> differs from those implementations by making the representation of elements more generic. Bag are mappings from elements to a BagBucket. This gives the possibility of implementing the bucket just like it is implemented in other languages or implementing custom buckets that fit some more specific purpose.</p> 
  <p>The key difference with other implementations is that buckets contain elements that are equivalent to each other but not necessarily equal. This give the user the possibility of grouping elements in a way that suits different needs.</p> 
  <p>Bag delegates subtasks of the Iterable methods to the underlying <code>BagBucket</code>. Therefore optimizations on buckets are reflected on the overall performance. For example if we take the compact representation it is possible to optimize filter (<code>forall</code>, <code>exists</code>, <code>contains</code>,...) to do only one check on the predicate.</p> 
  <p>The type of bucket that the bucket will have is defined at the construction of that bucket. It is defined using a <code>BagBucketFactory</code> that is implicitly taken into every constructor (ideally some default ones should be defined).</p> 
  <p>The code of bags looks like (input <code>--&gt;</code> output):</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">scala.collection.immutable.</span><span class="pl-v">_ </span><span class="pl-c"><span class="pl-c">//</span> Note that Bags are in the scala.collections packages but do not have aliases in Predef</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">m1</span> <span class="pl-k">=</span> <span class="pl-en">Bag</span>.configuration.compact[<span class="pl-k">Int</span>] <span class="pl-c"><span class="pl-c">//</span> define compact representation for Int</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">m2</span> <span class="pl-k">=</span> <span class="pl-en">Bag</span>.configuration.compact[<span class="pl-k">Char</span>] <span class="pl-c"><span class="pl-c">//</span> define compact representation for Char</span>
<span class="pl-en">Bag</span>.from(<span class="pl-c1">'c'</span><span class="pl-k">-</span><span class="pl-k">&gt;</span><span class="pl-c1">2</span>, <span class="pl-c1">'d'</span><span class="pl-k">-</span><span class="pl-k">&gt;</span><span class="pl-c1">3</span>)         <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-s"><span class="pl-pds">"</span>c<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>c<span class="pl-pds">"</span></span>; <span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>)
<span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">3</span>)                   <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">1</span>;<span class="pl-c1">2</span>,<span class="pl-c1">2</span>;<span class="pl-c1">3</span>,<span class="pl-c1">3</span>)
<span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">1</span>) union <span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>)          <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-c1">1</span>;<span class="pl-c1">2</span>)
<span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">3</span>).multiplicity(<span class="pl-c1">2</span>)   <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-c1">2</span>
<span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">3</span>).multiplicity(<span class="pl-c1">5</span>)   <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-c1">0</span>
{ <span class="pl-k">val</span> <span class="pl-en">b</span> <span class="pl-k">=</span> <span class="pl-en">Bag</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">3</span>); b(<span class="pl-c1">2</span>) } <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">2</span>,<span class="pl-c1">2</span>) <span class="pl-c"><span class="pl-c">//</span> Return equivalent elements</span></pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-c"><span class="pl-c">//</span> buckets will group Int that are equivalent modulo 3</span>
<span class="pl-k">val</span> <span class="pl-en">mod3Equiv</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Ordering</span>[<span class="pl-k">Int</span>] {
   <span class="pl-k">def</span> <span class="pl-en">compare</span>(<span class="pl-v">x</span>: <span class="pl-k">Int</span>, <span class="pl-v">y</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-k">Int</span> <span class="pl-k">=</span> (x <span class="pl-k">%</span> <span class="pl-c1">3</span>) <span class="pl-k">-</span> (y <span class="pl-k">%</span> <span class="pl-c1">3</span>)
}

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">m</span> <span class="pl-k">=</span> immutable.<span class="pl-en">TreeBag</span>.configuration.keepAll[<span class="pl-k">Int</span>](mod3Equiv)

<span class="pl-k">val</span> <span class="pl-en">bag</span> <span class="pl-k">=</span> scala.collection.immutable.<span class="pl-en">TreeBag</span>.from(<span class="pl-c1">1</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">2</span>, <span class="pl-c1">3</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">3</span>, <span class="pl-c1">2</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>, <span class="pl-c1">4</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">4</span>, <span class="pl-c1">5</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>, <span class="pl-c1">6</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>, <span class="pl-c1">7</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>, <span class="pl-c1">8</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)

bag       <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">6</span>, <span class="pl-c1">3</span>, <span class="pl-c1">3</span>, <span class="pl-c1">3</span>; <span class="pl-c1">7</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>; <span class="pl-c1">8</span>, <span class="pl-c1">5</span>, <span class="pl-c1">2</span>) <span class="pl-c"><span class="pl-c">//</span> Groups of equivalent elements are separated by ';'</span>
bag(<span class="pl-c1">0</span>)    <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">6</span>, <span class="pl-c1">3</span>, <span class="pl-c1">3</span>, <span class="pl-c1">3</span>) <span class="pl-c"><span class="pl-c">//</span> equivalent modulo 0</span>
bag(<span class="pl-c1">1</span>)    <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">7</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>) <span class="pl-c"><span class="pl-c">//</span> equivalent modulo 1</span>
bag(<span class="pl-c1">2</span>)    <span class="pl-k">--</span><span class="pl-k">&gt;</span> <span class="pl-en">Bag</span>(<span class="pl-c1">8</span>, <span class="pl-c1">5</span>, <span class="pl-c1">2</span>) <span class="pl-c"><span class="pl-c">//</span> equivalent modulo 2</span></pre>
  </div> 
  <h2><a href="https://github.com/nicolasstucki/multisets#tutorial" aria-hidden="true" class="anchor" id="user-content-tutorial" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Tutorial</h2> 
  <p><a href="https://github.com/nicolasstucki/multisets/blob/2.11.x/Tutorial.md" target="_blank">Complete tutorial</a></p> 
  <h2><a href="https://github.com/nicolasstucki/multisets#maven-repository" aria-hidden="true" class="anchor" id="user-content-maven-repository" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Maven repository</h2> 
  <p>It is available on <a href="https://github.com/nicolasstucki/multisets/blob/2.11.x/MavenRepository.md" target="_blank">Maven Central</a></p> 
 </article>
</div>