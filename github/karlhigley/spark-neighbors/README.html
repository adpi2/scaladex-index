<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/karlhigley/spark-neighbors#spark-neighbors--" aria-hidden="true" class="anchor" id="user-content-spark-neighbors--" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>spark-neighbors <a href="https://badge.fury.io/gh/karlhigley%2Fspark-neighbors" target="_blank"><img src="https://camo.githubusercontent.com/394eeb00e03f62e16c4e7a6197bd34ba58377ffb/68747470733a2f2f62616467652e667572792e696f2f67682f6b61726c6869676c6579253246737061726b2d6e65696768626f72732e737667" alt="GitHub version" data-canonical-src="https://badge.fury.io/gh/karlhigley%2Fspark-neighbors.svg" style="max-width:100%;"></a> <a href="https://travis-ci.org/karlhigley/spark-neighbors" target="_blank"><img src="https://camo.githubusercontent.com/f5bc7f4f44b35ac4c763e1ce589e53e77c30868e/68747470733a2f2f7472617669732d63692e6f72672f6b61726c6869676c65792f737061726b2d6e65696768626f72732e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/karlhigley/spark-neighbors.svg?branch=master" style="max-width:100%;"></a></h1> 
  <p>Spark-based approximate nearest neighbors (ANN) using locality-sensitive hashing (LSH)</p> 
  <h3><a href="https://github.com/karlhigley/spark-neighbors#motivation" aria-hidden="true" class="anchor" id="user-content-motivation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Motivation</h3> 
  <p>Spark's MLlib doesn't yet support locality-sensitive hashing or nearest neighbor search. While there are LSH Spark packages available for a variety of distance measures, it has been open question how to support multiple distance measures and hashing schemes behind a unified interface. This library presents one possible way to do that.</p> 
  <h3><a href="https://github.com/karlhigley/spark-neighbors#features" aria-hidden="true" class="anchor" id="user-content-features" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h3> 
  <ul> 
   <li>Computation of nearest neighbors for each point in a dataset</li> 
   <li>Computation of query point nearest neighbors against a dataset</li> 
   <li>Support for five distance measures: 
    <ul> 
     <li>Hamming distance via bit sampling LSH</li> 
     <li>Cosine distance via sign-random-projection LSH</li> 
     <li>Euclidean and Manhattan distances via scalar-random-projection LSH</li> 
     <li>Jaccard distance via Minhash LSH</li> 
    </ul> </li> 
  </ul> 
  <h3><a href="https://github.com/karlhigley/spark-neighbors#linking" aria-hidden="true" class="anchor" id="user-content-linking" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Linking</h3> 
  <p>You can link against this library (for Spark 1.6+) in your program at the following coordinates:</p> 
  <p>Using SBT:</p> 
  <pre><code>libraryDependencies += "com.github.karlhigley" %% "spark-neighbors" % "0.2.2"
</code></pre> 
  <p>Using Maven:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;com.github.karlhigley&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;spark-neighbors_2.10&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;0.2.2&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <p>This library can also be added to Spark jobs launched through spark-shell or spark-submit by using the --packages command line option. For example, to include it when starting the spark shell:</p> 
  <pre><code>$ bin/spark-shell --packages com.github.karlhigley:spark-neighbors_2.10:0.2.2
</code></pre> 
  <p>Unlike using --jars, using --packages ensures that this library and its dependencies will be added to the classpath. The --packages argument can also be used with bin/spark-submit.</p> 
  <h3><a href="https://github.com/karlhigley/spark-neighbors#usage" aria-hidden="true" class="anchor" id="user-content-usage" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h3> 
  <p>ANN models are created using the builder pattern:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.github.karlhigley.spark.neighbors.</span><span class="pl-v">ANN</span>

<span class="pl-k">val</span> <span class="pl-en">annModel</span> <span class="pl-k">=</span>
  <span class="pl-k">new</span> <span class="pl-en">ANN</span>(dimensions <span class="pl-k">=</span> <span class="pl-c1">1000</span>, measure <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hamming<span class="pl-pds">"</span></span>)
    .setTables(<span class="pl-c1">4</span>)
    .setSignatureLength(<span class="pl-c1">64</span>)
    .train(points)</pre>
  </div> 
  <p>An ANN model can compute a variable number of approximate nearest neighbors:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">neighbors</span> <span class="pl-k">=</span> model.neighbors(<span class="pl-c1">10</span>)</pre>
  </div> 
  <h4><a href="https://github.com/karlhigley/spark-neighbors#distance-measures-and-parameters" aria-hidden="true" class="anchor" id="user-content-distance-measures-and-parameters" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Distance Measures and Parameters</h4> 
  <p>The supported distance measures are "hamming", "cosine", "euclidean", "manhattan", and "jaccard". All distance measures allow the number of hash tables and the length of the computed hash signatures to be configured as above. The hashing schemes for Euclidean, Manhattan, and Jaccard distances have some additional configurable parameters:</p> 
  <h5><a href="https://github.com/karlhigley/spark-neighbors#euclidean-and-manhattan-distances" aria-hidden="true" class="anchor" id="user-content-euclidean-and-manhattan-distances" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Euclidean and Manhattan Distances</h5> 
  <p>This hash function depends on a bucket or quantization width. Higher widths lead to signatures that are more similar:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">annModel</span> <span class="pl-k">=</span>
  <span class="pl-k">new</span> <span class="pl-en">ANN</span>(dimensions <span class="pl-k">=</span> <span class="pl-c1">1000</span>, measure <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>euclidean<span class="pl-pds">"</span></span>)
    .setTables(<span class="pl-c1">4</span>)
    .setSignatureLength(<span class="pl-c1">64</span>)
    .setBucketWidth(<span class="pl-c1">5</span>)
    .train(points)</pre>
  </div> 
  <h5><a href="https://github.com/karlhigley/spark-neighbors#jaccard-distance" aria-hidden="true" class="anchor" id="user-content-jaccard-distance" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Jaccard Distance</h5> 
  <p>Minhashing requires two additional parameters: a prime larger than the number of input dimensions and the number of minhash bands. The prime is used in the permutation functions that generate minhash signatures, and the number of bands is used in the process of generating candidate pairs from the signatures.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">val</span> <span class="pl-en">annModel</span> <span class="pl-k">=</span>
  <span class="pl-k">new</span> <span class="pl-en">ANN</span>(dimensions <span class="pl-k">=</span> <span class="pl-c1">1000</span>, measure <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>jaccard<span class="pl-pds">"</span></span>)
    .setTables(<span class="pl-c1">4</span>)
    .setSignatureLength(<span class="pl-c1">128</span>)
    .setPrimeModulus(<span class="pl-c1">739</span>)
    .setBands(<span class="pl-c1">16</span>)
    .train(points)</pre>
  </div> 
  <h2><a href="https://github.com/karlhigley/spark-neighbors#references" aria-hidden="true" class="anchor" id="user-content-references" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>References</h2> 
  <p>Sign random projection:</p> 
  <ul> 
   <li>Charikar, M. "<a href="http://www.cs.princeton.edu/courses/archive/spr04/cos598B/bib/CharikarEstim.pdf" target="_blank">Similarity Estimation Techniques from Rounding Algorithms.</a>" STOC, 2002.</li> 
  </ul> 
  <p>Scalar random projection:</p> 
  <ul> 
   <li>Datar, Immorlica, Indyk, and Mirrokni. "<a href="http://www.cs.princeton.edu/courses/archive/spr05/cos598E/bib/p253-datar.pdf" target="_blank">Locality-sensitive hashing scheme based on p-stable distributions.</a>" SCG, 2004.</li> 
  </ul> 
  <p>Minhash:</p> 
  <ul> 
   <li>Broder, A. "<a href="http://www.cs.princeton.edu/courses/archive/spr05/cos598E/bib/broder97resemblance.pdf" target="_blank">On the resemblance and containment of documents.</a>" Compression and Complexity of Sequences: Proceedings, 1997.</li> 
   <li>Broder, et al. "<a href="http://www.cs.princeton.edu/courses/archive/spring04/cos598B/bib/BroderCFM-minwise.pdf" target="_blank">Min-wise independent permutations.</a>" STOC, 1998.</li> 
  </ul> 
  <p>Survey papers:</p> 
  <ul> 
   <li>Loic Pauleve, Herve Jegou, Laurent Amsaleg. "<a href="https://hal.inria.fr/file/index/docid/567191/filename/paper.pdf" target="_blank">Locality sensitive hashing: a comparison of hash function types and querying mechanisms.</a>" Pattern Recognition Letters, 2010.</li> 
   <li>Jingdong Wang, Heng Tao Shen, Jingkuan Song, and Jianqiu Ji. "<a href="http://arxiv.org/pdf/1408.2927.pdf" target="_blank">Hashing for similarity search: A survey.</a>" CoRR, abs/1408.2927, 2014.</li> 
  </ul> 
  <p>Performance evaluation and tuning:</p> 
  <ul> 
   <li>Wei Dong, Zhe Wang, William Josephson, Moses Charikar, and Kai Li. "<a href="http://www.cs.princeton.edu/cass/papers/cikm08.pdf" target="_blank">Modeling LSH for performance tuning</a>" CIKM, 2008.</li> 
  </ul> 
 </article>
</div>