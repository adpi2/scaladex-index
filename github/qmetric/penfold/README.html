<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a href="https://github.com/qmetric/penfold#penfold" aria-hidden="true" class="anchor" id="user-content-penfold" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Penfold</h1> 
  <p><a href="https://travis-ci.org/qmetric/penfold" target="_blank"><img src="https://camo.githubusercontent.com/8a1549ef4880744dc6060303f6d6108a9a59f2a3/68747470733a2f2f7472617669732d63692e6f72672f716d65747269632f70656e666f6c642e706e67" alt="Build Status" data-canonical-src="https://travis-ci.org/qmetric/penfold.png" style="max-width:100%;"></a></p> 
  <p>Penfold is responsible for managing queues of tasks. A task contains a payload of any valid JSON.</p> 
  <p>The primary purposes that penfold was built for:</p> 
  <ul> 
   <li>messaging</li> 
   <li>job scheduling</li> 
  </ul> 
  <p>Penfold is deployed as a standalone server, or mulitple standalone servers for a clustered environment.</p> 
  <p>Penfold is spoken to via a Restful API, based on the media type <a href="http://stateless.co/hal_specification.html" target="_blank">HAL+JSON</a>.</p> 
  <h2><a href="https://github.com/qmetric/penfold#documentation" aria-hidden="true" class="anchor" id="user-content-documentation" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Documentation</h2> 
  <p><a href="https://github.com/qmetric/penfold/wiki" target="_blank">Refer to Wiki</a></p> 
  <h2><a href="https://github.com/qmetric/penfold#quick-start" aria-hidden="true" class="anchor" id="user-content-quick-start" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Quick start</h2> 
  <h3><a href="https://github.com/qmetric/penfold#installation-and-configuration" aria-hidden="true" class="anchor" id="user-content-installation-and-configuration" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation and configuration</h3> 
  <p>Prerequisites:</p> 
  <ul> 
   <li><a href="https://www.java.com/en/download/" target="_blank">JVM</a> 8+</li> 
   <li><a href="http://www.postgresql.org/" target="_blank">Postgres database server</a></li> 
  </ul> 
  <ol> 
   <li></li> 
  </ol> 
  <p>Download the latest penfold JAR file from <a href="http://search.maven.org/" target="_blank">Maven Central</a>. The JAR can be found under "com.qmetric.penfold"</p> 
  <ol start="2"> 
   <li></li> 
  </ol> 
  <p>Create a new empty database on your Postgres database server</p> 
  <ol start="3"> 
   <li></li> 
  </ol> 
  <p>Create a configuration file named "penfold.conf", and populate with:</p> 
  <pre><code>penfold {

  publicUrl = "http://localhost:8080"

  httpPort = 8080
  
  authentication {
    username = usr
    password = pswd
  }

  database {
    url = "jdbc:postgresql://&lt;HOST:&lt;PORT&gt;/&lt;NAME_OF_EMPTY_DATABASE&gt;"
    username = &lt;USERNAME&gt;
    password = &lt;PASSWORD&gt;
  }
}
</code></pre> 
  <ol start="4"> 
   <li></li> 
  </ol> 
  <p>Start penfold</p> 
  <pre><code>java -Dconfig.file=&lt;CONFIG_FILE_PATH&gt;/penfold.conf -jar penfold.jar
</code></pre> 
  <ol start="5"> 
   <li></li> 
  </ol> 
  <p>Check if penfold server is running ok</p> 
  <pre><code>GET: /healthcheck  HTTP 1.1
</code></pre> 
  <p>If penfold is healthy, then expect to receive a response with a 200 HTTP status code</p> 
  <h3><a href="https://github.com/qmetric/penfold#quick-play-with-api" aria-hidden="true" class="anchor" id="user-content-quick-play-with-api" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Quick play with API</h3> 
  <p>A task has a status:</p> 
  <ul> 
   <li>waiting - task has been scheduled in the future and is waiting to become ready in its assigned queue</li> 
   <li>ready - task is available for starting</li> 
   <li>started - the task has been started</li> 
   <li>cancelled - the task has been cancelled</li> 
   <li>closed - the task has been closed</li> 
  </ul> 
  <p>You can view all tasks by queue and status. For the purpose of this tutorial we will use a queue named "greenback".</p> 
  <pre><code>GET: /queues/greenback/waiting  HTTP 1.1
GET: /queues/greenback/ready  HTTP 1.1
GET: /queues/greenback/started  HTTP 1.1
GET: /queues/greenback/cancelled  HTTP 1.1
GET: /queues/greenback/closed  HTTP 1.1
</code></pre> 
  <p>At this point, each of the above requests should not respond with any tasks.</p> 
  <p>Lets create a new task. Post the following data, replacing the "triggerDate" with a date a few minutes into the future:</p> 
  <pre><code>POST: /tasks  HTTP 1.1

Content-Type: application/json;domain-command=CreateFutureTask
    
{
    "queue": "greenback",
    "triggerDate": "yyyy-MM-dd HH:mm:ss",
    "payload": {
        "customer": { 
            "id": 1,
            "name" : "bob",
            "email": "bob@email.com"
        }
    }
}
</code></pre> 
  <p>You should see a response similar to below. The response lists the attributes of your newly created task, including an auto generated unique task ID. Notice, at this point, the "status" of the task is "waiting".</p> 
  <p>The links section of the response lists what actions and views are available for this task:</p> 
  <ul> 
   <li>self - link to this task resource</li> 
   <li>UpdateTaskPayload - link where requests should be sent to make changes to the task payload (POST)</li> 
   <li>CloseTask - link where requests should be sent to close the task (POST)</li> 
  </ul> 
  <pre><code>201 Created
Content-Type: application/hal+json

{
    "_links": {
        "self": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02"
        },
        "CloseTask": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/1"
        },
        "UpdateTaskPayload": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/1"
        }
    },
    "id": "25cfd0f7-2266-4d6f-9a33-997fec57ed02",
    "payload": {
        "customer": {
            "id": 1,
            "name": "bob",
            "email": "bob@email.com"
        }
    },
    "queue": "greenback",
    "status": "waiting",
    "triggerDate": "2014-07-11 16:05:00",
    "version": 1
}
</code></pre> 
  <p>Like before, send a GET request to view your task in the queue with "waiting" status.</p> 
  <pre><code>GET: /queues/greenback/waiting  HTTP 1.1
</code></pre> 
  <p>Send another request after your task's "triggerDate" has passed to view the task as being ready.</p> 
  <pre><code>GET: /queues/greenback/ready  HTTP 1.1
</code></pre> 
  <p>When your task is "ready", then you should see a response similar to below.</p> 
  <pre><code>{
    "_links": {
        "self": {
            "href": "http://localhost:8080/queues/greenback/ready"
        }
    },
    "id": "greenback",
    "_embedded": {
        "tasks": [
          {
            "_links": {
                "self": {
                    "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02"
                },
                "CloseTask": {
                    "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/2"
                },
                "StartTask": {
                    "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/2"
                },
                "UpdateTaskPayload": {
                    "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/2"
                }
            },
            "id": "25cfd0f7-2266-4d6f-9a33-997fec57ed02",
            "payload": {
                "customer": {
                    "id": 1,
                    "name": "bob",
                    "email": "bob@email.com"
                }
            },
            "queue": "greenback",
            "status": "ready",
            "triggerDate": "2014-07-11 16:05:00",
            "version": 2
          }
        ]
    }
}
</code></pre> 
  <p>Notice the new available action link "StartTask". A task can only be started when it's "ready".</p> 
  <p>Lets start the task by sending a POST to the action link. For any task command (such as creating or starting a task), the Content-Type header MUST always include the command type (the command type is stored as the action link relation name). In this example, since a "StartTask" command has no mandatory properties the command represented in the body of the request is an empty JSON object.</p> 
  <pre><code>POST: /tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/2  HTTP 1.1

Content-Type: application/json;domain-command=StartTask

{}
</code></pre> 
  <p>The task has now been started, you will notice in the POST response that the task's status has changed to "started".</p> 
  <pre><code>{
    "_links": {
        "self": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02"
        },
        "CloseTask": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/3"
        },
        "UpdateTaskPayload": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/3"
        }
    },
    "id": "25cfd0f7-2266-4d6f-9a33-997fec57ed02",
    "payload": {
        "customer": {
            "id": 1,
            "name": "bob",
            "email": "bob@email.com"
        }
    },
    "queue": "greenback",
    "status": "started",
    "triggerDate": "2014-07-11 16:05:00",
    "version": 3
}
</code></pre> 
  <p>Finally, assuming we've done whatever we wanted to do to the task, lets tell Penfold we're done with it and close it (see "CloseTask" action link). Notice the updated Content-Type header in the request below.</p> 
  <pre><code>POST: /tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02/3  HTTP 1.1

Content-Type: application/json;domain-command=CloseTask
    
{}
</code></pre> 
  <p>The task should now be closed.</p> 
  <pre><code>{
    "_links": {
        "self": {
            "href": "http://localhost:8080/tasks/25cfd0f7-2266-4d6f-9a33-997fec57ed02"
        }
    },
    "id": "25cfd0f7-2266-4d6f-9a33-997fec57ed02",
    "payload": {
        "customer": {
            "id": 1,
            "name": "bob",
            "email": "bob@email.com"
        }
    },
    "queue": "greenback",
    "status": "closed",
    "triggerDate": "2014-07-11 16:05:00",
    "version": 4
}
</code></pre> 
 </article>
</div>