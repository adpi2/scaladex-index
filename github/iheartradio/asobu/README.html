<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p><a href="https://travis-ci.org/iheartradio/asobu" target="_blank"><img src="https://camo.githubusercontent.com/d6c058c50688aeac4e6b6f06b8ecace2e679be4f/68747470733a2f2f7472617669732d63692e6f72672f696865617274726164696f2f61736f62752e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/iheartradio/asobu.svg" style="max-width:100%;"></a> <a href="http://waffle.io/iheartradio/asobu" target="_blank"><img src="https://camo.githubusercontent.com/5849aa7e60c8de0ccdd87fc0befa90d13b8d9a03/68747470733a2f2f62616467652e776166666c652e696f2f696865617274726164696f2f61736f62752e7376673f6c6162656c3d7265616479267469746c653d5265616479" alt="Stories in Ready" data-canonical-src="https://badge.waffle.io/iheartradio/asobu.svg?label=ready&amp;title=Ready" style="max-width:100%;"></a> <a href="https://coveralls.io/github/iheartradio/asobu?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/a2759274546f31a06279d6b3cf2f6747c78124c3/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f696865617274726164696f2f61736f62752f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/github/iheartradio/asobu/badge.svg?branch=master" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-asobu" class="anchor" href="https://github.com/iheartradio/asobu#asobu" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Asobu</h1> 
  <h2><a id="user-content-note-this-libary-is-not-ready-for-external-usage-outside-of-iheartradio-yet" class="anchor" href="https://github.com/iheartradio/asobu#note-this-libary-is-not-ready-for-external-usage-outside-of-iheartradio-yet" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Note: this libary is not ready for external usage outside of iHeartRadio yet.</h2> 
  <p>Asobu is a library that provides ability to create distributed Http endpoints between Play applications and Akka applications deployed in an Akka cluster.</p> 
  <h2><a id="user-content-caveat" class="anchor" href="https://github.com/iheartradio/asobu#caveat" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Caveat</h2> 
  <p>Asobu requires use site having <a href="https://issues.scala-lang.org/browse/SI-2712" target="_blank">SI-2712</a> fixed. The easiest way to achieve that would be using Miles Sabing's <a href="https://github.com/milessabin/si2712fix-plugin" target="_blank">SI-2712 fix plugin</a>. In short, you can add the following to your build.sbt file. Also we are pre-release so the API is by no means stable yet, but we'd love to see feedbacks, contributions etc.</p> 
  <div class="highlight highlight-source-scala">
   <pre>addCompilerPlugin(<span class="pl-s"><span class="pl-pds">"</span>com.milessabin<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>si2712fix-plugin<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.1.0<span class="pl-pds">"</span></span> cross <span class="pl-en">CrossVersion</span>.full)</pre>
  </div> 
  <h2><a id="user-content-distributed-endpoints" class="anchor" href="https://github.com/iheartradio/asobu#distributed-endpoints" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Distributed Endpoints</h2> 
  <p>Distributed endpoints allows you to dynamically add/remove Http endpoints at the Play app and having the request preprocessed and forwarded to the Akka App. This will allow a more flexible microservice architecture in which</p> 
  <ol> 
   <li>the play app serves http endpoints as an API gateway</li> 
   <li>microservices are implemented as Akka apps and can add/remove Http endpoints at the API gateway</li> 
   <li>there is no binary dependencies between the API gateway and the microservics.</li> 
   <li>complex cross-cutting logic such as authentication, validation and error handling can be written in the central API gateway, i.e. the play app, and updated without redeploying the microservices.</li> 
  </ol> 
  <h2><a id="user-content-usage" class="anchor" href="https://github.com/iheartradio/asobu#usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Usage</h2> 
  <p>Add asobu to dependences in your play app as</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> {
  <span class="pl-k">val</span> <span class="pl-en">version</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.3<span class="pl-pds">"</span></span>
  <span class="pl-en">Seq</span>(
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-dsl<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version,
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-distributed<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version,
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-dsl-akka<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version
  )
}
</pre>
  </div> 
  <p>Add asobu to dependencies in your akka app as</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">++</span><span class="pl-k">=</span> {
  <span class="pl-k">val</span> <span class="pl-en">version</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>0.1.3<span class="pl-pds">"</span></span>
  <span class="pl-en">Seq</span>(
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-dsl<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version,
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-distributed<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version,
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-distributed-kanaloa<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version,
    <span class="pl-s"><span class="pl-pds">"</span>com.iheart<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>asobu-dsl-akka<span class="pl-pds">"</span></span> <span class="pl-k">%</span> version
  )
}
</pre>
  </div> 
  <p>Then for both the play app and the akka app you have to enable distributed data by adding the following into the conf file,</p> 
  <pre><code>akka {

  //add distributed data extension to existing extensions
  extensions += "akka.cluster.ddata.DistributedData"

  //add the cluster role to existing roles
  cluster.roles += "distributed-service"

  actor.distributed-data.role = "distributed-service"

}

</code></pre> 
  <p>Then to create new endpoints at the akka app side, you need to write routes files and controllers. The routes file will look like a play routes file Here is example</p> 
  <pre><code>GET   /users/:userId/tests/groups    abtest.MainController.getGroups(userId: Int, time: Long)

POST  /tests      poweramp.abtest.MainController.createTest()
</code></pre> 
  <p>Then write a controller using asobu DSL, e.g.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">abtest</span>

<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">MainController</span>(<span class="pl-v">backend</span>: <span class="pl-en">ActorRef</span>)(
  <span class="pl-k">implicit</span>
  <span class="pl-v">sys</span>:     <span class="pl-en">ActorSystem</span>,
  <span class="pl-v">epc</span>:     <span class="pl-en">EndpointsRegistryClient</span>,
  <span class="pl-v">timeout</span>: <span class="pl-en">Timeout</span>,
  <span class="pl-v">ec</span>:      <span class="pl-en">ExecutionContext</span>
) <span class="pl-k">extends</span> <span class="pl-e">DistributedController</span> {

  handle(
    <span class="pl-s"><span class="pl-pds">"</span>getGroups<span class="pl-pds">"</span></span>,
    process[<span class="pl-en">GetGroups</span>]()
  )(using(backend).
      expect[<span class="pl-en">GroupsResult</span>] <span class="pl-k">&gt;&gt;</span>
      respondJson(<span class="pl-en">Ok</span>))

  handle(
    <span class="pl-s"><span class="pl-pds">"</span>createTest<span class="pl-pds">"</span></span>,
    process[<span class="pl-en">CreateTest</span>](
     from(author <span class="pl-k">=</span> authenticatedUserName),
     from(test   <span class="pl-k">=</span> jsonBody[<span class="pl-en">ABTest</span>]))
  )(using(backend).
      expect[<span class="pl-en">TestCreated</span>] <span class="pl-k">&gt;&gt;</span>
      respondJson(<span class="pl-en">Ok</span>))
}
</pre>
  </div> 
  <p>The constructor parameter <code>backend</code> is the actual actor that handles the messages such as <code>GetGroups</code> and <code>CreateTest</code> in this example. Then in the main class of the akka app you need to initialize the controllers so they get to register the endpoints they created to the remote play app.</p> 
  <pre><code>  implicit val timeout: Timeout = 30.seconds

    init { implicit rec ⇒
      List(
        new MainController(myBackend)
      )
    }

</code></pre> 
  <p>finally some boilerplate on the play app side. first in the conf file you need to enable asobu module</p> 
  <pre><code>play.modules.enabled += "asobu.distributed.gateway.GateWayModule"
</code></pre> 
  <p>then at the last of your root routes file add</p> 
  <pre><code>-&gt;    /                         asobu.distributed.gateway.GatewayRouter
</code></pre> 
  <p>Then you should be all set.</p> 
  <h2><a id="user-content-example" class="anchor" href="https://github.com/iheartradio/asobu#example" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Example</h2> 
  <p>An example project can be find in the <a href="https://github.com/iheartradio/asobu/blob/master/example" target="_blank">example</a> folder.</p> 
  <h2><a id="user-content-swagger-integration" class="anchor" href="https://github.com/iheartradio/asobu#swagger-integration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Swagger integration</h2> 
  <p>Asobu supports API documentation generation integration, so that API documentation can be generated at individual microservices (i.e. akka app) and submitted to the play app to be congregated as a whole. You can find an example of such integration with <a href="https://github.com/iheartradio/play-swagger" target="_blank">play-swagger</a> in the example. The basic idea is that you provide an apiDocGenerator at the Akka microservice side before initing the controllers , e.g.</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">lazy</span> <span class="pl-k">val</span> <span class="pl-en">swaggerGenerator</span> <span class="pl-k">=</span> <span class="pl-en">SwaggerSpecGenerator</span>(<span class="pl-s"><span class="pl-pds">"</span>backend<span class="pl-pds">"</span></span>)(getClass.getClassLoader)

  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">apiDocGenerator</span> <span class="pl-k">=</span> (<span class="pl-v">prefix</span>: <span class="pl-en">Prefix</span>, <span class="pl-v">routes</span>: <span class="pl-en">Seq</span>[<span class="pl-en">Route</span>]) <span class="pl-k">=&gt;</span> {
    <span class="pl-k">val</span> <span class="pl-en">doc</span><span class="pl-k">:</span> <span class="pl-en">JsObject</span> <span class="pl-k">=</span> swaggerGenerator.generateFromRoutes(<span class="pl-en">ListMap</span>((<span class="pl-s"><span class="pl-pds">"</span>backend<span class="pl-pds">"</span></span>,(prefix.value, routes))))
    <span class="pl-en">Some</span>(doc)
  }</pre>
  </div> 
  <p>And then at the play api side you can get the congregated API documentation from asobu <code>Gateway</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">ApiDocuments</span> <span class="pl-k">@</span><span class="pl-en">Inject</span>() (<span class="pl-v">gateway</span>: <span class="pl-en">Gateway</span>) <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {

<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">to</span><span class="pl-k">:</span> <span class="pl-en">Timeout</span> <span class="pl-k">=</span> <span class="pl-c1">60.</span>seconds

<span class="pl-k">def</span> <span class="pl-en">specs</span> <span class="pl-k">=</span> <span class="pl-en">Action</span>.async { _ <span class="pl-k">=&gt;</span>
  (gateway.apiDocsRegistry <span class="pl-k">?</span> <span class="pl-en">Retrieve</span>).mapTo[<span class="pl-en">JsObject</span>].map(<span class="pl-en">Ok</span>(_))
}
}</pre>
  </div> 
  <p>Example can be found in the <a href="https://github.com/iheartradio/asobu/blob/master/example" target="_blank">example</a> project.</p> 
  <h2><a id="user-content-kanaloa-integration" class="anchor" href="https://github.com/iheartradio/asobu#kanaloa-integration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Kanaloa integration</h2> 
  <p>Asobu aslo support integration with kanaloa sitting between play app and the microservice akka app. You need to add the asobu-distributed-kanaloa dependency</p> 
  <pre><code>  libraryDependencies ++= "com.iheart" %% "asobu-distributed-kanaloa" % version
</code></pre> 
  <p>and then in play application add the following class</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">package</span> <span class="pl-en">util</span>
<span class="pl-k">class</span> <span class="pl-en">KanaloaBridge</span> <span class="pl-k">@</span><span class="pl-en">Inject</span>() (<span class="pl-k">implicit</span> <span class="pl-v">config</span>: <span class="pl-en">Configuration</span>, <span class="pl-v">system</span>: <span class="pl-en">ActorSystem</span>) <span class="pl-k">extends</span> <span class="pl-e">AbstractKanaloaBridge</span> {

  <span class="pl-k">override</span> <span class="pl-k">protected</span> <span class="pl-k">def</span> <span class="pl-en">resultChecker</span><span class="pl-k">:</span> <span class="pl-en">ResultChecker</span> <span class="pl-k">=</span> {
    <span class="pl-k">case</span> <span class="pl-v">e</span>: <span class="pl-en">ErrorResult</span>[_] <span class="pl-k">⇒</span> <span class="pl-en">Left</span>(e.toString)
    <span class="pl-k">case</span> m                <span class="pl-k">⇒</span> <span class="pl-en">Right</span>(m)
  }
}
</pre>
  </div> 
  <p>where <code>ErrorResult</code> is your error class.</p> 
  <p>Then in the config file, add,</p> 
  <pre><code>asobu.bridgePropsClass = "util.KanaloaBridge"

</code></pre> 
 </article>
</div>