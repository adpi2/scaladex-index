<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <p><a href="https://travis-ci.org/zalando-incubator/hutmann" target="_blank"><img src="https://camo.githubusercontent.com/9cf706c2306e40f4dc2a59d636bb91a0b0cfc42b/68747470733a2f2f7472617669732d63692e6f72672f7a616c616e646f2d696e63756261746f722f6875746d616e6e2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/zalando-incubator/hutmann.svg?branch=master" style="max-width:100%;"></a> <a href="https://coveralls.io/github/hutmann/hutmann?branch=master" target="_blank"><img src="https://camo.githubusercontent.com/fe0ef126ee45c0dcdc5b6f5bdcc59a4518cc4b67/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f7a616c616e646f2d696e63756261746f722f6875746d616e6e2f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/github/zalando-incubator/hutmann/badge.svg?branch=master" style="max-width:100%;"></a> <a href="https://raw.githubusercontent.com/zalando-incubator/hutmann/master/LICENSE" target="_blank"><img src="https://camo.githubusercontent.com/6a40b4913be1852a0fe4a896c5912412202f9169/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d677265656e2e737667" alt="MIT licensed" data-canonical-src="https://img.shields.io/badge/license-MIT-green.svg" style="max-width:100%;"></a></p> 
  <h1><a id="user-content-hutmann---a-scalaplay-library-for-oauth2-authentication" class="anchor" href="https://github.com/zalando-incubator/hutmann#hutmann---a-scalaplay-library-for-oauth2-authentication" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Hutmann - a Scala/Play library for OAuth2 authentication</h1> 
  <p>This library provides support for using OAuth2 for authentication, mainly for backends, that use the Play framework (2.4). Additionally, it brings some support for logging and flow ids that can be used to follow requests through several microservices. It should not require much setup before using it - see <code>Configuration</code> for more details.</p> 
  <p>The name stems from the german mining term <a href="https://de.wikipedia.org/wiki/Hutmann" target="_blank">Hutmann</a>, who was responsible to make sure that no unauthorized person drove into the pit.</p> 
  <h2><a id="user-content-features" class="anchor" href="https://github.com/zalando-incubator/hutmann#features" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features</h2> 
  <ul> 
   <li>OAuth2 handling for backend services</li> 
   <li>Extended logging functionality</li> 
   <li>Flow ID handling</li> 
  </ul> 
  <h2><a id="user-content-key-concepts" class="anchor" href="https://github.com/zalando-incubator/hutmann#key-concepts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Key concepts</h2> 
  <p>We tried to minimize the needed user setup if you want to have a working minimal solution. There is a special play <code>Action</code> that you can use to mark services that require authentication, so places that have beforehand been like</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.hutmann.authentication.</span><span class="pl-v">OAuth2Action</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.mvc.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.mvc.Results.</span><span class="pl-v">_</span>

  <span class="pl-k">def</span> <span class="pl-en">heartbeat</span> <span class="pl-k">=</span> <span class="pl-en">Action</span> {
    <span class="pl-en">Ok</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;3<span class="pl-pds">"</span></span>)
  }</pre>
  </div> 
  <p>become</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">ExecutionContext</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.ws.</span><span class="pl-v">WSClient</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.</span><span class="pl-v">Configuration</span>

<span class="pl-c"><span class="pl-c">//</span>these come from the application normally</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">ws</span><span class="pl-k">:</span> <span class="pl-en">WSClient</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>
<span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">config</span><span class="pl-k">:</span> <span class="pl-en">Configuration</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.ExecutionContext.Implicits.</span><span class="pl-v">global</span>

  <span class="pl-k">def</span> <span class="pl-en">heartbeat</span> <span class="pl-k">=</span> <span class="pl-en">OAuth2Action</span>()(implicitly[<span class="pl-en">ExecutionContext</span>], implicitly[<span class="pl-en">WSClient</span>], implicitly[<span class="pl-en">Configuration</span>]) { 
    <span class="pl-en">Ok</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;3<span class="pl-pds">"</span></span>)
  }</pre>
  </div> 
  <p>and it automatically makes sure that requests to that route have a valid authentication token - although most probably, you won't make your heartbeat endpoint secured.</p> 
  <h1><a id="user-content-related-projects--why-this-one" class="anchor" href="https://github.com/zalando-incubator/hutmann#related-projects--why-this-one" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Related projects / Why this one?</h1> 
  <p>tell something about the other frameworks etc</p> 
  <h1><a id="user-content-getting-started" class="anchor" href="https://github.com/zalando-incubator/hutmann#getting-started" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Getting started</h1> 
  <h2><a id="user-content-perquisites-and-dependencies" class="anchor" href="https://github.com/zalando-incubator/hutmann#perquisites-and-dependencies" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Perquisites and dependencies</h2> 
  <p>The library currently only works with Play 2.4. It depends on its JSON and WS libraries, which your project must bring.</p> 
  <h2><a id="user-content-getting-it" class="anchor" href="https://github.com/zalando-incubator/hutmann#getting-it" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Getting it</h2> 
  <p>Versioning follows the Play version number it works with. 2.4.x therefore is a version that works with Play 2.4, 2.5.x (if any) works with Play 2.5.</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>org.zalando<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>hutmann<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>2.5.1<span class="pl-pds">"</span></span></pre>
  </div> 
  <h2><a id="user-content-configuring" class="anchor" href="https://github.com/zalando-incubator/hutmann#configuring" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuring</h2> 
  <p>If you are a user of the Zalando OAuth2 infrastructure, you don't need to configure anything. The following configuration keys may be interesting though:</p> 
  <div class="highlight highlight-source-json">
   <pre>org.zalando.hutmann.authentication.oauth<span class="pl-c1">2</span>: {
  <span class="pl-ii">tokenInfoUrl</span>: <span class="pl-s"><span class="pl-pds">"</span>https://info.services.auth.zalando.com/oauth2/tokeninfo<span class="pl-pds">"</span></span>
  <span class="pl-ii">tokenQueryParam:</span> <span class="pl-s"><span class="pl-pds">"</span>access_token<span class="pl-pds">"</span></span>
}</pre>
  </div> 
  <h1><a id="user-content-feature-explanation-and-their-usage" class="anchor" href="https://github.com/zalando-incubator/hutmann#feature-explanation-and-their-usage" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Feature explanation and their usage</h1> 
  <h2><a id="user-content-oauth2action" class="anchor" href="https://github.com/zalando-incubator/hutmann#oauth2action" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>OAuth2Action</h2> 
  <p>The <code>OAuth2Action</code> is used to secure your backend endpoints. It is made to return simple error messages, but you are free to extend the implementation if you need it by simply subclassing the Action. Besides the simple usage example that you already found above, this is a more elaborate example:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.hutmann.authentication.Filters.</span><span class="pl-v">_</span>
<span class="pl-k">def</span> <span class="pl-en">heartbeat</span> <span class="pl-k">=</span> <span class="pl-en">OAuth2Action</span>(scope(<span class="pl-s"><span class="pl-pds">"</span>myservice.read<span class="pl-pds">"</span></span>))(implicitly[<span class="pl-en">ExecutionContext</span>], implicitly[<span class="pl-en">WSClient</span>], implicitly[<span class="pl-en">Configuration</span>]) {
  <span class="pl-en">Ok</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;3<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <p>will only allow the users with scope <code>myservice.read</code>, and only if he has a valid access token, while</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">heartbeat</span> <span class="pl-k">=</span> <span class="pl-en">OAuth2Action</span>(isEmployee)(implicitly[<span class="pl-en">ExecutionContext</span>], implicitly[<span class="pl-en">WSClient</span>], implicitly[<span class="pl-en">Configuration</span>]) {
  <span class="pl-en">Ok</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;3<span class="pl-pds">"</span></span>)
}</pre>
  </div> 
  <p>will check if the token is from realm "/employees" and has a scope "uid" property set.</p> 
  <p>In both cases, the body of the action will only get called when the user may access it, and error responses are generated accordingly. If you do not want this behaviour, but care yourself for the handling, you have two possibilities:</p> 
  <ul> 
   <li>You can extend <code>OAuth2Action</code> in your project and <code>override def autoRejectBehaviour</code>, which allows you to specify in which case you want you want what behaviour. This is the recommended approach.</li> 
   <li>You can set <code>autoReject = false</code> as a parameter, and have a look at the request property <code>user</code> which is either a user, or an <code>AuthorizationProblem</code>. This is basically "doing everything by hand".</li> 
  </ul> 
  <p>The default timeout for contacting the server is 1 second, a request will be repeated once in case a timeout occurs, with circuit breakers applied.</p> 
  <h4><a id="user-content-create-own-authorization--using-your-own-servers" class="anchor" href="https://github.com/zalando-incubator/hutmann#create-own-authorization--using-your-own-servers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Create own authorization / using your own servers</h4> 
  <p>You can do so by subclassing OAuth2Action and <code>override def validateToken</code>.</p> 
  <h4><a id="user-content-how-to-mock-values-in-tests" class="anchor" href="https://github.com/zalando-incubator/hutmann#how-to-mock-values-in-tests" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to mock values in tests?</h4> 
  <p>Just create this in your project:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">scala.concurrent.duration.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">scala.concurrent.</span><span class="pl-v">Future</span>
<span class="pl-k">import</span> <span class="pl-v">com.typesafe.config.</span><span class="pl-v">Config</span>

<span class="pl-k">import</span> <span class="pl-v">org.zalando.hutmann.authentication.</span><span class="pl-v">_</span>
<span class="pl-k">trait</span> <span class="pl-en">Auth</span> {
  <span class="pl-k">def</span> <span class="pl-en">authAction</span>(
      <span class="pl-v">filter</span>:     <span class="pl-en">User</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>] <span class="pl-k">=</span> { <span class="pl-v">user</span>: <span class="pl-en">User</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>.successful(<span class="pl-c1">true</span>) },
      <span class="pl-v">autoReject</span>: <span class="pl-k">Boolean</span>                 <span class="pl-k">=</span> <span class="pl-c1">true</span>,
      <span class="pl-v">requestTimeout</span>: <span class="pl-en">Duration</span>            <span class="pl-k">=</span> <span class="pl-c1">1.</span>second
    )(<span class="pl-k">implicit</span> <span class="pl-v">config</span>: <span class="pl-en">Config</span>, <span class="pl-v">ec</span>: <span class="pl-en">ExecutionContext</span>, <span class="pl-v">ws</span>: <span class="pl-en">WSClient</span>)<span class="pl-k">:</span> <span class="pl-en">OAuth2Action</span> <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-en">OAuth2Action</span>(filter, autoReject, requestTimeout)
}
<span class="pl-k">trait</span> <span class="pl-en">FakeAuth</span> <span class="pl-k">extends</span> <span class="pl-e">Auth</span> {
  <span class="pl-k">val</span> <span class="pl-en">userResult</span><span class="pl-k">:</span> <span class="pl-en">Either</span>[<span class="pl-en">AuthorizationProblem</span>, <span class="pl-en">User</span>]
  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">authAction</span>(
      <span class="pl-v">filter</span>:     <span class="pl-en">User</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>[<span class="pl-k">Boolean</span>] <span class="pl-k">=</span> { <span class="pl-v">user</span>: <span class="pl-en">User</span> <span class="pl-k">=&gt;</span> <span class="pl-en">Future</span>.successful(<span class="pl-c1">true</span>) },
      <span class="pl-v">autoReject</span>: <span class="pl-k">Boolean</span>                 <span class="pl-k">=</span> <span class="pl-c1">true</span>,
      <span class="pl-v">requestTimeout</span>: <span class="pl-en">Duration</span>            <span class="pl-k">=</span> <span class="pl-c1">1.</span>second
    )(<span class="pl-k">implicit</span> <span class="pl-v">config</span>: <span class="pl-en">Config</span>, <span class="pl-v">ec</span>: <span class="pl-en">ExecutionContext</span>, <span class="pl-v">ws</span>: <span class="pl-en">WSClient</span>)<span class="pl-k">:</span> <span class="pl-en">OAuth2Action</span> <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-en">OAuth2Action</span>(filter, autoReject, requestTimeout) {
        <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">transform</span>[<span class="pl-en">A</span>](<span class="pl-v">request</span>: <span class="pl-en">Request</span>[<span class="pl-en">A</span>])<span class="pl-k">:</span> <span class="pl-en">Future</span>[<span class="pl-en">UserRequest</span>[<span class="pl-en">A</span>]] <span class="pl-k">=</span>
          <span class="pl-en">Future</span>.successful(<span class="pl-k">new</span> <span class="pl-en">UserRequest</span>(userResult, request)(request))
      }
}</pre>
  </div> 
  <p>You now only need to mix in <code>Auth</code> in your controller, and <code>FakeAuth</code> in your controller in your tests, additionally provide the result you'd like to have in the <code>FakeAuth</code>.</p> 
  <h4><a id="user-content-how-to-respond-with-custom-responses-for-401-403-and-504-cases" class="anchor" href="https://github.com/zalando-incubator/hutmann#how-to-respond-with-custom-responses-for-401-403-and-504-cases" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to respond with custom responses for 401, 403 and 504 cases?</h4> 
  <p>Extend <code>OAuth2Action</code> and override <code>autoRejectBehaviour</code>. You can copy the initial implementation and adjust for your needs.</p> 
  <h2><a id="user-content-filters" class="anchor" href="https://github.com/zalando-incubator/hutmann#filters" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Filters</h2> 
  <p>Play filters are used to run right after the routing and before invoking the action. This makes them particularly useful for cases like</p> 
  <ul> 
   <li>Logging request information (headers and response codes)</li> 
   <li>Adding flow information (flow ids) to the requests</li> 
  </ul> 
  <p>Refer to the <a href="https://www.playframework.com/documentation/2.4.x/ScalaHttpFilters" target="_blank">Play documentation</a> on how to add filters to your project.</p> 
  <h3><a id="user-content-loggingfilter" class="anchor" href="https://github.com/zalando-incubator/hutmann#loggingfilter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>LoggingFilter</h3> 
  <p>This one is used to log headers (including flow ids) and response codes of your requests, as well as the duration between an incoming request and the outgoing response.</p> 
  <h3><a id="user-content-flowidfilter" class="anchor" href="https://github.com/zalando-incubator/hutmann#flowidfilter" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>FlowIdFilter</h3> 
  <p><strong>What is a Flow ID?</strong> A flow id is a specific header that a service consumes and sends to all connected services that are called from the same flow. This flow id shall additionally be added to all log entries of your services. This way, you can track your requests through your microservice infrastructure.</p> 
  <p>The <code>FlowIdFilter</code> inspects the requests that come in if they have a flow id and - depending on the configuration - either adds one if it there is none, or rejects the request.</p> 
  <h2><a id="user-content-more-logging" class="anchor" href="https://github.com/zalando-incubator/hutmann#more-logging" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More logging</h2> 
  <p>You can use the integrated logger in your projects as well, and benefit from the automatic context evaluation that will take care that you have your flow ids in every log entry.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">org.zalando.hutmann.logging.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">play.api.libs.json.</span><span class="pl-v">_</span>

<span class="pl-k">object</span> <span class="pl-en">MyController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span> {
  <span class="pl-k">def</span> <span class="pl-en">doSomething</span>(<span class="pl-k">implicit</span> <span class="pl-v">context</span>: <span class="pl-en">Context</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span> <span class="pl-k">=</span> {
    <span class="pl-en">Logger</span>.warn(<span class="pl-s"><span class="pl-pds">"</span>watch out!<span class="pl-pds">"</span></span>)
  }

  <span class="pl-k">def</span> <span class="pl-en">createSession</span><span class="pl-k">:</span> <span class="pl-en">Action</span>[<span class="pl-en">JsValue</span>] <span class="pl-k">=</span> <span class="pl-en">OAuth2Action</span>()(implicitly[<span class="pl-en">ExecutionContext</span>], implicitly[<span class="pl-en">WSClient</span>], implicitly[<span class="pl-en">Configuration</span>])(parse.tolerantJson) { request <span class="pl-k">=&gt;</span>
    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">context</span><span class="pl-k">:</span> <span class="pl-en">Context</span> <span class="pl-k">=</span> request <span class="pl-c"><span class="pl-c">//</span>there is an implicit conversion for the request</span>
    doSomething
    <span class="pl-en">Logger</span>.info(<span class="pl-s"><span class="pl-pds">"</span>some message<span class="pl-pds">"</span></span>)
    <span class="pl-en">Created</span>
  }
}</pre>
  </div> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">MyController</span>.createSession(<span class="pl-en">FakeRequest</span>().withJsonBody(<span class="pl-en">Json</span>.obj()))</pre>
  </div> 
  <pre><code>09:52:00.578 [pool-1-thread-1-ScalaTest-running-LoggerDemo] WARN application - watch out! - 1ms/TheSourceFile.scala:15/THEFLOWID
09:52:00.578 [pool-1-thread-1-ScalaTest-running-LoggerDemo] INFO application - some message - 1ms/TheSourceFile.scala:20/THEFLOWID
</code></pre> 
  <p>will automatically log the passed time since the beginning of the flow (creation of the context), the flow id, and the source code line where the log event was created.</p> 
 </article>
</div>