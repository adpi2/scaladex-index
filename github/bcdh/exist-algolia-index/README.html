<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-еХist-indexer-for-algolia" class="anchor" href="https://github.com/bcdh/exist-algolia-index#еХist-indexer-for-algolia" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>еХist Indexer for Algolia</h1> 
  <p><a href="https://travis-ci.org/BCDH/exist-algolia-index" target="_blank"><img src="https://camo.githubusercontent.com/29ea25b39fb431accf6326a42f7c5ccf34eacb6b/68747470733a2f2f7472617669732d63692e6f72672f424344482f65786973742d616c676f6c69612d696e6465782e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/BCDH/exist-algolia-index.png?branch=master" style="max-width:100%;"></a> <a href="http://scala-lang.org" target="_blank"><img src="https://camo.githubusercontent.com/67dee860580432fadde79ada9bf5e812953e0205/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7363616c612d322e31322b2d6463333232662e737667" alt="Scala 2.12+" data-canonical-src="https://img.shields.io/badge/scala-2.12+-dc322f.svg" style="max-width:100%;"></a> <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank"><img src="https://camo.githubusercontent.com/4663c6a6193633b0ecfa7ee4caff1f9c47ab4a89/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d47504c253230332d626c75652e737667" alt="License GPL 3" data-canonical-src="https://img.shields.io/badge/license-GPL%203-blue.svg" style="max-width:100%;"></a> <a href="http://search.maven.org/remotecontent?filepath=org/humanistika/exist/index/algolia/exist-algolia-index_2.12/1.0/exist-algolia-index_2.12-1.0-assembly.jar" target="_blank"><img src="https://camo.githubusercontent.com/1b8746fcd4677ef860e7d7829ca828de47ed38a3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f776e6c6f61642d76657273696f6e253230312e302d6666363962342e737667" alt="Download" data-canonical-src="https://img.shields.io/badge/download-version%201.0-ff69b4.svg" style="max-width:100%;"></a></p> 
  <p>eXist Indexer for Algolia is a configurable index plug-in for the <a href="https://github.com/eXist-db/exist" target="_blank">eXist-db</a> native XML database. It uses eXist's own indexing mechanisms to create, upload and incrementally sync local indexes with <a href="http://www.algolia.com" target="_blank">Algolia's</a> cloud services.</p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/bcdh/exist-algolia-index#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>It's probably a good idea to start with a clean database, which means a completely clean <code>$EXIST_HOME/webapp/WEB-INF/data</code> folder.</p> 
  <ul> 
   <li> <p>The Index plugin requires at least eXist version 3.0.</p> </li> 
   <li> <p>The plugin can be <a href="https://github.com/bcdh/exist-algolia-index#building" target="_blank">built from source code</a> using <a href="http://www.scala-sbt.org/" target="_blank">SBT</a> or downloaded from <a href="https://search.maven.org/#search%7Cga%7C1%7Cg%3A%20org.humanistika.exist.index.algolia" target="_blank">Maven Central</a>.</p> </li> 
  </ul> 
  <ul> 
   <li> <p>Make sure eXist is not running</p> </li> 
   <li> <p>Place the jar file named like <code>exist-algolia-index-assembly-2.12_1.0.jar</code> into eXist's <code>lib/user</code>.</p> </li> 
   <li> <p>Modify eXist's <code>conf.xml</code> file by adding the following line to the <code>indexer/modules</code> section:</p> </li> 
  </ul> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">module</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>algolia-index<span class="pl-pds">"</span></span>
    <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>org.humanistika.exist.index.algolia.AlgoliaIndex<span class="pl-pds">"</span></span>
    <span class="pl-e">application-id</span>=<span class="pl-s"><span class="pl-pds">"</span>YOUR-ALGOLIA-APPLICATION-ID<span class="pl-pds">"</span></span>
    <span class="pl-e">admin-api-key</span>=<span class="pl-s"><span class="pl-pds">"</span>YOUR-ALGOLIA-ADMIN-API-KEY<span class="pl-pds">"</span></span>/&gt;</pre>
  </div> 
  <ul> 
   <li> <p>Startup eXist.</p> </li> 
   <li> <p>For the Collection(s) that you want to index with Algolia, you need to add an Algolia index configuration to eXist's <code>collection.xconf</code> file. See <a href="https://github.com/bcdh/exist-algolia-index#collectionconf" target="_blank">instructions</a>.</p> </li> 
   <li> <p>You can then reindex the collection with the data in eXist the way you normally do, and it should be added to Algolia.</p> </li> 
  </ul> 
  <p>You can use the Algolia Dashboard to examine the index. Alternatively, you can also set up eXist to to log changes to our Algolia Index. See <a href="https://github.com/bcdh/exist-algolia-index#logging" target="_blank">instructions</a>.</p> 
  <a name="user-content-collectionconf" target="_blank" href=""> ### Configuration </a> 
  <p>For a single collection in eXist, you can put data into one or more indexes in Algolia, just create an "index" element inside the "algolia" element for each index and give it the name of the Algolia index, if the index doesn't exist in Algolia it will be automatically created for you.</p> 
  <p>For incremental indexing to work, you need to have two sets of unique ids, one for each document in the collection (documentId) and one for each rootObject (nodeId).</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">collection</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://exist-db.org/collection-config/1.0<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">index</span>&gt;

        &lt;<span class="pl-ent">algolia</span>&gt;
            &lt;<span class="pl-ent">namespaceMappings</span>&gt;
                &lt;<span class="pl-ent">namespaceMapping</span>&gt;
                    &lt;<span class="pl-ent">prefix</span>&gt;xml&lt;/<span class="pl-ent">prefix</span>&gt;
                    &lt;<span class="pl-ent">namespace</span>&gt;http://www.w3.org/XML/1998/namespace&lt;/<span class="pl-ent">namespace</span>&gt;
                &lt;/<span class="pl-ent">namespaceMapping</span>&gt;
            &lt;/<span class="pl-ent">namespaceMappings</span>&gt;
            &lt;<span class="pl-ent">index</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>my-algolia-index-1<span class="pl-pds">"</span></span> <span class="pl-e">documentId</span>=<span class="pl-s"><span class="pl-pds">"</span>/path/to/unique-id/@хml:id<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">rootObject</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>/path/to/element<span class="pl-pds">"</span></span> <span class="pl-e">nodeId</span>=<span class="pl-s"><span class="pl-pds">"</span>@xml:id<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">attribute</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>f1<span class="pl-pds">"</span></span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>/further/patha<span class="pl-pds">"</span></span>/&gt;
                    &lt;<span class="pl-ent">attribute</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>f2<span class="pl-pds">"</span></span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>/further/pathb<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>/&gt;
                    &lt;<span class="pl-ent">object</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>other<span class="pl-pds">"</span></span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>/further/pathc<span class="pl-pds">"</span></span>&gt;
                        &lt;<span class="pl-ent">map</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>/x<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>boolean<span class="pl-pds">"</span></span>/&gt;
                   &lt;/<span class="pl-ent">object</span>&gt;
                &lt;/<span class="pl-ent">rootObject</span>&gt;
            &lt;/<span class="pl-ent">index</span>&gt;
        &lt;/<span class="pl-ent">algolia</span>&gt;

    &lt;/<span class="pl-ent">index</span>&gt;
&lt;/<span class="pl-ent">collection</span>&gt;</pre>
  </div> 
  <p>A <code>rootObject</code> is equivalent to an object inside an Algolia Index. We create one "rootObject" either for each document, or document fragment (if you specify a path attribute on the rootObject).</p> 
  <p>An <code>attribute</code> (represents a JSON object attribute, not to be confused with an XML attribute) is a simple key/value pair that is extracted from the XML and placed into the Algolia object ("rootObject" as we call it). All of the text nodes or attribute values indicated by the "path" on the "attribute" element will be serialized to a string (and then converted if you set an explicit "type" attribute).</p> 
  <p>The path for an "attribute" may point to either an XML element or XML attribute node. Paths must be simple, you can use namespace prefixes in the path, but you must also set the namespaceMappings element in the collection.xconf.</p> 
  <p>The XML Schema file <a href="https://github.com/BCDH/exist-algolia-index/blob/master/src/main/resources/xsd/exist-algolia-index-config.xsd" target="_blank">https://github.com/BCDH/exist-algolia-index/blob/master/src/main/resources/xsd/exist-algolia-index-config.xsd</a> defines and documents the index configuration.</p> 
  <p>An <code>object</code> represents a JSON object, and this is where things become fun, we basically serialize the XML node pointed to by the "path" attribute on the "object" element to a JSON equivalent. This allows you to create highly complex and structured objects in the Algolia index from your XML.</p> 
  <p>The <code>name</code> attribute that is available on the "attribute" and "object" elements allows you to set the name of the field in the JSON object of the Algolia index, this means that name names of your data fields can be different in Algolia to eXist if you wish.</p> 
  <a name="user-content-logging" target="_blank" href=""> ## Enable logging in eXist (optional) </a> 
  <p>You can see what we are sending to Algolia by adding the following to your <code>$EXIST_HOME/log4j2.xml</code> file:</p> 
  <p>Add this as a child of the <code>&lt;Appenders&gt;</code> element:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">RollingRandomAccessFile</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>algolia.index<span class="pl-pds">"</span></span>
        <span class="pl-e">filePattern</span>=<span class="pl-s"><span class="pl-pds">"</span>${logs}/algolia-index.${rollover.file.pattern}.log.gz<span class="pl-pds">"</span></span>
        <span class="pl-e">fileName</span>=<span class="pl-s"><span class="pl-pds">"</span>${logs}/algolia-index.log<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">Policies</span>&gt;
        &lt;<span class="pl-ent">SizeBasedTriggeringPolicy</span> <span class="pl-e">size</span>=<span class="pl-s"><span class="pl-pds">"</span>${rollover.max.size}<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">Policies</span>&gt;
    &lt;<span class="pl-ent">DefaultRolloverStrategy</span> <span class="pl-e">max</span>=<span class="pl-s"><span class="pl-pds">"</span>${rollover.max}<span class="pl-pds">"</span></span>/&gt;
    &lt;<span class="pl-ent">PatternLayout</span> <span class="pl-e">pattern</span>=<span class="pl-s"><span class="pl-pds">"</span>${exist.file.pattern}<span class="pl-pds">"</span></span>/&gt;
&lt;/<span class="pl-ent">RollingRandomAccessFile</span>&gt;</pre>
  </div> 
  <p>And add this as a child of the <code>&lt;Loggers&gt;</code> element:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">Logger</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>org.humanistika.exist.index.algolia<span class="pl-pds">"</span></span> <span class="pl-e">additivity</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> <span class="pl-e">level</span>=<span class="pl-s"><span class="pl-pds">"</span>trace<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">AppenderRef</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>algolia.index<span class="pl-pds">"</span></span>/&gt;
&lt;/<span class="pl-ent">Logger</span>&gt;</pre>
  </div> 
  <p>The log output will then appear in <code>$EXIST_HOME/webapp/WEB-INF/logs/algolia-index.log</code> the next time eXist is started.</p> 
  <h2><a id="user-content-current-limitations" class="anchor" href="https://github.com/bcdh/exist-algolia-index#current-limitations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Current limitations</h2> 
  <ul> 
   <li>you can't use paths with predicates in index configuration. Support for predicates will be added at a later stage.</li> 
   <li>when you backup eXist, you should now also make a backup copy of <code>$EXIST_HOME/webapp/WEB-INF/data/algolia-index</code> as that holds the local representation of what is on the remote Algolia Server. Support for adding locally stored Algolia indexes to the backup/restore procedure may be added in the future.</li> 
  </ul> 
  <a name="user-content-building" target="_blank" href=""> ## Building from Source </a> 
  <div class="highlight highlight-source-shell">
   <pre>$ git clone https://github.com/BCDH/exist-algolia-index.git
$ <span class="pl-c1">cd</span> exist-algolia-index
$ sbt assembly</pre>
  </div> 
  <p>The assembled binary can then be found is in the folder <code>target/scala-2.12</code>.</p> 
  <h2><a id="user-content-acknowledgements" class="anchor" href="https://github.com/bcdh/exist-algolia-index#acknowledgements" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Acknowledgements</h2> 
  <p>Hats off to <a href="https://github.com/adamretter" target="_blank">Adam Retter</a> for sharing his superb programming skills with us in this project.</p> 
  <p>This tool has been developed in the context of an ongoing <a href="http://www.humanistika.org" target="_blank">BCDH</a> project: Raskovnik - A Serbian Dictionary Platform (together with the Institute of Serbian Language). The project has received funding from the Ministry of Culture and Information of the Republic of Serbia.</p> 
 </article>
</div>