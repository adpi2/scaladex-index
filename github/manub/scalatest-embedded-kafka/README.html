<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-scalatest-embedded-kafka" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#scalatest-embedded-kafka" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>scalatest-embedded-kafka</h1> 
  <p>A library that provides an in-memory Kafka broker to run your ScalaTest specs against. It uses Kafka 0.10.2.1 and ZooKeeper 3.4.8.</p> 
  <p>The version supporting Kafka 0.8.x can be found <a href="https://github.com/manub/scalatest-embedded-kafka/tree/kafka-0.8" target="_blank">here</a> - <em>this is no longer actively supported, although I'll be happy to accept PRs and produce releases.</em></p> 
  <p>Inspired by <a href="https://github.com/chbatey/kafka-unit" target="_blank">https://github.com/chbatey/kafka-unit</a></p> 
  <p><a href="https://travis-ci.org/manub/scalatest-embedded-kafka" target="_blank"><img src="https://camo.githubusercontent.com/64ac1755182dba9eb07accd2cd01e97fb9358c74/68747470733a2f2f7472617669732d63692e6f72672f6d616e75622f7363616c61746573742d656d6265646465642d6b61666b612e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/manub/scalatest-embedded-kafka.svg?branch=master" style="max-width:100%;"></a></p> 
  <p><a href="https://www.codacy.com/app/emanuele-blanco/scalatest-embedded-kafka" target="_blank"><img src="https://camo.githubusercontent.com/72e9cd59573c46f185ec60c934deea655a49e473/68747470733a2f2f7777772e636f646163792e636f6d2f70726f6a6563742f62616467652f6337623236323932333335643433333162343961383133313738383464643137" alt="Codacy Badge" data-canonical-src="https://www.codacy.com/project/badge/c7b26292335d4331b49a81317884dd17" style="max-width:100%;"></a></p> 
  <p><a href="https://gitter.im/manub/scalatest-embedded-kafka" target="_blank"><img src="https://camo.githubusercontent.com/20d7543bc8280bf8134b686c46c7b7e2c0a467fd/68747470733a2f2f6261646765732e6769747465722e696d2f67697474657248512f6769747465722e706e67" alt="Gitter chat" data-canonical-src="https://badges.gitter.im/gitterHQ/gitter.png" style="max-width:100%;"></a></p> 
  <p><a href="http://doge.mit-license.org" target="_blank"><img src="https://camo.githubusercontent.com/3d7aa1ddbfa86368152bf42123c17b69ea8070be/687474703a2f2f696d672e736869656c64732e696f2f3a6c6963656e73652d6d69742d626c75652e737667" alt="License" data-canonical-src="http://img.shields.io/:license-mit-blue.svg" style="max-width:100%;"></a></p> 
  <h3><a id="user-content-version-compatibility-matrix" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#version-compatibility-matrix" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Version compatibility matrix</h3> 
  <p>scalatest-embedded-kafka is available on Bintray and Maven Central, compiled for both Scala 2.11 and 2.12.</p> 
  <ul> 
   <li>Scala 2.10 is supported until <code>0.10.0</code></li> 
   <li>Scala 2.11 is supported for all versions</li> 
   <li>Scala 2.12 is supported from <code>0.11.0</code>.</li> 
  </ul> 
  <h3><a id="user-content-how-to-use" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#how-to-use" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to use</h3> 
  <ul> 
   <li>In your <code>build.sbt</code> file add the following dependency: <code>"net.manub" %% "scalatest-embedded-kafka" % "0.13.1" % "test"</code></li> 
   <li>Have your <code>Spec</code> extend the <code>EmbeddedKafka</code> trait.</li> 
   <li>Enclose the code that needs a running instance of Kafka within the <code>withRunningKafka</code> closure.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MySpec</span> <span class="pl-k">extends</span> <span class="pl-e">WordSpec</span> <span class="pl-k">with</span> <span class="pl-e">EmbeddedKafka</span> {

<span class="pl-s"><span class="pl-pds">"</span>runs with embedded kafka<span class="pl-pds">"</span></span> should {

    withRunningKafka {
        <span class="pl-c"><span class="pl-c">//</span> ... code goes here</span>
    }

}</pre>
  </div> 
  <ul> 
   <li>In-memory Zookeeper and Kafka will be instantiated respectively on port 6000 and 6001 and automatically shutdown at the end of the test.</li> 
  </ul> 
  <h3><a id="user-content-use-without-the-withrunningkafka-method" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#use-without-the-withrunningkafka-method" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Use without the <code>withRunningKafka</code> method</h3> 
  <p>A <code>EmbeddedKafka</code> companion object is provided for usage without the <code>EmbeddedKafka</code> trait. Zookeeper and Kafka can be started an stopped in a programmatic way.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MySpec</span> <span class="pl-k">extends</span> <span class="pl-e">WordSpec</span> {
    
<span class="pl-s"><span class="pl-pds">"</span>runs with embedded kafka<span class="pl-pds">"</span></span> should {

    <span class="pl-en">EmbeddedKafka</span>.start()
    
    <span class="pl-c"><span class="pl-c">//</span> ... code goes here</span>
    
    <span class="pl-en">EmbeddedKafka</span>.stop() 

}</pre>
  </div> 
  <p>Please note that in order to avoid Kafka instances not shutting down properly, it's recommended to call <code>EmbeddedKafka.stop()</code> in a <code>after</code> block or in a similar teardown logic.</p> 
  <h3><a id="user-content-configuration" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Configuration</h3> 
  <p>It's possible to change the ports on which Zookeeper and Kafka are started by providing an implicit <code>EmbeddedKafkaConfig</code></p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MySpec</span> <span class="pl-k">extends</span> <span class="pl-e">WordSpec</span> <span class="pl-k">with</span> <span class="pl-e">EmbeddedKafka</span> {

<span class="pl-s"><span class="pl-pds">"</span>runs with embedded kafka on a specific port<span class="pl-pds">"</span></span> should {

    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">config</span> <span class="pl-k">=</span> <span class="pl-en">EmbeddedKafkaConfig</span>(kafkaPort <span class="pl-k">=</span> <span class="pl-c1">12345</span>)

    withRunningKafka {
        <span class="pl-c"><span class="pl-c">//</span> now a kafka broker is listening on port 12345</span>
    }

}</pre>
  </div> 
  <p>The same implicit <code>EmbeddedKafkaConfig</code> is used to define custom consumer or producer properties</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">MySpec</span> <span class="pl-k">extends</span> <span class="pl-e">WordSpec</span> <span class="pl-k">with</span> <span class="pl-e">EmbeddedKafka</span> {

<span class="pl-s"><span class="pl-pds">"</span>runs with custom producer and consumer properties<span class="pl-pds">"</span></span> should {
    <span class="pl-k">val</span> <span class="pl-en">customBrokerConfig</span> <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>replica.fetch.max.bytes<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2000000<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>message.max.bytes<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2000000<span class="pl-pds">"</span></span>)
        
    <span class="pl-k">val</span> <span class="pl-en">customProducerConfig</span> <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>max.request.size<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2000000<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">customConsumerConfig</span> <span class="pl-k">=</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>max.partition.fetch.bytes<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>2000000<span class="pl-pds">"</span></span>)

    <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">customKafkaConfig</span> <span class="pl-k">=</span> <span class="pl-en">EmbeddedKafkaConfig</span>(
        customBrokerProperties <span class="pl-k">=</span> customBrokerConfig,
        customProducerProperties <span class="pl-k">=</span> customProducerConfig,
        customConsumerProperties <span class="pl-k">=</span> customConsumerConfig)

    withRunningKafka {
        <span class="pl-c"><span class="pl-c">//</span> now a kafka broker is listening on port 12345</span>
    }

}</pre>
  </div> 
  <p>This works for both <code>withRunningKafka</code> and <code>EmbeddedKafka.start()</code></p> 
  <p>Also, it is now possible to provide custom properties to the broker while starting Kafka. <code>EmbeddedKafkaConfig</code> has a <code>customBrokerProperties</code> field which can be used to provide extra properties contained in a <code>Map[String, String]</code>. Those properties will be added to the broker configuration, be careful some properties are set by the library itself and in case of conflict the <code>customBrokerProperties</code> values will take precedence. Please look at the source code to see what these properties are.</p> 
  <h3><a id="user-content-utility-methods" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#utility-methods" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Utility methods</h3> 
  <p>The <code>EmbeddedKafka</code> trait provides also some utility methods to interact with the embedded kafka, in order to set preconditions or verifications in your specs:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">def</span> <span class="pl-en">publishToKafka</span>(<span class="pl-v">topic</span>: <span class="pl-k">String</span>, <span class="pl-v">message</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span>

<span class="pl-k">def</span> <span class="pl-en">consumeFirstMessageFrom</span>(<span class="pl-v">topic</span>: <span class="pl-k">String</span>)<span class="pl-k">:</span> <span class="pl-k">String</span>

<span class="pl-k">def</span> <span class="pl-en">createCustomTopic</span>(<span class="pl-v">topic</span>: <span class="pl-k">String</span>, <span class="pl-v">topicConfig</span>: <span class="pl-en">Map</span>[<span class="pl-k">String</span>,<span class="pl-k">String</span>], <span class="pl-v">partitions</span>: <span class="pl-k">Int</span>, <span class="pl-v">replicationFactor</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-k">Unit</span></pre>
  </div> 
  <h3><a id="user-content-custom-producers" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#custom-producers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom producers</h3> 
  <p>It is possible to create producers for custom types in two ways:</p> 
  <ul> 
   <li>Using the syntax <code>aKafkaProducer thatSerializesValuesWith classOf[Serializer[V]]</code>. This will return a <code>KafkaProducer[String, V]</code></li> 
   <li>Using the syntax <code>aKafkaProducer[V]</code>. This will return a <code>KafkaProducer[String, V]</code>, using an implicit <code>Serializer[V]</code>.</li> 
  </ul> 
  <p>For more information about how to use the utility methods, you can either look at the Scaladocs or at the tests of this project.</p> 
  <h3><a id="user-content-custom-consumers" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#custom-consumers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Custom consumers</h3> 
  <p>Use the <code>Consumer</code> trait that easily creates consumers of arbitrary key-value types and manages their lifecycle (via a loaner pattern).</p> 
  <ul> 
   <li>For basic String consumption use <code>Consumer.withStringConsumer { your code here }</code>.</li> 
   <li>For arbitrary key and value types, expose implicit <code>Deserializer</code>s for each type and use <code>Consumer.withConsumer { your code here }</code>.</li> 
   <li>If you just want to create a consumer and manage its lifecycle yourself then try <code>Consumer.newConsumer()</code>.</li> 
  </ul> 
  <h3><a id="user-content-easy-message-consumption" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#easy-message-consumption" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Easy message consumption</h3> 
  <p>With <code>ConsumerExtensions</code> you can turn a consumer to a Scala lazy Stream of key-value pairs and treat it as a collection for easy assertion.</p> 
  <ul> 
   <li>Just import the extensions.</li> 
   <li>On any <code>KafkaConsumer</code> instance you can now do:</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">net.manub.embeddedkafka.ConsumerExtensions.</span><span class="pl-v">_</span>
...
consumer.consumeLazily(<span class="pl-s"><span class="pl-pds">"</span>from-this-topic<span class="pl-pds">"</span></span>).take(<span class="pl-c1">3</span>).toList should be (<span class="pl-en">Seq</span>(
  <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>one<span class="pl-pds">"</span></span>, 
  <span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>two<span class="pl-pds">"</span></span>, 
  <span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>three<span class="pl-pds">"</span></span>
)</pre>
  </div> 
  <h2><a id="user-content-scalatest-embedded-kafka-streams" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#scalatest-embedded-kafka-streams" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>scalatest-embedded-kafka-streams</h2> 
  <p>A library that builds on top of <code>scalatest-embedded-kafka</code> to offer easy testing of <a href="https://cwiki.apache.org/confluence/display/KAFKA/Kafka+Streams" target="_blank">Kafka Streams</a> with ScalaTest. It uses Kafka Streams 0.10.1.1.</p> 
  <p>It takes care of instantiating and starting your streams as well as closing them after running your test-case code.</p> 
  <h3><a id="user-content-how-to-use-1" class="anchor" href="https://github.com/manub/scalatest-embedded-kafka#how-to-use-1" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>How to use</h3> 
  <ul> 
   <li>In your <code>build.sbt</code> file add the following dependency: <code>"net.manub" %% "scalatest-embedded-kafka-streams" % "0.12.0" % "test"</code></li> 
   <li>Have a look at the <a href="https://github.com/manub/scalatest-embedded-kafka/blob/master/kafka-streams/src/test/scala/net/manub/embeddedkafka/streams/ExampleKafkaStreamsSpec.scala" target="_blank">example test</a></li> 
   <li>For most of the cases have your <code>Spec</code> extend the <code>EmbeddedKafkaStreamsAllInOne</code> trait. This offers both streams management and easy creation of consumers for asserting resulting messages in output/sink topics.</li> 
   <li>If you only want to use the streams management without the test consumers just have the <code>Spec</code> extend the <code>EmbeddedKafkaStreams</code> trait.</li> 
   <li>Use the <code>runStreamsWithStringConsumer</code> to: 
    <ul> 
     <li>Create any topics that need to exist for the strems to operate (usually sources and sinks).</li> 
     <li>Pass the Stream or Topology builder that will then be used to instantiate and start the Kafka Streams. This will be done while using the <code>withRunningKafka</code> closure internally so that your stream runs with an embedded Kafka and Zookeeper.</li> 
     <li>Pass the <code>{code block}</code> that needs a running instance of your streams. This is where your actual test code will sit. You can publish messages to your source topics and consume messages from your sink topics that the Kafka Streams should have generated. This method also offers a pre-instantiated consumer that can read String keys and values.</li> 
    </ul> </li> 
   <li>For more flexibility, use <code>runStreams</code> and <code>withConsumer</code>. This allows you to create your own consumers of custom types as seen in the <a href="https://github.com/manub/scalatest-embedded-kafka/blob/master/kafka-streams/src/test/scala/net/manub/embeddedkafka/streams/ExampleKafkaStreamsSpec.scala" target="_blank">example test</a>.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">net.manub.embeddedkafka.ConsumerExtensions.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">org.apache.kafka.streams.kstream.</span><span class="pl-v">KStreamBuilder</span>
<span class="pl-k">import</span> <span class="pl-v">org.scalatest.</span>{<span class="pl-v">Matchers</span>, <span class="pl-v">WordSpec</span>}

<span class="pl-k">class</span> <span class="pl-en">MySpec</span> <span class="pl-k">extends</span> <span class="pl-e">WordSpec</span> <span class="pl-k">with</span> <span class="pl-e">Matchers</span> <span class="pl-k">with</span> <span class="pl-e">EmbeddedKafkaStreamsAllInOne</span> {
  <span class="pl-s"><span class="pl-pds">"</span>my kafka stream<span class="pl-pds">"</span></span> should {
    <span class="pl-s"><span class="pl-pds">"</span>be easy to test<span class="pl-pds">"</span></span> in {
      <span class="pl-k">val</span> <span class="pl-en">inputTopic</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>input-topic<span class="pl-pds">"</span></span>
      <span class="pl-k">val</span> <span class="pl-en">outputTopic</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>output-topic<span class="pl-pds">"</span></span>
      <span class="pl-c"><span class="pl-c">//</span> your code for building the stream goes here e.g.</span>
      <span class="pl-k">val</span> <span class="pl-en">streamBuilder</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">KStreamBuilder</span>
      streamBuilder.stream(inputTopic).to(outputTopic)
      <span class="pl-c"><span class="pl-c">//</span> tell the stream test</span>
      <span class="pl-c"><span class="pl-c">//</span> 1. what topics need to be created before the stream starts</span>
      <span class="pl-c"><span class="pl-c">//</span> 2. the builder to be used for initializing and starting the stream</span>
      runStreamsWithStringConsumer(
        topicsToCreate <span class="pl-k">=</span> <span class="pl-en">Seq</span>(inputTopic, outputTopic),
        builder <span class="pl-k">=</span> streamBuilder
      ){ consumer <span class="pl-k">=&gt;</span>
        <span class="pl-c"><span class="pl-c">//</span> your test code goes here</span>
        publishToKafka(inputTopic, key <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span>, message <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>world<span class="pl-pds">"</span></span>)
        consumer.consumeLazily(outputTopic).head should be (<span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>world<span class="pl-pds">"</span></span>)
      }
    }
  }
}</pre>
  </div> 
 </article>
</div>