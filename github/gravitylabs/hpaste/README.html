<div class="announce instapaper_body markdown" data-path="README.markdown" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-welcome-to-hpaste" class="anchor" href="https://github.com/gravitylabs/hpaste#welcome-to-hpaste" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Welcome to HPaste!</h1> 
  <h3><a id="user-content-what-is-hpaste" class="anchor" href="https://github.com/gravitylabs/hpaste#what-is-hpaste" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What is HPaste?</h3> 
  <p>HPaste unlocks the rich functionality of HBase for a Scala audience. In so doing, it attempts to achieve the following goals:</p> 
  <ul> 
   <li>Provide a strong, clear syntax for querying and filtration</li> 
   <li>Perform as fast as possible while maintaining idiomatic Scala client code -- the abstractions should not show up in a profiler!</li> 
   <li>Re-articulate HBase's data structures rather than force it into an ORM-style atmosphere.</li> 
   <li>A rich set of base classes for writing MapReduce jobs in hadoop against HBase tables.</li> 
   <li>Provide a maximum amount of code re-use between general Hbase client usage, and operation from within a MapReduce job.</li> 
   <li>Use Scala's type system to its advantage--the compiler should verify the integrity of the schema.</li> 
   <li>Be a verbose DSL--minimize boilerplate code, but be human readable!</li> 
  </ul> 
  <h3><a id="user-content-what-isnt-hpaste" class="anchor" href="https://github.com/gravitylabs/hpaste#what-isnt-hpaste" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>What isn't HPaste?</h3> 
  <p>You'll notice that HPaste has a lot of convenience classes for MapReduce jobs. This is to make it painless to use your domain objects and tables in the context of MR jobs. HPaste has no aspirations to replace tuple-based frameworks like Pig or Cascading (both of which we use for complex log parsing). HPaste is intended to hug the Hadoop MapReduce API very closely, building convenience functions where necessary, without abstracting too far away from the base concept. </p> 
  <p>The goal of HPaste's MapReduce support is to allow you to build rich functionality into your Table and Row objects, and make it be painless to have those tables and rows participate in MapReduce jobs. Oftentimes in HBase you have a combination of OLTP style operations (client gets data, client serves data), and OLAP style operations (pivot one table around a particular piece of data, and output to another table). That is where HPaste comes in handy, because there is often an impedance in Pig and/or Cascading between HBase-friendly binary data serialized objects and the tuple framework that makes those libraries so awesome to use for ad-hoc log-style data.</p> 
  <p>(It is a mini-goal of HPaste to integrate into Cascading's tuple framework.)</p> 
  <h2><a id="user-content-project-status" class="anchor" href="https://github.com/gravitylabs/hpaste#project-status" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Project Status</h2> 
  <p>This project is currently actively developed and maintained. It is used in a large production codebase in high-throughput, memory-intensive scenarios, and has many months of bug fixes under its belt. Because it already has a great deal of code utilizing it, there will not be many breaking changes to the API. Instead what we usually do is provide an upgraded API that sits next to the old API, then deprecate the old one. </p> 
  <h2><a id="user-content-installation" class="anchor" href="https://github.com/gravitylabs/hpaste#installation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Installation</h2> 
  <p>This project uses <a href="http://maven.apache.org/" title="Apache Maven" target="_blank">Maven</a>. To use HPaste in your own maven project, simply add it as a dependency:</p> 
  <div class="highlight highlight-text-xml">
   <pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.gravity&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;gravity-hpaste&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;0.1.11&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre>
  </div> 
  <h2><a id="user-content-quickstart" class="anchor" href="https://github.com/gravitylabs/hpaste#quickstart" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Quickstart</h2> 
  <p>Here's some quick code examples to give you a sense of what you're getting into. All of the examples in the sections below come from the HPaste unit tests. Specifically the file <a href="https://github.com/GravityLabs/HPaste/blob/master/src/test/scala/com/gravity/hbase/schema/WebCrawlSchemaTest.scala" target="_blank">WebCrawlSchemaTest.scala</a>. If you go to that file and follow along with the explanations below, things will make more sense.</p> 
  <h4><a id="user-content-creating-a-webtable" class="anchor" href="https://github.com/gravitylabs/hpaste#creating-a-webtable" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Creating a WebTable</h4> 
  <p>The classic case for HBase and BigTable is crawling and storing web pages. You need to define a WebTable for your crawling. The below defines a table called WebTable, with a String key.</p> 
  <ul> 
   <li>It has a column family called "meta", that holds columns with String keys and Any value-type.</li> 
   <li>It then specifies that the "meta" family holds a "title" column, a "lastCrawled" column, and a "url" column.</li> 
   <li>A second column family holds content and has the compressed flag to true.</li> 
   <li>It has a family "content" for storing content. The "article" column is for storing the main page content.</li> 
   <li>The Attributes column is a map where you can atomically store values keyed by a string.</li> 
   <li>SearchMetrics is a column family that contains searches your users have made that have sent them to that page, organized by day.</li> 
  </ul> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">WebTable</span> <span class="pl-k">extends</span> <span class="pl-e">HbaseTable</span>[<span class="pl-en">WebTable</span>, <span class="pl-k">String</span>, <span class="pl-en">WebPageRow</span>](tableName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>pages<span class="pl-pds">"</span></span>, rowKeyClass <span class="pl-k">=</span> <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>]) {
    <span class="pl-k">def</span> <span class="pl-en">rowBuilder</span>(<span class="pl-v">result</span>: <span class="pl-en">DeserializedResult</span>) <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">WebPageRow</span>(<span class="pl-v">this</span>, result)

    <span class="pl-k">val</span> <span class="pl-en">meta</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-en">Any</span>](<span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])
    <span class="pl-k">val</span> <span class="pl-en">lastCrawled</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>lastCrawled<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-en">DateTime</span>])

    <span class="pl-k">val</span> <span class="pl-en">content</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-en">Any</span>](<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>, compressed <span class="pl-k">=</span> <span class="pl-c1">true</span>)
    <span class="pl-k">val</span> <span class="pl-en">article</span> <span class="pl-k">=</span> column(content, <span class="pl-s"><span class="pl-pds">"</span>article<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])
    <span class="pl-k">val</span> <span class="pl-en">attributes</span> <span class="pl-k">=</span> column(content, <span class="pl-s"><span class="pl-pds">"</span>attrs<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-en">Map</span>[<span class="pl-k">String</span>, <span class="pl-k">String</span>]])

    <span class="pl-k">val</span> <span class="pl-en">searchMetrics</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-en">DateMidnight</span>, <span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>searchesByDay<span class="pl-pds">"</span></span>)


  }

  <span class="pl-k">class</span> <span class="pl-en">WebPageRow</span>(<span class="pl-v">table</span>: <span class="pl-en">WebTable</span>, <span class="pl-v">result</span>: <span class="pl-en">DeserializedResult</span>) <span class="pl-k">extends</span> <span class="pl-e">HRow</span>[<span class="pl-en">WebTable</span>, <span class="pl-k">String</span>](result, table)

  <span class="pl-k">val</span> <span class="pl-en">WebTable</span> <span class="pl-k">=</span> table(<span class="pl-k">new</span> <span class="pl-en">WebTable)</span>
}</pre>
  </div> 
  <h4><a id="user-content-putting-values-into-the-webtable" class="anchor" href="https://github.com/gravitylabs/hpaste#putting-values-into-the-webtable" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Putting values into the WebTable</h4> 
  <p>Now, suppose you're crawling a website. The below will create a row with the values specified. When you call value(), the first argument is a function that points to the column you specified in the above WebTable schema. This dips into DSL-land.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>
            .put(<span class="pl-s"><span class="pl-pds">"</span>http://mycrawledsite.com/crawledpage.html<span class="pl-pds">"</span></span>)
            .value(_.title, <span class="pl-s"><span class="pl-pds">"</span>My Crawled Page Title<span class="pl-pds">"</span></span>)
            .value(_.lastCrawled, <span class="pl-k">new</span> <span class="pl-en">DateTime</span>())
            .value(_.article, <span class="pl-s"><span class="pl-pds">"</span>Jonsie went to the store.  She didn't notice the spinning of the Earth, nor did the Earth notice the expansion of the Universe.<span class="pl-pds">"</span></span>)
            .value(_.attributes, <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>bar<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>custom<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>))
            .valueMap(_.searchMetrics, <span class="pl-en">Map</span>(<span class="pl-k">new</span> <span class="pl-en">DateMidnight</span>(<span class="pl-c1">2011</span>, <span class="pl-c1">6</span>, <span class="pl-c1">5</span>) <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">3l</span>, <span class="pl-k">new</span> <span class="pl-en">DateMidnight</span>(<span class="pl-c1">2011</span>, <span class="pl-c1">6</span>, <span class="pl-c1">4</span>) <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">34l</span>))
            .execute()</pre>
  </div> 
  <h4><a id="user-content-querying-values-out-of-the-webtable" class="anchor" href="https://github.com/gravitylabs/hpaste#querying-values-out-of-the-webtable" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Querying values out of the WebTable</h4> 
  <p>Let's get the above page out of the WebTable. Let's say we just want the title of the page and when it was last crawled. The withColumns() call tells HBase to only fetch those columns. It takes a series of functions that return the column values you specified in the WebTable, so you get compile-time checking on that. </p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>.query2.withKey(<span class="pl-s"><span class="pl-pds">"</span>http://mycrawledsite.com/crawledpage.html<span class="pl-pds">"</span></span>)
            .withColumns(_.title, _.lastCrawled)
            .withFamilies(_.searchMetrics)
            .singleOption() <span class="pl-k">match</span> {
      <span class="pl-k">case</span> <span class="pl-en">Some</span>(pageRow) <span class="pl-k">=&gt;</span> {
        println(<span class="pl-s"><span class="pl-pds">"</span>Title: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> pageRow.column(_.title).getOrElse(<span class="pl-s"><span class="pl-pds">"</span>No Title<span class="pl-pds">"</span></span>))
        println(<span class="pl-s"><span class="pl-pds">"</span>Crawled on: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> pageRow.column(_.lastCrawled).getOrElse(<span class="pl-k">new</span> <span class="pl-en">DateTime</span>()))

        pageRow.family(_.searchMetrics).foreach {
          <span class="pl-k">case</span> (<span class="pl-v">date</span>: <span class="pl-en">DateMidnight</span>, <span class="pl-v">views</span>: <span class="pl-k">Long</span>) <span class="pl-k">=&gt;</span>
            println(<span class="pl-s"><span class="pl-pds">"</span>Got <span class="pl-pds">"</span></span> <span class="pl-k">+</span> views <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> views on date <span class="pl-pds">"</span></span> <span class="pl-k">+</span> date.toString(<span class="pl-s"><span class="pl-pds">"</span>MM-dd-yyyy<span class="pl-pds">"</span></span>))
        }
        <span class="pl-c">//Do something with title and crawled date...</span>
      }
      <span class="pl-k">case</span> <span class="pl-c1">None</span> <span class="pl-k">=&gt;</span> {
        println(<span class="pl-s"><span class="pl-pds">"</span>Row not found<span class="pl-pds">"</span></span>)
      }
    }</pre>
  </div> 
  <p>The result you get back is an instance of the row class you specified against the WebTable: WebPageRow. When you get a WebPageRow back from a query, a scan, or a map reduce job, you can fetch the columns out via the column() call. If you asked for a column family that can be treated as a Map (a Column Family that does not have columns specified in it), then you can retrieve the map via the family() call.</p> 
  <h4><a id="user-content-aggregating-values-via-mapreduce-jobs" class="anchor" href="https://github.com/gravitylabs/hpaste#aggregating-values-via-mapreduce-jobs" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Aggregating values via MapReduce jobs</h4> 
  <p>HPaste contains support for low-level MapReduce operations. What we mean by low-level is that there are not many layers of abstraction on top of a basic MR job--instead, we focus on making it easy to create and manage table inputs and outputs and serialize binary data between them.</p> 
  <p>Let's say we have a lot of pages crawled, and we, as a search engine, have searches people have performed for those pages. We now want to roll those into per-site totals. Let's create a table next to our WebTable called the SiteMetricsTable:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">SiteMetricsTable</span> <span class="pl-k">extends</span> <span class="pl-e">HbaseTable</span>[<span class="pl-en">SiteMetricsTable</span>, <span class="pl-k">String</span>, <span class="pl-en">SiteMetricsRow</span>](tableName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>site-metrics<span class="pl-pds">"</span></span>, rowKeyClass <span class="pl-k">=</span> <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>]) {
    <span class="pl-k">def</span> <span class="pl-en">rowBuilder</span>(<span class="pl-v">result</span>: <span class="pl-en">DeserializedResult</span>) <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SiteMetricsRow</span>(<span class="pl-v">this</span>, result)

    <span class="pl-k">val</span> <span class="pl-en">meta</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-en">Any</span>](<span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>)
    <span class="pl-k">val</span> <span class="pl-en">name</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])

    <span class="pl-k">val</span> <span class="pl-en">searchMetrics</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-en">DateMidnight</span>, <span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>searchesByDay<span class="pl-pds">"</span></span>)
}

<span class="pl-k">class</span> <span class="pl-en">SiteMetricsRow</span>(<span class="pl-v">table</span>: <span class="pl-en">SiteMetricsTable</span>, <span class="pl-v">result</span>: <span class="pl-en">DeserializedResult</span>) <span class="pl-k">extends</span> <span class="pl-e">HRow</span>[<span class="pl-en">SiteMetricsTable</span>, <span class="pl-k">String</span>](result, table)

<span class="pl-k">val</span> <span class="pl-en">Sites</span> <span class="pl-k">=</span> table(<span class="pl-k">new</span> <span class="pl-en">SiteMetricsTable)</span>
</pre>
  </div> 
  <p>Now we'll make a MapReduce job that scans the WebPages table, aggregates its metrics, and writes them to the SiteMetricsTable:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">WebSearchAggregationJob</span> <span class="pl-k">extends</span> <span class="pl-e">HJob</span>[<span class="pl-en">NoSettings</span>](<span class="pl-s"><span class="pl-pds">"</span>Aggregate web searches by site<span class="pl-pds">"</span></span>,
  <span class="pl-en">HMapReduceTask</span>(
    <span class="pl-en">HTaskID</span>(<span class="pl-s"><span class="pl-pds">"</span>Aggregation task<span class="pl-pds">"</span></span>),
    <span class="pl-en">HTaskConfigs</span>(),
    <span class="pl-en">HIO</span>(
      <span class="pl-en">HTableInput</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>),
      <span class="pl-en">HTableOutput</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">Sites</span>)
    ),
    <span class="pl-k">new</span> <span class="pl-en">FromTableBinaryMapperFx</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>) {
      <span class="pl-k">val</span> <span class="pl-en">webPage</span> <span class="pl-k">=</span> row
      <span class="pl-k">val</span> <span class="pl-en">domain</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">URL</span>(webPage.rowid).getAuthority
      ctr(<span class="pl-s"><span class="pl-pds">"</span>Sites for domain<span class="pl-pds">"</span></span> <span class="pl-k">+</span> domain)

      <span class="pl-k">val</span> <span class="pl-en">dates</span> <span class="pl-k">=</span> webPage.family(_.searchMetrics)

      <span class="pl-k">for</span>((dateOfSearches,searchCount) <span class="pl-k">&lt;</span><span class="pl-k">-</span> dates) {
        <span class="pl-k">val</span> <span class="pl-en">keyOutput</span> <span class="pl-k">=</span> makeWritable{keyWriter<span class="pl-k">=&gt;</span>
          keyWriter.writeUTF(domain)
          keyWriter.writeObj(dateOfSearches)
        }
        <span class="pl-k">val</span> <span class="pl-en">valueOutput</span> <span class="pl-k">=</span> makeWritable{valueWriter<span class="pl-k">=&gt;</span>
          valueWriter.writeLong(searchCount)
        }
        ctr(<span class="pl-s"><span class="pl-pds">"</span>Dated metrics written for domain <span class="pl-pds">"</span></span> <span class="pl-k">+</span> domain)
        write(keyOutput, valueOutput)
      }
    },
    <span class="pl-k">new</span> <span class="pl-en">ToTableBinaryReducerFx</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">Sites</span>) {
      <span class="pl-k">val</span> (domain, dateOfSearches) <span class="pl-k">=</span> readKey{keyInput<span class="pl-k">=&gt;</span>
        (keyInput.readUTF(), keyInput.readObj[<span class="pl-en">DateMidnight</span>])
      }

      <span class="pl-k">var</span> <span class="pl-en">totalCounts</span> <span class="pl-k">=</span> <span class="pl-c1">0l</span>

      perValue{valueInput<span class="pl-k">=&gt;</span>
        totalCounts <span class="pl-k">+</span><span class="pl-k">=</span> valueInput.readLong
      }


      write(
        <span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">Sites</span>.put(domain).valueMap(_.searchMetrics,<span class="pl-en">Map</span>(dateOfSearches<span class="pl-k">-</span><span class="pl-k">&gt;</span>totalCounts))
      )
    }
  )
)
</pre>
  </div> 
  <p>The above is a self-contained MapReduce job that is ready to go. We can execute the above job via (where the Configuration object is the one relevant to your clsuter):</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">new</span> <span class="pl-en">WebSearchAggregationJob</span>().run(<span class="pl-en">Settings</span>.<span class="pl-c1">None</span>, <span class="pl-en">LocalCluster</span>.getTestConfiguration)</pre>
  </div> 
  <p>All of the above examples are part of the HPaste unit tests, so it should be easy to use them to set up your own system. </p> 
  <h2><a id="user-content-features-not-covered-in-the-quickstart" class="anchor" href="https://github.com/gravitylabs/hpaste#features-not-covered-in-the-quickstart" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Features not covered in the Quickstart</h2> 
  <p>There are many features not included in the Quickstart that exist in the codebase. </p> 
  <ul> 
   <li>Complex type serialization</li> 
   <li>Chaining map reduce jobs</li> 
   <li>Scanners and the filtration DSL</li> 
   <li>Settings classes that can be injected into MapReduce jobs</li> 
  </ul> 
  <h1><a id="user-content-building-and-testing-hpaste" class="anchor" href="https://github.com/gravitylabs/hpaste#building-and-testing-hpaste" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Building and Testing HPaste</h1> 
  <p>This project is put together with Maven. In theory you should be able to build and run the project's tests via:</p> 
  <p><code> mvn test </code></p> 
  <p>The tests will create a temporary hbase cluster, create temporary tables, and run map reduce jobs against those tables. The unit tests are the best way to encounter HPaste, because they are constantly added to and perform live operations against a real cluster, so there's no smoke-and-mirrors.</p> 
  <h1><a id="user-content-more-in-depth" class="anchor" href="https://github.com/gravitylabs/hpaste#more-in-depth" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More In Depth</h1> 
  <h2><a id="user-content-defining-a-schema" class="anchor" href="https://github.com/gravitylabs/hpaste#defining-a-schema" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Defining a Schema</h2> 
  <p>Following the HBase structure, first you define a Schema, then Tables, then Column Families, then (optionally) Columns. Below is an example schema that contains a single Table definition. The table will be called "schema_example" in HBase. It will expect its row keys to be Strings.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">object</span> <span class="pl-en">ExampleSchema</span> <span class="pl-k">extends</span> <span class="pl-e">Schema</span> {


  <span class="pl-c">//There should only be one HBaseConfiguration object per process.  You'll probably want to manage that</span>
  <span class="pl-c">//instance yourself, so this library expects a reference to that instance.  It's implicitly injected into</span>
  <span class="pl-c">//the code, so the most convenient place to put it is right after you declare your Schema.</span>
  <span class="pl-k">implicit</span> <span class="pl-k">val</span> <span class="pl-en">conf</span> <span class="pl-k">=</span> <span class="pl-en">LocalCluster</span>.getTestConfiguration

  <span class="pl-c">//A table definition, where the row keys are Strings</span>
  <span class="pl-k">class</span> <span class="pl-en">ExampleTable</span> <span class="pl-k">extends</span> <span class="pl-e">HbaseTable</span>[<span class="pl-en">ExampleTable</span>,<span class="pl-k">String</span>, <span class="pl-en">ExampleTableRow</span>](tableName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>schema_example<span class="pl-pds">"</span></span>,rowKeyClass<span class="pl-k">=</span><span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])
  {
    <span class="pl-k">def</span> <span class="pl-en">rowBuilder</span>(result<span class="pl-k">:</span><span class="pl-en">DeserializedResult</span>) <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">ExampleTableRow</span>(<span class="pl-v">this</span>,result)

    <span class="pl-k">val</span> <span class="pl-en">meta</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-en">Any</span>](<span class="pl-s"><span class="pl-pds">"</span>meta<span class="pl-pds">"</span></span>)
    <span class="pl-c">//Column family definition</span>
    <span class="pl-c">//Inside meta, assume a column called title whose value is a string</span>
    <span class="pl-k">val</span> <span class="pl-en">title</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])
    <span class="pl-c">//Inside meta, assume a column called url whose value is a string</span>
    <span class="pl-k">val</span> <span class="pl-en">url</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">String</span>])
    <span class="pl-c">//Inside meta, assume a column called views whose value is a string</span>
    <span class="pl-k">val</span> <span class="pl-en">views</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>views<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-k">Long</span>])
    <span class="pl-c">//A column called date whose value is a Joda DateTime</span>
    <span class="pl-k">val</span> <span class="pl-en">creationDate</span> <span class="pl-k">=</span> column(meta, <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-en">DateTime</span>])

    <span class="pl-c">//A column called viewsArr whose value is a sequence of strings</span>
    <span class="pl-k">val</span> <span class="pl-en">viewsArr</span> <span class="pl-k">=</span> column(meta,<span class="pl-s"><span class="pl-pds">"</span>viewsArr<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-en">Seq</span>[<span class="pl-k">String</span>]])
    <span class="pl-c">//A column called viewsMap whose value is a map of String to Long</span>
    <span class="pl-k">val</span> <span class="pl-en">viewsMap</span> <span class="pl-k">=</span> column(meta,<span class="pl-s"><span class="pl-pds">"</span>viewsMap<span class="pl-pds">"</span></span>, <span class="pl-c1">classOf</span>[<span class="pl-en">Map</span>[<span class="pl-k">String</span>,<span class="pl-k">Long</span>]])

    <span class="pl-c">//A column family called views whose column names are Strings and values are Longs.  Can be treated as a Map</span>
    <span class="pl-k">val</span> <span class="pl-en">viewCounts</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>views<span class="pl-pds">"</span></span>)

    <span class="pl-c">//A column family called views whose column names are YearDay instances and whose values are Longs</span>
    <span class="pl-k">val</span> <span class="pl-en">viewCountsByDay</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-en">YearDay</span>, <span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>viewsByDay<span class="pl-pds">"</span></span>)

    <span class="pl-c">//A column family called kittens whose column values are the custom Kitten type</span>
    <span class="pl-k">val</span> <span class="pl-en">kittens</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>,<span class="pl-k">String</span>,<span class="pl-en">Kitten</span>](<span class="pl-s"><span class="pl-pds">"</span>kittens<span class="pl-pds">"</span></span>)
  }

  <span class="pl-k">class</span> <span class="pl-en">ExampleTableRow</span>(table<span class="pl-k">:</span><span class="pl-en">ExampleTable</span>,result<span class="pl-k">:</span><span class="pl-en">DeserializedResult</span>) <span class="pl-k">extends</span> <span class="pl-e">HRow</span>[<span class="pl-en">ExampleTable</span>,<span class="pl-k">String</span>](result,table)

  <span class="pl-c">//Register the table (DON'T FORGET TO DO THIS :) )</span>
  <span class="pl-k">val</span> <span class="pl-en">ExampleTable</span> <span class="pl-k">=</span> table(<span class="pl-k">new</span> <span class="pl-en">ExampleTable)</span>

}
</pre>
  </div> 
  <p>The above table has a column family called meta, and several strongly-typed columns in the "meta" family. It then creates several column families that do not have column definitions under them ("views" and "viewsByDay"). The reason for this is that in HBase you tend to create two different types of column families: in one scenario, you create a column family that contains a set of columns that resemble columns in an RDBMS: each column is "typed" and has a unique identity. In the second scenario, you create a column family that resembles a Map: you dynamically add key-value pairs to this family. In this second scenario, you don't know what the columns are ahead of time--you'll be adding and removing columns on the fly. HPaste supports both models.</p> 
  <h2><a id="user-content-lifecycle-management" class="anchor" href="https://github.com/gravitylabs/hpaste#lifecycle-management" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Lifecycle Management</h2> 
  <p>Because HBase prefers to have a single instance of the Configuration object for connection management purposes, HPaste does not manage any Configuration lifecycle. When you specify your schema, you need to have an implicit instance of Configuration in scope.</p> 
  <h2><a id="user-content-table-creation-scripts" class="anchor" href="https://github.com/gravitylabs/hpaste#table-creation-scripts" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Table Creation Scripts</h2> 
  <p>If you have an existing table in HBase with the same name and families, you can get started. If you don't, you can now call:</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">val</span> <span class="pl-en">create</span> <span class="pl-k">=</span> <span class="pl-en">ExampleSchema</span>.<span class="pl-en">ExampleTable</span>.createScript()
    println(create)</pre>
  </div> 
  <p>Paste the results into your hbase shell to create the table.</p> 
  <h2><a id="user-content-data-manipulation" class="anchor" href="https://github.com/gravitylabs/hpaste#data-manipulation" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Data Manipulation</h2> 
  <p>HPaste supports GETS, PUTS, and INCREMENTS. You can batch multiple operations together, or do them serially. </p> 
  <h3><a id="user-content-column-valued-operations" class="anchor" href="https://github.com/gravitylabs/hpaste#column-valued-operations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Column Valued Operations</h3> 
  <p>Column valued operations are ops that work against a particular column. Rather like a RDBMS.</p> 
  <p>The following example chains a series of operations together. We will put a title against Chris, a title against Joe, and increment Chris' "views" column by 10. If the columns do not exist, they will be lazily created as per HBase convention.</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-en">ExampleSchema</span>.<span class="pl-en">ExampleTable</span>
            .put(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>).value(_.title, <span class="pl-s"><span class="pl-pds">"</span>My Life, My Times<span class="pl-pds">"</span></span>)
            .put(<span class="pl-s"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>).value(_.title, <span class="pl-s"><span class="pl-pds">"</span>Joe's Life and Times<span class="pl-pds">"</span></span>)
            .increment(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>).value(_.views, <span class="pl-c1">10l</span>)
            .execute()</pre>
  </div> 
  <p>When you call execute(), the operations you chained together will be executed in the following order: DELETES, then PUTS, then INCREMENTS. We decided to order the operations in that way because that is how they will generally be ordered in normal use cases, and also because HBase cannot guarantee ordering in batch-operations in which increments are mixed in with deletes and puts.</p> 
  <p>If you need to enforce your own ordering, you should break your statements apart by calling execute() when you want to flush operations to HBase.</p> 
  <h3><a id="user-content-column-family-operations" class="anchor" href="https://github.com/gravitylabs/hpaste#column-family-operations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Column Family Operations</h3> 
  <p>Often times you will define a column family where the columns themselves hold data (as columns are dynamically created in HBase).</p> 
  <p>Here's the "views" column we specified in the example schema. The type parameters tell the system that we expect this column family to have a string-valued family name, a string-valued column name, and a Long value.</p> 
  <div class="highlight highlight-source-scala">
   <pre>      <span class="pl-k">val</span> <span class="pl-en">viewCounts</span> <span class="pl-k">=</span> family[<span class="pl-k">String</span>, <span class="pl-k">String</span>, <span class="pl-k">Long</span>](<span class="pl-s"><span class="pl-pds">"</span>views<span class="pl-pds">"</span></span>)</pre>
  </div> 
  <p>Because Column Families treated in this fashion resemble the Map construct most closely, that's what we support. The following will put two columns titled "Today" and "Yesterday" into the Example Table under the key 1346:</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-en">ExampleSchema</span>.<span class="pl-en">ExampleTable</span>.put(<span class="pl-c1">1346l</span>).valueMap(_.viewCounts, <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>Today<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">61l</span>, <span class="pl-s"><span class="pl-pds">"</span>Yesterday<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">86l</span>)).execute</pre>
  </div> 
  <h3><a id="user-content-serialization-creating-your-own-types" class="anchor" href="https://github.com/gravitylabs/hpaste#serialization-creating-your-own-types" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Serialization: Creating your own types</h3> 
  <p>For serialization, HPaste uses Scala's implicit parameter system, which is very handy for creating an extensible conversion library. All of HPaste's built-in serializers are contained in a package object called "schema". Here's the serializer for Strings:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">StringConverter</span> <span class="pl-k">extends</span> <span class="pl-e">ByteConverter</span>[<span class="pl-k">String</span>] {
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">toBytes</span>(<span class="pl-v">t</span>: <span class="pl-k">String</span>) <span class="pl-k">=</span> <span class="pl-en">Bytes</span>.toBytes(t)
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">fromBytes</span>(<span class="pl-v">bytes</span>: <span class="pl-en">Array</span>[<span class="pl-k">Byte</span>]) <span class="pl-k">=</span> <span class="pl-en">Bytes</span>.toString(bytes)
  }</pre>
  </div> 
  <p>To create your own serializer, follow the above pattern. Implement a ByteConverter of the type you want, and declare it as an implicit object. Any time you use a type that requires that serializer, make sure the namespace is in scope (for example, HPaste wants you to have "import com.gravity.hbase.schema._" at the top of your client code, so that all the standard serializers get imported).</p> 
  <h4><a id="user-content-complex-type-serialization--strings-slow-big-but-readable" class="anchor" href="https://github.com/gravitylabs/hpaste#complex-type-serialization--strings-slow-big-but-readable" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Complex Type Serialization : Strings (slow, big, but readable)</h4> 
  <p>If you want to create your own custom type, the easiest way to do so is to make it a string value under the covers. For example, there's a built in type in HPaste called YearDay:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">YearDay</span>(<span class="pl-v">year</span>: <span class="pl-k">Int</span>, <span class="pl-v">day</span>: <span class="pl-k">Int</span>)</pre>
  </div> 
  <p>The serializer for it is located in the "schema" package object. All it does is convert the YearDay object to a string, then serialize out the String as bytes using the Hbase Bytes helper object.</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">YearDayConverter</span> <span class="pl-k">extends</span> <span class="pl-e">ByteConverter</span>[<span class="pl-en">YearDay</span>] {
    <span class="pl-k">val</span> <span class="pl-en">SPLITTER</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>_<span class="pl-pds">"</span></span>.r
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">toBytes</span>(t<span class="pl-k">:</span><span class="pl-en">YearDay</span>) <span class="pl-k">=</span> <span class="pl-en">Bytes</span>.toBytes(t.year.toString <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>_<span class="pl-pds">"</span></span> <span class="pl-k">+</span> t.day.toString)
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">fromBytes</span>(bytes<span class="pl-k">:</span><span class="pl-en">Array</span>[<span class="pl-k">Byte</span>]) <span class="pl-k">=</span> {
      <span class="pl-k">val</span> <span class="pl-en">strRep</span> <span class="pl-k">=</span> <span class="pl-en">Bytes</span>.toString(bytes)
      <span class="pl-k">val</span> <span class="pl-en">strRepSpl</span> <span class="pl-k">=</span> <span class="pl-en">SPLITTER</span>.split(strRep)
      <span class="pl-k">val</span> <span class="pl-en">year</span> <span class="pl-k">=</span> strRepSpl(<span class="pl-c1">0</span>).toInt
      <span class="pl-k">val</span> <span class="pl-en">day</span> <span class="pl-k">=</span> strRepSpl(<span class="pl-c1">1</span>).toInt
      <span class="pl-en">YearDay</span>(year,day)
    }
  }</pre>
  </div> 
  <p>This means that YearDay objects will be human readable when you look at them in HBase, and also it means it's mentally easier to reason about the layout of the object when you're extending it.</p> 
  <p>That having been said, string-based serialization is the lowest common denominator when it comes to speed and size of data. The next section describes custom byte serialization.</p> 
  <h4><a id="user-content-complex-type-serialization--byte-arrays-fast-small-unreadable" class="anchor" href="https://github.com/gravitylabs/hpaste#complex-type-serialization--byte-arrays-fast-small-unreadable" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Complex Type Serialization : Byte Arrays (fast, small, unreadable)</h4> 
  <p>Because ByteConverter (and by proxy HBase) just needs byte arrays, you can extend the class with any serializer framework you want (Thrift, Avro, etc.).</p> 
  <p>HPaste does have some extra support for the simplest, most performant, and most dangerous Java serialization framework: DataInputStream and DataOutputStream. To use this, you can inherit from ComplexByteConverter. This will provide a DataInputStream when bytes need to be serialized to your type, and a DataOutputStream when it's time for your object to become a byte array.</p> 
  <p>Let's say you have a class Kitten:</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">Kitten</span>(name<span class="pl-k">:</span><span class="pl-k">String</span>, age<span class="pl-k">:</span><span class="pl-k">Int</span>, height<span class="pl-k">:</span><span class="pl-k">Double</span>)</pre>
  </div> 
  <p>The following defines a serializer for Kitten:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">KittenConverter</span> <span class="pl-k">extends</span> <span class="pl-e">ComplexByteConverter</span>[<span class="pl-en">Kitten</span>] {
    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">write</span>(kitten<span class="pl-k">:</span><span class="pl-en">Kitten</span>, output<span class="pl-k">:</span><span class="pl-en">DataOutputStream</span>)  {
      output.writeUTF(kitten.name)
      output.writeInt(kitten.age)
      output.writeDouble(kitten.height)
    }

    <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">read</span>(input<span class="pl-k">:</span><span class="pl-en">DataInputStream</span>) <span class="pl-k">=</span> {
      <span class="pl-en">Kitten</span>(input.readUTF(), input.readInt(), input.readDouble())
    }
  }</pre>
  </div> 
  <p>WARNING: There are a lot of production issues with using raw serialization this way. They mainly revolve around versioning. What if you want to change the layout of Kitten later? The above method of serializing uses no metadata. The bytestream is just a bunch of undifferentiated primitives. If you, for example, add a new Int value before the Name, the deserializer will, when it encounters older objects, read the first bytes of the Name as the Int. In that situation you'll need to write a tool that massages the old Kitten byte-layout into the new Kitten byte-layout. Better serialization frameworks do a better job of handling this situation. HPaste will soon support Avro out of the box. That having been said, as long as you're mindful about what you're doing, DataInput and DataOutput are blazingly fast and leave a tiny data footprint--if you confine yourself to relative immutable type definitions, you can go far with this model.</p> 
  <h3><a id="user-content-sequences-maps-and-sets" class="anchor" href="https://github.com/gravitylabs/hpaste#sequences-maps-and-sets" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Sequences, Maps, and Sets</h3> 
  <p>Once you have a serializer for a type, you can (fairly) easily define a serializer that lets you define a Set, Map, or Seq of that object. The below assumes you already have a ByteConverter for a Kitten object, and will now support column values that are sequences.</p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">implicit</span> <span class="pl-k">object</span> <span class="pl-en">KittenSeqConverter</span> <span class="pl-k">extends</span> <span class="pl-e">SeqConverter</span>[<span class="pl-en">Kitten</span>]</pre>
  </div> 
  <p>NOTE: The above way of defining a sequence is clumsy, agreed. Need to refactor.</p> 
  <h3><a id="user-content-mixing-modification-operations" class="anchor" href="https://github.com/gravitylabs/hpaste#mixing-modification-operations" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Mixing Modification Operations</h3> 
  <p>You can mix column-valued and column family operations into the same call.</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-en">ExampleSchema</span>.<span class="pl-en">ExampleTable</span>
            .put(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>).value(_.title, <span class="pl-s"><span class="pl-pds">"</span>My Life, My Times<span class="pl-pds">"</span></span>)
            .put(<span class="pl-s"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>).value(_.title, <span class="pl-s"><span class="pl-pds">"</span>Joe's Life and Times<span class="pl-pds">"</span></span>)
            .put(<span class="pl-s"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>).value(_.viewsArr,<span class="pl-en">Seq</span>(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>Bissell<span class="pl-pds">"</span></span>))
            .increment(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>).value(_.views, <span class="pl-c1">10l</span>)
            .put(<span class="pl-s"><span class="pl-pds">"</span>Chris<span class="pl-pds">"</span></span>).valueMap(_.viewCountsByDay, <span class="pl-en">Map</span>(<span class="pl-en">YearDay</span>(<span class="pl-c1">2011</span>,<span class="pl-c1">16</span>)<span class="pl-k">-</span><span class="pl-k">&gt;</span><span class="pl-c1">60l</span>, <span class="pl-en">YearDay</span>(<span class="pl-c1">2011</span>,<span class="pl-c1">17</span>)<span class="pl-k">-</span><span class="pl-k">&gt;</span><span class="pl-c1">50l</span>))
            .execute()</pre>
  </div> 
  <h1><a id="user-content-data-retrieval" class="anchor" href="https://github.com/gravitylabs/hpaste#data-retrieval" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Data Retrieval</h1> 
  <ol> 
   <li><p>Creating a specification for your Get operation, in which you decide what rows to get back, what columns and column families to get back.</p></li> 
   <li><p>When you issue the retrieval operation and get the results back, extracting the results into useful data.</p></li> 
  </ol> 
  <p>Assuming the examples under the DATA MANIPULATION section, the following will retrieve a Map of String to Long out of the Example Table:</p> 
  <div class="highlight highlight-source-scala">
   <pre>    <span class="pl-k">val</span> <span class="pl-en">dayViewsRes</span> <span class="pl-k">=</span> <span class="pl-en">ExampleSchema</span>.<span class="pl-en">ExampleTable</span>.query.withKey(key).withColumnFamily(_.viewCountsByDay).single()
    <span class="pl-k">val</span> <span class="pl-en">dayViewsMap</span> <span class="pl-k">=</span> dayViewsRes.family(_.viewCountsByDay)</pre>
  </div> 
  <h1><a id="user-content-more-on-mapreduce-support" class="anchor" href="https://github.com/gravitylabs/hpaste#more-on-mapreduce-support" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>More on MapReduce support</h1> 
  <h2><a id="user-content-row-serialization-between-mappers-and-reducers" class="anchor" href="https://github.com/gravitylabs/hpaste#row-serialization-between-mappers-and-reducers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Row Serialization between Mappers and Reducers</h2> 
  <p>HRows can be serialized between Mappers and Reducers, using the writeRow and readRow methods of PrimitiveOutputStream and PrimitiveInputStream.</p> 
  <p>This is often the least performant way of passing data between mappers and reducers (depending on how big your rows are), but also involves the least amount of code.</p> 
  <p>Below is a job that assumes the same WebCrawling schema in the Quickstart. Its goal is to write output files that show page by the site they're contained in. We've added a convenience function to the WebPageRow to extract the domain:</p> 
  <div class="highlight highlight-source-scala">
   <pre>  <span class="pl-k">class</span> <span class="pl-en">WebPageRow</span>(<span class="pl-v">table</span>: <span class="pl-en">WebTable</span>, <span class="pl-v">result</span>: <span class="pl-en">DeserializedResult</span>) <span class="pl-k">extends</span> <span class="pl-e">HRow</span>[<span class="pl-en">WebTable</span>, <span class="pl-k">String</span>](result, table) {
    <span class="pl-k">def</span> <span class="pl-en">domain</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">URL</span>(rowid).getAuthority
  }</pre>
  </div> 
  <p>Here is the job. </p> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">class</span> <span class="pl-en">WebTablePagesBySiteJob</span> <span class="pl-k">extends</span> <span class="pl-e">HJob</span>[<span class="pl-en">NoSettings</span>](<span class="pl-s"><span class="pl-pds">"</span>Get articles by site<span class="pl-pds">"</span></span>,
  <span class="pl-en">HMapReduceTask</span>(
    <span class="pl-en">HTaskID</span>(<span class="pl-s"><span class="pl-pds">"</span>Articles by Site<span class="pl-pds">"</span></span>),
    <span class="pl-en">HTaskConfigs</span>(),
    <span class="pl-en">HIO</span>(
      <span class="pl-en">HTableInput</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>),
      <span class="pl-en">HPathOutput</span>(<span class="pl-s"><span class="pl-pds">"</span>/reports/wordcount<span class="pl-pds">"</span></span>)
    ),
    <span class="pl-k">new</span> <span class="pl-en">FromTableBinaryMapperFx</span>(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>) {
      <span class="pl-k">val</span> <span class="pl-en">webPage</span> <span class="pl-k">:</span> <span class="pl-en">WebPageRow</span> <span class="pl-k">=</span> row <span class="pl-c">//For illustrative purposes we're specifying the type here, no need to</span>
      <span class="pl-k">val</span> <span class="pl-en">domain</span> <span class="pl-k">=</span> row.domain <span class="pl-c">//We've added a convenience method to WebPageRow to extract the domain for us</span>

      write(
      {keyOutput<span class="pl-k">=&gt;</span>keyOutput.writeUTF(domain)}, <span class="pl-c">//This writes out the domain as the key</span>
      {valueOutput<span class="pl-k">=&gt;</span>valueOutput.writeRow(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>,webPage)} <span class="pl-c">//This writes the entire value of the row out</span>
      )
    },
    <span class="pl-k">new</span> <span class="pl-en">BinaryToTextReducerFx</span> {
      <span class="pl-k">val</span> <span class="pl-en">domain</span> <span class="pl-k">=</span> readKey(_.readUTF()) <span class="pl-c">//This allows you to read out the key</span>

      perValue{valueInput<span class="pl-k">=&gt;</span>
        <span class="pl-k">val</span> <span class="pl-en">webPage</span> <span class="pl-k">:</span> <span class="pl-en">WebPageRow</span> <span class="pl-k">=</span> valueInput.readRow(<span class="pl-en">WebCrawlingSchema</span>.<span class="pl-en">WebTable</span>) <span class="pl-c">//Now you can read out the entire WebPageRow object from the value stream</span>
        ctr(<span class="pl-s"><span class="pl-pds">"</span>Pages for domain <span class="pl-pds">"</span></span> <span class="pl-k">+</span> domain)
        writeln(domain <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> webPage.column(_.title).getOrElse(<span class="pl-s"><span class="pl-pds">"</span>No Title<span class="pl-pds">"</span></span>)) <span class="pl-c">//This is a convenience function that writes a line to the text output</span>
      }
    }
  )
)
</pre>
  </div> 
  <p>This job is part of HPaste's unit tests, so you can see it in context at <a href="https://github.com/GravityLabs/HPaste/blob/master/src/test/scala/com/gravity/hbase/schema/WebCrawlSchemaTest.scala" target="_blank">WebCrawlSchemaTest.scala</a>.</p> 
  <h1><a id="user-content-developers" class="anchor" href="https://github.com/gravitylabs/hpaste#developers" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Developers</h1> 
  <p>This library was developed by <a href="https://github.com/Lemmsjid" title="Lemmsjid" target="_blank">Chris Bissell</a>, with many contributions, both philosophical and code, by <a href="https://github.com/erraggy" title="erraggy" target="_blank">Robbie Coleman</a>.</p> 
 </article>
</div>